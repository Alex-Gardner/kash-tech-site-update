function wcStartApplication(){if(typeof String.prototype.endsWith!=="function")String.prototype.endsWith=function(suffix){return this.indexOf(suffix,this.length-suffix.length)!==-1};ibx.deferredExceptionHook(false);window.wcapplication=new wcApplication;var wcxapi=arguments[1];var params=arguments;window.wcapplication.init(arguments[0],function(){var input=[];if(wcapplication.csrftokenname!="")input.push({name:wcapplication.csrftokenname,value:wcapplication.csrftokenvalue});input.push({name:"IBIS_page",
value:"NLSSTR"});var hdrs={};hdrs["Accept"]="application/json";$.ajax({method:"POST",dataType:"json",headers:hdrs,url:wcapplication.wcurl,data:input,success:function(result){ibx.resourceMgr.addStringBundle(result)}});window.addEventListener("ibx_ibxresmgr_resolveuri",function(e){if(!e.data)return;var url=e.data.uri;if(/^\{res\}/.test(url)){var str="";var idx=wcapplication.wcurl.lastIndexOf("/webconsole");if(idx)str=wcapplication.wcurl.substring(0,idx);e.data.uri=url.replace("{res}",str)}else if(/^\{context\}/.test(url)){var str=
url.replace("{context}","");e.data.uri=ibx.resourceMgr.getContextPath().replace(/\/ibx\/.+/,str)}else if(/^\{wcstrurl\}/.test(url))e.data.uri=url.replace("{wcstrurl}",wcapplication.wcurl)+"&IBIS_page=NLSSTR"});var path=ibx.resourceMgr.getContextPath().replace(/\/ibx\/.+/,"/ibxtools");ibx.resourceMgr.addBundles([path+"/shared_resources/shared_resource_bundle.xml",path+"/rs/common/common_bundle.xml",path+"/rs/aceeditor/aceeditor_bundle.xml"]).done(function(){try{try{if(window.self===window.top){$(window).off("beforeunload");
$(window).on("beforeunload",function(e){if(wcapplication.reload||$(".wcx-webfocus-logo-tool").length==0)return;if(window.opener&&window.opener.noleavediag)return;e.preventDefault();e.returnValue="";return""})}}catch(e){}var container=new WcxWidget;container.setOption("focusRoot",true);container._element.attr("tabindex","-1").css("width","100%").css("height","100%");wcapplication.add(container);wcapplication.topframe=new WcxVBox;wcapplication.toppage=wcapplication.topframe;wcapplication.topframe._element.addClass("wcx-topframe");
container.add(wcapplication.topframe);if(!wcxapi){wcapplication.statusbar=new WcxHBox;wcapplication.statusbar._element.addClass("wcx-statusbar");container.add(wcapplication.statusbar);wcapplication.statusbar._element.hide()}wcapplication.topframe._element.css("bottom","0px");var category=sessionStorage.getItem("page_category");if(category){wcapplication.gspx_category=category;sessionStorage.removeItem("page_category")}var pageset=false;var xml=new WcLoader;xml.addParam("IBIS_login","y");for(var i=
2;i<params.length;++i){var eq=params[i].indexOf("=");if(eq==-1)continue;if(params[i].substring(0,eq)=="IBIS_page"){xml.setUrl(wcapplication.wcurl+"/"+params[i].substring(eq+1));pageset=true;continue}xml.addParam(params[i].substring(0,eq),unescape(params[i].substring(eq+1)))}if(!pageset){xml.setUrl(wcapplication.wcurl+"/MAIN");if(window.name=="")window.name="wchome"}xml.load(function(rsp,data){wcStartMonitor();wcxParseXml(rsp,data)},wcapplication.topframe)}catch(e){}})})}
function wcApplication(){this._counters=[];this._wcfobjects=[];this._jsIsBusyFlag=false;this._jsIsBusyStack=[];this.imgstr={};this.nlsstr={};window.addEventListener("dragover",function(e){e=e||event;e.preventDefault()},false);window.addEventListener("drop",function(e){e=e||event;e.preventDefault()},false)}
wcApplication.prototype.init=function(file,callback){$.ajax({method:"GET",url:file,dataType:"xml"}).done(function(data){var script=data.documentElement.getElementsByTagName("script");for(var i=0;i<script.length;++i)for(var j=0;j<script[i].childNodes.length;++j)if(script[i].childNodes[j].nodeName=="#cdata-section")eval(script[i].childNodes[j].nodeValue);callback()}).fail(function(jqXHR,textStatus,errorThrown){alert("failed to load "+file)})};
wcApplication.prototype.jsIsBusyStart=function(noStack){if(noStack)this._jsIsBusyFlag=true;else{var now=new Date;this._jsIsBusyStack.push(now)}$("body").removeAttr("style");$("body").attr("jsisbusy","true");var elem=$("#jsisbusy");if(elem.length==0)$("body").prepend($("<div></div>").attr("id","jsisbusy").css("display","none"))};
wcApplication.prototype.jsIsBusyFinish=function(noStack){if(noStack)this._jsIsBusyFlag=false;else this._jsIsBusyStack.pop();if(!this._jsIsBusyFlag&&this._jsIsBusyStack.length<1){$("body").removeAttr("jsisbusy");$("#jsisbusy").remove()}if(this._jsIsBusyStack.length<1){$("body").addClass("wcisloaded");$("body").attr("wcisloaded","true")}};
wcApplication.prototype.setGlassPaneVisible=function(visible){if(visible){if(!wcapplication._glasspane){wcapplication._glasspanevisible=0;wcapplication._glasspane=$("<div></div>");wcapplication._glasspane.addClass("wcx-glasspane");$("body").append(wcapplication._glasspane)}if(wcapplication._glasspanevisible++==0)this._glasspane.css("width","100%").css("height","100%").css("cursor","progress")}else if(wcapplication._glasspane)if(--wcapplication._glasspanevisible==0)this._glasspane.css("width","0px").css("height",
"0px").css("cursor","default")};wcApplication.prototype.add=function(obj){$("body").append(obj._element)};wcApplication.prototype.remove=function(obj){if(obj)$("#"+obj._id).remove()};wcApplication.prototype.setWcfObject=function(wcfobj){if(wcfobj.getName){var name=wcfobj.getName();for(var i=this._wcfobjects.length-1;i>=0;i--)if(this._wcfobjects[i].getName()==name){this._wcfobjects[i]=wcfobj;return}}this._wcfobjects.push(wcfobj)};
wcApplication.prototype.getWcfObject=function(name){for(var i=this._wcfobjects.length-1;i>=0;i--)if(this._wcfobjects[i].getName()==name){if(!this._wcfobjects[i]._disposed)return this._wcfobjects[i];this._wcfobjects.splice(i,1);return null}for(var i=this._wcfobjects.length-1;i>=0;i--)if(this._wcfobjects[i].constructor.name==name){if(!this._wcfobjects[i]._disposed)return this._wcfobjects[i];this._wcfobjects.splice(i,1);return null}for(var i=this._wcfobjects.length-1;i>=0;i--){var wcfStr=this._wcfobjects[i].constructor.toString();
wcfStr=wcfStr.split(" ")[1].split("(")[0];if(wcfStr==name){if(!this._wcfobjects[i]._disposed)return this._wcfobjects[i];this._wcfobjects.splice(i,1);return null}}return null};wcApplication.prototype.clrWcfObject=function(wcfobj){try{for(var i=0;i<this._wcfobjects.length;i++)if(this._wcfobjects[i]==wcfobj){this._wcfobjects.splice(i,1);break}}catch(e){}};
wcApplication.prototype.isWebconsoleRequest=function(url){if(!url)return false;var idx=url.lastIndexOf("/webconsole");if(idx==-1){if(url.lastIndexOf("webconsole/admin")>=0)return true;return false}var idx2=url.toLowerCase().indexOf("/webconsole/iwaynode_");if(idx2==-1||idx>idx2)return true;return false};wcApplication.prototype.setLocalStorageItem=function(name,value){localStorage.setItem(this.localstorageID+"-"+name,value)};
wcApplication.prototype.getLocalStorageItem=function(name){return localStorage.getItem(this.localstorageID+"-"+name)};wcApplication.prototype.removeLocalStorageItem=function(name){localStorage.removeItem(this.localstorageID+"-"+name)};wcApplication.prototype.setSessionStorageItem=function(name,value){sessionStorage.setItem(this.localstorageID+"-"+name,value)};wcApplication.prototype.getSessionStorageItem=function(name){return sessionStorage.getItem(this.localstorageID+"-"+name)};
wcApplication.prototype.removeSessionStorageItem=function(name){sessionStorage.removeItem(this.localstorageID+"-"+name)};
function wcStartMonitor(){if(wcapplication.nowebsocket)return;if(wcapplication.msocket)return;if("WebSocket"in window){var url;if(location.protocol=="https:")url="wss";else url="ws";url+="://"+location.host+wcapplication.wcurl+"@IBIS_page=WCCONTROL";wcapplication.msocket=new WebSocket(url);wcapplication.msocket.onopen=function(){wcapplication.msocket.send("ping")};wcapplication.msocket.onerror=function(error){wcapplication.msocket=null};wcapplication.msocket.onclose=function(){wcapplication.msocket=
null};wcapplication.msocket.onmessage=function(e){if(!wcapplication)return;wcapplication.msocket.send("p");var pos=e.data.indexOf(" ");if(pos<=0){if(e.data=="ALIVE")return}else{var command=e.data.substring(0,pos);if(command=="WARNINGMSG")new WcMessageDialog(e.data.slice(pos+1),"warning","ok");else if(command=="REFRESHOBJ"){var wcobjid=e.data.slice(pos+1);var id=wcobjid.split(" ");var xlink={};xlink.http_target="TARGET_OBJ";xlink.winname=id[0];var n=id.slice(1);if(n.length>0){xlink.winname2=n[0];if(n.length>
1)xlink.winname3=n[1]}wcExecLink(xlink)}else if(command=="NEWMODAL"){var postdata=e.data.slice(pos+1);if(postdata)alert("wcStartMonitor: "+postdata)}}}}}var _wcconstructing=false;function wcInherit(newclass,base){_wcconstructing=true;var p=newclass.prototype=new base;p.constructor=newclass;_wcconstructing=false;return p}
function WcxComponent(type){if(_wcconstructing)return;this._children=[];if(!type)type="wcxbase";var x=wcapplication._counters[type];var num=0;if(x!=null)num=parseInt(x);++num;this._disposed=false;this._objtype=type;this._id=type+"-"+num;wcapplication._counters[type]=num;this._element=$("<div>").attr("id",this._id).addClass("wcxcomponent");this._element.data("wcobj",this)}_p=wcInherit(WcxComponent,Object);_p.dispose=function(){if(this._disposeCallback)this._disposeCallback(this);this._disposed=true};
_p.setDispose=function(fn){this._disposeCallback=fn};_p.setWcId=function(value){this._wcid=value;this._element.attr("wcid",value)};_p._setQaAttr=function(value){setQaAttrToElement(this._element,value)};_p.setUserData=function(data){this._userdata=data};_p.getUserData=function(){return this._userdata};_p.setName=function(name){this._name=name;this._setQaAttr(name)};_p.getName=function(){return this._name};_p.getChildren=function(){return this._children};
_p.setCursor=function(cursor){this._element.css("cursor",cursor)};_p.setHeight=function(height){this._element.css("height",height+"px")};_p.getHeight=function(){return this._element.outerHeight(true)};_p.setWidth=function(width){this._element.css("width",width+"px")};_p.getWidth=function(){return this._element.outerWidth(true)};_p.setTop=function(pixel){this._element.css("top",pixel+"px")};_p.getTop=function(){var str=this._element.css("top");if(str)return parseInt(str.match(/\d+/));return 0};
_p.setLeft=function(pixel){this._element.css("left",pixel+"px")};_p.getLeft=function(){var str=this._element.css("left");if(str)return parseInt(str.match(/\d+/));return 0};_p.setRight=function(pixel){this._element.css("right",pixel+"px")};_p.setBottom=function(pixel){this._element.css("bottom",pixel+"px")};_p.getElement=function(){return this._element};_p.setVisible=function(visible){if(visible)this._element.show();else this._element.hide()};_p.getVisible=function(){return this._element.is(":visible")};
_p.setOption=function(name,value){if(this._element){var option={};option[name]=value;this._element.ibxWidget(option)}};_p.getInstance=function(){return this._element.ibxWidget("instance")};_p.addEventListener=function(evt,handler,obj){if(evt&&handler)this._element.on(evt,handler.bind(obj?obj:this))};_p.removeEventListener=function(evt,handler){this._element.off(evt,handler)};
_p.add=function(child){if(child==null)return;this._children.push(child);this._element.append(child._element);return this._children.length-1};_p.prepend=function(child){if(child==null)return;this._children.unshift(child);this._element.prepend(child._element);return 0};
_p.insertAfter=function(child,after){if(child==null)return;if(!after)return this.add(child);var idx=this._children.indexOf(after);if(idx==-1)return this.add(child);this._children.splice(idx+1,0,child);child._element.insertAfter(after._element);return idx+1};
_p.insertBefore=function(child,before){if(child==null)return;if(!before)return this.add(child);var idx=this._children.indexOf(before);if(idx==-1)return this.add(child);this._children.splice(idx,0,child);child._element.insertBefore(before._element);return idx};_p.remove=function(child){if(child==null)return;child.removeAll();var index=this._children.indexOf(child);if(index>=0)this._children.splice(index,1);$(child._element).remove()};
_p.removeAll=function(){for(var i=0;i<this._children.length;++i){this._children[i].removeAll();this._children[i].dispose()}this._children=[];this._element.empty()};_p.setTitle=function(title){if(title){this._element.attr("title",title);setQaAttrToElement(this._element,title)}};function WcxWidget(){if(_wcconstructing)return;WcxComponent.call(this,"ibxWidget");this._element.ibxWidget()}_p=wcInherit(WcxWidget,WcxComponent);
_p.setDragStartEventListener=function(handler,obj){if(handler)this._element.on("ibx_dragstart",handler.bind(obj?obj:this))};_p.setDragLeaveEventListener=function(handler,obj){if(handler)this._element.on("ibx_dragleave",handler.bind(obj?obj:this))};_p.setDragOverEventListener=function(handler,obj){if(handler)this._element.on("ibx_dragover",handler.bind(obj?obj:this))};_p.setDropEventListener=function(handler,obj){if(handler)this._element.on("ibx_drop",handler.bind(obj?obj:this))};
_p.setResizeEventListener=function(handler,obj){if(handler){var thisObj=this;this._element.ready(function(){try{thisObj._element.ibxWidget("option","wantResize",true).on("ibx_resize",handler.bind(obj?obj:thisObj))}catch(err){}})}};_p.addItem=function(item){this._element.ibxWidget("add",item)};function WcxHBox(){if(_wcconstructing)return;WcxComponent.call(this,"ibxHBox");this._element.ibxHBox()}_p=wcInherit(WcxHBox,WcxWidget);
function WcxVBox(){if(_wcconstructing)return;WcxComponent.call(this,"ibxVBox");this._element.ibxVBox()}_p=wcInherit(WcxVBox,WcxComponent);
function WcxLabel(text,html,icon){if(_wcconstructing)return;WcxComponent.call(this,"ibxLabel");this._text=text?text:"";this._iconname="";this._iconcolor="";var options={};options.text=this._text;if(html!==undefined)options.textIsHtml=html;if(icon){if(wcxIsIconFont(icon)){var font=wcxGetIconFontName(icon);options.glyph=font.name;options.glyphClasses=font.class}else options.icon=icon;this._iconname=icon}this._element.ibxLabel(options);this._element.on("keydown",this.doKeyDown)}
_p=wcInherit(WcxLabel,WcxComponent);_p.doKeyDown=function(e){if(e.keyCode==32||e.keyCode==13)$(e.currentTarget).trigger("click")};_p.setText=function(text){this._text=text?text:"";this._element.ibxWidget({"text":this._text});this._setQaAttr(text)};_p.getText=function(){return this._text};_p.showText=function(){this._element.ibxWidget({"text":this._text?this._text:""})};_p.hideText=function(){this._element.ibxWidget({"text":""})};
_p.setIcon=function(name){if(wcxIsIconFont(name)){var font=wcxGetIconFontName(name);this._element.ibxWidget({"glyph":font.name,"glyphClasses":font.class})}else this._element.ibxWidget({"icon":name});this._iconname=name};_p.getIcon=function(){return this._iconname};_p.setIconSize=function(size){this._element.children(".ibx-label-glyph").css("font-size",size+"px")};
_p.setIconColor=function(color){if(color){this._element.children(".ibx-label-glyph").css("color",color).css("opacity","1");this._iconcolor=color}};_p.getIconColor=function(){return this._iconcolor};_p.setColor=function(color){if(color)this._element.children(".ibx-label-text").css("color",color).css("opacity","1")};_p.setSize=function(size){this._element.children(".ibx-label-text").css("font-size",size+"px")};_p.setIconPosition=function(pos){this._element.ibxWidget({"iconPosition":pos})};
_p.setBold=function(bold){this._element.children(".ibx-label-text").css("font-weight",bold?"bold":"normal")};_p.setWrap=function(wrap){this._element.ibxWidget({"textWrap":wrap})};_p.setJustify=function(value){this._element.ibxWidget({"justify":value})};_p.addEventListenerToLabel=function(evt,handler,obj){if(evt&&handler)this._element.children(".ibx-label-text").on(evt,handler.bind(obj?obj:this))};
function WcxButton(text){if(_wcconstructing)return;WcxComponent.call(this,"ibxButton");if(text&&text!=""){this._element.ibxButton({"text":text});this._text=text;this._setQaAttr(text)}else{this._element.ibxButton();this._text=""}$(this._element).attr("tabindex","0")}_p=wcInherit(WcxButton,WcxLabel);_p.setEnabled=function(enabled){this._disabled=!enabled;if(enabled){this._element.ibxWidget("enable",true);this._element.removeClass("ds-disabled")}else{this._element.ibxWidget("disable",true);this._element.addClass("ds-disabled")}};
_p.getEnabled=function(){return!this._disabled};_p.setHighlighted=function(highlighted){if(highlighted)this._element.addClass("wcx-highlighted");else this._element.removeClass("wcx-highlighted")};_p.getHighlighted=function(){return this._element.hasClass("wcx-highlighted")};_p.setSize=function(size){this._element.css("font-size",size+"px")};
function WcxButtonSimple(text,icon,ariaText){if(_wcconstructing)return;WcxComponent.call(this,"ibxButtonSimple");this._text=text?text:"";this._iconname="";this._iconcolor="";var options={};options.text=this._text;if(icon){this._iconname=icon;if(wcxIsIconFont(icon)){var font=wcxGetIconFontName(icon);options.glyph=font.name;options.glyphClasses=font.class}else options.icon=icon;var imgclass=icon.replace(/ /g,"-");imgclass=imgclass.replace(/\./g,"_");$(this._element).addClass("wcx-"+imgclass)}if(ariaText)options.aria=
{label:ariaText};this._element.ibxButtonSimple(options);$(this._element).attr("tabindex","0");this._element.on("keydown",this.doKeyDown);this._element.on("focus",this.doFocus);this._setQaAttr(this._text)}_p=WcxButtonSimpleProto=wcInherit(WcxButtonSimple,WcxButton);
_p.doKeyDown=function(e){var keyCode=e.keyCode;var target=e.currentTarget;var parent=$(target).parent();var is_vertical=parent.hasClass("ibx-flexbox-vertical");var container=null;var buttons=null;if(parent.hasClass("wcx-ribbon-vbox")){is_vertical=false;container=parent.closest(".wcx-ribbon");buttons=container.find(".wcx-ribbon-button:not(.ibx-widget-disabled)")}else if(parent.hasClass("wcx-mainmenu-bar-left")||parent.hasClass("wcx-mainmenu-bar-right")){container=parent.closest(".wcx-mainmenu-bar");
buttons=container.find(".ibx-button-simple:not(.ibx-widget-disabled)")}else if(parent.hasClass("wcx-left-main-menu"))buttons=parent.find(".ibx-button-simple:not(.ibx-widget-disabled)");else{container=$(target).closest(".wcx-toolbar");if(container&&container.length>0)buttons=container.find(".ibx-button-simple:not(.ibx-widget-disabled)")}var hasButtons=buttons&&buttons.length>1;if(keyCode==32||keyCode==13);else if(hasButtons){var currIndex=-1;for(var i=0;i<buttons.length;i++){var btn=buttons[i];if(btn==
target){currIndex=i;break}}if(is_vertical)if(keyCode==38){var prevIndex=currIndex-1;if(prevIndex<0)prevIndex=buttons.length-1;var prevButton=buttons[prevIndex];prevButton.focus();var hasSub=$(prevButton).hasClass("wcx-button-pulldown");if(hasSub)$(prevButton).trigger("click")}else{if(keyCode==40){var nextIndex=currIndex+1;if(nextIndex>=buttons.length)nextIndex=0;var nextButton=buttons[nextIndex];nextButton.focus();var hasSub=$(nextButton).hasClass("wcx-button-pulldown");if(hasSub)$(nextButton).trigger("click")}}else if(keyCode==
37){var prevIndex=currIndex-1;if(prevIndex<0)prevIndex=buttons.length-1;var prevButton=buttons[prevIndex];prevButton.focus();var hasSub=$(prevButton).hasClass("wcx-button-pulldown");if(hasSub)$(prevButton).trigger("click")}else if(keyCode==39){var nextIndex=currIndex+1;if(nextIndex>=buttons.length)nextIndex=0;var nextButton=buttons[nextIndex];nextButton.focus();var hasSub=$(nextButton).hasClass("wcx-button-pulldown");if(hasSub)$(nextButton).trigger("click")}else if(keyCode==40||keyCode==93){var hasSub=
$(target).hasClass("wcx-button-pulldown");if(hasSub)$(target).trigger("click")}}};
_p.doFocus=function(e){var activeEl=document.activeElement;if(activeEl){var modal=$(activeEl).closest(".ds-modal.pop-top");if(modal&&modal.length)return;modal=$(document.body).find(".ds-modal.pop-top");if(modal&&modal.length){var frame=modal.find("iframe");if(frame&&frame.length){frame.focus();var frameBody=frame.contents().find("body");var button=frameBody.find(".ds-modal-header .ds-modal-header-close");if(button&&button.length)$(button).focus()}}}};
function WcxHSplitMenuButton(text,icon){if(_wcconstructing)return;WcxComponent.call(this,"ibxHSplitMenuButton");this._text=text?text:"";var options={};options.text=this._text;if(icon)if(wcxIsIconFont(icon)){var font=wcxGetIconFontName(icon);options.glyph=font.name;options.glyphClasses=font.class}else options.icon=icon;this._element.ibxHSplitMenuButton(options);this._element.addClass("wcx-hsplitmenubutton");$(this._element).attr("tabindex","0");this._element.on("keydown",this.doKeyDown);this._setQaAttr(this._text)}
_p=wcInherit(WcxHSplitMenuButton,WcxButtonSimple);_p.doKeyDown=WcxButtonSimpleProto.doKeyDown;_p.addMenu=function(menu){this._element.ibxWidget("menu",menu._element)};function WcxMonoTree(handler,obj){if(_wcconstructing)return;WcxComponent.call(this,"ibxTreeBrowser");this._element.ibxTreeBrowser();this._element.addClass("wcx-tree-browser");this._element.css("width","100%");if(handler)$(this._element).on("ibx_beforeexpand ibx_beforecollapse",handler.bind(obj?obj:this))}_p=wcInherit(WcxMonoTree,WcxComponent);
_p.createNode=function(createOptions){var isfolder=createOptions.isfolder;var nodeOptions={"container":isfolder,"draggable":createOptions.draggable?createOptions.draggable:!isfolder,"expanded":false,"labelOptions":{"text":createOptions.text,"glyph":createOptions.glyph?createOptions.glyph:"","glyphClasses":createOptions.glyphClasses?createOptions.glyphClasses:isfolder?"ds-icon-folder-closed-outline":""}};var treeNode=$("<div>").ibxTreeBrowserNode(nodeOptions).ibxAddClass(isfolder?"folder":"file").ibxAddClass("wcx-tree-node");
treeNode.attr("qa",createOptions.text);if(createOptions.title)treeNode.attr("title",createOptions.title);return treeNode};_p.addNode=function(treeNode){this._element.ibxWidget("add",treeNode)};function WcxTree(handler,obj){if(_wcconstructing)return;WcxComponent.call(this,"ibxTree");this._element.ibxTree();this._element.css("width","100%");if(handler)$(this._element).on("ibx_beforeexpand ibx_beforecollapse",handler.bind(obj?obj:this))}_p=wcInherit(WcxTree,WcxComponent);
_p.createNode=function(createOptions){var isfolder=createOptions.isfolder;var nodeOptions={"container":isfolder,"draggable":createOptions.draggable?createOptions.draggable:!isfolder,"expanded":createOptions.expanded,"btnCollapsed":"wcx-tree-btn-collapsed","btnExpanded":"wcx-tree-btn-expanded","labelOptions":{"text":createOptions.text}};var treeNode=$("<div>").ibxTreeNode(nodeOptions).ibxAddClass(isfolder?"folder":"file").ibxAddClass("wcx-tree-node");treeNode.attr("qa",createOptions.text);return treeNode};
_p.addNode=function(treeNode){this._element.ibxWidget("add",treeNode)};function WcxHCarousel(){if(_wcconstructing)return;WcxComponent.call(this,"ibxHCarousel");this._element.ibxHCarousel({"showPageMarkers":false,"prevNextButtonPos":"end"});this._element.css("width","100%")}_p=wcInherit(WcxHCarousel,WcxComponent);_p.addItem=function(item){this._element.ibxWidget("add",item._element,null,null,true)};
_p.insertItem=function(item,sibling){this._element.ibxWidget("add",item._element,sibling._element,true,true)};_p.removeItem=function(item){this._element.ibxWidget("remove",item._element,true)};_p.getAllItems=function(){return this._element.ibxWidget("children","*")};function WcxVCarousel(){if(_wcconstructing)return;WcxComponent.call(this,"ibxVCarousel");this._element.ibxVCarousel({"showPageMarkers":false,"prevNextButtonPos":"end"});this._element.css("width","100%")}_p=wcInherit(WcxVCarousel,WcxComponent);
_p.addItem=function(item){this._element.ibxWidget("add",item._element,null,null,true)};_p.insertItem=function(item,sibling){this._element.ibxWidget("add",item._element,sibling._element,true,true)};_p.removeItem=function(item){this._element.ibxWidget("remove",item._element,true)};_p.getAllItems=function(){return this._element.ibxWidget("children","*")};
function WcxDialog(type,buttons){if(_wcconstructing)return;WcxComponent.call(this,"ibxDialog");if(!buttons)buttons="okcancel";else if(buttons=="yesnocancel")buttons="oknocancel";this._element.ibxDialog({"type":type?"std "+type:"std plain","buttons":buttons})}_p=wcInherit(WcxDialog,WcxComponent);_p.show=function(){this._element.ibxWidget("open")};_p.add=function(obj){this._element.ibxWidget("add",obj)};_p.addItem=function(item){this._element.ibxWidget("add",$(item._element))};
_p.setCaption=function(text){this._element.ibxWidget("option","captionOptions",{"text":text})};_p.onClose=function(fn,obj){if(fn)this._element.on("ibx_close",fn.bind(obj?obj:this))};_p.disableOKButton=function(disable){var dlg=this.getInstance();var btnOK=dlg.btnOK.ibxWidget("instance");if(btnOK)if(disable)btnOK.element.ibxWidget("disable",true);else btnOK.element.ibxWidget("enable",true)};
function WcxPopup(){if(_wcconstructing)return;WcxComponent.call(this,"ibxPopup");this._element.ibxPopup({"resizable":true,"movable":true,"modal":true,"escapeToClose":true,"autoClose":false});this._close=false}_p=wcInherit(WcxPopup,WcxComponent);_p.setResizable=function(value){this._element.ibxWidget({"resizable":value})};_p.setModal=function(value){this._element.ibxWidget({"modal":value})};_p.setAutoClose=function(value){this._element.ibxWidget({"autoClose":value})};
_p.open=function(location){var shellTool=wcapplication.shellTool;if(shellTool&&shellTool.shellUI&&shellTool.shellUI.disableToolbar)shellTool.shellUI.disableToolbar(true);if(location)this._element.ibxWidget({"position":{"my":"left top","at":"left bottom","collision":"flipfit flipfit","of":location}});this._element.ibxWidget("open")};
_p.close=function(){var shellTool=wcapplication.shellTool;if(shellTool&&shellTool.shellUI&&shellTool.shellUI.disableToolbar)shellTool.shellUI.disableToolbar(false);if(!this._close&&this._element.ibxWidget("isOpen")){this._element.ibxWidget("close");this._close=true}};
function WcxMenuItem(text){if(_wcconstructing)return;WcxComponent.call(this,"ibxMenuItem");this._element.ibxMenuItem({"iconPosition":"left","labelOptions":{"text":text?text:""}});this._element.on("keydown",this.doKeyDown);this._setQaAttr(text)}_p=wcInherit(WcxMenuItem,WcxComponent);_p.getText=function(){return this._element.ibxMenuItem("option","text")};
_p.setEnabled=function(enabled){if(enabled){this._element.ibxWidget("enable",true);this._element.removeClass("ds-disabled")}else{this._element.ibxWidget("disable",true);this._element.addClass("ds-disabled")}};_p.setHighlighted=function(highlighted){if(highlighted)this._element.addClass("wcx-highlighted");else this._element.removeClass("wcx-highlighted")};
_p.setIcon=function(name){if(wcxIsIconFont(name)){var font=wcxGetIconFontName(name);this._element.ibxWidget({"labelOptions":{"glyph":font.name,"glyphClasses":font.class}})}else this._element.ibxWidget({"labelOptions":{"icon":name}});this._iconname=name};_p.getIconName=function(){return this._iconname};_p.setIconColor=function(color){if(color)this._element.find(".ibx-label-glyph").css("color",color).css("opacity","1")};_p.addSubMenu=function(menu){if(menu)this._element.ibxWidget("addSubMenu",menu._element)};
_p.doKeyDown=function(e){var keyCode=e.keyCode;var target=e.currentTarget;var sub=$(target).find(".ibx-marker-sub");var hasSub=sub&&sub.length>0;if(!(hasSub&&keyCode==39)){var parentObj=$(target).parent().parent().data("wcobj");var prevActive=parentObj.getInstance()._elPrevActive;while(prevActive&&$(prevActive).hasClass("ibx-menu-item")){parentObj=$(prevActive).parent().parent().data("wcobj");prevActive=parentObj.getInstance()._elPrevActive}if(prevActive){var activeEl=null;var kd=null;if(keyCode==
37||keyCode==39){parentObj._element.ibxWidget("close");activeEl=document.activeElement;if($(activeEl).hasClass("ibx-button-simple")){kd=$.Event(e);kd.type="keydown";kd.keyCode=keyCode;$(activeEl).trigger(kd);activeEl=document.activeElement;var hasSub=$(activeEl).hasClass("wcx-button-pulldown");if(hasSub)$(activeEl).trigger("click")}}}}};
function WcxCheckMenuItem(text,uservalue){if(_wcconstructing)return;WcxComponent.call(this,"ibxCheckMenuItem");this._element.ibxCheckMenuItem({"userValue":uservalue?uservalue:"","iconPosition":"left","labelOptions":{"text":text?text:""}})}_p=wcInherit(WcxCheckMenuItem,WcxMenuItem);_p.setChecked=function(checked){this._element.ibxWidget("checked",checked)};_p.getChecked=function(){return this._element.ibxWidget("checked")};_p.getUserValue=function(){return this._element.ibxWidget("userValue")};
function WcxMenuSeparatorLabel(text){if(_wcconstructing)return;WcxComponent.call(this,"ibxMenuSeparatorLabel");this._element.ibxMenuSeparatorLabel({"text":text})}_p=wcInherit(WcxMenuSeparatorLabel,WcxComponent);function WcxMenuSeparator(text){if(_wcconstructing)return;WcxComponent.call(this,"ibxMenuSeparator");this._element.ibxMenuSeparator()}_p=wcInherit(WcxMenuSeparator,WcxComponent);
function WcxMenu(doNotDestroyOnClose){if(_wcconstructing)return;WcxComponent.call(this,"ibxMenu");this._element.ibxMenu({"destroyOnClose":!doNotDestroyOnClose})}_p=wcInherit(WcxMenu,WcxComponent);_p.removeAllItems=function(){this._element.ibxWidget("remove","*",true)};_p.getAllItems=function(){return this._element.ibxWidget("children","*")};_p.addItem=function(item){this._element.ibxWidget("add",item._element)};
_p.open=function(location,ismenukey){if(ismenukey)this._element.ibxWidget({"position":{"my":"left top","at":"center center","collision":"flipfit flipfit","of":location}});else if(location)this._element.ibxWidget({"position":{"my":"left top","at":"left bottom","collision":"flipfit flipfit","of":location}});this._element.ibxWidget("open")};
_p.getFirstItem=function(){var child=this._element.ibxWidget("children",":first");var submenu=child.ibxWidget("subMenu");while(submenu!=null){child=submenu.ibxWidget("children",":first");submenu=child.ibxWidget("subMenu")}return child};_p.addCloseEventListener=function(handler,obj){if(handler)this._element.on("ibx_close",handler.bind(obj?obj:this))};_p.setMultiSelect=function(value){this._element.ibxWidget("option","multiSelect",value)};
function WcxDaysGrid(c){if(_wcconstructing)return;WcxComponent.call(this,"ibxGrid");var cols="auto";for(var i=1;i<c;i++)cols+=" auto";this._element.ibxGrid({"cols":cols,"align":"center","alignContent":"center","justify":"center","justifyContent":"center"});this._element[0].style["-ms-grid-column-align"]="center"}_p=wcInherit(WcxDaysGrid,WcxComponent);
function WcxGrid(){if(_wcconstructing)return;WcxComponent.call(this,"ibxGrid");this._element.ibxGrid({"justifyContent":"start"});this._colcount=1;this._span=0}_p=wcInherit(WcxGrid,WcxComponent);_p.setColumnCount=function(count){this._colcount=count;if(count>0){var str="auto";for(var i=1;i<count;++i)str+=" auto";this._element.ibxWidget({"cols":str})}};_p.setJustifyContent=function(value){this._element.ibxWidget({"justifyContent":value})};
_p._add_placement_styles=function(child,n,span){if(child==null||n==null)return;n+=this._span;var noMargins=$(child._element[0]).hasClass("wcx-paging-frame");if(!noMargins){if(n>=this._colcount)child._element[0].style["margin-top"]="5px";if((n+1)%this._colcount!=1)child._element[0].style["margin-left"]="10px"}var colN=n%this._colcount;child._element[0].style["-ms-grid-column"]=colN+1;child._element[0].style["-ms-grid-row"]=Math.floor(n/this._colcount)+1;if(span>1)child._element[0].style["-ms-grid-column-span"]=
span;if(colN+span>this._colcount)span=this._colcount-colN;if(span>1)this._span+=span-1;return n};_p.add=function(child){return this._add_placement_styles(child,WcxComponent.prototype.add.call(this,child),1)};_p.add=function(child,span){return this._add_placement_styles(child,WcxComponent.prototype.add.call(this,child),span)};
function WcxTextArea(text){if(_wcconstructing)return;WcxComponent.call(this,"ibxTextArea");this._element.ibxTextArea({"text":text?text:""});this.addEventListener("contextmenu",function(evt){evt.stopPropagation()});var textarea=this.getInstance()._textArea;$(textarea).attr("tabindex","0");$(textarea).on("drop",function(evt){var e=evt.originalEvent;var dt=e.dataTransfer;var text=dt.getData("text");if(text){text=textarea.val()+text;if(textarea&&textarea.length>0){textarea.focus();textarea.val(text)}}}.bind(this))}
_p=wcInherit(WcxTextArea,WcxComponent);_p.getText=function(){return this._element.ibxWidget("value")};_p.setText=function(value){this._element.ibxWidget("value",value)};_p.setWrap=function(value){this._element.ibxWidget({"textWrap":value})};_p.setReadOnly=function(readonly){this._element.ibxWidget({"readonly":readonly})};_p.setRows=function(rows){if(!rows)return;this._element.ibxWidget({"rows":rows})};
_p.setCols=function(cols){if(!cols)return;this._element.ibxWidget({"cols":cols});this._element.css("width",cols+"em")};function WcxTextField(text){if(_wcconstructing)return;WcxComponent.call(this,"ibxTextField");this._element.ibxTextField({"autoSize":true,"text":text?text:""});this._element.addClass("wcx-text-field");var el=this._element;setTimeout(function(){$(el).find("input").removeAttr("tabindex")},0);this.addEventListener("contextmenu",function(evt){evt.stopPropagation()})}
_p=wcInherit(WcxTextField,WcxComponent);_p.getText=function(){return this._element.ibxWidget("value")};_p.setText=function(value){this._element.ibxWidget("value",value)};_p.setType=function(type){this._element.ibxWidget({"ctrlType":type})};_p.setMaxLength=function(len){this._element.ibxWidget({"maxLength":len})};_p.setSize=function(size){this._element.ibxWidget({"autoSize":false}).css("width",size+"px");this.getInstance()._textInput.css({"min-width":"","max-width":""})};_p.setReadOnly=function(readonly){this._element.ibxWidget({"readonly":readonly})};
_p.addTextChangedEventListener=function(handler,obj){if(handler)this._element.on("ibx_textchanged",handler.bind(obj?obj:this))};_p.setEnabled=function(enabled){if(enabled){this._element.ibxWidget("enable",true);this._element.removeClass("ds-disabled")}else{this._element.ibxWidget("disable",true);this._element.addClass("ds-disabled")}};
function WcxSelect(readonly,size){if(_wcconstructing)return;WcxComponent.call(this,"ibxSelect");this._element.ibxSelect({"autoComplete":"off","readonly":readonly,"focusDefault":false});this._items=[];this.autosize=true;var select=this.getInstance();var textInput=select._textInput;select._popup.ready(function(){$(this._element).find("input").attr("tabindex","0");var selectMgr=$(this._element).find(".ibx-select-item-list.ibx-selection-manager").data("ibiIbxSelectionManager");if(selectMgr)selectMgr._setOptions({"focusDefault":false});
if(size!=-1)if(size){this.autosize=false;textInput.css("width",size);textInput.css("min-width",size);textInput.css("max-width",size);textInput.on("click",function(evt){evt.stopPropagation()})}else{if(!this.wcWidth){var width=$(select._popup).width();if(width<2)width=100;else width=Math.max(50,width-8);this.wcWidth=width+"px"}if(this.autosize){textInput.css("width",this.wcWidth);$(this._element).on("fixwidth",function(){textInput.css("width",this.wcWidth)}.bind(this));$(this._element).on("ibx_change",
function(){this._element.trigger("fixwidth")}.bind(this))}}this.addClosePopupEventListener(function(){if($(this._element).hasClass("wcx-multilist-select")){var selectEl=this._element;$(selectEl).removeClass("wcx-multilist-select")}else{this._element.trigger("change");this._element.trigger("fixwidth")}}.bind(this))}.bind(this))}_p=wcInherit(WcxSelect,WcxComponent);
_p.setEnabled=function(enabled){if(enabled){this._element.ibxWidget("enable",true);this._element.removeClass("ds-disabled")}else{this._element.ibxWidget("disable",true);this._element.addClass("ds-disabled")}};_p.removeButton=function(value){this._element.ibxWidget({"btnShow":!value})};_p.addItem=function(item,selected){this._element.ibxWidget("addControlItem",item._element);this._items.push(item._element);if(selected)this._element.ibxWidget("selected",item._element)};
_p.removeItem=function(item_element){for(var i=0;i<this._items.length;i++)if(this._items[i]==item_element){this._element.ibxWidget("removeControlItem",this._items[i]);this._items.splice(i,1);break}};_p.clearItems=function(){for(var i=this._items.length-1;i>=0;i--)this._element.ibxWidget("removeControlItem",this._items[i]);this._items=[]};_p.getUserValue=function(){return this._element.ibxWidget("userValue")};_p.setUserValue=function(value){this._element.ibxWidget("userValue",value)};_p.getText=function(){return this._element.ibxWidget("value")};
_p.setText=function(value){if(this._element.hasClass("ibx-widget"))this._element.ibxWidget("value",value)};_p.getSelected=function(){return this._element.ibxWidget("selected").data("wcobj")};_p.setMultiSelect=function(value){this._element.ibxWidget("option","multiSelect",value)};_p.addBeforeOpenPopupEventListener=function(handler,obj){if(handler)this._element.on("ibx_beforeopenpopup",handler.bind(obj?obj:this))};
_p.addClosePopupEventListener=function(handler,obj){if(handler){var instance=this.getInstance();if(instance){var popup=instance._popup.ibxWidget("instance");popup.element.on("ibx_close",handler.bind(obj?obj:this))}}};_p.resetWidth=function(){if(this._reset)return;this._reset=true;if(this.autosize){var popup=this._element.ibxWidget("popup");var w=popup.width();if(w>0)this.getInstance()._textInput.css("width",w)}};
_p.resizeMultiColumns=function(){var wcselect=this;var popup=wcselect.getInstance()._popup;popup.ready(function(e){var selectItems=$(this).find(".ibx-select-item");wcselect.resizeSelectItems(selectItems)}.bind(popup))};_p.resizeMultiListColumns=function(selectlists){var wcselect=this;for(var i=0;i<selectlists.length;i++){var selectList=selectlists[i];if(selectList.hasClass("wcx-has-other-text")){var selectItems=selectList.find(".ibx-select-item");wcselect.resizeSelectItems(selectItems,selectList.width())}}};
_p.resizeSelectItems=function(selectItems,listWidth){var otherWidth=0;var maxOptionWidth=0;var maxWidths=[];for(var i=0;i<selectItems.length;i++){var si=selectItems[i];var labelText=$(si).find(".ibx-label-text").first();var text=labelText.html();var html_span="<span>"+text+"</span>";labelText.html(html_span);var optionWidth=labelText.find("span:first").width()+parseInt(labelText.css("padding-left"));labelText.html(text);if(maxOptionWidth<optionWidth)maxOptionWidth=parseInt(optionWidth);var otherText=
$(si).find("span.wcx-other-text");if(otherText&&otherText.length>0)for(var j=0;j<otherText.length;j++){var maxWidth=maxWidths[j];var width=$(otherText[j]).width();if(!maxWidth||maxWidth<width)maxWidths[j]=parseInt(width)}}if(listWidth){otherWidth=parseInt(listWidth)-maxOptionWidth;if(otherWidth<0)otherWidth=0}for(var i=0;i<selectItems.length;i++){var si=selectItems[i];var otherText=$(si).find("span.wcx-other-text");if(otherText&&otherText.length>0){var optionText=$(si).find(".ibx-label-text").first();
optionText.css("display","flex");optionText.css("min-width",maxOptionWidth+"px");optionText.css("max-width",maxOptionWidth+"px");optionText.width(maxOptionWidth);for(var j=0;j<otherText.length;j++){var maxWidth=maxWidths[j];$(otherText[j]).css("display","inline-block");$(otherText[j]).css("min-width",maxWidth+"px");$(otherText[j]).css("max-width",maxWidth+"px");$(otherText[j]).width(maxWidth)}}var otherTextCont=$(si).find(".wcx-other-text-container");otherTextCont.css("display","flex");if(listWidth)otherTextCont.css("width",
otherWidth+"px")}};function WcxSelectItemList(){if(_wcconstructing)return;WcxComponent.call(this,"ibxSelectItemList");this._element.ibxSelectItemList({"filter":true});this._element.addClass("wcx-selectitemlist")}_p=wcInherit(WcxSelectItemList,WcxComponent);_p.addItem=function(item){this._element.ibxWidget("add",item._element)};
function WcxSelectCheckItem(text,value,options){if(_wcconstructing)return;WcxComponent.call(this,"ibxSelectCheckItem");this._element.ibxSelectCheckItem({"text":text,"userValue":value?value:""});this._element.data("text",text);if(text)this._setQaAttr(text);var selectItem=this;this._element.ready(function(){var item=selectItem.getInstance();if(item){var sie=item.element;if(sie&&options){if(options.title)$(sie).attr("title",options.title);if(options.itemType){sie.on("click",function(evt){evt.stopPropagation()});
if(options.itemType=="separator")$(sie).addClass("wcx-select-separator");else{var icon=$('<div class="ibx-label-glyph ibx-label-icon material-icons">'+options.itemType+"</div>");if(icon)sie.append(icon);if(options.handler)icon.on("click",options.handler.bind(selectItem))}}}}}.bind(this))}_p=wcInherit(WcxSelectCheckItem,WcxComponent);
function WcxSelectItem(text,value,options){if(_wcconstructing)return;WcxComponent.call(this,"ibxSelectItem");this._element.ibxSelectItem({"text":text,"userValue":value?value:""});this._element.data("text",text);if(text)this._setQaAttr(text);var selectItem=this;var sie=selectItem._element;sie.ready(function(){if(sie&&options){var icon=$(sie).find(".ibx-label-glyph").first();var text=$(sie).find(".ibx-label-text").first();if(options.deletable){options.image=new WcxLabel(null,null,"ds-icon-delete");
options.image._element.addClass("wcx-fp-delete-icon");options.image.addEventListener("click",function(){var parent=$(sie).parent();$(sie).remove();selectItem.dispose();$(parent).trigger("change")})}if(options.image){icon.css("padding-right","5px");text.prepend(icon);icon.replaceWith(options.image._element);$(sie).parent().addClass("wcx-has-images")}if(options.level)$(text).css("padding-left",(options.level-1)*12+3+"px");if(options.title)$(sie).attr("title",options.title);if(options.itemType){sie.on("click",
function(evt){evt.stopPropagation()});if(options.itemType=="separator")$(sie).addClass("wcx-select-separator");else if(options.itemType=="text"){$(sie).addClass("wcx-text-option");var tf=$('<input style="width:100%"/>');if(tf)sie.append(tf);if(options.handler)tf.on("keyup",options.handler.bind(selectItem))}else{var icon=$('<div class="ibx-label-glyph ibx-label-icon material-icons">'+options.itemType+"</div>");if(icon)sie.append(icon);if(options.handler)icon.on("click",options.handler.bind(selectItem))}}else{$(sie).addClass("wcx-select-option");
if(options.handler)sie.on("click",options.handler.bind(selectItem))}var otherText=options.otherText;if(otherText&&otherText.length>0){var otc=$('<span class="wcx-other-text-container"></span>');sie.append(otc);$(sie).parent().addClass("wcx-has-other-text");for(var i=0;i<otherText.length;i++){var ot=$('<span class="wcx-other-text">'+otherText[i]+"&#9;</span>");if(ot)otc.append(ot)}}}}.bind(this))}_p=wcInherit(WcxSelectItem,WcxComponent);
function WcxSelectSeparatorLabel(text){if(_wcconstructing)return;WcxComponent.call(this,"ibxSelectSeparatorLabel");this._element.ibxSelectSeparatorLabel({"text":text})}_p=wcInherit(WcxSelectSeparatorLabel,WcxComponent);function WcxSelectSeparator(text){if(_wcconstructing)return;WcxComponent.call(this,"ibxSelectSeparator");this._element.ibxSelectSeparator()}_p=wcInherit(WcxSelectSeparator,WcxComponent);
function WcxRichEdit(text){if(_wcconstructing)return;WcxComponent.call(this,"ibxRichEdit");this._element.ibxRichEdit();this._text=text;this._element.ibxWidget("ready",function(){this._element.ibxWidget("text",this._text)}.bind(this))}_p=wcInherit(WcxRichEdit,WcxComponent);_p.getText=function(){var doc=this._element.ibxWidget("contentDocument");return doc.body.innerText};
function WcxButtonBrowse(text){if(_wcconstructing)return;WcxComponent.call(this,"ibxButtonBrowse");if(text&&text!=""){this._element.ibxButtonBrowse({"text":text});this._text=text;this._setQaAttr(text)}else{this._element.ibxButtonBrowse();this._text=""}$(this._element).attr("tabindex","0")}_p=wcInherit(WcxButtonBrowse,WcxButton);_p.addChangeEventListener=function(handler,obj){if(handler)this._element.on("ibx_change",handler.bind(obj?obj:this))};
_p.getFile=function(){var files=this._element.ibxWidget("files");return files};_p.setAccept=function(accept){this._element.ibxWidget({"accept":accept})};
function WcxTabPane(position,newstyle){if(_wcconstructing)return;WcxComponent.call(this,"ibxTabPane");if(position)this._position=position;else this._position="top";if(newstyle)this._newstyle=true;else this._newstyle=false;this._element.ibxTabPane({"position":this._position});if(this._newstyle)this._element.addClass("ds-tab-pane");this._icontabbutton=false;this._element.resize(function(e){e.stopPropagation();for(var i=0;i<this._children.length;++i)this._children[i]._element.find(".wcx-wctable").trigger("resize")}.bind(this))}
_p=wcInherit(WcxTabPane,WcxComponent);
_p.addPage=function(page,selected,noclosebutton){this._children.push(page);this._element.ibxWidget("add",page._element);if(selected)this._element.ibxWidget("selected",page._element);var div=page._element.ibxWidget("button");setQaAttrToElement(div,div.attr("title"));if(page._icon)this._icontabbutton=true;if(noclosebutton)return;if(this._newstyle)this._element.removeClass("ds-tab-pane");var close=new WcxLabel(null,false,wcapplication.imgstr.close);close._setQaAttr("Close");close._element.addClass("wcx-tabpage-closebutton");
close._element.on("click",function(e){if(page.closehdr)page.closehdr(e);else this.removePage(page)}.bind(this));div.append(close._element);page.closebtn=close};_p.removePage=function(page){var index=this._children.indexOf(page);if(index!==-1)this._children.splice(index,1);this._element.ibxWidget("remove",page._element);var s=this._element.ibxWidget("selected");if(s)s.ibxWidget("button").click()};
_p.moveTab=function(fromIndex,toIndex){var tabBar=this._element.ibxWidget("tabBar");var tabBtns=tabBar.find(".ibx-tab-button");var fromBtn=tabBtns[fromIndex];var toBtn=tabBtns[toIndex];if(toIndex>fromIndex)$(fromBtn).insertAfter($(toBtn));else $(fromBtn).insertBefore($(toBtn))};
function WcxTabPage(caption,icon){if(_wcconstructing)return;WcxComponent.call(this,"ibxTabPage");if(icon)if(wcxIsIconFont(icon)){var font=wcxGetIconFontName(icon);this._element.ibxTabPage({tabOptions:{text:caption,"glyph":font.name,"glyphClasses":font.class}})}else this._element.ibxTabPage({tabOptions:{text:caption,"icon":icon}});else this._element.ibxTabPage({tabOptions:{text:caption}})}_p=wcInherit(WcxTabPage,WcxComponent);_p.selectTab=function(){var tabBtn=this._element.ibxWidget("button");$(tabBtn).trigger("click")};
_p.addEventListenerToTabButton=function(evt,handler,obj){if(evt&&handler){var tabBtn=this._element.ibxWidget("button");$(tabBtn).on(evt,handler.bind(obj?obj:this))}};_p.addClickEventListenerToCloseButton=function(handler,obj){if(handler)this.closehdr=handler.bind(obj?obj:this)};_p.setTitle=function(title){this._element.ibxWidget("button").attr("title",title)};
function WcxProgressBar(){if(_wcconstructing)return;WcxComponent.call(this,"ibxProgressBar");this._element.ibxProgressBar();this._element.addClass("wcx-progressbar")}_p=wcInherit(WcxProgressBar,WcxComponent);_p.setCurVal=function(value){this._element.ibxWidget({"curVal":value})};_p.setProgText=function(value){this._element.ibxWidget({"progText":value,"showProgText":true})};
function wcxGetIconFontName(fontname){var out=new Object;i=fontname.indexOf("-");if(i==-1||i==0){out.class="material-icons";out.name=fontname}else{var fn=fontname.substring(0,i);if(fn=="ibi"){out.class=fn+"-icons";out.name=fontname.substr(i+1)}else if(fn=="ibx"){out.class=fontname+" ibx-icons";out.name=""}else{out.class=fontname;out.name=""}}return out}function wcxIsIconFont(str){if(!str)return false;if(str.lastIndexOf(".")==-1)return true;return false}
function WcxSlider(isrange,orientation,min,max,value,value2){if(_wcconstructing)return;WcxComponent.call(this,"ibxSlider");if(isrange)this._element.ibxRange({"orientation":orientation,"max":max,"min":min,"minTextPos":"end","maxTextPos":"end","valueTextPos":"start","value":value,"value2":value2});else this._element.ibxHSlider({"orientation":orientation,"max":max,"min":min,"minTextPos":"center","maxTextPos":"center","valueTextPos":"start","value":value,"value2":value2});this._element.addClass("wcx-hslider")}
_p=wcInherit(WcxSlider,WcxComponent);_p.getInfo=function(){return this._element.ibxWidget("info")};_p.setFormat=function(fn){this._element.ibxWidget("format",fn)};function WcxCheckBoxSimple(checked,text){if(_wcconstructing)return;WcxComponent.call(this,"ibxCheckBoxSimple");this._element.ibxCheckBoxSimple({"checked":checked?true:false,"text":text?text:""});this._element.addClass("wcx-checkbox");$(this._element).attr("tabindex","0");this._setQaAttr(text)}_p=wcInherit(WcxCheckBoxSimple,WcxLabel);
_p.getChecked=function(){return this._element.ibxWidget("checked")};_p.setChecked=function(checked){this._element.ibxWidget("checked",checked?true:false)};_p.setEnabled=function(enabled){if(enabled){this._element.ibxWidget("enable",true);this._element.removeClass("ds-disabled")}else{this._element.ibxWidget("disable",true);this._element.addClass("ds-disabled")}};
function WcxRadioButtonSimple(checked,text){if(_wcconstructing)return;WcxComponent.call(this,"ibxRadioButtonSimple");this._element.ibxRadioButtonSimple({"checked":checked?true:false,"text":text?text:""});$(this._element).attr("tabindex","0");this._setQaAttr(text)}_p=wcInherit(WcxRadioButtonSimple,WcxLabel);_p.setChecked=function(checked){this._element.ibxWidget("checked",checked?true:false)};_p.getChecked=function(){return this._element.ibxWidget("checked")};
_p.setEnabled=function(enabled){if(enabled){this._element.ibxWidget("enable",true);this._element.removeClass("ds-disabled")}else{this._element.ibxWidget("disable",true);this._element.addClass("ds-disabled")}};_p.addChangeEventListener=function(handler,obj){if(handler)this._element.on("ibx_change",handler.bind(obj?obj:this))};function WcxRadioGroup(name){if(_wcconstructing)return;WcxComponent.call(this,"ibxRadioGroup");this._element.ibxRadioGroup({"name":name});this._setQaAttr(name)}
_p=wcInherit(WcxRadioGroup,WcxComponent);_p.addButton=function(radiobutton){this._element.ibxWidget("add",radiobutton._element)};
function WcxCalendar(dt,datefmt,type){if(_wcconstructing)return;WcxComponent.call(this,"ibxDatePicker");var date=$.datepicker.formatDate(datefmt,dt);this._element.ibxDatePicker({"type":type?type:"popup","date":date?date:"","initDate":false,"showClear":false,"pickerClasses":"","dateFormat":datefmt?datefmt:"MM/dd/yyyy","outDateFormat":datefmt?datefmt:"MM/dd/yyyy","changeYear":true,"changeMonth":true,"adjustForMonthYear":true});this._element.addClass("wcx-calendar")}_p=wcInherit(WcxCalendar,WcxComponent);
_p.getUserValue=function(){return this._element.ibxWidget("option","date")};
function WcxDateRange(dtFrom,dtTo,datefmt,type){if(_wcconstructing)return;WcxComponent.call(this,"ibxDateRange");var dateFrom=$.datepicker.formatDate(datefmt,dtFrom);var dateTo=$.datepicker.formatDate(datefmt,dtTo);this._element.ibxDateRange({"type":type?type:"popup","dateFrom":dateFrom?dateFrom:"","dateTo":dateTo?dateTo:"","initDate":false,"showClear":false,"pickerClasses":"","dateFormat":datefmt?datefmt:"MM/dd/yyyy","outDateFormat":datefmt?datefmt:"MM/dd/yyyy","changeYear":true,"changeMonth":true});
this._element.addClass("wcx-daterange")}_p=wcInherit(WcxDateRange,WcxComponent);_p.getDateFrom=function(){return this._element.ibxWidget("option","dateFrom")};_p.getDateTo=function(){return this._element.ibxWidget("option","dateTo")};function WcxAccordionPane(){if(_wcconstructing)return;WcxComponent.call(this,"ibxAccordionPane");this._element.ibxAccordionPane();this.setOption("navKeyRoot",false)}_p=wcInherit(WcxAccordionPane,WcxComponent);_p.addPage=function(page){this._element.ibxWidget("add",page._element)};
function WcxAccordionPage(){if(_wcconstructing)return;WcxComponent.call(this,"ibxAccordionPage");this._element.ibxAccordionPage({"autoClose":false,"btnOptions":{"iconPosition":"right"}});var wcx=this;var ap=this.getInstance();var content=ap._content;var button=ap._button;this._element.ready(function(){content.removeAttr("tabindex");button.attr("tabindex","0");wcx.addEventListener("ibx_open",function(evt){setTimeout(function(){var sel=window.getSelection?window.getSelection():document.selection;if(sel){if(sel.removeAllRanges)sel.removeAllRanges();
if(sel.empty)sel.empty()}button.focus()},0)})})}_p=wcInherit(WcxAccordionPage,WcxComponent);_p.addContent=function(content){this._element.ibxWidget("add",content._element)};_p.setSelected=function(selected){this._element.ibxWidget({"selected":selected})};_p.setTitle=function(text){this._element.ibxWidget("option","btnOptions.text",text)};
function WcxIFrame(){if(_wcconstructing)return;WcxComponent.call(this,"ibxIFrame");this._element.ibxIFrame({"focusOnOpen":false,"focusDefault":false,"focusRoot":false,"closeOpenMenusOnBlur":false});this._element.addClass("wcx-iframe")}_p=wcInherit(WcxIFrame,WcxComponent);_p.getContentDocument=function(){return this._element.ibxWidget("contentDocument")};function WcxWaiting(text){if(_wcconstructing)return;WcxComponent.call(this,"ibxWaiting");this._element.ibxWaiting({"text":text?text:""})}
_p=wcInherit(WcxWaiting,WcxComponent);function setQaAttrToElement(element,value,override){if(!value)return;var v=$.trim(value);if(v=="")return;if(!override){var x=element.attr("qa");if(x&&x!="")return}element.attr("qa",v)}
function wcConstants(){this.WCF_TEXT_SMALL=1;this.WCF_TEXT_LARGE=2;this.WCF_TEXT_NOSPACE=4;this.WCF_TEXT_BOLD=8;this.WCF_TEXT_UNDERLINE=16;this.WCF_TEXT_INDENTTEXT=64;this.WCF_TEXT_ALLSPACE=128;this.WCF_FIR_LINETEXT=256;this.WCF_LAST_LINETEXT=512;this.WCF_TEXT_WRAP=1024;this.WCF_TEXT_HTML=2048;this.WCF_TEXT_UPPERCASE=8192;this.WCF_TEXT_LIGHTER=16384;this.WCF_TEXT_MONOSPACE=32768}var wcconstants=new wcConstants;
function wcBuild(obj,options){if(obj.type==="wctext"){if(typeof obj.initial_size!=="undefined"&&obj.initial_size>0)return new WcCollapsibleText(obj);if(typeof obj.description!=="undefined"||obj.getDescription&&obj.getDescription())return new WcText(obj);if(typeof obj.helplink!=="undefined")return new WcText(obj);return new WcTextOnly(obj)}if(obj.type==="wcinputtext")return new WcInputText(obj);if(obj.type==="wcmultiframes")return new WcMultiframes(obj);if(obj.type==="wcmflayout")return WcMultiframes._doWcMFLayout(obj);
if(obj.type==="wcform"){if(obj.formid=="loginform")return null;return new WcForm(obj)}if(obj.type==="wctree")return new WcTree(obj);if(obj.type==="wctable")return new WcTable(obj);if(obj.type==="wcpassword")return new WcPassword(obj);if(obj.type==="wcfilter")return new WcFilter(obj);if(obj.type==="wcselect"){if(obj.display=="month")return new WcMonthWeekDays(obj);if(obj.display=="week")return new WcMonthWeekDays(obj,true);if(obj.display=="checkbox")return new WcCheckBoxList(obj);if(obj.display=="radio")return new WcRadioList(obj);
if(obj.display=="button")return new WcButtonList(obj);if(obj.display=="slider")return new WcxLabel("WcSelectSlider");if(options=="popup")return new WcPopupSelect(obj);return new WcSelect(obj)}if(obj.type==="wcbutton")return new WcButton(obj);if(obj.type==="hidden")return new WcHidden(obj);if(obj.type==="wctexteditor")return new WcTextEditor(obj);if(obj.type==="wclist")return new WcList(obj);if(obj.type==="wcbarchart")return new WcBarChart(obj);if(obj.type==="wcslider")return new WcSlider(obj);if(obj.type===
"wcupload")return new WcUpload(obj,options);if(obj.type==="wccheckbox")return new WcCheckBox(obj);if(obj.type==="wccombobox")return new WcComboBox(obj);if(obj.type==="wccalendar")return new WcCalendar(obj);if(obj.type==="wcdaterange")return new WcDateRange(obj);if(obj.type=="wclngraph")return new WcGraph(obj);if(obj.type=="wcimage")return new WcImage(obj);if(obj.type=="wctextarea")return new WcTextArea(obj);if(obj.type=="wcradio")return new WcRadio(obj);if(obj.type==="wcfilepicker")return new WcFilePicker(obj,
options);if(obj.type==="wchelplink")return new WcHelpLink(obj);if(obj.type==="wcemailaddr")return new WcEmailAddr(obj);if(obj.type==="wcexpcalculator")return new WcExpCalculator(obj);if(obj.type==="wccalculator")return new WcCalculator(obj);if(obj.type==="wcbarchart")return new WcBarChart(obj);if(obj.type==="wcricheditor")return new WcRichEditor(obj);if(obj.type==="wcbreadcrumb")return new WcBreadCrumb(obj);if(obj.type==="wcmultiitem")return new WcMultiItem(obj);if(obj.type==="wcbuttonpane")return new WcButtonPane(obj);
if(obj.type==="wcnavmenu"){var menu=new WcxMenu(true);menu._element.addClass("wcx-navmenu");var wcnodes={};wcnodes.node=obj.node;wcBuildMenu(null,wcnodes,null,null,menu);return menu}return null}function WcUrl(){this._paramN=[];this._paramV=[];this._url=window.location.pathname.replace("wc/wcstart.html","webconsole")}
WcUrl.prototype.setParams=function(paramarray){if(paramarray==null)return;if(Array.isArray(paramarray)){for(var i=0;i<paramarray.length;++i){this._paramN.push(paramarray[i].name);this._paramV.push(paramarray[i].value)}return}for(var p in paramarray)if(paramarray.hasOwnProperty(p))this.addParam(p,paramarray[p])};WcUrl.prototype.getAllParams=function(){var params={};for(var i=0;i<this._paramN.length;++i)if(this._paramN[i])params[this._paramN[i]]=this._paramV[i];return params};
WcUrl.prototype.copyAll=function(bcparams,notemptyonly){if(bcparams==null||bcparams._paramN.length==0)return;for(var i=0;i<bcparams._paramN.length;++i){if(notemptyonly&&bcparams._paramV[i]=="")continue;var unique=true;for(var j=0;j<i;++j)if(bcparams._paramN[i]==bcparams._paramN[j]){unique=false;break}if(unique)this.replaceParam(bcparams._paramN[i],bcparams._paramV[i]);else this.addParam(bcparams._paramN[i],bcparams._paramV[i])}};
WcUrl.prototype.getParam=function(k){var i;for(i=0;i<this._paramN.length;++i)if(this._paramN[i]==k)return this._paramV[i];return null};WcUrl.prototype.addQueryString=function(qs){if(!qs)return;var p=qs.split("&");for(var i=0;i<p.length;++i){t=p[i].indexOf("=");if(t>0)this.addParam(p[i].substr(0,t),p[i].substr(t+1))}};
WcUrl.prototype.addParam=function(k,v){if(!k)return;if(typeof k=="string"){this._paramN.push(k);this._paramV.push(v)}else if(typeof k=="object"){if(Array.isArray(k)){for(var i=0;i<k.length;++i){this._paramN.push(k[i].name);this._paramV.push(k[i].value)}return}for(var i in k)if(i&&k.hasOwnProperty(i)){var val=k[i];if(Array.isArray(val))for(var j=0;j<val.length;++j){this._paramN.push(i);this._paramV.push(val[j])}else{this._paramN.push(i);this._paramV.push(val)}}}};
WcUrl.prototype.replaceParam=function(k,v){if(typeof k=="string"){var i;for(i=0;i<this._paramN.length;++i)if(this._paramN[i]==k){this._paramV[i]=v;return}this._paramN.push(k);this._paramV.push(v)}else if(typeof k=="object"){if(Array.isArray(k)){for(var i=0;i<k.length;++i){for(x=0;x<this._paramN.length;++x)if(this._paramN[x]==k[i].name){this._paramV[x]=k[i].value;break}if(x==this._paramN.length){this._paramN.push(k[i].name);this._paramV.push(k[i].value)}}return}for(var i in k)if(i&&k.hasOwnProperty(i)){var x;
for(x=0;x<this._paramN.length;++x)if(this._paramN[x]==i){var val=k[i];if(Array.isArray(val)){this._paramV[x]=[];for(var j=0;j<val.length;++j)this._paramV[x].push(val[j])}else this._paramV[x]=val;break}if(x==this._paramN.length){var val=k[i];if(Object.prototype.toString.call(val)==="[object Array]")for(var aa=0;aa<val.length;++aa){this._paramN.push(i);this._paramV.push(val[aa])}else{this._paramN.push(i);this._paramV.push(val)}}}}};WcUrl.prototype.getHref=function(){if(this._url)return this._url;return null};
WcUrl.prototype.setUrl=function(app){if(!app)return;var t=app.indexOf("?");if(t>0){this._url=app.substr(0,t);var p=app.substr(t+1).split("&");for(var i=0;i<p.length;++i){t=p[i].indexOf("=");if(t>0)this.addParam(p[i].substr(0,t),p[i].substr(t+1))}}else this._url=app};function WcLoader(app){WcUrl.call(this);this.setUrl(app);this._async=true;this.no_wait=false}WcLoader.prototype=new WcUrl;WcLoader.prototype.constructor=WcLoader;
WcLoader.prototype.getHtmlForm=function(fullpath){var path;if(fullpath)path=window.location.origin+this._url;else path=this._url;var text='<form accept-charset="UTF-8" name=form method=POST action='+path+">";for(var i=0;i<this._paramN.length;++i)if(typeof this._paramV[i]=="object")for(var j=0;j<this._paramV[i].length;++j)text+='<input type="hidden" name="'+this._paramN[i]+'" value="'+this._paramV[i][j].toString().replace(/"/g,"&quot;")+'">';else text+='<input type="hidden" name="'+this._paramN[i]+
'" value="'+this._paramV[i].toString().replace(/"/g,"&quot;")+'">';text+='<input type="hidden" name="CHARSET" value="UTF-8">';if(wcapplication.csrftokenname!=""&&wcapplication.csrftokenvalue!="")text+='<input type="hidden" name="'+wcapplication.csrftokenname+'" value="'+wcapplication.csrftokenvalue+'">';text+="</form>";return text};WcLoader.prototype.setAsync=function(value){this._async=value};WcLoader.prototype.setLoadingMessage=function(value){if(value)this._loadingmessage=value};
WcLoader.prototype.addResource=function(filename,selector){this._resourcename=filename;this._resourceselector=selector};
WcLoader.prototype.load=function(fn,obj,errorfn){if(this._resourcename&&this._resourceselector){var appPath=ibx.getAppPath();var pos=appPath.indexOf("?");if(pos>0){appPath=appPath.substring(0,pos);pos=appPath.lastIndexOf("/");if(pos>0){appPath=appPath.substring(0,pos+1);ibx.setAppPath(appPath)}}ibx.resourceMgr.addBundle(this._resourcename,"app").then(function(a,b,c){this.loadjson(a,b,c)}.bind(this,fn,obj,errorfn))}else this.loadjson(fn,obj,errorfn)};
WcLoader.prototype.loadjson=function(fn,obj,errorfn){var params=[];var date=new Date;var reqid=date.valueOf();var isreport=false;var isnotxml=false;var hdrs={};for(var i=0;i<this._paramN.length;++i)if(this._paramN[i]=="IBIS_output"){isreport=true;if(this._paramV[i]=="notbindows")isnotxml=true;break}var loadiframe;if(wcapplication.isWebconsoleRequest(this._url)&&!isnotxml||this._url.endsWith("ibiweb.exe")&&!isreport)loadiframe=false;else loadiframe=true;if(obj&&obj.popupwindow&&obj.popupwindow.iframe)loadiframe=
true;if(!loadiframe){for(var i=0;i<this._paramN.length;++i)if(this._paramV[i]!=null&&typeof this._paramV[i]=="object")for(var j=0;j<this._paramV[i].length;++j)if(this._paramV[i][j]!=null)params.push({name:this._paramN[i],value:this._paramV[i][j]});else params.push({name:this._paramN[i],value:""});else if(this._paramV[i]!=null)params.push({name:this._paramN[i],value:this._paramV[i]});else params.push({name:this._paramN[i],value:""});hdrs["Accept"]="application/vnd.api+json";params.push({name:"reqid",
value:reqid});if(wcapplication.csrftokenname!="")params.push({name:wcapplication.csrftokenname,value:wcapplication.csrftokenvalue});params.push({name:"ibx",value:"y"})}else{this.replaceParam("reqid",reqid);var iframe;if(obj){obj.removeAll();iframe=new WcxIFrame;obj.add(iframe);if(obj instanceof WcxComponent&&typeof obj.wcUpdate=="function")obj.wcUpdate();if(obj.popupwindow&&obj.popupwindow.iframe){iframe._element.find("iframe").attr("role","dialog").attr("aria-live","polite");var iframeid=iframe._element.attr("id");
iframe._element.on("closeRsPop",function(e){var popup=$(this).closest(".wcx-popup-window").data("wcobj");if(popup){wcapplication.clrWcfObject(popup);popup.close()}if(e.originalEvent.data)wcOpenNewWindow(e.originalEvent.data)});this.addParam("IBIS_iframeid",iframeid)}}else{var iframe=$(".wcx-iframe-invisible").data("wcobj");if(!iframe){iframe=new WcxIFrame;iframe._element.addClass("wcx-iframe-invisible");$("body").append(iframe._element)}}iframe.setDispose(function(iframe){if(iframe.wctimer){wcStopTimer(iframe.wctimer);
delete iframe.wctimer}if(!iframe.wcloaded){wcapplication.setGlassPaneVisible(false);wcapplication.jsIsBusyFinish()}});var doc=iframe.getContentDocument();doc.write(this.getHtmlForm());doc.close();iframe.wctimer={};iframe.wctimer.reqid=reqid;iframe.wctimer.iframe=iframe;if(this._loadingmessage)iframe.wctimer.loadingmessage=this._loadingmessage;iframe.addEventListener("load",function(){$(iframe._element).find("iframe").removeAttr("tabindex");if(this.wctimer){wcStopTimer(this.wctimer);delete this.wctimer}if(this.wcloaded)return;
wcapplication.setGlassPaneVisible(false);wcapplication.jsIsBusyFinish();this.wcloaded=true}.bind(iframe));iframe.wcloaded=false;wcapplication.jsIsBusyStart();wcapplication.setGlassPaneVisible(true);wcStartTimer(iframe.wctimer);doc.forms[0].submit();return}var resourceselector=this._resourceselector;var resourcename=this._resourcename;try{wcSaveFocusInfo(obj);var pwin=obj&&obj.popupwindow?obj.popupwindow:null;$.ajax({mimeType:"application/json",wcpopupwin:pwin,wcloadingmessage:this._loadingmessage,
wcnowait:this.no_wait,wcreqid:reqid,headers:hdrs,method:"POST",traditional:true,url:this._url,data:params,dataType:"json",async:this._async,beforeSend:function(jqXHR,settings){wcapplication.jsIsBusyStart();if(!settings.wcnowait){wcapplication.setGlassPaneVisible(true);jqXHR.wctimer={};jqXHR.wctimer.reqid=settings.wcreqid;if(settings.wcloadingmessage)jqXHR.wctimer.loadingmessage=settings.wcloadingmessage;if(settings.wcpopupwin)jqXHR.wctimer.coverarea=settings.wcpopupwin._element[0];wcStartTimer(jqXHR.wctimer)}}}).always(function(p1,
textStatus,p3){if(!wcapplication)return;wcapplication.setGlassPaneVisible(false);var data;var jqXHR;if(textStatus=="success"){data=p1;jqXHR=p3}else jqXHR=p1;if(jqXHR.wctimer){wcStopTimer(jqXHR.wctimer);delete jqXHR.wctimer}if(textStatus!="success"){wcapplication.jsIsBusyFinish();if(errorfn)errorfn(textStatus+" - status: "+jqXHR.status+" "+p3);else if(obj)alert(textStatus+" - status: "+jqXHR.status+" "+p3);return}if(obj&&obj instanceof WcxComponent)obj._element.attr("contentpage","y");if(fn)fn(data,
obj,resourceselector,resourcename);else wcxParseXml(data);if(obj&&obj instanceof WcxComponent&&typeof obj.wcUpdate=="function")obj.wcUpdate(data.resourcebundle&&data.resourceselector);setTimeout(function(){wcapplication.jsIsBusyFinish()},0)})}catch(e){}};function wcGetCookie(name){var parts=document.cookie.split(name+"=");if(parts.length==2)return parts.pop().split(";").shift();return null}
function wcStartTimer(wctimer){wctimer.second=0;wctimer.handle=setInterval(function(timer){if(wcapplication.wcIbxBusy){if(timer.second>=wcapplication.stopthreshold){var msgstr;if(timer.loadingmessage)msgstr=timer.loadingmessage;else msgstr=ibx.resourceMgr.getString("loading");ibxBusy.busy.message(msgstr+" "+wcNumberToTime(timer.second));wcapplication.wcIbxBusy.removeClass("ds-stopthreshold");wcapplication.wcIbxBusy.children().show()}}else{var strStop=ibx.resourceMgr.getString("stop")?ibx.resourceMgr.getString("stop"):
"Stop";var strAgentStats=ibx.resourceMgr.getString("agent")?ibx.resourceMgr.getString("agent"):"Agent Stats";var strSessionLog=ibx.resourceMgr.getString("slog")?ibx.resourceMgr.getString("slog"):"Session Log";var buttons=["<button class='btn-busy-icon btnStop ds-icon-block' title='"+strStop+"' qa='"+strStop+"' />","<button class='btn-busy-icon btnAgentStats ds-icon-chart-bar' title='"+strAgentStats+"' qa='"+strAgentStats+"' />","<button class='btn-busy-icon btnSessionLog ds-icon-log' title='"+strSessionLog+
"' qa='"+strSessionLog+"' />"];var template=ibxBusy.busy.show(true,timer.coverarea?timer.coverarea:document.body,{"buttons":buttons});wcapplication.wcIbxBusy=$(template);var btn;btn=template.querySelector(".btnStop");btn.addEventListener("click",function(e){e.preventDefault();e.stopPropagation();var sxml=new WcLoader(wcapplication.wcurl);sxml.addParam("IBIS_page","STOPMYREQUESTS");sxml.addParam("killid",timer.reqid);sxml.load();$(this).prop("disabled",true)}.bind(btn));btn=template.querySelector(".btnAgentStats");
btn.addEventListener("click",function(e){e.preventDefault();e.stopPropagation();var link={};link.url=wcapplication.wcurl;link.http_target="TARGET_MAIN";link.method="post";link.wintype=4096;link.winsize="SIZE_LARGE";wcAddParameter(link,"IBIS_page","AGENTS");wcAddParameter(link,"IBIS_my","y");wcAddParameter(link,"IBIS_refreshagents","y");wcSubmitLink(link)});btn=template.querySelector(".btnSessionLog");btn.addEventListener("click",function(e){e.preventDefault();e.stopPropagation();var link={};link.url=
wcapplication.wcurl;link.http_target="TARGET_MAIN";link.method="post";link.wintype=4096;link.winsize="SIZE_LARGE";link.wincaption=strSessionLog;wcAddParameter(link,"IBIS_page","SESSIONLOGWIN");wcSubmitLink(link)});$(template).addClass("ds-stopthreshold");$(template).children().hide()}timer.second+=1;if(timer.reqid&&timer.iframe){var token=wcGetCookie("downloadToken");if(token&&token==timer.reqid)timer.iframe._element.trigger("load")}},1E3,wctimer);if(window.ibitimerintervals)window.ibitimerintervals.push(wctimer.handle)}
function wcStopTimer(wctimer){clearInterval(wctimer.handle);if(window.ibitimerintervals){var index=window.ibitimerintervals.indexOf(wctimer.handle);if(index>=0)window.ibitimerintervals.splice(index,1)}wcapplication.wcIbxBusy=null;ibxBusy.busy.show(false)}function wcNumberToTime(sec){var time="";var h=Math.floor(sec/60);var s=sec-h*60;if(h<10)time="0"+h;else time=h;time+=":";if(s<10)time+="0"+s;else time+=s;return time}
function wcxAddResource2Page(page,rsp){page.removeAll();page.xmlwcfitem=[];var content=new WcxComponent;page.add(content);var obj=ibx.resourceMgr.getResource("."+rsp.resourceselector);content._element.addClass(obj.attr("class"));var children=obj.children();for(var i=0;i<children.length;++i)$(children[i]).detach().appendTo(content._element);fn=window[rsp.resourceselector+"_getparams"];if(typeof fn==="function")page.fn_getdivparams=fn;fn=window[rsp.resourceselector+"_beforesubmit"];if(typeof fn==="function")page.fn_beforesubmit=
fn;page.getResourceParams=page.getParams=function(){var allp={};if(this.fn_getdivparams)$.extend(allp,this.fn_getdivparams());if(page.xmlwcfitem)for(var i=0;i<page.xmlwcfitem.length;++i)allp=wcGetParams(page.xmlwcfitem[i],allp);return allp}.bind(page);if(rsp.data)$.each(rsp.data.item,function(key,item){if(!item.selector)return;var obj=this._element.find(item.selector);if(obj.length==0)return;var wcobj=wcBuild(item);if(wcobj){wcobj._element.appendTo(obj);this.xmlwcfitem.push(wcobj)}}.bind(page));var fn=
window[rsp.resourceselector+"_init"];if(typeof fn==="function")fn(rsp,content._element)}
function wcxParseXml(rsp,page,selector,resourcename){var oldFocusEl=document.activeElement;if(wcPreProcess(rsp,true,page,selector,resourcename)!=true)return rsp;if(page&&rsp.data)page._rsp=rsp;if(rsp.iframeid&&$("body").children(".wcx-popup-window-header").length==0){var header=$("<div></div>").addClass("wcx-popup-window-header ds-modal-header").insertBefore(wcapplication.topframe._element);wcapplication.topframe._element.css("top","48px");var wcPopup=wcapplication.topframe._element.parent();wcPopup.addClass("ds-modal");
$(wcPopup).on("keydown",function(e){var kc=e.keyCode;if(kc==27){var jqobj=$(e.target).closest(".wcx-multiframes-content-pane");var wcobj=jqobj&&jqobj.length?jqobj.data("wcobj"):false;var hasFrameAnimation=wcobj?wcobj.wcContentFrame.wcFrameInfo.wcFrameFlag&&wcMF.frame.wcDoAnimationFlag:false;if(hasFrameAnimation){e.stopPropagation();e.preventDefault()}else{var closeBtn=$(wcPopup).find(".ds-modal-header-close");if(closeBtn&&closeBtn.length>0)closeBtn.click();else{var esc=$.Event("keydown",{keyCode:27});
parent.$("body").find("#"+wcapplication.iframeid).trigger(esc)}}}});wcPopup.attr("data-ibx-nav-map",".wcx-navmenu");wcapplication.windowtitle=new WcxLabel;wcapplication.windowtitle._element.addClass("wcx-header-label ds-modal-header-title").appendTo(header);var button=new WcxButtonSimple(null,"wc_close.svg");button._element.ibxWidget("setAccessibility",false);button._element.addClass("ds-modal-header-close ds-btn ds-btn-link").attr("tabindex","0");button._setQaAttr("XClose");button.setTitle(ibx.resourceMgr.getString("close"));
button._element.on("click.wc",function(){$("body").empty();parent.$("body").find("#"+wcapplication.iframeid).dispatchEvent("closeRsPop")});button._element.appendTo(header);wcapplication.closebutton=button;if(wcapplication.statusbar)wcapplication.statusbar._element.css("height","0px");wcapplication.topframe._element.css("bottom","0px")}if(rsp.data.item)for(var i=0;i<rsp.data.item.length;++i){if(rsp.data.item[i].type=="wcframeset"){if(rsp.data.item[i].direction=="topdown")wcxBuildWcFrameset(rsp.data.item[i],
page);else wcxBuildServletFrameset(rsp.data.item[i],page);if(typeof page.done==="function")page.done();wcPostProcess(rsp,page);return rsp}if(rsp.data.item[i].type=="wctabbedpane"){wcxBuildTabbedPane(rsp.data.item[i],page);if(typeof page.done==="function")page.done();wcPostProcess(rsp,page);return rsp}}var general=false;var container;var property=rsp.data.form;$(document.body).removeClass("ds-login-page");if(property&&property.login){wcapplication.reload=true;if(page!=wcapplication.topframe){wcapplication.toppage=
wcapplication.topframe;wcClosePopup(page);if(wcapplication.topframe){delete wcapplication.topframe.mainframe;page=wcapplication.topframe;page.removeAll()}}wcxParseLogin(rsp,page);return}if(rsp.resourcebundle&&rsp.resourceselector){page.pageproperty=property;ibx.resourceMgr.addBundle(rsp.resourcebundle,"app").then(function(container,jsonrsp){wcxAddResource2Page(container,jsonrsp)}.bind(null,page,rsp));wcPostProcess(rsp,page);return}else if(selector&&resourcename){page.pageproperty=property;rsp.resourcebundle=
resourcename;rsp.resourceselector=selector;wcxAddResource2Page(page,rsp);wcPostProcess(rsp,page);return}if(page.getResourceParams){delete page.getResourceParams;delete page.getParams}if(property&&property.center){wcapplication.reload=true;container=new WcxComponent;container._element.addClass("wcx-login-message");page.add(container);if(wcapplication.topframe){wcapplication.topframe._element.addClass("wcx-mainframe-background");if(wcapplication.isi5)wcapplication.topframe._element.addClass("wcx-ibm")}}else{if(rsp.noleavingwarning)wcapplication.reload=
true;else delete wcapplication.reload;container=new WcxComponent;container._element.addClass("wcx-content");container._element.on("resize",function(e){e.stopPropagation();var children=this.getChildren();for(var k=0;k<children.length;++k)children[k]._element.triggerHandler("resize")}.bind(container));page.add(container);general=true;if(wcapplication.topframe){wcapplication.topframe._element.removeClass("wcx-mainframe-background");if(wcapplication.isi5)wcapplication.topframe._element.removeClass("wcx-ibm")}}var showall=
false;if(rsp.data.item)for(var i=0;i<rsp.data.item.length;++i)if(rsp.data.item[i].type=="wcmenu"||rsp.data.item[i].type=="wctree"||rsp.data.item[i].type=="wcframeset"||rsp.data.item[i].type=="wcform"||rsp.data.item[i].type=="wctabbedpane"||rsp.data.item[i].type=="wclngraph"||rsp.data.item[i].type=="wcmultiframes"||rsp.data.item[i].type=="wccalculator"||rsp.data.item[i].type=="wcexpcalculator"||rsp.data.item[i].type=="wcfilter"||rsp.data.item[i].type=="wcbarchart"||rsp.data.item[i].type=="wctexteditor"||
rsp.data.item[i].type=="wctable"){showall=true;break}if(showall){page.pageproperty=property;if(property&&property.myid)page.setName(property.myid);wcapplication.setWcfObject(page);if(property&&property.canenter){page._element.off("keydown");page._element.keydown(function(e){if(e.keyCode==$.ui.keyCode.ENTER)$(this).find(".ibx-button[enterbutton='y']").click()})}}if(rsp.pageheader&&rsp.pageheader!=""&&typeof page.setWindowTitle==="function"&&rsp.pagetitle){var div=new WcxComponent;div._element.addClass("wcx-page-header");
div.add(new WcxLabel(rsp.pageheader));container.add(div)}page.focusTaken=false;if(rsp.data.item){var buttons=[];for(var i=0;i<rsp.data.item.length;++i){var item=rsp.data.item[i];item._page=page;var ui=wcBuild(item);if(ui)if(general&&ui instanceof WcForm&&ui._element.children(".wcx-buttonbar").length>0)buttons.push(ui);else{if(ui.top)container.prepend(ui);else container.add(ui);if(!page.useFocusInfo)if(page.willTakeFocus&&!page.focusTaken){if(ui.takeFocus)page.focusTaken=ui.takeFocus()}else if(ui.wcFocusedObj)page.focusTaken=
true}}if(buttons.length>0){page._element.css("justify-content","space-between");page.add(buttons[0])}}container._element.css("overflow-x","auto");var children=container.getChildren();for(var i=0;i<children.length;++i){var child=children[i];if(child.hidehscrollbar||child instanceof WcTree||child instanceof WcTable||child instanceof WcMultiframes||child instanceof WcExpCalculator||child instanceof WcFilter||child instanceof WcForm&&child.wcitems&&(child.wcitems[0]instanceof WcCheckBoxList||child.wcitems[0]instanceof
WcRadioList||child.wcitems[0]instanceof WcButtonList)){container._element.css("overflow-x","hidden");break}}if(container._element.is(":empty"))page.remove(container);wcPostProcess(rsp,page);return rsp}
function wcPreProcess(rsp,main,page,selector,resourcename){if(!rsp)return false;if(rsp.iframeid)wcapplication.iframeid=rsp.iframeid;if(rsp.errormsg)new WcMessageDialog(rsp.errormsg,"warning",rsp.errortitle);if(rsp.error)new WcMessageDialog(rsp.error,"error",rsp.errortitle);if(rsp.notification)new WcNotification(rsp.notification,rsp.pagetitle);if(rsp.stopthreshold)wcapplication.stopthreshold=rsp.stopthreshold;if(typeof rsp.csrftoken!=="undefined")wcapplication.csrftokenvalue=rsp.csrftoken;if(typeof rsp.csrftokenname!==
"undefined")wcapplication.csrftokenname=rsp.csrftokenname;if(typeof rsp.trackingid!=="undefined"&&typeof aptrinsic!=="undefined"){wcapplication.gspx_userid=rsp.trackingid;aptrinsic("identify",{"id":wcapplication.gspx_userid,"signUpDate":(new Date).valueOf(),"IBIRelease":wcapplication.gspx_release},{"id":wcapplication.gspx_siteid})}if(rsp.timermessage)wcapplication.customtimermsg=rsp.timermessage;if(rsp.closewindow)if(window.opener&&sessionStorage.srvtool){wcapplication.reload=true;window.close();
window.close();return false}if(rsp.link){var link=rsp.link;if(page)link.jqobj=page._element;else link.jqobj=wcapplication.topframe._element;if(selector&&resourcename)link.resourcebundle={"filename":resourcename,"selector":selector};wcSubmitLink(link);if(page&&typeof page.done==="function")page.done();return false}if(rsp.showlastpg)return false;if(rsp.data.form&&rsp.data.form.login){var dlg;if(window.name!="wchome"&&ibx.resourceMgr.getString("serverrestarted")){dlg=new WcMessageDialog(ibx.resourceMgr.getString("serverrestarted"),
"error");dlg.onClose(function(){wcapplication.reload=true;window.close();window.close()});return}if(!page){new WcMessageDialog(ibx.resourceMgr.getString("serverrestarted"),"error");return}var m=page._element.closest(".ds-modal");if(m.length>0||rsp.iframeid){dlg=new WcMessageDialog(ibx.resourceMgr.getString("serverrestarted"),"error");dlg.onClose(function(){wcClosePopup(this)},page);return}}if(!main)return true;if(!page){if(rsp.redirect&&rsp.redirect.message){var link=rsp.redirect;link.http_target=
"TARGET_NONE";wcSubmitLink(link)}wcPostProcess(rsp);return false}if(rsp.backgroundlink){var link=rsp.backgroundlink;link.http_target="TARGET_NONE";link.no_wait=true;if(link.parameters===undefined)link.parameters=[];link.parameters.push({"name":"IBIS_async","value":"y"});wcSubmitLink(link)}if(page==wcapplication.topframe){wcapplication.toppage=wcapplication.topframe;delete wcapplication.topframe.mainframe}if(rsp.redirect)if(!page.wcIsPopupPage){ibxPopupManager.closeOpenPopups(".ibx-menu");page.removeAll();
page.xmlwcfitem=[]}if(rsp.data&&rsp.data.item)for(var i=0;i<rsp.data.item.length;++i)if(rsp.data.item[i].type=="wcmenu"||rsp.data.item[i].type=="wctree"||rsp.data.item[i].type=="wcframeset"||rsp.data.item[i].type=="wcform"||rsp.data.item[i].type=="wctabbedpane"||rsp.data.item[i].type=="wclngraph"||rsp.data.item[i].type=="wcmultiframes"||rsp.data.item[i].type=="wccalculator"||rsp.data.item[i].type=="wcexpcalculator"||rsp.data.item[i].type=="wcfilter"||rsp.data.item[i].type=="wcbarchart"||rsp.data.item[i].type==
"wctexteditor"||rsp.data.item[i].type=="wctable")if(!page.wcIsPopupPage){ibxPopupManager.closeOpenPopups(".ibx-menu");page.removeAll();page.xmlwcfitem=[];break}if(rsp.redirect){if(typeof page.wcUpdate=="function")page.wcUpdate(true);var link=rsp.redirect;link.jqobj=page._element;wcSubmitLink(link);if(typeof page.done==="function")page.done();return false}$(document.body).removeAttr("aria-label");$(document.body).removeAttr("role");if(window.top!=window.self){document.title=rsp.pageheader;var iframe=
$(".ds-modal.pop-top iframe",window.parent.document);if(iframe&&iframe.length){iframe.attr("role","dialog");iframe.removeAttr("tabindex")}}if(typeof page.setWindowTitle==="function")page.setWindowTitle(rsp.pagetitle?rsp.pagetitle:rsp.pageheader);else if(wcapplication.windowtitle)if(rsp.pagetitle)wcapplication.windowtitle.setText(rsp.pagetitle);else if(rsp.pageheader){wcapplication.windowtitle.setText(rsp.pageheader);if(wcapplication.closebutton&&!wcapplication.closebutton._disposed){var announcement=
rsp.pageheader+" dialog "+ibx.resourceMgr.getString("close")+" dialog";var closeEl=wcapplication.closebutton._element;if(closeEl){closeEl.ibxWidget("setAccessibility",true,{label:announcement});closeEl.focus();closeEl.off("blur").on("blur",function(){try{this.ibxWidget("setAccessibility",true,{label:ibx.resourceMgr.getString("close")+" dialog"})}catch(e){}}.bind(closeEl))}}}if(rsp.restarting){if(rsp.restarting.url&&rsp.restarting.qry){var waiting=new WcxWaiting(rsp.restarting.message);wcapplication.topframe.add(waiting);
var tid=setInterval(function(){$.ajax({method:"GET",url:rsp.restarting.qry}).done(function(){clearInterval(tid);if(window.ibitimerintervals){var index=window.ibitimerintervals.indexOf(tid);if(index>=0)window.ibitimerintervals.splice(index,1)}var xml=new WcLoader(rsp.restarting.url);xml.addParam("IBIS_login","y");wcapplication.reload=true;wcSubmitForm(window.document,xml.getHtmlForm())})},1E4);if(window.ibitimerintervals)window.ibitimerintervals.push(tid)}return false}return true}
function wcPostProcess(rsp,page){if(page&&page.setAllowRefresh)page.setAllowRefresh(null);if(page&&!page.focusTaken)wcHandleFocusInfo(page);if(document.styleSheets)wcFixStylesheets();if(rsp.refreshpage)wcProcessRefreshpage(rsp.refreshpage,page);if(rsp.showframe)wcProcessShowframe(rsp.showframe,page);if(rsp.autorefresh&&page&&page.setAllowRefresh){var nparams=new WcUrl;nparams.setUrl(rsp.autorefresh.url);nparams.addParam(rsp.autorefresh.parameters);page.setAllowRefresh(nparams)}if(rsp.closelink){if(page&&
page.popupwindow){var popup=page.popupwindow;popup.delayClose=true;popup._element.ready(function(){var closeBtn=$(popup._element).find(".ds-modal-header-close.ds-btn.ds-btn-link");if(closeBtn&&closeBtn.length>0)wcAttachLinksTo(closeBtn,[rsp.closelink])});if(rsp.winsize){page.setWindowSize(rsp.winsize);$(window).trigger("resize")}}if(wcapplication.windowtitle){var closeBtn=wcapplication.windowtitle._element.siblings(".ds-modal-header-close.ds-btn.ds-btn-link");if(closeBtn&&closeBtn.length>0)wcAttachLinksTo(closeBtn,
[rsp.closelink])}}if(page&&page instanceof WcMultiframesContentPane)page.setTitleText(rsp.pageheader,null,rsp.pagetitle);if(rsp.restartnow){var xml=new WcLoader(rsp.restartnow.url);xml.addParam(rsp.restartnow.parameters);xml.load(wcxParseXml,wcapplication.topframe)}if(page){if(rsp.closepage&&typeof page.close==="function")page.close();if(typeof rsp.closepopup!=="undefined")wcClosePopup(page,rsp.closepopup);if(typeof page.done==="function")page.done()}if(rsp.walkme)setTimeout(function(name){$.get(wcapplication.wcurl.replace("/webconsole",
"/wc/walkme.xml"),function(data){var script=$("#"+name,data);if(script.length>0)$.globalEval($(script[0]).html())},"xml")},0,rsp.walkme)}function wcFixStylesheets(){var cssSheets=document.styleSheets;if(cssSheets.length)for(var i=cssSheets.length-1;i>0;i--){var checkCss=cssSheets[i];if(checkCss.href)for(var j=i-1;j>0;j--){var matchCss=cssSheets[j];if(matchCss.href&&checkCss.href==matchCss.href){checkCss.disabled=true;break}}}}
function wcSaveFocusInfo(obj){if(!wcapplication.wcFocusInfo)wcapplication.wcFocusInfo={};var focusInfo=wcapplication.wcFocusInfo;var activeInfo={};var activeEl=document.activeElement;if(activeEl){var fp=$(activeEl).closest(".wcx-filepicker-dialog");if(fp&&fp.length)return;var itemUnknown=false;if(activeEl.tagName)if(activeEl.tagName=="BODY"||$(activeEl).hasClass("ibx-button-simple"))itemUnknown=true;else if(activeEl.tagName=="INPUT"){var parentEl=$(activeEl).closest(".wcx-emailaddr");if(parentEl&&
parentEl.length)itemUnknown=true}var formItemSet=false;if(itemUnknown){activeEl=null;if(obj&&obj.focusEl){activeEl=obj.focusEl;var emailaddr=$(activeEl).find(".wcx-emailaddr");if(emailaddr&&emailaddr.length){activeInfo.formItem=$(activeEl).data("wcobj");formItemSet=true;var firstSelect=emailaddr.find(".ibx-select")[0];activeInfo.formItemID=$(firstSelect).attr("qa")}else if($(activeEl).hasClass("ds-textarea")){jqobj=$(activeEl).find("textarea");if(jqobj&&jqobj.length)activeEl=jqobj[0]}else if($(activeEl).hasClass("wcx-inputtext")){jqobj=
$(activeEl).find("input");if(jqobj&&jqobj.length)activeEl=jqobj[0]}}if(!activeEl)return;activeInfo.focusNext=true}activeInfo.activeEl=activeEl;activeInfo.tagName=activeEl.tagName;if(!formItemSet)if(activeInfo.tagName=="INPUT"||activeInfo.tagName=="TEXTAREA"||$(activeEl).hasClass("wcx-checkbox")){var formItemEl=$(activeEl).closest(".wcx-form-item");if(formItemEl&&formItemEl.length)activeInfo.formItem=$(formItemEl).data("wcobj")}var accPaneEl=$(activeEl).closest(".ds-accordian");if(accPaneEl&&accPaneEl.length){var arrExpandStates=
[];var jqAccPages=accPaneEl.find(".ds-accordian-page");for(var i=0;i<jqAccPages.length;i++){var accPage=jqAccPages[i];var expanded=!$(accPage).hasClass("acc-pg-closed");arrExpandStates.push(expanded)}activeInfo.expandedStates=arrExpandStates}focusInfo.lastActive=activeInfo}}
function wcHandleFocusInfo(page){var focusInfo=wcapplication.wcFocusInfo;if(focusInfo){if(focusInfo.wcPendingHandle)clearTimeout(focusInfo.wcPendingHandle);focusInfo.wcPendingHandle=setTimeout(function(){var lastActive=focusInfo.lastActive;if(lastActive)if(lastActive.tagName!=="BODY"){var formItem=lastActive.formItem;if(formItem&&formItem.getName){var jqNewItem=null;var itemName=lastActive.formItemID?lastActive.formItemID:formItem.getName();if(itemName){jqNewItem=$(page._element).find("div[qa='"+
itemName+"']");if(jqNewItem&&jqNewItem.length){var wcNewItem=jqNewItem.data("wcobj");if(wcNewItem)if(wcNewItem.takeFocus)wcNewItem.takeFocus();else{var input=$(wcNewItem._element).find("input");if(input&&input.length)setTimeout(function(){input[0].focus()},500)}}}if(lastActive.expandedStates)if(jqNewItem){var accPaneEl=jqNewItem.closest(".ds-accordian");if(accPaneEl&&accPaneEl.length){var accPages=$(accPaneEl[0]).find(".ds-accordian-page");if(accPages&&accPages.length)for(var i=0;i<accPages.length;i++){var accPageEl=
accPages[i];if(accPageEl){var wcAccPage=$(accPageEl).data("wcobj");var expanded=null;if(lastActive.expandedStates.length>i)expanded=lastActive.expandedStates[i];if(expanded===null)break;if(wcAccPage)wcAccPage.setSelected(expanded)}}}}}}focusInfo.wcPendingHandle=null},500)}}
function wcAriaSpeak(text){var el=document.createElement("div");var id="speak-"+Date.now();el.setAttribute("id",id);el.setAttribute("aria-live","polite");el.classList.add("screen-reader-only");document.body.appendChild(el);window.setTimeout(function(){var node=document.getElementById(id);if(node)node.innerText=text},100);window.setTimeout(function(){var node=document.getElementById(id);if(node)document.body.removeChild(node)},1E3)}
function wcProcessRefreshpage(rfrsh,page){for(var k=0;k<rfrsh.length;++k){if(rfrsh[k].item){for(var i=0;i<rfrsh[k].item.length;++i)if(rfrsh[k].item[i].type=="wcbutton"){var obj=$("body").find("div[wcid='"+rfrsh[k].item[i].name+"']");if(obj.length>0){var wcobj=obj.data("wcobj");if(wcobj){wcobj.setEnabled(!rfrsh[k].item[i].disabled);wcobj.setTitle(rfrsh[k].item[i].tooltip)}}else if(typeof ibxShellTool!=="undefined"){var shellTool=wcapplication.shellTool;if(shellTool){shellTool.setResContext(true);obj=
$("body").find("div[wcid='"+rfrsh[k].item[i].name+"']");var wcobj=obj.data("wcobj");if(wcobj){wcobj.setEnabled(!rfrsh[k].item[i].disabled);wcobj.setTitle(rfrsh[k].item[i].tooltip)}shellTool.setResContext(false)}}}continue}rfrsh[k].refreshobj=true;if(page){rfrsh[k].jqobj=page._element;rfrsh[k].wcDoNotTrack=true}wcSubmitLink(rfrsh[k])}}
function wcProcessShowframe(showframe,page){for(var i=0;i<showframe.length;i++){var sf=showframe[i];var mf_id=sf.multiframes_id;var frame_id=sf.frame_id;if(mf_id&&frame_id){var mf=wcapplication.getWcfObject(mf_id);if(mf&&mf instanceof WcMultiframes){var frame=mf.getFrameByFrameID(frame_id);if(frame){if(sf.show)frame.show("SHOW");else frame.hide();mf.sendUpdateLayout("RESIZE")}}}}}
function wcxParseLogin(rsp,page){var oldLogin=$(".dm-login-wrap");if(oldLogin&&oldLogin.length>0){oldLogin.empty();oldLogin.remove()}$(document.body).removeAttr("role");$(document.body).addClass("ds-login-page");if(wcapplication.isi5)$(document.body).addClass("wcx-ibm");var htmlLogin='<div class="dm-login-wrap">'+'<div class="dm-custom-msg" style="display:none"></div>'+'<div class="dm-phone-msg"></div>'+'<div class="dm-language">'+'<div class="language-div" id="language-menu">'+"</div>"+"</div>"+
'<div class="dm-body">'+'<div class="dm-top-border"></div>'+'<div class="dm-top-banner"></div>'+'<div class="dm-top-banner-text"></div>'+'<div class="dm-header">'+"Sign in"+"</div>"+'<h1 style="position:absolute; opacity:0">Sign In</h1>'+'<div class="dm-container">'+'<div tabindex="-1" class="dm-error" data-ibxp-nav-key-root="true" data-ibxp-focus-default="true">'+"</div>"+'<div class="dm-uname">'+'<div class="dm-username">'+'<label class="dm-label-name" for="uname" id="Username">Username</label>'+
'<label class="dm-star">*</label>'+"</div>"+'<div id="wc-uname"></div>'+"</div>"+'<div class="dm-label-divider">'+'<div class="dm-password">'+'<label class="dm-label-name" for="psw" id="Password">Password</label>'+'<label class="dm-star">*</label>'+"</div>"+'<div id="wc-password"></div>'+'<div class="dm-newpassword-container">'+'<div class="dm-newpassword dm-label-divider">'+'<label class="dm-label-name" for="newpsw" id="NewPassword">New Password</label>'+'<label class="dm-star">*</label>'+"</div>"+
'<div id="wc-newpassword"></div>'+'<div class="dm-newpasswordc dm-label-divider">'+'<label class="dm-label-name" for="newpswc" id="NewPasswordC">Confirm Password</label>'+'<label class="dm-star">*</label>'+"</div>"+'<div id="wc-newpasswordc"></div>'+"</div>"+'<div class="dm-bottom-container">'+'<div class="dm-left-container">'+'<div class="dm-provider">'+'<div class="dm-sec-provider">'+'<label class="dm-label-name" for="secprovider" id="SecProvider">Security Provider</label>'+'<label class="dm-star">*</label>'+
"</div>"+'<div id="wc-provider"></div>'+"</div>"+"</div>"+'<div class="dm-center-container">'+'<div class="dm-center">'+"<div></div>"+'<div id="wc-center"></div>'+"</div>"+"</div>"+'<div class="dm-right-container">'+'<div class="dm-domain-container">'+'<div class="dm-domain">'+'<label class="dm-label-name" for="domain" id="Domain">Domain</label>'+'<label class="dm-star">*</label>'+"</div>"+'<div id="wc-domain"></div>'+"</div>"+"</div>"+"</div>"+'<div class="dm-bottom-left">'+'<div tabindex="0" class="dm-button" id="CancelbtnLogin" alt="Cancel">Cancel</div>'+
"</div>"+'<div tabindex="0" class="dm-button" id="SignonbtnLogin" alt="Sign in">Sign in</div>'+"</div>"+"</div>"+'<div class="dm-copyright" alt="Copyright '+wcapplication.buildyear+' TIBCO Software Inc. All rights reserved.">Copyright &copy; '+wcapplication.buildyear+" TIBCO Software Inc. All rights reserved.</div>"+"</div>"+"</div>";$(document.body).append(htmlLogin);if(wcapplication.isclm)$(document.body).find(".dm-top-banner-text").text("Cluster Manager");var doParseRows=function(rows,itms){if(rows&&
rows.length>0)for(var i=0;i<rows.length;i++){var items=rows[i].item;if(items)for(var j=0;j<items.length;j++){var item=rows[i].item[j];if(item){item._page=page;var wcobj=wcBuild(item);if(item.label)wcobj.label=item.label;if(item.xlink)wcobj.xlink=item.xlink;if(wcobj)itms.push(wcobj)}}}};var getLoginItemByName=function(name,itms){if(itms&&itms.length>0)for(var i=0;i<itms.length;i++){var item=itms[i];if(item.getName&&item.getName()==name)return item}};var getLoginButtons=function(itms){var btns=[];if(itms&&
itms.length>0)for(var i=0;i<itms.length;i++){var item=itms[i];if(item instanceof WcButton)btns.push(item)}return btns};var getLoginTexts=function(itms){var txts=[];if(itms&&itms.length>0)for(var i=0;i<itms.length;i++){var item=itms[i];if(item instanceof WcTextOnly)txts.push(item)}return txts};var loginform;var servername;var msg;var custommsg;var items=rsp.data.item;if(items&&items.length>0)for(var i=0;i<items.length;i++){var itm=items[i];if(itm.formid=="loginform")loginform=itm;else if(itm.formid==
"servername")servername=itm;else if(itm.formid=="msg")msg=itm;else if(itm.formid=="custommsg")custommsg=itm}if(!wcapplication.wclogin)wcapplication.wclogin={};wcapplication.wclogin.wcItems=[];var wcitems=wcapplication.wclogin.wcItems;if(loginform){doParseRows(loginform.row,wcitems);var wcSelect=getLoginItemByName("IBIS_wclng",wcitems);var wcUsername=getLoginItemByName("IBIC_user",wcitems);var wcPassword=getLoginItemByName("IBIC_pass",wcitems);var wcNewPwd=getLoginItemByName("IBIS_newpwd",wcitems);
var wcNewPwdC=getLoginItemByName("IBIS_newpwdc",wcitems);var hasNewPwd=false;var wcSecProvider=getLoginItemByName("IBIC_secprovider",wcitems);var wcDomain=getLoginItemByName("IBIC_domain",wcitems);var hasBottomContainer=false;var wcAutoLogin=getLoginItemByName("IBIS_autologin",wcitems);var wcButtons=getLoginButtons(wcitems);if(wcButtons&&wcButtons.length>0){wcapplication.wclogin.wcSignInButton=wcButtons[0];var txtSignIn=wcapplication.wclogin.wcSignInButton.getText();var txtCancel="Cancel";if(wcButtons.length>
1){wcapplication.wclogin.wcCancelButton=wcButtons[1];txtCancel=wcapplication.wclogin.wcCancelButton.getText()}$(".dm-header").text(txtSignIn?txtSignIn:"")}if(wcSelect){$("#language-menu").html(wcSelect._element);wcSelect._element.find("input").attr("aria-label","Choose language")}if(wcUsername){$("#Username").text(wcUsername.label);$("#wc-uname").html(wcUsername._element);$("#wc-uname").find("input").attr("aria-labelledby","Username")}if(wcPassword){$("#Password").text(wcPassword.label);$("#wc-password").html(wcPassword._element);
$("#wc-password").find("input").attr("aria-labelledby","Password")}if(wcSecProvider){hasBottomContainer=true;$("#SecProvider").text(wcSecProvider.label);$("#wc-provider").html(wcSecProvider._element);$("#wc-provider").find("input").attr("aria-labelledby","SecProvider")}if(wcDomain){hasBottomContainer=true;$("#Domain").text(wcDomain.label);$("#wc-domain").html(wcDomain._element);$("#wc-domain").find("input").attr("aria-labelledby","Domain")}if(wcapplication.wclogin.wcCancelButton)$("#CancelbtnLogin").css("display",
"block");if(wcAutoLogin)$(".dm-bottom-left").html(wcAutoLogin._element);$("#SignonbtnLogin").attr("alt",txtSignIn?txtSignIn:"");$("#SignonbtnLogin").text(txtSignIn?txtSignIn:"");$("#CancelbtnLogin").attr("alt",txtCancel?txtCancel:"");$("#CancelbtnLogin").text(txtCancel?txtCancel:"");if(hasBottomContainer){$(".dm-bottom-container").css("display","flex");if(wcDomain){$(".dm-left-container").css("display","inherit");$(".dm-center-container").css("display","inherit");$(".dm-right-container").css("display",
"inherit")}else{$(".dm-left-container").css("display","inherit");$(".dm-left-container").css("width","100%");$(".dm-center-container").css("display","none");$(".dm-right-container").css("display","none")}$(".dm-body").css("height","655px")}if(wcNewPwd||wcNewPwdC){hasNewPwd=true;$(".dm-newpassword-container").css("display","block");if(wcNewPwd){$("#NewPassword").text(wcNewPwd.label);$("#wc-newpassword").html(wcNewPwd._element)}if(wcNewPwdC){$("#NewPasswordC").text(wcNewPwdC.label);$("#wc-newpasswordc").html(wcNewPwdC._element)}$(".dm-body").css("height",
"775px")}}if(servername)doParseRows(servername.row,wcitems);if(msg){wcitems=[];doParseRows(msg.row,wcitems);var wcTexts=getLoginTexts(wcitems);if(wcTexts&&wcTexts.length>0){wcapplication.wclogin.wcMessage=wcTexts[wcTexts.length-1];var txtMessage=wcapplication.wclogin.wcMessage.getText();var errOptions={type:"error",displayCloseIcon:false,info:txtMessage,isMultiMessages:false,msgType:"F"};$(".dm-error").css("height","auto");$(".dm-error").css("margin","0");$(".dm-error").attr("tabindex","0");$(".dm-error").focus();
var errWarnMsg=$(".dm-error").errorWarningMessages();errWarnMsg.ibxWidget("option",errOptions);$(".dm-uname").addClass("dm-label-divider");if(!hasNewPwd){$("#wc-uname").addClass("dm-has-error");$("#wc-password").addClass("dm-has-error")}}}if(custommsg){wcitems=[];doParseRows(custommsg.row,wcitems);var wcTexts=getLoginTexts(wcitems);if(wcTexts&&wcTexts.length>0){wcapplication.wclogin.wcCustomMsg=wcTexts[wcTexts.length-1];var txtCustomMsg=wcapplication.wclogin.wcCustomMsg.getText();if(txtCustomMsg){var img=
new WcxLabel(null,false,"ds-icon-announcement");img._element.addClass("dm-custom-msg-icon");var txt=$("<div></div>");txt.addClass("dm-custom-msg-text");txt.html(txtCustomMsg);$(".dm-custom-msg").css("display","").append(img._element).append(txt);$(".dm-custom-msg").attr("tabindex","0")}}}setTimeout(function(){var bodyOffset=$(".dm-body").offset().top;var btnOffset=$("#SignonbtnLogin").offset().top;var copyRTop=btnOffset-bodyOffset+80;var bodyHeight=copyRTop+63;var customMsgTop=bodyHeight;$(".dm-body").css("height",
bodyHeight+"px");if(wcapplication.isi5)$(".dm-copyright").text(ibx.resourceMgr.getString("reporting_server_console")).attr("alt",ibx.resourceMgr.getString("reporting_server_console"))},0);wcapplication.wclogin.wcSubmitLogin=function(xlink){if(xlink){var wcitems=wcapplication.wclogin.wcItems;var params=new Object;for(var i=0;i<wcitems.length;i++)params=wcGetParams(wcitems[i],params);var hasLang=false;var p=xlink[0].parameters;for(var param in params){if(param=="IBIS_wclng"){hasLang=true;wcapplication.wclogin.wcLang=
params[param][0]}var data={};data.name=param;data.value=params[param][0];p.push(data)}wcSubmitLink(xlink[0])}};$(".dm-login-wrap").on("keydown",function(e){var keycode=e.keyCode;if(keycode==13){var wcSignInBtn=wcapplication.wclogin.wcSignInButton;if(wcSignInBtn)wcapplication.wclogin.wcSubmitLogin(wcSignInBtn.xlink)}else if(keycode==27){var wcCancelBtn=wcapplication.wclogin.wcCancelButton;if(wcCancelBtn)wcapplication.wclogin.wcSubmitLogin(wcCancelBtn.xlink)}});$("#SignonbtnLogin").on("click",function(){var wcSignInBtn=
wcapplication.wclogin.wcSignInButton;if(wcSignInBtn)wcapplication.wclogin.wcSubmitLogin(wcSignInBtn.xlink)});$("#CancelbtnLogin").on("click",function(){var wcCancelBtn=wcapplication.wclogin.wcCancelButton;if(wcCancelBtn)wcapplication.wclogin.wcSubmitLogin(wcCancelBtn.xlink)})}
function wcxParseMainMenu(rsp,page){if(wcPreProcess(rsp,false)!=true)return;if(page&&rsp.data)page._rsp=rsp;for(var i=0;i<rsp.data.item.length;++i){if(rsp.data.item[i].type!="wcmenu")continue;var divider=new WcxHBox;wcapplication.topframe._element.prepend(divider._element.addClass("wcx-mainmenu-bar-top"));var left=new WcxHBox;left._element.addClass("wcx-mainmenu-bar-left");var logo=$("<img></img>").addClass("wcx-webfocus-logo-clickable").addClass("wcx-webfocus-logo").css("cursor","pointer").attr("src",
wcapplication.logo).attr("tabindex","0");if(wcapplication.isi5)logo.attr("title",ibx.resourceMgr.getString("home")).attr("aria-label",ibx.resourceMgr.getString("home"));else logo.attr("title",ibx.resourceMgr.getString("tibcohome")).attr("aria-label",ibx.resourceMgr.getString("tibcohome"));logo.on("click",function(e){e.preventDefault();e.stopPropagation();var home=new WcLoader(wcapplication.wcurl);home.addParam("IBIS_page","APPLICATIONS");home.load(wcxParseXml,wcapplication.topframe)});left._element.append(logo);
left._element.append($("<div>/</div>").addClass("wcx-webfocus-logo-separator"));var right=new WcxHBox;right._element.addClass("wcx-mainmenu-bar-right");page.add(left);page.add(right);var menuNodes=rsp.data.item[i];var mct=menuNodes.node.length;for(var i=0;i<mct;i++){var cnode=menuNodes.node[i];cnode._objtype="wcnode";cnode._page=page;if(rsp.data&&rsp.data.item)for(var j=0;j<rsp.data.item.length;j++){var item=rsp.data.item[j];if(item.type=="wcmenu")cnode._popupnodes=item.node}if(cnode.isPopup){if(cnode.isPopup())continue}else if(cnode.cat==
"popup")continue;var button;var position=cnode.getPosition?cnode.getPosition():cnode.position;if(position=="right"){button=wcCreateIconButton(cnode);button._element.addClass("ds-btn ds-btn-link");right.add(button)}else if(position=="bottom"){button=wcCreateIconButton(cnode);wcapplication.statusbar.removeAll();wcapplication.statusbar.add(button)}else{var label=new WcxLabel(cnode.label.text);label.setTitle(cnode.title);label._element.addClass("wcx-mainmenu-bar-left-item ds-btn ds-btn-link");wcAttachLinksTo(label,
cnode.xlink);left.add(label)}}}wcapplication.topframe._element.css("bottom","17px");if(wcapplication.statusbar)wcapplication.statusbar._element.show();wcPostProcess(rsp)}
function wcxParseRibbon(rsp,ribbon){if(wcPreProcess(rsp,false)!=true)return;ribbon.removeAllButtons();if(ribbon&&rsp.data)ribbon._rsp=rsp;if(rsp.data.item)for(var i=0;i<rsp.data.item.length;++i){if(rsp.data.item[i].type!="wctree")continue;var wcobj=rsp.data.item[i];var wcnode=null;for(var j=0;j<wcobj.node.length;++j)if(wcobj.node[j].cat=="ribbon"){wcnode=wcobj.node[j];break}if(wcnode&&(wcnode.node||wcnode.groupname)&&wcnode.cat=="ribbon"){var groups=[];if(wcnode.groupname)for(var j=0;j<wcnode.groupname.length;j++)groups.push(wcnode.groupname[j].name);
ribbon.setGroups(groups);var childnodes=wcnode.node;if(childnodes)for(var j=0;j<childnodes.length;j++){var node=childnodes[j];node._objtype="wcnode";node._page=ribbon;if(rsp.data&&rsp.data.item)for(var k=0;k<rsp.data.item.length;k++){var item=rsp.data.item[k];if(item.type=="wctree")node._popupnodes=item.node}ribbon.addButton(node,wcnode.groupname)}}}if(rsp.pageicon)ribbon.addLogo(rsp.pageicon,rsp.pageiconlink);if(rsp.pagetitle)ribbon.addTitle(rsp.pagetitle,rsp.pageheader);wcPostProcess(rsp);if(ribbon.willTakeFocus)ribbon.takeFocus()}
function wcCloseTab(){var tp=this._element.parent().data("wcobj");tp.pane.removePage(tp)}
function wcxBuildTabbedPane(tabpane,page){var pane;var flags=tabpane.flags;if(flags&16){wcxBuildCollapsible(tabpane,page);return}else pane=new WcxTabPane(flags&1?"top":"bottom",flags&4?true:false);if(flags&4)pane._element.css("padding","0px 16px");pane._element.addClass("wcx-tabbedpane");pane._element.addClass("ibxtool-pages-pane");page.add(pane);var tabs=tabpane.item;for(var i=0;i<tabs.length;i++){var tab=tabs[i];var current=tab.current;var abbrv=tab.abbreviation;var text=tab.text;var tp=new WcxTabPage(abbrv?
abbrv:text,tab.image);if(flags&8)tp._element.addClass("ds-tab-box-shadow");tp.setTitle(text);pane.addPage(tp,current,flags&2?true:false);tp.page=page;tp.pane=pane;tp.url=tab.url;var topframe=new WcxVBox;topframe._element.addClass("wcx-tabtopframe");topframe._element.attr("contentpage","y");topframe.close=wcCloseTab;tp.add(topframe);tp.addEventListenerToTabButton("click",function(e){if(this.page==wcapplication.topframe)wcapplication.toppage=this._children[0];var xml=new WcLoader(this.url);xml.load(wcxParseXml,
this._children[0])},tp);if(current){if(page==wcapplication.topframe)wcapplication.toppage=topframe;var xml=new WcLoader(tp.url);xml.load(wcxParseXml,topframe)}if(!(flags&2)){tp.closelink=tab.closelink;if(tp.closelink){tp.closelink.jqobj=topframe._element;tp.addClickEventListenerToCloseButton(function(e){wcSubmitLink(this.closelink);e.stopPropagation()},tp)}}}}
function wcxBuildCollapsible(wcitem,page){var accPane=new WcxAccordionPane;accPane._element.addClass("ds-collapsible");page.add(accPane);for(var i=0;i<wcitem.item.length;i++){var wcitempage=wcitem.item[i];var accPage=new WcxAccordionPage;accPage._element.addClass("ds-accordian-page");accPage.setSelected(i==0);accPage.wcTitle=wcitempage.text;accPage.setTitle(accPage.wcTitle);accPane.addPage(accPage);var topframe=new WcxVBox;topframe._element.addClass("wcx-collapsibletopframe");topframe._element.attr("contentpage",
"y");accPage.addContent(topframe);accPage._element.on("ibx_open",topframe,function(evt){$(this._element).css("flex","1 auto");evt.stopPropagation()}.bind(accPage));accPage._element.on("ibx_close",function(evt){$(this._element).css("flex","");evt.stopPropagation()}.bind(accPage));var xml=new WcLoader(wcitempage.url);xml.load(wcxParseXml,topframe)}}
function wcxBuildServletFrameset(frameset,page){var content;var left;for(var i=0;i<frameset.iframe.length;++i){var iframe=frameset.iframe[i];var xml=new WcLoader(iframe.url);for(var k=0;k<iframe.parameters.length;++k)xml.addParam(iframe.parameters[k].name,iframe.parameters[k].value);if(iframe.id=="left"){left=new WcxVBox;left._element.addClass("wcx-servlet-left");xml.load(wcxParseXml,left)}else{content=new WcxVBox;content._element.addClass("wcx-servlet-content");xml.load(wcxParseXml,content)}}var ribbon=
new WcMainRibbon;ribbon.displayIconText(false);page.add(ribbon.getWcObject());var contentframe=new WcxHBox;contentframe._element.addClass("wcx-servlet-contentframe");contentframe.add(content);contentframe.content=content;var mainframe=new WcxHBox;mainframe._element.addClass("wcx-servlet-mainframe");mainframe.add(left);mainframe.add(contentframe);mainframe.contentframe=contentframe;page.add(mainframe);page.mainframe=mainframe;$("<div>").ibxVSplitter({"resize":"first"}).insertAfter(left._element).addClass("left-splitter");
document.body.focus()}
function wcxBuildWcFrameset(frameset,page){var mainmenubar=null;var ribbon;var content;var i;for(i=0;i<frameset.iframe.length;++i){var iframe=frameset.iframe[i];var xml=new WcLoader(iframe.url);for(var k=0;k<iframe.parameters.length;++k)xml.addParam(iframe.parameters[k].name,iframe.parameters[k].value);if(iframe.id=="1"){ribbon=new WcMainRibbon(true);if(!ribbon.wcribbon)xml.addParam("designerribbon","y");xml.load(wcxParseRibbon,ribbon)}else if(iframe.id=="0"){content=new WcxVBox;content._element.addClass("wcx-contentframe-content");
xml.load(wcxParseXml,content)}else{mainmenubar=new WcxHBox;mainmenubar._element.addClass("wcx-mainmenu-bar");xml.load(wcxParseMainMenu,mainmenubar)}}var contentframe=new WcxHBox;contentframe._element.addClass("wcx-contentframe");contentframe.sidebar=new WcSidebar;contentframe.sidebar._element.addClass("wcx-contentframe-sidebar");contentframe.add(contentframe.sidebar);contentframe.add(content);contentframe.content=content;contentframe.vtoolbar=new WcVToolbar;contentframe.vtoolbar._element.addClass("wcx-contentframe-vtoolbar");
contentframe.add(contentframe.vtoolbar);if(page.contentframe){page.add(ribbon.getWcObject());page.add(contentframe);page.ribbon=ribbon;page.contentframe=contentframe}else{if(mainmenubar!=null){page.add(mainmenubar);page.mainmenubar=mainmenubar}var mainframe=new WcxVBox;mainframe._element.addClass("wcx-mainframe");if(ribbon){mainframe.add(ribbon.getWcObject());mainframe.ribbon=ribbon}mainframe.add(contentframe);mainframe.contentframe=contentframe;page.add(mainframe);page.mainframe=mainframe}if(ribbon&&
ribbon.wcribbon){var gp=ribbon.wcribbon._element.parent();if(gp)gp=gp.parent();if(gp)if(page.mainframe){page.mainframe._element.addClass("wcx-mainframe-background");if(wcapplication.isi5)page.mainframe._element.addClass("wcx-ibm")}else{page._element.addClass("wcx-mainframe-background");if(wcapplication.isi5)page._element.addClass("wcx-ibm")}}document.body.focus()}
function wcBuildMenu(jqobj,wcnode,parentNode,parameters,menu,otherparamsfn){var childnodes;var groupname;if(wcnode.dynamic){wcnode.xlink[0]._menu_name=wcnode.dynamic;var p=wcHandleDynamicPopup(wcnode.xlink[0]);if(p){childnodes=p.node;groupname=p.groupname}}else{childnodes=wcnode.node;groupname=wcnode.groupname}if(!childnodes||childnodes.length==0)return null;if(!menu)menu=new WcxMenu;if(wcnode.noimageinallnodes)menu._element.addClass("ibx-menu-no-icons");menu._element.addClass("ds-menu");var addsep=
false;var num=0;if(!parameters&&parentNode&&parentNode.properties)parameters=parentNode.properties;for(var c=0;c<childnodes.length;++c){var n=childnodes[c];if(parameters){var hidden=false;if(n.hide_this){for(var i=0;i<parameters.length;++i)if(parameters[i].name==n.hide_this.name&&parameters[i].value==n.hide_this.value){hidden=true;break}if(hidden){if(!addsep){if(num>0)addsep=n.separator;num=0}continue}}}if(n.dynamic){var dlink=null;if(n.xlink)dlink=n.xlink[0];else if(n.label&&n.label.xlink)dlink=
n.label.xlink[0];if(dlink!=null){dlink._page=wcnode._page;dlink._popupnodes=wcnode._popupnodes;dlink._menu_name=n.dynamic;n=wcHandleDynamicPopup(dlink);if(n)n._page=dlink._page}}var item=new WcxMenuItem(n.label?n.label.text:"");item._element.addClass("ds-menuitem");++num;if(n.selected)item.setHighlighted(true);var xlink=null;if(n.image){item.setIcon(n.image.src);item.setIconColor(n.image.color);xlink=n.image.xlink}var title=n.title;if(title!="")item.setTitle(title);if(n.options)item.addSubMenu(wcBuildCheckboxMenu(jqobj,
n,parentNode,parameters,otherparamsfn));else{if(xlink==null)xlink=n.label?n.label.xlink:null;if(xlink==null)xlink=n.helplink?[n.helplink]:n.xlink?n.xlink:null;if(xlink&&xlink.length>0)for(var k=0;k<xlink.length;++k){var link=JSON.parse(JSON.stringify(xlink[k]));link.getOtherParams=otherparamsfn;link.parentNode=parentNode;if(link.method=="popup"){var node;var popupid=link.popup;if(popupid){if(wcnode._popupnodes)for(var j=0;j<wcnode._popupnodes.length;j++){var popupnode=wcnode._popupnodes[j];var pid=
popupnode.id;if(pid&&pid==popupid){node=popupnode;node._popupnodes=wcnode._popupnodes;break}}}else{node=link.node?link.node[0]:null;if(node&&wcnode)node._popupnodes=wcnode._popupnodes}if(node)item.addSubMenu(wcBuildMenu(jqobj,node,parentNode,parameters,null,otherparamsfn));else item.setEnabled(false)}else if(link.method=="popup_page"){var popupMenu=new WcxMenu;var popupItem=new WcxMenuSeparator;popupItem.wcPopupPageLink=link;popupItem._element.ready(function(){$(this._element).addClass("wcx-popupmenu-item");
$(this._element).removeClass("ibx-menu-separator");this.wcPopupPageLink.wcIsPopupPage=true;this.wcPopupPageLink.method="submit";this.wcPopupPageLink.wcobj=this;this.wcPopupPageLink.jqobj=this._element;wcExecLink(this.wcPopupPageLink)}.bind(popupItem));popupMenu.addItem(popupItem);item.addSubMenu(popupMenu)}else{if(jqobj)link.jqobj=jqobj;if(parameters&&link.parameters)for(var i=0;i<link.parameters.length;++i)if(link.parameters[i].variable)for(var j=0;j<parameters.length;++j)if(parameters[j].name==
link.parameters[i].name){link.parameters[i].value=parameters[j].value;break}wcAttachLinksTo(item,[link])}if(link.sharewith){var obj=$("body").find("div[wcid='"+link.sharewith+"']");if(obj.length>0){var wcobj=obj.data("wcobj");if(wcobj&&wcobj.updateLink)wcobj.updateLink(link)}}}else if(!n.node)item.setEnabled(false);if(n.node)item.addSubMenu(wcBuildMenu(jqobj,n,parentNode,parameters,null,otherparamsfn))}if(addsep){var sep=null;if(typeof n.groupid!=="undefined"&&groupname)for(var m=0;m<groupname.length;++m)if(groupname[m].id==
n.groupid){sep=new WcxMenuSeparatorLabel(groupname[m].name);break}if(!sep)sep=new WcxMenuSeparator;menu.addItem(sep)}menu.addItem(item);addsep=n.separator}menu.wcnode=wcnode;menu.setOption("open",function(e){var obj=e.target;var height=$(obj).height();var top=$(obj).offset().top;if(top<0){var delta=0-top;$(obj).css("top","0px");$(obj).css("max-height",height-delta+"px");top=0;height=height-delta}var winheight=$(window).height()-8;if(top+height>winheight)$(obj).css("max-height",winheight-top+"px")}.bind(menu));
return menu}
function wcBuildCheckboxMenu(jqobj,wcnode,parentNode,parameters,otherparamsfn){var options=wcnode.options;if(options){var menu=new WcxMenu;menu.setOption("multiSelect",true);menu.wcValuesChanged=false;menu.wcItemClicked=null;menu.wcXLink=wcnode.label.xlink;menu.wcOptions=[];menu._element.addClass("ds-menu");for(var i=0;i<options.length;i++){var mi=options[i];var item=new WcxCheckMenuItem(mi.text,mi.value);$(item._element).addClass("wcx-checkbox-menuitem");$(item._element).addClass("ds-menuitem");item.setChecked(mi.checked);
item.wcOption=mi;menu.wcOptions.push(item);$(item._element).on("ibx_change",function(){this.wcValuesChanged=true}.bind(menu));var itemtext=$(item._element).find(".ibx-label-no-icon");$(itemtext).on("click",function(e){this.wcItemClicked=$(e.target).closest(".wcx-checkbox-menuitem").data("wcobj");this._element.ibxWidget("close")}.bind(menu));menu.addItem(item)}menu.setOption("open",function(e){var parentMenu=this.getInstance().parentMenu();while(parentMenu){var wcParentMenu=parentMenu.data("wcobj");
var parent=wcParentMenu.getInstance();parent.options.multiSelect=true;parentMenu=parent.parentMenu()}}.bind(menu));menu.setOption("close",function(e){if(!this.wcValuesChanged&&!this.wcItemClicked)return;var xlink=null;if(this.wcItemClicked)xlink=this.wcItemClicked.wcOption.xlink;else xlink=this.wcXLink;if(xlink&&xlink.length>0)for(var k=0;k<xlink.length;++k){var link=JSON.parse(JSON.stringify(xlink[k]));link.getOtherParams=otherparamsfn;link.parentNode=parentNode;if(jqobj)link.jqobj=jqobj;if(parameters&&
link.parameters){for(var i=0;i<menu.wcOptions.length;i++){var item=menu.wcOptions[i];if(item&&item.wcOption){var wcValue=item.getChecked()?1:0;var param={name:item.wcOption.value,value:wcValue};link.parameters.push(param)}}for(var i=0;i<link.parameters.length;++i)if(link.parameters[i].variable)for(var j=0;j<parameters.length;++j)if(parameters[j].name==link.parameters[i].name){link.parameters[i].value=parameters[j].value;break}}wcSubmitLink(link)}}.bind(menu));return menu}}
function wcCreateIconButton(obj,styleclass){var button;var xlinks;var disabled=true;if(obj._objtype=="wcnode"){button=new WcxButtonSimple(obj.label?obj.label.text:"",obj.image.src);if($.trim(button.getText())=="")button._element.addClass("control");if(obj.xlink){xlinks=obj.xlink;for(var i=0;i<xlinks.length;i++){if(obj._page)xlinks[i]._page=obj._page;if(xlinks[i].method=="popup"||xlinks[i].dynamic){if(obj._popupnodes)xlinks[i]._popupnodes=obj._popupnodes;if(obj.dynamic)xlinks[i]._menu_name=obj.dynamic;
xlinks[i].parentNode=obj}}}button.setIconColor(obj.image.color);button.setTitle(obj.title);if(styleclass)button._element.addClass(styleclass);else button._element.addClass("wcx-iconbutton");if(obj.selected)button._element.addClass("wcx-selected");if(xlinks&&xlinks.length>0)disabled=false}else if(obj._objtype=="wcdeletebutton"){var btnOptions={wcImage:"ds-icon-delete",wcTooltip:obj.tooltip,wcValue:"",wcXlinks:[obj.xlink]};button=new WcSimpleButton(btnOptions);button._element.addClass("wcx-delete-button")}else if(obj._objtype==
"wcdescription"){var link=obj._helplink;if(link){xlinks=[link];button=new WcxButtonSimple(null,"ds-icon-help")}else button=new WcxLabel(null,false,"ds-icon-help");button._element.addClass("wcx-description-help");var dtext=obj.text;if(dtext&&obj.desc_flags&4096){wcAttachTooltip(button,dtext,"left",obj._nohelpfile?"nohelpfile":"");$(button._element).attr("qa",dtext)}button._element.ibxWidget("setAccessibility",true,{label:ibx.resourceMgr.getString("helptooltip")+" "+dtext});disabled=false}else if(obj._objtype==
"wcbutton"){if(obj.split){button=new WcxHSplitMenuButton(obj.value,obj.image&&obj.image.src?obj.image.src:obj.image);xlinks=obj.xlink;for(var i=0;i<xlinks.length;i++)if(xlinks[i].method=="popup"){button._element.on("ibx_click",{"xlink":xlinks[i],"inribbon":obj._inribbon},function(e){var shellTool=null;if(e.data.inribbon){shellTool=wcapplication.shellTool;if(shellTool)shellTool.setResContext(true)}if(!($(e.target).is(".ibx-menu-button")||e.menu))return;var menu=new WcxMenu(true);e.menu=menu._element;
menu.wcxlink=e.data.xlink;var node=menu.wcxlink.node[0];if(node.dynamic){var dlink=node.xlink[0];dlink._page=node._page;dlink._popupnodes=node._popupnodes;dlink._menu_name=node.dynamic;node=wcHandleDynamicPopup(dlink);if(node)node._page=dlink._page}wcBuildMenu(null,node,null,null,menu);if(shellTool)shellTool.setResContext(false)});xlinks.splice(i,1);break}}else{button=new WcxButtonSimple(obj.value,obj.image&&obj.image.src?obj.image.src:obj.image);if(obj.imagecolor)button.setIconColor(obj.imagecolor);
if(obj.active){button._element.removeClass("btn-default");button._element.addClass("btn-active")}if(obj.image_right)button.setIconPosition("right");if(obj.buttonbordercolor)button._element.css("border","1px solid "+obj.buttonbordercolor);if(obj.bordercolor)button._element.css("border","1px solid "+obj.bordercolor);if(obj.backcolor)button._element.css("background-color",obj.backcolor);xlinks=obj.xlink}button.setTitle(obj.tooltip);button.setHighlighted(obj.highlight);if(styleclass)button._element.addClass(styleclass);
else button._element.addClass("wcx-iconbutton");disabled=obj.disabled}else if(obj._objtype=="wcfilepicker"){button=new WcxButtonSimple(obj.title,obj.image);button.setTitle(obj.title);button.setHighlighted(obj.highlight);if(styleclass)button._element.addClass(styleclass);else button._element.addClass("wcx-iconbutton");disabled=obj.disabled;button.addEventListener("click",function(e){e.preventDefault();e.stopPropagation();wcBuild(this,"popup").show()},obj)}else if(typeof obj==="object"){button=new WcxButtonSimple(obj.text,
obj.icon);button.setTitle(obj.title);if(styleclass)button._element.addClass(styleclass);else button._element.addClass("wcx-iconbutton");disabled=false}else if(typeof obj==="string"){button=new WcxButtonSimple(null,obj);if(styleclass)button._element.addClass(styleclass);else button._element.addClass("wcx-iconbutton");disabled=false}if(xlinks&&xlinks.length>0){if(!button._iconname||button._iconname.indexOf(".svg",button._iconname.length-4)==-1&&button._iconname.indexOf(".png",button._iconname.length-
4)==-1)for(var i=0;i<xlinks.length;i++)if(xlinks[i].method=="popup"||xlinks[i].dynamic){button._element.addClass("wcx-button-pulldown");break}wcAttachLinksTo(button,xlinks)}if(button.setEnabled&&disabled)button.setEnabled(false);return button}
function wcHandleClick(e){try{wcapplication.jsIsBusyStart();e.preventDefault();e.stopPropagation();var location,ismenukey;var shellTool=null;if(e.currentTarget.hasAttribute("mainribbon")){shellTool=wcapplication.shellTool;shellTool.setResContext(true)}var wco=$(e.currentTarget).data("wcobj");var parent=$(e.currentTarget).parent();if(parent&&(parent.hasClass("wcx-ribbon-vbox")||shellTool))location=parent;else if(e.which==93){location=e.jqobj?e.jqobj:e.currentTarget;ismenukey=true}else if(wco instanceof
WcxButtonSimple||e.clientX===undefined)location=e.currentTarget;else location=e;var links=[];for(var i=0;i<this.length;++i)if(this[i].method!="post"&&this[i].method!="submit")links.unshift(this[i]);else links.push(this[i]);for(var i=0;i<links.length;++i)if(links[i].dynamic){var node;if(links[i]._popupnodes||links[i].method=="post")node=wcHandleDynamicPopup(links[i]);if(node){var menu=wcBuildMenu(links[i].jqobj,node);if(e.type=="dblclick")menu.getFirstItem().trigger("click");else menu.open(location,
ismenukey)}}else if(links[i].method=="popup"){var link=links[i];var node;var others;if(typeof link.getOtherParams=="function")others=link.getOtherParams();else others=null;try{if(link.popup&&link._popupnodes)for(var j=0;j<link._popupnodes.length;j++){var pid=link._popupnodes[j].id;if(pid&&pid==link.popup){node=link._popupnodes[j];node._page=link._page;node._popupnodes=link._popupnodes;break}}else if(link.node){node=link.node[0];node._page=link._page;node._popupnodes=link._popupnodes}if(node&&node.dynamic){var dlink=
node.xlink[0];dlink._page=node._page;dlink._popupnodes=node._popupnodes;dlink._menu_name=node.dynamic;wcHandleLinkVariables(dlink.parameters,link.parameters);node=wcHandleDynamicPopup(dlink,others);if(node)node._page=dlink._page}if(!node){if(shellTool)shellTool.setResContext(false);return}}catch(e){if(shellTool)shellTool.setResContext(false);return}var menu=wcBuildMenu(link.jqobj,node,link.parentNode,link.parameters,null,link.getOtherParams);if(menu)if(e.type=="dblclick"||e.type=="wcfirstmenuitem")menu.getFirstItem().trigger("click");
else menu.open(location,ismenukey)}else if(links[i].method=="close"){if(links[i].url)wcSubmitLink(links[i]);var wcobj=$("#"+e.currentTarget.id).closest("div[contentpage='y']").data("wcobj");if(wcobj.close)wcobj.close()}else if(links[i].method=="hideshow"){var targetobj=$("#"+e.currentTarget.id).closest(".wcx-form-item").data("wcobj");if(targetobj instanceof WcCheckBox){if(links[i].grp_hide)if(targetobj.checkbox.getChecked())links[i].grp_hide.forEach(function(name){$("#"+e.currentTarget.id).closest(".wcx-wcform").find("div[wcgroup='"+
name+"']").hide()});else links[i].grp_hide.forEach(function(name){$("#"+e.currentTarget.id).closest(".wcx-wcform").find("div[wcgroup='"+name+"']").show()});if(links[i].grp_show){var parentform=$("#"+e.currentTarget.id).closest(".wcx-wcform");if(targetobj.checkbox.getChecked())links[i].grp_show.forEach(function(name){parentform.find("div[wcgroup='"+name+"']").show();if($(targetobj._element).hasClass("wcx-chkbox-default-off")){var accPageContent=$(targetobj._element).closest(".ibx-accordion-page-content");
if(accPageContent&&accPageContent.length)accPageContent.css("max-height","")}});else links[i].grp_show.forEach(function(name){parentform.find("div[wcgroup='"+name+"']").hide();if($(targetobj._element).hasClass("wcx-chkbox-default-off")){var grp_objs=$("#"+e.currentTarget.id).closest(".wcx-wcform").find("div[wcgroup='"+name+"']");for(var j=0;j<grp_objs.length;j++){var grpObj=grp_objs[j];if($(grpObj).hasClass("wcxcomponent")){var wcobj=$(grpObj).data("wcobj");if(wcobj instanceof WcCheckBox){var chkboxClicked=
false;if(targetobj.getName()!=wcobj.getName())if($(wcobj._element).hasClass("wcx-chkbox-default-off")){if(wcobj.checkbox.getChecked()){$(wcobj.checkbox._element).click();chkboxClicked=true}}else if(!wcobj.checkbox.getChecked()){$(wcobj.checkbox._element).click();chkboxClicked=true}if(chkboxClicked){var targetName=targetobj.getName();var wcMFCP=$(targetobj._element).closest(".wcx-multiframes-content-pane");setTimeout(function(){var newobj=wcMFCP.find(".wcx-chkbox-default-off[qa='"+targetName+"']").data("wcobj");
if(newobj.checkbox.getChecked()){newobj.checkbox.setChecked(false);$(newobj._element).closest(".wcx-wcform").find("div[wcgroup='"+name+"']").hide()}},500)}}}}}})}}else if(targetobj instanceof WcSelect||targetobj instanceof WcRadio){if(links[i].grp_hide)links[i].grp_hide.forEach(function(name){$("#"+e.currentTarget.id).closest(".wcx-wcform").find("div[wcgroup='"+name+"']").each(function(){$(this).hide()})});if(links[i].grp_show)links[i].grp_show.forEach(function(name){$("#"+e.currentTarget.id).closest(".wcx-wcform").find("div[wcgroup='"+
name+"']").each(function(){$(this).show()})})}}else if(links[i].method=="toggle_all"){if(links[i].group_id){var obj=$("#"+e.currentTarget.id).closest(".wcx-form-item").data("wcobj");if(obj){var checked=obj.checkbox.getChecked();$("#"+e.currentTarget.id).closest(".wcx-wcform").find("div[wcgroup='"+links[i].group_id+"']").each(function(){var obj=$(this).data("wcobj");if(obj instanceof WcCheckBox)if(obj.checkbox.getChecked()!=checked)obj.checkbox._element.trigger("click")});var tb=$("#"+e.currentTarget.id).closest(".wcx-wctable");
if(tb.length>0)$(tb[0]).data("wcobj").checkGroup(links[i].group_id,checked)}}}else if(links[i].method=="popup_item"){if(links[i].item&&links[i].item.length>0)if(links[i].item[0].type=="wcfilepicker")wcBuild(links[i].item[0],"popup").show();else if(links[i].item[0].type=="wcupload")wcBuild(links[i].item[0],"popup").show(links[i].jqobj);else if(links[i].item[0].type=="wcselect")wcBuild(links[i].item[0],"popup").show(location,links[i]);else if(links[i].item[0].type=="wccalculator")wcBuild(links[i].item[0]).show();
else confirm(links[i].item[0].type)}else if(links[i].method=="update_item"){if(links[i].item&&links[i].item.length>0)for(var k=0;k<links[i].item.length;++k)if(links[i].item[k].type=="wcbutton"){var obj=$("body").find("div[wcid='"+links[i].item[k].name+"']");if(obj.length>0){var wcobj=obj.data("wcobj");if(wcobj&&wcobj.update)wcobj.update(links[i].item[k])}}}else wcSubmitLink(links[i]);if(shellTool)shellTool.setResContext(false)}finally{wcapplication.jsIsBusyFinish()}}
function wcHandleLinkVariables(varparams,valparams){if(varparams&&varparams.length)for(var i=0;i<varparams.length;i++){var varp=varparams[i];if(varp.variable){var found=false;if(valparams&&valparams.length)for(var j=0;j<valparams.length;j++){var valp=valparams[j];if(valp.name==varp.variable){varp.value=valp.value;found=true;break}}if(!found)varp.value=""}}}
function wcHandleDynamicLink(xlink,params,ibix_action){var link=new wcXmlLink;link.parseJson(xlink);link.syncall=true;if(ibix_action)link.addParam("IBIX_action",ibix_action);if(wcapplication.csrftokenname!=""&&wcapplication.csrftokenvalue!="")link.addParam(wcapplication.csrftokenname,wcapplication.csrftokenvalue);if(params)for(var k in params)if(k&&params.hasOwnProperty(k))link.addParam(k,params[k]);var rsp=link.submit();if(rsp)if(rsp.data){var items=rsp.data.item;for(var i=0;i<items.length;i++){var item=
items[0];if(item&&item.node&&item.type=="wctree"){var node=wcGetPopupMenu(xlink._menu_name,item.node,items);return node}}}}
function wcHandleDynamicPopup(link,params){var ldr=new WcLoader(link.url?link.url:wcapplication.wcurl);ldr.addParam(link.parameters);if(params)ldr.addParam(params);var popupnode=null;var parsePopupMenu=function(rsp){if(wcPreProcess(rsp,false)!=true)return;if(rsp.data){var items=rsp.data.item;for(var i=0;i<items.length;i++){var item=items[0];if(item&&item.node&&item.type=="wctree")popupnode=wcGetPopupMenu(link._menu_name,item.node,items)}}};ldr.setAsync(false);ldr.load(parsePopupMenu);return popupnode}
function wcGetPopupMenu(menuname,nodes,rspItems){var node;for(var j=0;j<nodes.length;j++){var node=nodes[j];var id=node.id;if(id&&(!menuname||id==menuname)){if(rspItems)for(var k=0;k<rspItems.length;k++){var item=rspItems[k];if(item.type=="wctree")node._popupnodes=item.node}return node}else if(node.node)return wcGetPopupMenu(menuname,node.node,rspItems)}return null}
function wcAttachLinksTo(obj,xlinks,click){if(obj instanceof WcxSelect){if(xlinks)obj.xlink=true;if(!obj._disposed){var o=obj.getInstance();if(o){var popup=o._popup;obj._popup=popup;$(popup).on("click.wc",function(e){var popup=this._popup;if(!popup.hasClass("wcx-multilist-popup")){var wcobj=this.getSelected();if(wcobj){var xlinks=wcobj.wcxlinks;if(xlinks&&xlinks.length>0){for(var i=0;i<xlinks.length;i++)xlinks[i].jqobj=obj._element;e.currentTarget=this._element[0];wcHandleClick.bind(xlinks)(e)}}}}.bind(obj));
return}}}if(xlinks)if(obj instanceof jQuery){for(var i=0;i<xlinks.length;++i)xlinks[i].jqobj=obj;obj.off(click?click:"click.wc");obj.on(click?click:"click.wc",wcHandleClick.bind(xlinks))}else{obj.xlink=true;for(var i=0;i<xlinks.length;++i){var xlink=xlinks[i];if(xlink&&!xlink.jqobj)xlink.jqobj=obj._element}if(obj instanceof WcSlider)obj._element.on("ibx_end",wcHandleClick.bind(xlinks));else obj._element.on(click?click:"click.wc",wcHandleClick.bind(xlinks))}}
function wcAddParameter(link,name,value){if(!link.parameters)link.parameters=[];for(var i=0;i<link.parameters.length;++i)if(link.parameters[i].name==name){link.parameters[i].value=value;break}if(i==link.parameters.length)link.parameters.push({name:name,value:value})}
function wcSubmitLink(link){if(link.xlinkid&&link._sharedlink)for(var j=0;j<link._sharedlink.length;j++){var slink=link._sharedlink[j];if(slink.id==link.xlinkid){link=slink;break}}var pn=link.parentNode;if(pn){var values=pn.properties?pn.properties:null;if(!values&&pn.xlink){var pxlink=pn.xlink[0];values=pxlink.parameters}if(values)wcHandleLinkVariables(link.parameters,values)}if(link.confirm&&link.confirm.confirmmsg){var msg;if(link.parentNode)if(link.parentNode.xlink)msg=wcSubstitute(link.confirm.confirmmsg,
link.parentNode.xlink[0].parameters);else if(link.parentNode.properties)msg=wcSubstitute(link.confirm.confirmmsg,link.parentNode.properties);else msg=link.confirm.confirmmsg;else msg=link.confirm.confirmmsg;var confirmType=link.confirm.statustype?link.confirm.statustype:"Warning";var statusType=link.confirm.statustype?link.confirm.statustype:"warn";var buttons=link.confirm.type;var okText;if(link.confirm.primarytext)okText=link.confirm.primarytext;else if(buttons&&buttons.search("yes")!=-1)okText=
ibx.resourceMgr.getString("yes");else okText=ibx.resourceMgr.getString("IBX_STR_OK");var noText;if(link.confirm.secondarytext)noText=link.confirm.secondarytext;else if(buttons&&buttons.search("no")!=-1)noText=ibx.resourceMgr.getString("IBX_STR_NO");else noText=ibx.resourceMgr.getString("IBX_STR_CANCEL");var options={};options.statusType=statusType;options.message=msg;var dlgCaption=link.confirm.title?link.confirm.title:confirmType;if(dlgCaption=="warn")dlgCaption="warning";var tmpstr=ibx.resourceMgr.getString(dlgCaption.toLowerCase());
if(tmpstr)dlgCaption=tmpstr;options.caption=dlgCaption;options.okText=okText;options.noText=noText;var dlg=$.ibi.ibxDialog.createConfirmDialog(options);dlg.ibxDialog("open").on("ibx_close",function(e,btn){var link=this;if(btn=="ok")wcExecLink(link);else if(btn=="no"&&link.other_param){for(var i=0;i<link.other_param.length;++i)wcAddParameter(link,link.other_param[i].name,link.other_param[i].value);wcExecLink(link)}}.bind(link))}else if(link.inline){var obj=null;if(link.jqobj.hasClass("wcx-grid-body-tree-row")){var label=
link.jqobj.find(".ibx-label");if(label.length>1)obj=$(label[1])}if(obj){obj.closest(".wcx-grid").data("wcobj").editing=true;obj.ibxWidget("startEditing",{editOnFocus:true}).one("ibx_changed ibx_canceledit",link,function(e){delete $(this).closest(".wcx-grid").data("wcobj").editing;if(e.type=="ibx_changed")if(e.originalEvent.data!=""&&e.originalEvent.data!=$(e.target).ibxWidget("preEditValue")){wcAddParameter(e.data,e.data.inline.inline_param,e.originalEvent.data);wcExecLink(e.data)}else{$(e.currentTarget).ibxWidget("option",
"text","");$(e.currentTarget).ibxWidget("option","text",$(e.target).ibxWidget("preEditValue"))}})}}else if(link.dialog){var msg;if(link.parentNode&&link.parentNode.properties)msg=wcSubstitute(link.dialog.dialog_text,link.parentNode.properties);else msg=link.dialog.dialog_text;var x=new WcInputDialog(msg,link.dialog.dialog_header,link.dialog.dialog_value);x.onClose(function(e,btn){if(btn=="ok"){var value=$(e.target).data("wcobj").getValue();if(value!=""){wcAddParameter(this,this.dialog.dialog_param,
value);wcExecLink(this)}}}.bind(link))}else wcExecLink(link)}
function wcExecLink(link){var otherparams=null;if(typeof link.getOtherParams=="function")otherparams=link.getOtherParams();var isFocusableLink=false;if(link.jqobj&&link.jqobj.length){var jqObj=link.jqobj[0];if($(jqObj).hasClass("wcx-focusable"))isFocusableLink=true}if(!link.http_target||link.http_target=="TARGET_DEFAULT")if(link.method=="submit"){var cp=wcGetCurrentPage(link);var xml=new WcLoader(cp?cp.pageproperty.action:wcapplication.wcurl);xml.addParam(wcGetAllParams(link));xml.addParam(otherparams);
xml.replaceParam(link.parameters);if(cp&&cp.fn_beforesubmit&&!cp.fn_beforesubmit({"name":xml._paramN,"value":xml._paramV}))return;if(link.resourcebundle)xml.addResource(link.resourcebundle.filename,link.resourcebundle.selector);if(link.jqobj&&link.jqobj.length){var jqobj=link.jqobj;if(isFocusableLink){cp.useFocusInfo=true;cp.focusEl=jqobj[0]}else if(jqobj.hasClass("ibx-select")||jqobj.hasClass("wcx-calendar")||jqobj.hasClass("wcx-filepicker")){cp.useFocusInfo=true;cp.focusEl=jqobj.find("input")[0]}}xml.setLoadingMessage(link.loadingmessage);
xml.load(wcxParseXml,cp)}else if(link.method=="post")if(link.jqobj){var targetobj;if(link.closelink){targetobj=link.jqobj.closest(".wcx-popup-window").data("wcobj");if(targetobj)targetobj=targetobj._content;else if(wcapplication.windowtitle)targetobj=wcapplication.topframe}else{targetobj=link.jqobj.closest("div[contentpage='y']").data("wcobj");if(!targetobj)targetobj=$(document.activeElement).closest("div[contentpage='y']").data("wcobj")}if(targetobj){var xml=new WcLoader(link.url);if(link.resourcebundle)xml.addResource(link.resourcebundle.filename,
link.resourcebundle.selector);xml.addParam(link.parameters);if(link.wintype&65536){if(targetobj instanceof WcMultiframesContentPane)targetobj=targetobj.wcMultiFrames.getContentPaneByID(link.winname,targetobj.wcContentFrame.wcFrameInfo.wcFrameID)}else if(link.wintype&4096){var pop=new WcPopupWindow(link.winsize);pop.setWindowTitle(link.wincaption);pop.open();targetobj=pop._content}xml.addParam(otherparams);xml.setLoadingMessage(link.loadingmessage);xml.load(wcxParseXml,targetobj)}}else if(link.parsefunction){var xml=
new WcLoader(link.url);xml.addParam(link.parameters);xml.setLoadingMessage(link.loadingmessage);xml.load(link.parsefunction)}else confirm("current page but no target id");else if(link.method=="row_toggle"||link.method=="row_top")if(link.jqobj){var wcitem=link.jqobj.data("wcobj");if(wcitem){var rowid;var wctable=link.jqobj.closest(".wcx-wctable").data("wcobj");if(!wctable){var id=link.jqobj.closest("[wctable]").attr("wctable");if(id){wctable=$(document.body).find(".wcx-wctable[wctable='"+id+"']").data("wcobj");
if(wctable)rowid=link.jqobj.closest("[wcrow]").attr("wcrow")}}else rowid=link.jqobj.closest(".wcx-grid-body-row, .wcx-grid-body-tree-row").attr("row");if(wctable)if(wcitem instanceof WcxCheckBoxSimple)wctable.enableRow(rowid,wcitem.getChecked(),link.method=="row_top");else if(wcitem instanceof WcxRadioButtonSimple){wctable.enableRow(-1,false,link.method=="row_top");wctable.enableRow(rowid,true,link.method=="row_top")}}}else confirm("current page but no target id");else if(link.method=="js")eval(link.page);
else if(link.method=="goto_item"){var jqobj=$("."+link.item_id);var wcobj=jqobj.data("wcobj");if(wcobj instanceof WcGrid)wcobj._focusthis();else if(wcobj instanceof WcButton||wcobj instanceof WcTextOnly)jqobj.click()}else confirm(link.method);else if(link.http_target=="TARGET_SCREEN")if(link.method=="href"){var url=link.url?link.url:link.page?link.page:"";if(link.file)url+="/"+link.file;var usePopupBox=link.popup?true:false;if(usePopupBox){if(window.console)console.debug("url:"+url);var popup=new WcPopupBox(link.jqobj,
"wcx-popup-help");$(popup._content._element).load(url+" #"+link.tag,function(){var text=$.trim($(popup._content._element).text());if(text&&text.length>0){popup.open(link.jqobj);var height=$(popup._element).height();if(height>300){var top=link.jqobj.offset().top+link.jqobj.height();$(popup._element).css("top",top+"px");$(popup._element).css("height","300px");$(popup._element).css("overflow-y","auto")}$(popup._element).css("overflow-x","auto")}else wcOpenNewWindow(url+"#"+link.tag,link.winname)});$(popup._element).on("click",
function(){wcOpenNewWindow(url+"#"+link.tag,link.winname)});if(window.console)console.debug(link.tag)}else{if(link.tag)url+="#"+link.tag;wcOpenNewWindow(url,link.winname)}}else if(link.method=="submit"){var cp=wcGetCurrentPage(link);var xml=new WcLoader(cp?cp.pageproperty.action:wcapplication.wcurl);xml.addParam(wcGetAllParams(link));xml.addParam(otherparams);xml.replaceParam(link.parameters);xml.addParam("srvtool","y");if(cp&&cp.fn_beforesubmit&&!cp.fn_beforesubmit({"name":xml._paramN,"value":xml._paramV}))return;
wcOpenNewWindow(null,link.winname,xml.getHtmlForm(true))}else if(link.method=="post"){var xml=new WcLoader(link.url);xml.addParam(otherparams);xml.replaceParam(link.parameters);xml.addParam("srvtool","y");wcOpenNewWindow(null,link.winname?link.winname:"_blank",xml.getHtmlForm(true))}else confirm(link.http_target+" "+link.method);else if(link.http_target=="TARGET_FRAME"&&link.winname=="2"){var xml;if(link.method=="submit"){var cp=wcGetCurrentPage(link);xml=new WcLoader(cp?cp.pageproperty.action:wcapplication.wcurl);
xml.addParam(wcGetAllParams(link));xml.addParam(otherparams);xml.replaceParam(link.parameters);if(cp&&cp.fn_beforesubmit&&!cp.fn_beforesubmit({"name":xml._paramN,"value":xml._paramV}))return;wcapplication.toppage.mainmenubar.removeAll();xml.setLoadingMessage(link.loadingmessage);xml.load(wcxParseMainMenu,wcapplication.toppage.mainmenubar)}else if(link.method=="post"){var xml=new WcLoader(link.url);xml.addParam(link.parameters);xml.addParam(otherparams);wcapplication.toppage.mainmenubar.removeAll();
xml.setLoadingMessage(link.loadingmessage);xml.load(wcxParseMainMenu,wcapplication.toppage.mainmenubar)}else confirm(link.method)}else if(link.http_target=="TARGET_TOP"){var xml;if(link.method=="submit"){var cp=wcGetCurrentPage(link);xml=new WcLoader(cp?cp.pageproperty.action:wcapplication.wcurl);xml.addParam(wcGetAllParams(link));xml.addParam(otherparams);xml.replaceParam(link.parameters);if(cp&&cp.fn_beforesubmit&&!cp.fn_beforesubmit({"name":xml._paramN,"value":xml._paramV}))return;if(xml.getParam("refreshtophref")){wcapplication.reload=
true;wcSubmitForm(window.document,xml.getHtmlForm())}else{xml.setLoadingMessage(link.loadingmessage);if(link.resourcebundle)xml.addResource(link.resourcebundle.filename,link.resourcebundle.selector);if(wcapplication.topframe)xml.load(wcxParseXml,wcapplication.topframe);else xml.load(wcxParseXml,link.jqobj.closest("div[contentpage='y']").data("wcobj"))}}else if(link.method=="post"){if(link.wintype&65536)confirm("tab");var xml=new WcLoader(link.url);xml.addParam(link.parameters);xml.addParam(otherparams);
if(xml.getParam("refreshtophref")){wcapplication.reload=true;wcSubmitForm(window.document,xml.getHtmlForm())}else{xml.setLoadingMessage(link.loadingmessage);if(link.resourcebundle)xml.addResource(link.resourcebundle.filename,link.resourcebundle.selector);xml.load(wcxParseXml,wcapplication.topframe)}}else confirm(link.method)}else if(link.http_target=="TARGET_MAIN"){var xml;if(link.method=="submit"){var cp=wcGetCurrentPage(link);xml=new WcLoader(cp?cp.pageproperty.action:wcapplication.wcurl);xml.addParam(wcGetAllParams(link));
xml.addParam(otherparams);xml.replaceParam(link.parameters);if(cp&&cp.fn_beforesubmit&&!cp.fn_beforesubmit({"name":xml._paramN,"value":xml._paramV}))return}else{xml=new WcLoader(link.url);xml.addParam(link.parameters);xml.addParam(otherparams)}xml.setLoadingMessage(link.loadingmessage);if(link.resourcebundle)xml.addResource(link.resourcebundle.filename,link.resourcebundle.selector);if(link.wintype&4096||link.wintype&8){var pop=wcapplication.getWcfObject(link.winname);if(pop&&pop instanceof WcPopupWindow){if(pop._close)pop.open();
pop.setWindowTitle(link.wincaption);xml.load(wcxParseXml,pop._content)}else{pop=new WcPopupWindow(link.winsize,link.wintype&8?true:false);pop.setWindowTitle(link.wincaption);pop.setName(link.winname);if(link.wintype&8)pop.iframe=true;if(wcapplication.toppage.mainframe)wcapplication.toppage.mainframe._element.append(pop._element);wcapplication.setWcfObject(pop);xml.load(wcxParseXml,pop._content)}}else{if(link.wintype&65536)confirm("tab");var dest=wcapplication.toppage.mainframe;xml.load(wcxParseXml,
dest)}}else if(link.http_target=="TARGET_CONTENT"||link.http_target=="TARGET_FRAME"&&link.winname=="0"){var xml;if(link.method=="submit"){var cp=wcGetCurrentPage(link);xml=new WcLoader(cp?cp.pageproperty.action:wcapplication.wcurl);xml.addParam(wcGetAllParams(link));xml.addParam(otherparams);xml.replaceParam(link.parameters);if(cp&&cp.fn_beforesubmit&&!cp.fn_beforesubmit({"name":xml._paramN,"value":xml._paramV}))return}else{xml=new WcLoader(link.url);xml.addParam(link.parameters);xml.addParam(otherparams)}xml.setLoadingMessage(link.loadingmessage);
if(link.resourcebundle)xml.addResource(link.resourcebundle.filename,link.resourcebundle.selector);if(link.wcIsPopupPage){link.wcobj.wcIsPopupPage=true;xml.load(wcxParseXml,link.wcobj)}else if(link.wintype&4096){var pop=new WcPopupWindow(link.winsize);pop.setWindowTitle(link.wincaption);if(link.jqobj)pop._content.parentpage=link.jqobj.closest("div[contentpage='y']").data("wcobj");xml.load(wcxParseXml,pop._content)}else{if(link.wintype&65536)confirm("tab");xml.load(wcxParseXml,wcapplication.toppage.mainframe.contentframe.content)}}else if(link.http_target==
"TARGET_PARENT"||link.http_target=="TARGET_OUTERMOST_PARENT"){if(link.jqobj){var parentpage;if(link.method=="submit"){var cp=wcGetCurrentPage(link);if(cp&&cp.parentpage){parentpage=cp.parentpage;if(link.http_target=="TARGET_OUTERMOST_PARENT"){var np=parentpage.parentpage;while(np){if(typeof parentpage.close==="function")parentpage.close();parentpage=np;np=np.parentpage}}var xml=new WcLoader(cp.pageproperty.action);xml.addParam(wcGetAllParams(link));xml.addParam(otherparams);xml.replaceParam(link.parameters);
if(cp&&cp.fn_beforesubmit&&!cp.fn_beforesubmit({"name":xml._paramN,"value":xml._paramV}))return;xml.setLoadingMessage(link.loadingmessage);if(link.resourcebundle)xml.addResource(link.resourcebundle.filename,link.resourcebundle.selector);xml.load(wcxParseXml,parentpage);cp.close()}}else if(link.method=="post"){var targetobj=link.jqobj.closest("div[contentpage='y']").data("wcobj");if(targetobj&&targetobj.parentpage){parentpage=targetobj.parentpage;if(link.http_target=="TARGET_OUTERMOST_PARENT"){var np=
parentpage.parentpage;while(np){if(typeof parentpage.close==="function")parentpage.close();parentpage=np;np=np.parentpage}}var xml=new WcLoader(link.url);xml.addParam(link.parameters);xml.addParam(otherparams);xml.setLoadingMessage(link.loadingmessage);if(link.resourcebundle)xml.addResource(link.resourcebundle.filename,link.resourcebundle.selector);xml.load(wcxParseXml,parentpage);targetobj.close()}}}}else if(link.http_target=="TARGET_NONE"){var xml;if(link.method=="submit"){var cp=wcGetCurrentPage(link);
xml=new WcLoader(cp?cp.pageproperty.action:wcapplication.wcurl);xml.addParam(wcGetAllParams(link));xml.addParam(otherparams);xml.replaceParam(link.parameters);if(cp&&cp.fn_beforesubmit&&!cp.fn_beforesubmit({"name":xml._paramN,"value":xml._paramV}))return}else{xml=new WcLoader(link.url);xml.addParam(link.parameters);xml.addParam(otherparams)}if(link.no_wait)xml.no_wait=true;xml.load()}else if(link.http_target=="TARGET_TREE_FOLDER"){var xml=new WcLoader(link.url);xml.addParam(link.parameters);xml.addParam(otherparams);
xml.setLoadingMessage(link.loadingmessage);if(link.parentNode._objtype=="wcnode")xml.load(wcxParsePartialTree,link.parentNode);else if(link.parentNode._objtype=="wctablerow")xml.load(wcxParsePartialTreeGrid,link.parentNode);else if(link.jqobj)xml.load(wcxParsePartialTreeGrid,link.jqobj.data("wcobj"))}else if(link.http_target=="TARGET_TREE"||link.http_target=="TARGET_FRAME"&&link.winname=="1"){var xml;if(link.method=="submit"){var cp=wcGetCurrentPage(link);xml=new WcLoader(cp?cp.pageproperty.action:
wcapplication.wcurl);xml.addParam(wcGetAllParams(link));xml.addParam(otherparams);xml.replaceParam(link.parameters);if(cp&&cp.fn_beforesubmit&&!cp.fn_beforesubmit({"name":xml._paramN,"value":xml._paramV}))return}else{xml=new WcLoader(link.url);xml.addParam(link.parameters);xml.addParam(otherparams)}xml.setLoadingMessage(link.loadingmessage);wcapplication.toppage.mainframe.ribbon.willTakeFocus=link.wintype&4?false:true;xml.load(wcxParseRibbon,wcapplication.toppage.mainframe.ribbon)}else if(link.http_target==
"TARGET_OBJ"){var obj=wcapplication.getWcfObject(link.winname);if(!obj)return;if(obj instanceof WcMultiframes)if(link.winname2||link.winname3){var p;var allparams;if(link.method=="submit")allparams=wcGetAllParams(link);if(link.winname3)p=obj.getContentPaneByID(link.winname2,link.winname3);else p=obj.getContentPaneByID(link.winname2);if(p){if(link.wincaption)p.setTitleText(link.wincaption,link.wintip);var params=new WcUrl;params.setUrl(link.url?link.url:wcapplication.wcurl);if(link.method=="submit"){params.addParam(allparams);
params.replaceParam(link.parameters);params.addParam(otherparams)}else{params.setParams(link.parameters);params.addParam(otherparams)}var option=null;if(link.resourcebundle)option={"wcResourceBundleName":link.resourcebundle.filename,"wcResourceSelector":link.resourcebundle.selector};if(link.flags&1||link.wintype&2||link.refreshobj&&!(link.flags&4)){if(option==null)option={};option.wcDoNotForceShow=true}if(link.loadingmessage){if(option==null)option={};option.wcLoadingMessage=link.loadingmessage}p.willTakeFocus=
link.wintype&4||link.flags&2?false:true;if(link.nofocus)p.willTakeFocus=false;p.doLoad(params,link.refreshobj,option)}}else obj.doRefreshAll();else if(obj instanceof WcFilePicker){if(link.winname2){p=obj.getObjectByName(link.winname2);if(p){var xml=new WcLoader(link.url);xml.addParam(link.parameters);xml.addParam(otherparams);xml.setLoadingMessage(link.loadingmessage);if(link.resourcebundle)xml.addResource(link.resourcebundle.filename,link.resourcebundle.selector);xml.load(wcxParseXml,p)}}}else if(obj instanceof
WcExpCalculator)obj.doRefresh()}else if(link.http_target=="TARGET_WINDOW"&&link.wintype==1&&!link.winname&&link.jqobj){var xml;if(link.method=="submit"){var cp=wcGetCurrentPage(link);xml=new WcLoader(cp?cp.pageproperty.action:wcapplication.wcurl);xml.addParam(wcGetAllParams(link));xml.addParam(otherparams);xml.replaceParam(link.parameters);if(cp&&cp.fn_beforesubmit&&!cp.fn_beforesubmit({"name":xml._paramN,"value":xml._paramV}))return}else{xml=new WcLoader(link.url);xml.addParam(link.parameters);xml.addParam(otherparams)}xml.setLoadingMessage(link.loadingmessage);
if(link.resourcebundle)xml.addResource(link.resourcebundle.filename,link.resourcebundle.selector);var contentpage=link.jqobj.closest(".wcx-popup-window-body");if(contentpage.length==1)xml.load(wcxParseXml,$(contentpage[0]).data("wcobj"));else xml.load(wcxParseXml,wcapplication.topframe)}else{confirm(link.http_target);return}if(link.image&&link.jqobj){var obj=link.jqobj.data("wcobj");if(obj instanceof WcxButtonSimple){var n=obj.getIcon();obj.setIcon(link.image.src);link.image.src=n;if(link.image.color){var c=
obj.getIconColor();obj.setIconColor(link.image.color);link.image.color=c}}}}
function wcTrackLink(link){if(!link)return;if(link.wcDoNotTrack)return;if(link.closelink)return;var event=null;var params=link.parameters;if(link.url){var pos=link.url.lastIndexOf("webconsole/");if(pos>=0)event=link.url.substring(pos+11)}if(!event&&params)for(var i=0;i<params.length;i++){var p=params[i];var pName=p.name.toUpperCase();if(pName=="IBIS_PAGE"){event=p.value;break}}wcTrackActivity(wcapplication.gspx_category,event,link.analytics)}
function wcTrackActivity(category,event,info){if(typeof aptrinsic!=="undefined"){if(!info)info={};if(!info.type)info.type=event?event:"webconsole";aptrinsic("track",category?category:"server",info)}}
function wcGetAllParams(link){var all={};var obj=null;if(link.formid)obj=wcapplication.getWcfObject(link.formid);if(obj==null&&link.jqobj)obj=link.jqobj.closest("div[contentpage='y']").data("wcobj");if(obj){if(obj.pageproperty&&obj.pageproperty.pageid)all["IBIS_pageid"]=obj.pageproperty.pageid;if(obj.getParams){$.extend(all,obj.getParams());return all}var children=obj.getChildren();for(var i=0;i<children.length;++i)all=wcGetParams(children[i],all)}return all}
function wcGetParams(wcitem,others){if(!wcitem.getParams){var children=wcitem.getChildren();for(var i=0;i<children.length;++i)others=wcGetParams(children[i],others);return others}var params=wcitem.getParams();for(var k in params)if(k&&params.hasOwnProperty(k))if(others[k])others[k]=others[k].concat(params[k]);else others[k]=params[k];return others}
function wcAttachTooltip(obj,tipText,tipSide,tipType,moreClass){if(!obj)return;if(tipText){var cssClass="ds-tooltip ds-tip-"+tipSide+" ds-tip-"+tipType;tipText=tipText.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");if(/\r|\n/.exec(tipText))cssClass+=" ds-tip-pre-wrap";else if(tipText.length<=200)cssClass+=" ds-tip-short";if(moreClass)cssClass+=" "+moreClass;var wcobj=null;if(obj._element)wcobj=obj;else{wcobj={};wcobj._element=obj[0]}if(wcobj){wcobj.wcTooltip=$("<div></div>").ibxTooltip({destroyOnClose:false,
text:tipText}).ibxAddClass(cssClass);$(wcobj._element).on("mouseenter",function(evt){var tipPosition={"my":"center bottom-8","at":"center top","of":this._element};if(tipSide=="center-right")tipPosition={"my":"left top","at":"center top","of":this._element};else if(tipSide=="right")tipPosition={"my":"left center","at":"right center","of":this._element};else if(tipSide=="left")tipPosition={"my":"right center","at":"left center","of":this._element};this.wcTooltip.ibxWidget("option","position",tipPosition);
if(evt.buttons==0){var oldTooltip=$(".ibx-tooltip.pop-top");if(oldTooltip.length>0)oldTooltip.ibxWidget("close");this.wcTooltip.ibxWidget("open")}}.bind(wcobj));$(wcobj._element).on("mouseleave",function(evt){this.wcTooltip.ibxWidget("close")}.bind(wcobj));wcobj.wcTooltip.on("mouseleave",function(evt){this.wcTooltip.ibxWidget("close")}.bind(wcobj))}}}
function WcBaseDialog(mf){if(_wcconstructing)return;WcxDialog.call(this);this._element.addClass("wcx-dialog");this._element.addClass("ds-modal");var dlg=this.getInstance();if(dlg){dlg.titleBox.addClass("ds-modal-header");var title=dlg.titleBox.find(".ibx-title-bar-caption");if(title&&title.length>0)title.addClass("ds-modal-header-title");dlg.titleClose.addClass("ds-modal-header-close")}}_p=wcInherit(WcBaseDialog,WcxDialog);_p.setWindowTitle=function(text){if(text)this.setOption("captionOptions",{"text":text})};
_p.createContent=function(){this.wcContent=new WcxVBox;this.wcContent._element.addClass("wcx-dialog-content");this.addItem(this.wcContent);return this.wcContent};_p.createTabPane=function(){this.wcTabPane=new WcxTabPane;this.wcTabPane._element.addClass("wcx-tab-pane");this.addItem(this.wcTabPane);return this.wcTabPane};
_p.addTabPage=function(title,defaultPage){var tabPage=new WcxTabPage(title);$(tabPage._element).css("padding","10px");this.wcTabPane.addPage(tabPage,defaultPage);var closeBtn=$(this.wcTabPane._element).find(".wcx-tabpage-closebutton");closeBtn.css("display","none");return tabPage};
_p.addOption=function(label,option,page){var hBox=new WcxHBox;hBox._element.css("margin-top","5px");if(label){label=new WcxLabel(label+": ");hBox.add(label);label._element.css("margin-top","5px");label._element.css("margin-right","5px")}option._element.css("flex","1 1 auto");hBox.add(option);if(page)page.add(hBox);else this.addItem(hBox);return hBox};
_p.addOptionSeparator=function(page){var separator="<div style='border:1px solid gray;margin-top:6px;margin-bottom:2px'/>";if(page)$(page._element).append($(separator));else this.add($(separator))};_p.close=function(){var dlg=this.getInstance();dlg.close()};
function WcPopupWindow(){if(_wcconstructing)return;WcxPopup.call(this);this._element.addClass("wcx-popup-window");this._element.addClass("ds-modal");var winsize;var noheader=false;for(var i=0;i<arguments.length;++i)if(typeof arguments[i]==="boolean")noheader=arguments[i];else winsize=arguments[i];if(!noheader){this._header=new WcxHBox;this._header._element.addClass("wcx-popup-window-header");this._header._element.addClass("ds-modal-header");this._title=new WcxLabel;this._title._element.addClass("wcx-header-label");
this._title._element.addClass("ds-modal-header-title");this._header.add(this._title);this.addEventListener("ibx_close",function(){wcapplication.clrWcfObject(this);this._element.remove()},this);this.delayClose=false;var button=new WcxButtonSimple(null,"wc_close.svg");button._element.addClass("ds-modal-header-close ds-btn ds-btn-link").attr("tabindex","0");button._element.attr("aria-label",ibx.resourceMgr.getString("close")+" Dialog");button._setQaAttr("XClose");button.setTitle(ibx.resourceMgr.getString("close"));
button.addEventListener("click.wc",function(){if(this.delayClose){var popup=this;$(popup._element).hide();setTimeout(function(){popup.close()},1E3)}else this.close()},this);this._header.add(button)}this._content=new WcxVBox;this._content._element.addClass("wcx-popup-window-body");this._content.popupwindow=this;this._content.addEventListener("mousedown",function(e){e.stopPropagation()});var container=new WcxVBox;container._element.addClass("wcx-popup-window-container");if(!noheader)container.add(this._header);
container.add(this._content);this.add(container);this._content.wcUpdate=function(open){var children=this.getChildren();if(children.length==0&&!open)return;var scrollDone=false;for(var i=children.length-1;i>=0;i--){var obj=children[i];if(obj&&!scrollDone)if(obj._objtype=="WcForm"){if(obj._formid!="wcf_buttonbar"){$(obj._element).css({"flex":"1 1 auto","overflow":"auto","width":"100%"});scrollDone=true}}else scrollDone=true}if(this.popupwindow.wcopened)return;this.popupwindow.wcopened=true;this.popupwindow.open();
var dialog=$(document.body).children(".ibx-dialog");if(dialog.length>0)for(var i=0;i<dialog.length;++i)$(dialog[i]).css("z-index",parseInt(this.popupwindow._element.css("z-index"))+i+1)};this._content.close=function(){this.popupwindow.close()};this._content.setWindowTitle=function(title){this.popupwindow.setWindowTitle(title)};this._content.setWindowSize=function(winsize){if(winsize=="")return;if(winsize=="SIZE_MAX"){if(wcapplication.shellTool)this._element.addClass("ds-fullscreen ds-in-iframe");
else this._element.addClass("ds-fullscreen");this.setResizable(false);$(window).resize(this._resizefn.bind(this))}else if(winsize=="SIZE_XLARGE"){this._element.css("width","90%");this._element.css("height","80%")}else if(winsize=="SIZE_LARGE"){this._element.css("width","960px");this._element.css("height","720px")}else if(winsize=="SIZE_LARGE_PORTRAIT"){this._element.css("width","720px");this._element.css("height","960px")}else if(winsize=="SIZE_MEDIUM"){this._element.css("width","736px");this._element.css("height",
"568px")}else if(winsize=="SIZE_MEDIUM_PORTRAIT"){this._element.css("width","568px");this._element.css("height","736px")}else if(winsize=="SIZE_SMALL"){this._element.css("width","50%");this._element.css("height","60%")}else if(winsize=="SIZE_XSMALL"){this._element.css("width","30%");this._element.css("height","40%")}else if(winsize=="SIZE_XXSMALL"){this._element.css("width","30%");this._element.css("height","30%")}}.bind(this);this._content.setWindowSize(winsize);var element=this._content._element;
this._element.on("ibx_open",function(){var firstFocusable=$(element).find(":focusable").eq(0);if(firstFocusable){if(firstFocusable.is("iframe"))return;var focusEl=$(element).find("ds-modal-header-close");if(focusEl&&focusEl.length>0)focusEl.focus();else firstFocusable.focus()}});this._element.on("resize",this._resizefn.bind(this))}_p=wcInherit(WcPopupWindow,WcxPopup);_p._resizefn=function(){var jqgrid=this._content._element.find(".wcx-grid");if(jqgrid&&jqgrid.length>0)jqgrid.trigger("resize")};
_p.closewcpopup=_p.close;_p.close=function(){$(window).off("resize",this._resizefn.bind(this));this.closewcpopup()};_p.setWindowTitle=function(text){if(!text)return;if(this._title)this._title.setText(text)};
function WcPopupBox(jqobj,classname){if(_wcconstructing)return;WcxPopup.call(this);this._element.ibxWidget({"modal":false});this._element.ibxWidget({"autoClose":true});this._element.ibxWidget({"resizable":false});this._element.addClass("wcx-popup-box");if(classname){this._element.addClass(classname);this.wcClassname=classname}this.jqSource=jqobj?jqobj:null;this._content=new WcxVBox;this._content._element.addClass("wcx-popupbox-body");this._content.popupwindow=this;this.add(this._content);if(this.wcClassname==
"wcx-popup-help")this._element.on("keydown",function(e){var kc=e.keyCode;if(kc==27){e.stopPropagation();e.preventDefault();wcapplication.wcPreventMFClose=true}else if(kc==13||kc==32)this._element.click();this._element.ibxWidget("close");if(this.jqSource)this.jqSource.focus()}.bind(this));this._element.on("ibx_open",function(){var maxWidth=parseInt(window.innerWidth*.75);var popupWidth=$(this).width();if(popupWidth>maxWidth){$(this).css("width",maxWidth+"px");var left=parseInt((window.innerWidth-maxWidth)/
2);$(this).css("left",left+"px")}$(this).focus()})}_p=wcInherit(WcPopupBox,WcxPopup);
function wcOpenNewWindow(url,name,submitForm,width,height){var wHnd;window.noleavediag=true;if(width&&height)wHnd=window.open(url?url:"about:blank",name?name:"_blank","menubar=yes,toolbar=yes,scrollbars=yes,resizable=yes,width="+width+",height="+height);else wHnd=window.open(url?url:"about:blank",name?name:"_blank");delete window.noleavediag;if(wHnd)try{wHnd.focus();if(submitForm)$(wHnd.document).ready(function(){if(wHnd.wcapplication)wHnd.wcapplication.reload=true;wcSubmitForm(wHnd.document,submitForm)})}catch(err){}else new WcMessageDialog("Popup blocker detected.  Please disable popup blocker.",
"warning");return wHnd}
function WcMessageDialog(text,type,title,button){if(_wcconstructing)return;WcxDialog.call(this,type,button?button:"ok");this._element.addClass("wcx-alert-dialog");this._element.ibxWidget("option","closeButton",false);if(title)this._element.ibxWidget("option","captionOptions",{"text":title});var res=text.split("\n");$(this._element).find(".ibx-dialog-button").each(function(){var text=this.textContent;if(text)$(this).attr("qa",text)});var container=new WcxVBox;container._element.addClass("wcx-dialog-text");this.addItem(container);
for(var i=0;i<res.length;++i){var t=new WcxLabel(res[i]);t.setWrap(true);t.addEventListener("contextmenu",function(evt){var text=" ";if(window.getSelection)text=window.getSelection().toString();else if(document.getSelection)text=document.getSelection().toString();else if(document.selection&&document.selection.type!="Control")text=document.selection.createRange().text;if(text.length>0)evt.stopPropagation()});container.add(t)}this.show()}_p=wcInherit(WcMessageDialog,WcxDialog);
function WcInputDialog(text,caption,value){if(_wcconstructing)return;WcxDialog.call(this);this._element.addClass("wcx-input-dialog");var container=new WcxComponent;container._element.addClass("wcx-dialog-text");var t=new WcxLabel(text);t._element.css("white-space","pre-wrap");t.setWrap(true);t.addEventListener("contextmenu",function(evt){var text=" ";if(window.getSelection)text=window.getSelection().toString();else if(document.getSelection)text=document.getSelection().toString();else if(document.selection&&
document.selection.type!="Control")text=document.selection.createRange().text;if(text.length>0)evt.stopPropagation()});container.add(t);this.addItem(container);this.setCaption(caption);var input=new WcxTextField(value);input._element.addClass("wcx-dialog-input");input.setSize(300);this.addItem(input);this.inputbox=input;var dlg=this.getInstance();var btnOK=dlg.btnOK.ibxWidget("instance").element;$(btnOK).addClass("common-btn btn-solid btn-default");$(btnOK).css("order","1");var btnCancel=dlg.btnCancel.ibxWidget("instance").element;
$(btnCancel).addClass("common-btn btn-ghost btn-default");this.show()}_p=wcInherit(WcInputDialog,WcxDialog);_p.getValue=function(){return this.inputbox.getText()};function WcReorderArray(theArray,fromIndex,toIndex){if(toIndex>=theArray.length){var k=toIndex-theArray.length+1;while(k--)theArray.push(undefined)}theArray.splice(toIndex,0,theArray.splice(fromIndex,1)[0])}
function wcGetCurrentPage(link){var targetobj=null;if(link.formid)targetobj=wcapplication.getWcfObject(link.formid);if(targetobj==null)targetobj=link.jqobj.closest("div[contentpage='y']").data("wcobj");return targetobj}
function wcReconnect(xml){var waiting;var text="";var href;var qry;var childnodes=xml.childNodes;for(var i=0;i<childnodes.length;++i){if(childnodes[i].nodeType!=1)continue;if(childnodes[i].nodeName=="url"&&childnodes[i].firstChild)href=childnodes[i].firstChild.nodeValue;else if(childnodes[i].nodeName=="qry"&&childnodes[i].firstChild)qry=childnodes[i].firstChild.nodeValue;else if(childnodes[i].nodeName=="message"&&childnodes[i].firstChild)text=childnodes[i].firstChild.nodeValue}if(href&&qry){waiting=
new WcxWaiting(text);wcapplication.topframe.add(waiting);var tid=setInterval(function(){$.ajax({method:"GET",url:qry}).done(function(){clearInterval(tid);if(window.ibitimerintervals){var index=window.ibitimerintervals.indexOf(tid);if(index>=0)window.ibitimerintervals.splice(index,1)}var xml=new WcLoader(href);xml.addParam("IBIS_login","y");xml.load(wcxParseXml,wcapplication.topframe)})},1E4);if(window.ibitimerintervals)window.ibitimerintervals.push(tid)}}
function wcGetComponentByName(name){if(name){var forms=$(".wcx-wcform");if(forms)for(var i=0;i<forms.length;i++){var wcobj=$(forms[i]).data("wcobj");if(wcobj&&wcobj.wcitems){for(var j=0;j<wcobj.wcitems.length;j++){var item=wcobj.wcitems[j];if(item&&item.getName()==name)return item}if(wcobj.wchiddens&&wcobj.wchiddens.item)for(var k=0;k<wcobj.wchiddens.item.length;k++){var hidden=wcobj.wchiddens.item[k];if(hidden&&hidden.name==name)return wcBuild(hidden)}}}}return null}
function wcClosePopup(page,value){var p=page._element.closest(".wcx-popup-window");if(p.length>0){var wcobj=p.data("wcobj");if(wcobj)wcobj.close();else if(p.hasClass("wcx-calculator-window"))p.ibxWidget("close")}else{p=page._element.closest(".wcx-dialog");if(p.length>0)p.ibxWidget("close");else if(wcapplication.iframeid){$("body").empty();if(value&&value!="")parent.$("body").find("#"+wcapplication.iframeid).dispatchEvent("closeRsPop",value);else parent.$("body").find("#"+wcapplication.iframeid).dispatchEvent("closeRsPop")}}}
function wcSubstitute(value,parameters){var v;if(value==null||value=="")return value;if(!parameters)return value;v=value;return v.replace(/%\{?([a-zA-Z_]\w*)\}?/g,function(str,tag){for(var i=0;i<parameters.length;++i)if(parameters[i].name==tag)return parameters[i].value;return""})}function wcSubmitForm(doc,html,callback,obj){var te=doc.createElement("div");te.innerHTML=html;if(doc.body)doc.body.appendChild(te);if(callback)callback(obj);doc.charset="utf-8";doc.forms[0].submit()}
function wcClearTextSelection(){if(window.getSelection)if(window.getSelection().empty)window.getSelection().empty();else{if(window.getSelection().removeAllRanges)window.getSelection().removeAllRanges()}else if(document.selection)document.selection.empty()}
function wcTrace(){if(window.XMLHttpRequest)this._ajaxreq=new XMLHttpRequest;else if(window.ActiveXObject)this._ajaxreq=new ActiveXObject("Microsoft.XMLHTTP");else this._ajaxreq=null;this.path="./wctrace";this.off=true;this.syncall=true;this.ajaxCallback=function(){}}wcTrace.prototype.setTrace=function(on){this.off=!on};
wcTrace.prototype.write=function(msg,type,stack){if(!type||type!="error"&&type!="warning"&&type!="information")type="trace";if(this.off&&type=="trace")return null;try{var callfun=arguments.callee.caller.toString();callfun=callfun.substr("function ".length);callfun=callfun.substr(0,callfun.indexOf("("));if(!callfun)callfun="<anonymous>";var dt=new Date;var hh=dt.getHours();var mm=dt.getMinutes();var ss=dt.getSeconds();if(hh<=9)hh="0"+hh;if(mm<=9)mm="0"+mm;if(ss<=9)ss="0"+ss;var dtime=hh+"."+mm+"."+
ss;var data=" "+type+" "+dtime+" "+callfun+" : "+msg;var div=" | "+Array(41).join("=")+" | ";if(typeof stack==="string"){var cs_str=stack.split("\n").join(" | ");data+=" | Call Stack:"+div+cs_str+div}else{var callstack=printStackTrace();var cs_str=callstack.join(" | ");data+=" | Call Stack:"+div+cs_str+div}if(!this.syncall){this._ajaxreq.open("POST",this.path,true);this._ajaxreq.onreadystatechange=this.ajaxCallback}else this._ajaxreq.open("POST",this.path,false);this._ajaxreq.send(data);if(this.syncall)if(this._ajaxreq.status==
200){if(!this._ajaxreq.responseXML)return null;var resdoc=this._ajaxreq.responseXML.documentElement;return resdoc}else return null}catch(e){}return null};var ibitrace=new wcTrace;window.defaultOnerror=window.onerror;window.onerror=function(m,s,l,c,e){if(ibitrace)ibitrace.write(e.message,"error",e.stack);if(window.defaultOnerror)window.defaultOnerror(m,s,l,c,e)};window.ibitimerintervals=[];
window.addEventListener("unload",function(event){if(window.ibitimerintervals){var count=window.ibitimerintervals.length;if(count>0)for(var i=count-1;i>=0;i--){var interval=window.ibitimerintervals[i];if(interval)clearInterval(interval)}}window.ibitimerintervals=[]});
function WcNotification(text,title){if(_wcconstructing)return;WcxHBox.call(this);this._element.addClass("wcx-notification");$(this._element).css({"position":"absolute","z-index":999999,"right":"30px","bottom":"30px","width":"320px","min-height":"72px","color":"white","background-color":"#1f1f1f","padding":"10px","display":"none"});var icon=$("<div class='wcx-notification-icon ds-icon-info'></div>");$(icon).css({"color":"#ffffff","background-color":"#2984FF","padding":"10px"});$(this._element).append(icon);
if(!title)title=ibx.resourceMgr.getString("notification");var text=$("<div class='wcx-notification-text' style='padding-left:10px; color:#a5a5a5; font-size:11pt'>"+"<span class='wcx-title' style='color:#ffffff'>"+title+"</span><br>"+text+"</div>");$(this._element).append(text);var notification=this;if(!WcNotification.disabled)setTimeout(function(){$(document.body).append(notification._element);$(notification._element).fadeIn("slow",function(){setTimeout(function(){$(notification._element).fadeOut("slow",
function(){$(notification._element).remove();notification.dispose()})},3E3)})},0)}_p=wcInherit(WcNotification,WcxHBox);WcNotification.disabled=false;WcNotification.log=[];wcScroll_Stop=0;wcScroll_Top=1;wcScroll_Left=2;wcScroll_Right=3;wcScroll_Bottom=4;
function wcAddDragDropScroller(scrollableObj,options){var size=40;var step=2;var delay=2;var startDelay=20;if(options){if(options.size)size=options.size;if(options.step)step=options.step;if(options.delay)delay=options.delay;if(options.startdelay)startDelay=options.startdelay}scrollableObj.data("scroll",wcScroll_Stop);var doScroll=function(){var scroll=$(this).data("scroll");var scrollX=$(this).scrollLeft();var scrollY=$(this).scrollTop();if(scroll==wcScroll_Top)$(this).scrollTop(scrollY-step);else if(scroll==
wcScroll_Bottom)$(this).scrollTop(scrollY+step);else if(scroll==wcScroll_Left)$(this).scrollLeft(scrollX-step);else if(scroll==wcScroll_Right)$(this).scrollLeft(scrollX+step);if(scroll!=wcScroll_Stop)setTimeout(doScroll.bind(this),delay)};var wcobj=scrollableObj.data("wcobj");var isWidget=wcobj instanceof WcxWidget?true:false;$(scrollableObj).data("isdragging",!isWidget);if(isWidget)wcobj.setDragOverEventListener(function(evt){$(this).data("isdragging",true)}.bind(scrollableObj));scrollableObj.on("mousemove mouseenter",
function(evt){var scroll=wcScroll_Stop;var isDragging=$(this).data("isdragging");if(evt.buttons>0&&isDragging){var x=evt.clientX-$(this).offset().left;var y=evt.clientY-$(this).offset().top;var objWidth=$(this).width();var objHeight=$(this).height();if(y<size)scroll=wcScroll_Top;else if(y>objHeight-size)scroll=wcScroll_Bottom;else if(x<size)scroll=wcScroll_Left;else if(x>objWidth-size)scroll=wcScroll_Right}else{var wcobj=$(this).data("wcobj");var isWidget=wcobj instanceof WcxWidget;if(isWidget)$(this).data("isdragging",
false)}var oldScroll=this.data("scroll");this.data("scroll",scroll);if(scroll!=oldScroll&&scroll!=wcScroll_Stop)setTimeout(doScroll.bind(this),startDelay)}.bind(scrollableObj));scrollableObj.on("mouseleave",function(evt){this.data("scroll",wcScroll_Stop)}.bind(scrollableObj))}var wcMF={};wcMF.wcSN=0;wcMF.wcNoDragAndDropFlag=1;wcMF.wcEnableAutoRefreshFlag=2;wcMF.wcNotRestrictedFlag=4;wcMF.wcNoMoveFlag=8;wcMF.wcReadOnlyFlag=16;wcMF.wcEnableContentMoveFlag=1024;wcMF.wcHeaderLocation=false;
wcMF.wcShowFramesToolbar=1;wcMF.wcMaxContentPerFrame=10;wcMF.wcObjects=[];wcMF.container={};wcMF.container.wcPersistentFlag=16;wcMF.frame={};wcMF.frame.wcNoSwitchViewFlag=1;wcMF.frame.wcPersistentFrameFlag=2;wcMF.frame.wcCurrentlyHiddenFlag=4;wcMF.frame.wcStayInFrameFlag=8;wcMF.frame.wcDelayLoadFlag=16;wcMF.frame.wcNoFramesToolbarFlag=32;wcMF.frame.wcDoAnimationFlag=64;wcMF.frame.wcHItemsResizedFlag=1024;wcMF.frame.wcVItemsResizedFlag=2048;wcMF.frame.wcItemResizing=false;wcMF.content={};
wcMF.content.wcDoNotReload=1;wcMF.content.wcCannotClose=2;wcMF.content.wcIsRedirectFlag=128;
function WcMultiframes(mfItem){if(_wcconstructing)return;WcxWidget.call(this);this._element.addClass("wcx-multiframe");this.setName(mfItem.id);this.registerObj();wcapplication.setWcfObject(this);this.wcId=mfItem.id;this.setName(this.wcId);this._element.addClass("wcx-mf-"+this.wcId);this.wcFlags=mfItem.flags;this.wcNoDragAndDropMode=this.wcFlags&wcMF.wcNoDragAndDropFlag?true:false;this.wcNotRestricted=this.wcFlags&wcMF.wcNotRestrictedFlag?true:false;this.wcNoMove=this.wcFlags&wcMF.wcNoMoveFlag?true:
false;this.wcReadOnly=this.wcFlags&wcMF.wcReadOnlyFlag?true:false;this.wcEnableContentMove=false;this.wcNoContentMove=!this.wcEnableContentMove||this.wcNoMove;tempVal=localStorage.getItem("mf,headerLocation");if(tempVal)wcMF.wcHeaderLocation=tempVal!="false";tempVal=localStorage.getItem("mf,showFramesToolbar");if(tempVal)wcMF.wcShowFramesToolbar=parseInt(tempVal);tempVal=localStorage.getItem("mf,maxContentPerFrame");if(tempVal)wcMF.wcMaxContentPerFrame=parseInt(tempVal);this.wcThemeIndex=0;this.wcOriginalCaption=
"";this.wcDbObjsWidth=0;this.wcDbObjsHeight=0;this.wcInPage=mfItem._page;this.wcActionInfo={wcHttpXML:mfItem.xlinkd,wcActionName:mfItem.actionname,wcActionValue:"",wcDropName:mfItem.dropname,wcDropValue:"",wcContentName:mfItem.contentname,wcContentValue:"",wcLayoutName:mfItem.layout_propertyname,wcLayoutValue:mfItem.layout_properties};this.wcDragDropInfo={wcDragContent:null,wcDropFrame:null,wcDropTarget:null};this.wcCaption=mfItem.caption;this.wcTipText=mfItem.tip;this.wcOuterSize=50;this.wcTabHeight=
22;this.wcMaximized=null;this.wcLayoutIDCounter=1;this.wcFramesList=[];this.wcContentsList=[];this.wcHoverView=null;this.wcAdjustLayoutFailCounter=0;this.wcMFMaxPanel=new WcMultiframesFlexContainer("vertical","WcMultiframesMaxPanel");this.wcMFMaxPanel._element.addClass("wcx-mfmaxpanel");this.wcMFMaxPanel.setVisible(false);this.add(this.wcMFMaxPanel);this.wcMFMaxHeaderPanel=new WcxHBox(false);this.wcMFMaxHeaderPanel._element.addClass("wcx-mfmaxheaderpanel");this.wcMFMaxPanel.add(this.wcMFMaxHeaderPanel);
this.wcRestoreBtn=new wcCreateIconButton({"icon":wcapplication.imgstr.rstore});this.wcRestoreBtn._setQaAttr("Restore");this.wcRestoreBtn._element.addClass("wcx-mfrestorebtn");$(this.wcRestoreBtn._element).attr("title",ibx.resourceMgr.getString("restore"));this.wcRestoreBtn.setEnabled(true);this.wcRestoreBtn.addEventListener("click",this.doRestore,this);this.wcMFMaxHeaderPanel.add(this.wcRestoreBtn);this.wcMFMaxNotifyPanel=new WcxComponent("WcMFMaxNotifyPanel");this.wcMFMaxNotifyPanel._element.addClass("wcx-mfmaxnotifypanel");
this.wcMFMaxNotifyPanel.setVisible(false);this.wcMFMaxPanel.add(this.wcMFMaxNotifyPanel);var notifyText="Changes were made to other frames. Close maximize to see the changes.";this.wcMFNotifyLabel=new WcxLabel(notifyText);this.wcMFMaxNotifyPanel.add(this.wcMFNotifyLabel);this.wcMFObject=new WcMultiframesFlexContainer("vertical","WcMultiframesMFObject");this.wcMFObject._element.addClass("wcx-mfobject");this.add(this.wcMFObject);this.wcMFRefreshPanel=new WcMultiframesRefreshPanel(this);this.wcMFRefreshPanel.setVisible(this.getAutoRefreshShow());
this.wcMFRefreshPanel.wcDropLabel.setVisible(!this.wcNoDragAndDropMode&&!this.wcReadOnly);this.wcMFRefreshPanel.wcDropOption.setVisible(!this.wcNoDragAndDropMode&&!this.wcReadOnly);this.wcMFObject.addItem(this.wcMFRefreshPanel);this.wcMFBodyPanel=new WcMultiframesBodyPanel(this);this.wcMFMainPanel=this.wcMFBodyPanel.wcMFMainPanel;this.wcRootContainer=this.wcMFBodyPanel.wcRootContainer;this.wcHighlight=this.wcMFBodyPanel.wcHighlight;this.wcMeasure1=this.wcMFBodyPanel.wcMeasure1;this.wcMeasure2=this.wcMFBodyPanel.wcMeasure2;
this.wcMFObject.addItem(this.wcMFBodyPanel,null,true);this.wcOverlay=new WcxComponent("WcMultiframesOverlay");this.wcOverlay._element.addClass("wcx-mfoverlay");this.wcOverlay.setVisible(false);this.wcOverlay.wcDragStarted=false;this.wcOverlay.wcIsResizing=false;this.wcOverlay.addEventListener("mousemove",this.doOverlayMouseMove,this);this.wcOverlay.addEventListener("mouseup",this.doOverlayMouseUp,this);this.add(this.wcOverlay);if(!this.wcNoDragAndDropMode){this.wcParsingLayout=true;if(this.renderLayout(this.wcActionInfo.wcLayoutValue)){var actionInfo=
this.wcActionInfo;actionInfo.wcDropValue="";actionInfo.wcContentValue="";actionInfo.wcActionValue="load";actionInfo.wcLayoutValue=this.getLayoutString();this.renderContent();this.sendUpdateLayout("INIT")}else this.wcRootContainer.removeAll();this.wcParsingLayout=false}this.wcMFstatus="start";this.wcLoadPending=[];var mf=this;this.wcMainTop=$(this.wcMFMainPanel._element).offset().top;this.wcMainLeft=$(this.wcMFMainPanel._element).offset().left;this.wcMainWidth=this.wcMFMainPanel.getWidth();this.wcMainHeight=
this.wcMFMainPanel.getHeight();this.wcInIframe=window.self!==window.top;if(this.wcInIframe)$(window).on("resize",this.doWindowResize.bind(this));else this.setResizeEventListener(this.doCheckResize);$(this._element).on("resize",this.doCheckResize.bind(this))}_p=wcInherit(WcMultiframes,WcxWidget);
WcMultiframes._doWcMFLayout=function(mflayoutItem){var mf=null;for(var i=wcMF.wcObjects.length-1;i>=0;i--){var obj=wcMF.wcObjects[i];if(obj.getName()==mflayoutItem.multiframeid){mf=obj;break}}if(mf)mf.doMFLayoutWcItem(mflayoutItem);return null};WcMultiframes._reorderArray=function(theArray,fromIndex,toIndex){if(toIndex>=theArray.length){var k=toIndex-theArray.length+1;while(k--)theArray.push(undefined)}theArray.splice(toIndex,0,theArray.splice(fromIndex,1)[0])};_p._dispose=_p.dispose;
_p.dispose=function(){this.setVisible(false);clearInterval(this.wcCheckResize);$(window).off("resize",this.doWindowResize);$(document).off("keydown",this.doKeyDown);$(document).off("keyup",this.doKeyUp);wcapplication.clrWcfObject(this);this.unregisterObj();var x=this.wcOverlay;if(x)x.dispose();delete this.wcOverlay;x=this.wcMFBodyPanel;if(x)x.dispose();delete this.wcMFBodyPanel;x=this.wcMFObject;if(x)x.dispose();delete this.wcMFObject;delete this.wcHighlight;delete this.wcMeasure1;delete this.wcMeasure2;
delete this.wcRootContainer;if(this.wcContentsList.length>0)for(var i=this.wcContentsList.length-1;i>=0;i--){var x=this.wcContentsList[i];x.dispose()}delete this.wcContentsList;if(this.wcFramesList.length>0)for(var i=this.wcFramesList.length-1;i>=0;i--){var x=this.wcFramesList[i];x.dispose()}delete this.wcFramesList;this._dispose.call(this)};
_p.getParams=function(){var params=new Object;if(this.wcContentsList)for(var i=0;i<this.wcContentsList.length;i++){var cp=this.wcContentsList[i];if(cp){var children=cp.getChildren();if(children)for(j=0;j<children.length;j++){var child=children[j];if(child)params=wcGetParams(child,params)}}}return params};_p.registerObj=function(){wcMF.wcObjects.push(this)};_p.unregisterObj=function(){var index=wcMF.wcObjects.indexOf(this);wcMF.wcObjects.splice(index,1)};
_p.doMFLayoutWcItem=function(mflayoutItem){var layout=mflayoutItem.properties;if(layout){var mf=this;var view=this.doDetachAllViews();this.wcInPopupWindow=false;var popup=$(this._element).closest(".wcx-popup-window-body");if(popup&&popup.length>0){this.wcInPopupWindow=true;$(popup[0]).ready(function(){var width=popup.width();if(width<=0){width=parseInt(window.innerWidth*.75);mf.setWidth(width);mf.wcPopupForm=false;var wcform=$(mf._element).siblings(".wcx-wcform-buttonbar");if(wcform&&wcform.length>
0){mf.wcPopupForm=true;if(mf.wcPopupForm)mf._element.addClass("wcx-mf-popupform")}popup.css("overflow","hidden");var popupwindow=$(mf._element).closest(".wcx-popup-window");if(popupwindow){var popupWidth=$(popupwindow).width();if(popupWidth<width){var left=parseInt((window.innerWidth-width)/2);popupwindow.css("left",left+"px")}popupwindow.css("width",width+"px")}mf._element.css("width","")}setTimeout(function(){mf.adjustLayout("INITIAL_SHOW",null);if(mf.wcInIframe)setTimeout(function(){mf.doCheckResize()},
0)},100)})}this.doMFLayout(layout,view);if(mf.wcHasUnspecifiedSize)mf.adjustLayout("INITIAL_SHOW",null)}};_p.doDetachAllViews=function(){var views=[];if(this.wcContentsList)for(var i=0;i<this.wcContentsList.length;i++){var cp=this.wcContentsList[i];var view=cp.wcContentView;views.push(view);var item=view.wcContentItem;item.wcContentView=null}return views};
_p.doReattachViews=function(views){var nContents=this.wcContentsList;for(var i=0;i<views.length;i++){var oView=views[i];var oCP=oView.wcContentPane;var oContentID=oCP.wcContentInfo.wcContentID;var nCP=null;var matchFound=false;for(var j=0;j<nContents.length;j++){nCP=nContents[j];if(nCP&&nCP.wcContentInfo){var nContentID=nCP.wcContentInfo.wcContentID;var nData=nCP.wcContentInfo.wcData;var doNotReload=nData=="undefined";var nFlags=nCP.wcContentInfo.wcOptionsFlag;if(nFlags&wcMF.content.wcDoNotReload)doNotReload=
true;if(nContentID==oContentID&&doNotReload){matchFound=true;break}}}if(matchFound){var nView=nCP.wcContentView;var item=nCP.wcContentItem;var frameView=nCP.wcFrameView;var frame=nCP.wcContentFrame;var contentPanes=frame.wcContentPanes;if(contentPanes&&contentPanes.length>0){var cpIndex=contentPanes.indexOf(nCP);if(cpIndex>=0)contentPanes[cpIndex]=oCP}oCP.wcContentFrame=frame;oCP.wcFrameView=frameView;oCP.wcContentItem=item;oCP.wcLoadPending=false;oCP.wcContentInfo.wcParsedWidth=nCP.wcContentInfo.wcParsedWidth;
oCP.wcContentInfo.wcParsedHeight=nCP.wcContentInfo.wcParsedHeight;oView.wcContentFrame=frame;oView.wcContentItem=item;item.wcContentView=oView;item.wcContentPane=oCP;var oHoverTab=oView.wcHoverTab;oHoverTab.wcContentFrame=frame;var index=-1;index=frame.wcContentPanes.indexOf(nCP);if(index>=0)frame.wcContentPanes[index]=oCP;index=nContents.indexOf(nCP);if(index>=0)nContents[index]=oCP;nView.dispose()}else oView.dispose()}this.adjustLayout("REFRESH",null);for(var i=0;i<this.wcFramesList.length;i++){var frameObj=
this.wcFramesList[i];if(frameObj)frameObj.doFrameResize()}};_p.doMFLayout=function(layoutParam,views){this.removeAllFrames();if(this.renderLayout(layoutParam)){if(views)this.doReattachViews(views);var that=this;var actionInfo=this.wcActionInfo;actionInfo.wcDropValue="";actionInfo.wcContentValue="";actionInfo.wcActionValue="load";actionInfo.wcLayoutValue=that.getLayoutString();that.renderContent()}else{if(views)this.doReattachViews(views);this.removeAllFrames()}this.wcParsingLayout=false};
_p.renderLayout=function(layoutParam){var result=true;this.wcHasPersistentFrame=false;this.wcParsingLayout=true;var rootContainer=this.wcRootContainer;rootContainer.removeAll();this.wcFramesList=[];this.wcContentsList=[];if(layoutParam&&(typeof layoutParam==="string"&&layoutParam.length>1||typeof layoutParam==="object")){var jsonObj=null;if(typeof layoutParam==="object"){jsonObj=layoutParam;if(jsonObj&&jsonObj.wcThemeIndex)this.wcThemeIndex=jsonObj.wcThemeIndex;this.processJsonObj(jsonObj,jsonObj.wcLayout);
layoutParam=this.getLayoutStrFromJson(jsonObj,jsonObj.wcLayout)}else{var extendedStr="";if(layoutParam[0]=="["){var pos=layoutParam.indexOf("//");if(pos>0){extendedStr=layoutParam.substring(pos+2);if(extendedStr)jsonObj=JSON.parse(extendedStr);layoutParam=layoutParam.substring(0,pos);this.processJsonObj(jsonObj,jsonObj.wcLayout);var layoutParamFromJson=this.getLayoutStrFromJson(jsonObj,jsonObj.wcLayout)}}else{jsonObj=JSON.parse(layoutParam);if(jsonObj){if(jsonObj.wcThemeIndex)this.wcThemeIndex=jsonObj.wcThemeIndex;
if(jsonObj.wcLayout&&jsonObj.wcLayout.wcInitialSize)this.wcFixedRoot=parseInt(jsonObj.wcLayout.wcInitialSize)}this.processJsonObj(jsonObj,jsonObj.wcLayout);layoutParam=this.getLayoutStrFromJson(jsonObj,jsonObj.wcLayout)}}this.wcHasFiltersFrame=false;result=rootContainer.parseLayout(layoutParam);if(result){if(this.wcFixedRoot){rootContainer.wcSizeInfo.wcClientHeight=this.wcFixedRoot;rootContainer.wcSizeInfo.wcParsedHeight=this.wcFixedRoot;$(rootContainer._element).removeClass("wcx-multiframes-container");
$(rootContainer._element).removeClass("wcx-mfflex-container");$(rootContainer._element).addClass("wcx-multiframes-fixedroot");$(rootContainer._element).css("height",this.wcFixedRoot+"px");$(rootContainer._element).css("width","100%");$(this.wcMFMainPanel._element).css("overflow-y","visible")}var frames=this.wcFramesList;var fiArray=jsonObj?jsonObj.wcFramesInfo:null;if(!fiArray||fiArray.length<1)fiArray=this.wcActionInfo.wcFrameInfoArray;if(fiArray&&fiArray.length>0)for(var i=frames.length-1;i>=0;i--){var f=
frames[i];var matchFound=false;for(var j=0;j<fiArray.length;j++){var frameInfo=fiArray[j];if(frameInfo.wcFrameID!=""){if(frameInfo.wcFrameID==f.wcFrameInfo.wcFrameID)matchFound=true}else if(frameInfo.wcActiveID)if(frameInfo.wcActiveID==f.wcActiveID)matchFound=true;if(matchFound){if(frameInfo.wcNotServerID)f.wcFrameInfo.wcNotServerID=frameInfo.wcNotServerID;if(frameInfo.wcIsTemplate)f.wcFrameInfo.wcIsTemplate=frameInfo.wcIsTemplate;if(frameInfo.wcFrameLabel)f.wcFrameInfo.wcFrameLabel=frameInfo.wcFrameLabel;
if(frameInfo.wcFrameOrientation){var orientation=frameInfo.wcFrameOrientation;if(f.wcFrameView.setOrientation){f.wcFrameView.setOrientation(orientation[0]=="H"?"HORIZONTAL":"VERTICAL");f.wcFrameView.updateViewItems()}}break}}}if(frames.length<=1){this.wcRootContainer.wcOrientation="ROOT";if(frames.length==1){var f=frames[0];f.setLeft(0);f.setTop(0)}}else rootContainer.parseArrangeObjects();for(var i=this.wcContentsList.length-1;i>=0;i--){var cp=this.wcContentsList[i];if(cp){var frame=cp.wcContentFrame;
var strID=cp.wcContentInfo.wcContentID+"";if(!strID||strID.substring(0,1)=="-")cp.wcContentFrame.removeContent(cp.wcContentInfo.wcContentID);else{var ciArray=jsonObj?jsonObj.wcContentsInfo:null;if(!ciArray||ciArray.length<1)ciArray=this.wcActionInfo.wcContentInfoArray;if(ciArray&&ciArray.length>0){var matchFound=false;for(var j=0;j<ciArray.length;j++){var contentInfo=ciArray[j];if(contentInfo.wcContentID==cp.wcContentInfo.wcContentID){matchFound=true;cp.wcContentInfo.wcNotServerID=contentInfo.wcNotServerID;
cp.wcContentInfo.wcServerTitle=contentInfo.wcContentTitle?true:false;if(contentInfo.wcContentTitle)cp.wcContentInfo.wcContentTitle=contentInfo.wcContentTitle;if(contentInfo.wcContentSubtitle)cp.wcContentInfo.wcContentSubtitle=contentInfo.wcContentSubtitle;if(contentInfo.wcContentTooltip)cp.wcContentInfo.wcContentTooltip=contentInfo.wcContentTooltip;cp.setTitleText(cp.wcContentInfo.wcContentTitle,cp.wcContentInfo.wcContentTooltip,cp.wcContentInfo.wcContentSubtitle);if(contentInfo.wcWindowSize)cp.wcContentInfo.wcWindowSize=
contentInfo.wcWindowSize;if(contentInfo.wcServerActions)cp.wcContentInfo.wcServerActions=contentInfo.wcServerActions;cp.wcContentInfo.wcParams=new WcUrl;cp.wcContentInfo.wcParams.setUrl(contentInfo.wcUrl);if(contentInfo.wcParams&&contentInfo.wcParams._paramN)cp.wcContentInfo.wcParams.copyAll(contentInfo.wcParams);cp.wcContentInfo.wcUrl=contentInfo.wcUrl;cp.wcIsEmpty=false;break}}if(!matchFound&&this.wcNoDragAndDropMode){var keepFrame=frame.wcFrameInfo.wcFrameID||frame.wcFrameInfo.wcFrameFlag&1||frame.wcFrameInfo.wcFrameFlag&
2;cp.wcContentFrame.removeContent(cp.wcContentInfo.wcContentID,keepFrame);if(frame.wcFrameInfo.wcFrameFlag&1)frame.hide()}}}var cv=cp.wcContentView;cv.doRefresh()}}delete this.wcActionInfo.wcFrameInfoArray;delete this.wcActionInfo.wcContentInfoArray}}this.wcParsingLayout=false;if(this.wcFramesList.length==0){if(!this.wcNoDragAndDropMode)this.doShowTemplateSelector()}else{this.wcInitialHiddenFrames=0;for(var i=0;i<this.wcFramesList.length;i++){var frame=this.wcFramesList[i];if(frame&&frame.wcIsHidden)this.wcInitialHiddenFrames+=
1}if(this.wcFramesList.length==1){var frame=this.wcFramesList[0];this.wcNoMove=frame.wcFrameType=="single"}}var mf=this;setTimeout(function(){var parentEl=$(mf._element).parent();if(parentEl&&parentEl.hasClass("wcx-content"))parentEl=parentEl.parent();if(parentEl.hasClass("wcx-multiframes-content-pane")){var parentCP=parentEl.data("wcobj");if(parentCP){parentCP.wcHasMultiFrame=mf;$(parentCP._element).css("display","flex");$(parentCP._element).css("flex-direction","column");var parentMF=parentCP.wcMultiFrames;
if(parentMF){parentMF.wcHasMultiFrames=true;mf.wcInMultiFrame=parentMF;if(!parentMF.wcNoDragAndDropMode){mf.wcFlags=mf.wcFlags&~wcMF.wcNoDragAndDropFlag;mf.wcNoDragAndDropMode=false}parentMF.updateFramesToolbar()}var flags=parentCP.wcContentInfo.wcOptionsFlag;var cannotClose=flags&wcMF.content.wcCannotClose?true:false;if(cannotClose)mf.adjustLayout("INITIAL_SHOW",null);var showHeader=!cannotClose&&mf.wcNotRestricted;parentCP.wcContentFrame.wcShowHeader=showHeader;parentCP.wcContentFrame.wcFrameView.refreshFrameView();
if(cannotClose)mf.adjustLayout("REFRESH",null)}else mf.wcNotRestricted=true}mf.updateFramesToolbar();if(mf)mf.doMultiFrameResize()},100);return result};
_p.renderContent=function(){var loadCount=0;this.wcLoadContentIDs=[];if(this.wcContentsList.length>0)for(var i=0;i<this.wcContentsList.length;i++){var cp=this.wcContentsList[i];if(cp&&cp.wcLoadPending){loadCount+=1;if(this.wcActionInfo.wcActionValue!="load"&&this.wcActionInfo.wcActionValue!="refresh"){if(cp.wcContentInfo)this.wcLoadContentIDs.push(cp.wcContentInfo.wcContentID)}else{cp.wcIsEmpty=false;if(cp.wcContentInfo&&!cp.wcContentInfo.wcData)cp.wcIsEmpty=true;var loadOptions={};loadOptions.wcDoNotForceShow=
true;loadOptions.wcDoRefresh=this.wcActionInfo.wcActionValue=="refresh";cp.doLoad(null,null,loadOptions)}cp.wcLoadPending=false}}return loadCount};
_p.processJsonObj=function(jsonRoot,jsonContainer){var jsonModified=jsonRoot&&jsonRoot.wcModified;if(jsonContainer==jsonRoot&&jsonModified){jsonContainer.wcWidth=1E3;jsonContainer.wcHeight=1E3}else{if(!jsonContainer.wcWidth)jsonContainer.wcWidth=1E3;if(!jsonContainer.wcHeight)jsonContainer.wcHeight=1E3}if(jsonContainer.wcOrientation=="R"&&jsonRoot.wcFramesInfo.length>1)jsonContainer.wcOrientation="H";var totalCurrent=0;var totalInitial=0;var visibleCount=0;var hasVisibleFrames=false;var resizeNeeded=
jsonModified;var items=jsonContainer.wcLayoutItems;var itemsCount=items.length;for(var i=0;i<itemsCount;i++){var item=items[i];if(item.wcCurrentSize>=0)totalCurrent+=item.wcCurrentSize;else resizeNeeded=true;var percentSize=parseInt(item.wcInitialSize);if(item.wcInitialSize==""+percentSize)item.wcPercentSize=percentSize;if(item.wcItemType=="frame"){var flags=this.getFrameInfoFromJson("wcFrameFlags",item,jsonRoot);var isHidden=flags&wcMF.frame.wcCurrentlyHiddenFlag;if(!isHidden){visibleCount+=1;hasVisibleFrames=
true;if(item.wcPercentSize)totalInitial+=item.wcPercentSize}}else if(item.wcItemType=="container"){var containerFlags=item.wcContainerFlags;var isPersistent=containerFlags&wcMF.container.wcPersistentFlag?true:false;if(this.hasVisibleFrames(jsonRoot,item)||isPersistent){visibleCount+=1;hasVisibleFrames=true;if(item.wcPercentSize)totalInitial+=item.wcPercentSize}}}if(resizeNeeded){var parentWidth=jsonContainer.wcWidth;var parentHeight=jsonContainer.wcHeight;for(var i=0;i<itemsCount;i++){var item=items[i];
if(!item.wcInitialSize&&!item.wcPercentSize)this.wcHasUnspecifiedSize=true;var itemSize=item.wcInitialSize;var itemWidth=jsonContainer.wcWidth;var itemHeight=jsonContainer.wcHeight;if(item.wcPercentSize){itemSize=item.wcPercentSize;if(jsonContainer.wcOrientation=="H")if(itemSize&&totalInitial>0)itemWidth=parseInt(parentWidth*itemSize/totalInitial);else itemWidth=visibleCount>0?parseInt(parentWidth/visibleCount):parentWidth;else if(itemSize&&totalInitial>0)itemHeight=parseInt(parentHeight*itemSize/
totalInitial);else itemHeight=visibleCount>0?parseInt(parentHeight/visibleCount):parentHeight}else if(jsonContainer.wcOrientation=="H")itemWidth=itemSize;else itemHeight=itemSize;item.wcWidth=itemWidth;item.wcHeight=itemHeight;if(item.wcItemType=="frame"){var flags=this.getFrameInfoFromJson("wcFrameFlags",item,jsonRoot);var isHidden=flags&wcMF.frame.wcCurrentlyHiddenFlag;if(isHidden){item.wcWidth=itemWidth=0;item.wcHeight=itemHeight=0}var cItems=item.wcItems;if(cItems)for(var j=0;j<cItems.length;j++){content=
cItems[j];content.wcWidth=itemWidth;content.wcHeight=itemHeight}}if(item.wcItemType=="container")this.processJsonObj(jsonRoot,item)}}return jsonRoot};
_p.hasVisibleFrames=function(jsonRoot,jsonContainer){var hasVisibleFrames=false;var items=jsonContainer.wcLayoutItems;if(items){var itemsCount=items.length;for(var i=0;i<itemsCount;i++){var item=items[i];if(item.wcItemType=="frame"){var flags=this.getFrameInfoFromJson("wcFrameFlags",item,jsonRoot);var isHidden=flags&wcMF.frame.wcCurrentlyHiddenFlag;if(!isHidden)hasVisibleFrames=true}else if(item.wcItemType=="container")if(this.hasVisibleFrames(jsonRoot,item))hasVisibleFrames=true}}return hasVisibleFrames};
_p.getFrameInfoFromJson=function(info,layoutItem,jsonRoot){var frameInfos=jsonRoot.wcFramesInfo;if(frameInfos)for(var i=0;i<frameInfos.length;i++){var fi=frameInfos[i];if(fi)if(fi.wcFrameID&&fi.wcFrameID==layoutItem.wcFrameID||fi.wcActiveID&&fi.wcActiveID==layoutItem.wcActiveID)if(info=="wcFrameFlags")return fi.wcFrameFlags?fi.wcFrameFlags:0}};
_p.getLayoutStrFromJson=function(jsonRoot,obj){var layoutStr="[";if(obj){var strInitialSize=obj.wcInitialSize?obj.wcInitialSize:"";layoutStr+=obj.wcOrientation+obj.wcWidth+","+obj.wcHeight+","+strInitialSize+","+obj.wcContainerFlags+","+obj.wcLayoutID+":";if(obj.wcLayoutItems)for(var i=0;i<obj.wcLayoutItems.length;i++){var layoutItem=obj.wcLayoutItems[i];if(layoutItem.wcItemType=="container")layoutStr+=this.getLayoutStrFromJson(jsonRoot,layoutItem);else if(layoutItem.wcItemType=="frame"){var frameFlags=
this.getFrameInfoFromJson("wcFrameFlags",layoutItem,jsonRoot);layoutStr+="["+layoutItem.wcFrameType+layoutItem.wcWidth+","+layoutItem.wcHeight;layoutStr+=","+(layoutItem.wcInitialSize?layoutItem.wcInitialSize:"");layoutStr+=","+(frameFlags?frameFlags:"0");layoutStr+=","+(layoutItem.wcFrameID?layoutItem.wcFrameID:"");layoutStr+=","+(layoutItem.wcActiveID?layoutItem.wcActiveID:"");layoutStr+=":";var items=layoutItem.wcItems;if(items)for(var j=0;j<items.length;j++){var item=items[j];if(item){var contentFlags=
this.getContentInfoFromJson("wcContentFlags",item,jsonRoot);layoutStr+="("+item.wcContentID+","+item.wcWidth+","+item.wcHeight+",";if(item.wcData==undefined)layoutStr+="undefined";else layoutStr+=item.wcData;layoutStr+=","+(contentFlags?contentFlags:"0");layoutStr+=")"}}layoutStr+="]"}}}layoutStr+="]";return layoutStr};
_p.getContentInfoFromJson=function(info,layoutItem,jsonRoot){var contentInfos=jsonRoot.wcContentsInfo;if(contentInfos)for(var i=0;i<contentInfos.length;i++){var ci=contentInfos[i];if(ci)if(ci.wcContentID&&ci.wcContentID==layoutItem.wcContentID)if(info=="wcContentFlags")return ci.wcContentFlags?ci.wcContentFlags:0}};
_p.createFrame=function(frameType,contentID,noFramesToolbarBtn,bgColor){var frame=new WcMultiframesContentFrame(this,frameType);frame.setVisible(true);frame.wcContainer=null;if(!contentID)contentID=this.getNextContentID();frame.wcActiveID=contentID;frame.wcFramesToolbarBtn=null;this.wcMFBodyPanel.wcMFFramesToolbar.addFramesToolbarBtn(frame);this.wcFramesList.push(frame);return frame};
_p.removeAllFrames=function(){if(this.wcMaximized)this.wcMaximized.doRestore(false);var contents=this.wcContentsList;for(var i=0;i<contents.length;i++){var cp=contents[i];var ci=cp.wcContentItem;var view=ci.wcContentView;if(view){view.setVisible(false);view.dispose();cp.dispose()}ci.dispose()}var actionInfo=this.wcActionInfo;actionInfo.wcDropValue="";actionInfo.wcContentValue="";this.wcRootContainer.removeAll();this.wcRootContainer.wcOrientation="ROOT";this.wcFramesList=[];this.wcContentsList=[]};
_p.updateFramesToolbar=function(){if(!this._disposed&&this.wcMFBodyPanel)this.wcMFBodyPanel.wcMFFramesToolbar.doRefresh()};
_p.buildViewFramesMenuArray=function(menuArray){var body=this.wcMFBodyPanel;var framesToolbar=body.wcMFFramesToolbar;var children=framesToolbar.getChildren();for(var i=0;i<children.length;i++){var btn=children[i];var frame=btn.wcContentFrame;var frameInfo=frame.wcFrameInfo;var frameFlags=frameInfo.wcFrameFlag;var isFramePersistent=frameFlags&wcMF.frame.wcPersistentFrameFlag?true:false;var showMenuItem=true;if(!this.wcIsTopMF)if(!this.wcNoDragAndDropMode)showMenuItem=false;if(isFramePersistent)showMenuItem=
false;if(frame.getContentCount()<=0)showMenuItem=false;var cp=frame.getActiveContentPane();if(cp){if(frame.wcFrameType=="single")if(cp.wcIsEmpty)showMenuItem=false;var nestedMF=cp.wcHasMultiFrame;if(isFramePersistent&&nestedMF)showMenuItem=true}if(showMenuItem){var menuitem={};var frameCaption='"'+framesToolbar.getFrameCaption(frame)+'"';menuitem.text=(frame.wcIsHidden?ibx.resourceMgr.getString("show"):ibx.resourceMgr.getString("hide"))+" "+frameCaption;var icon=cp?cp.wcContentInfo.wcPageIcon:null;
if(!icon)icon=frame.wcIsHidden?"ds-icon-toggle-off":"ds-icon-toggle-on";menuitem.icon=icon;menuitem.wcContentFrame=frame;menuitem.click=frame.toggle;menuitem.wcFramesToolbar=framesToolbar;menuitem.mouseover=framesToolbar.doFrameBtnMouseOver;menuitem.mouseout=framesToolbar.doFrameBtnMouseOut;menuArray.push(menuitem)}if(cp)if(!frame.wcIsHidden){var nestedMF=cp.wcHasMultiFrame;if(nestedMF)nestedMF.buildViewFramesMenuArray(menuArray)}}};
_p.getDockingFrame=function(e){var x=e.pageX;var y=e.pageY;var frame=null;var frameTop=0;var frameLeft=0;var frameRight=0;var frameBottom=0;for(var i=0;i<this.wcFramesList.length;i++)try{frame=this.wcFramesList[i];if(frame&&!frame.wcIsHidden){frameTop=$(frame._element).offset().top;frameLeft=$(frame._element).offset().left;frameRight=frameLeft+$(frame._element).width();frameBottom=frameTop+$(frame._element).height();if(x>=frameLeft&&x<=frameRight&&y>=frameTop&&y<=frameBottom)return frame}}catch(e){}return null};
_p.getNextFrameID=function(){var NextID=1;for(var i=1;i<=this.wcFramesList.length+1;i++){var frame=this.getFrameByFrameID("F"+i);NextID=i;if(!frame)break}return"F"+NextID};_p.getNextContentID=function(){var NextID=1;for(var i=1;i<=this.wcContentsList.length+1;i++){var content=null;for(var j=0;j<this.wcContentsList.length;j++){var cp=this.wcContentsList[j];if(cp&&cp.wcContentInfo&&cp.wcContentInfo.wcContentID==""+i){content=cp;break}}NextID=i;if(!content)break}return""+NextID};
_p.getFrameByFrameID=function(id){if(this.wcFramesList)for(var i=0;i<this.wcFramesList.length;i++){var frame=this.wcFramesList[i];if(frame&&frame.wcFrameInfo.wcFrameID==id)return frame}return null};
_p.getContentPaneByID=function(contentID,frameID){if(contentID!=null)if(this.wcContentsList)for(var i=0;i<this.wcContentsList.length;i++){var cp=this.wcContentsList[i];if(cp&&cp.wcContentInfo&&cp.wcContentInfo.wcContentID==contentID)return cp}var strError=" \n does not exist! \n\n Please make sure the ID(s) are correct. ";if(frameID){frame=this.getFrameByFrameID(frameID);if(frame){var contentInfo={};if(contentID!=null){contentInfo.wcContentID=contentID;contentInfo.wcNotServerID=false}else{contentInfo.wcContentID=
this.getNextContentID();contentInfo.wcNotServerID=true}contentInfo.wcData="undefined";contentInfo.wcOptionsFlag=0;contentInfo.wcIsLoadingNew=true;contentInfo.wcOriginalFrameID=frameID;var wasHidden=frame.wcIsHidden;var cp=frame.addContent(contentInfo);if(wasHidden&&frame.wcContainer)frame.wcContainer.adjustSizes(null);cp.wcIsEmpty=false;return cp}}return null};_p.getAutoRefreshShow=function(){var show=this.wcFlags&wcMF.wcEnableAutoRefreshFlag?true:false;return show};
_p.hasRefreshableContent=function(){var result=false;if(this.wcContentsList)for(var i=0;i<this.wcContentsList.length;i++){var cp=this.wcContentsList[i];var contentInfo=cp?cp.wcContentInfo:null;if(contentInfo&&contentInfo.wcAllowRefresh){result=true;break}}return result};
_p.doHttpRequest=function(options){var loadCount=0;if(options.wcLoadCount)loadCount=options.wcLoadCount;if(loadCount>2)return;var userAction="";if(options.wcUserAction)userAction=options.wcUserAction;var action="update";if(options.wcAction)action=options.wcAction;var actionInfo=this.wcActionInfo;if(!action)action=actionInfo.wcActionValue;if(!action)action="update";if(action=="update"&&this.wcFramesList.length==0)return;var drop=null;if(options.wcDropValue)drop=options.wcDropValue;if(!drop)drop=actionInfo.wcDropValue;
if(drop==" ")drop="";var content=null;if(options.wcContentValue)content=options.wcContentValue;if(!content)content=actionInfo.wcContentValue;if(content==" ")content="";var layout=null;if(options.wcLayoutStr)layout=options.wcLayoutStr;if(!layout)layout=actionInfo.wcLayoutValue;var strTrace=" ACTION: "+action+"; DROP: "+drop+"; CONTENT: "+content;var wcHref;var fromwcParams=false;if(options.wcParams)if(!options.wcContentParams||!wcapplication.isWebconsoleRequest(options.wcContentParams._url)||!wcapplication.isWebconsoleRequest(options.wcParams._url)||
!options.wcParams._url.endsWith("/webconsole")){wcHref=options.wcParams._url;fromwcParams=true}else wcHref=options.wcContentParams._url;else if(options.wcContentParams)wcHref=options.wcContentParams._url;else wcHref=wcapplication.wcurl;var wcHrefNotWC=false;if(options.wcParams&&options.wcParams.getHref){var href=options.wcParams.getHref();wcHrefNotWC=true;if(!href.endsWith("/webconsole")){wcHref=href;fromwcParams=true}for(var i=0;i<options.wcParams._paramN.length;++i)if(options.wcParams._paramN[i]==
"IBIS_page"){wcHref=href;fromwcParams=true;break}}if(wcapplication.isWebconsoleRequest(wcHref))wcHrefNotWC=false;var loader=new WcLoader(wcHref);loader.setLoadingMessage(options.wcLoadingMessage);var isLoadAction=action=="load"||action=="refresh"||userAction=="DROP"||options.wcIsServerAction;if(userAction=="DROP")action="drop";if(!isLoadAction||!this.wcNoDragAndDropMode)if(actionInfo.wcHttpXML){if(actionInfo.wcHttpXML.url&&!actionInfo.wcHttpXML.url.endsWith("/webconsole"))loader.setUrl(actionInfo.wcHttpXML.url);
if(actionInfo.wcHttpXML.parameters)loader.replaceParam(actionInfo.wcHttpXML.parameters)}if(options.wcDoMerge){loader.copyAll(options.wcContentParams,true);loader.copyAll(options.wcParams)}else if(options.wcParams&&(options.wcParams._paramN.length>0||fromwcParams))loader.copyAll(options.wcParams);else if(isLoadAction)loader.copyAll(options.wcContentParams);if(options.wcResourceBundleName&&options.wcResourceSelector)loader.addResource(options.wcResourceBundleName,options.wcResourceSelector);var cp=
null;if(isLoadAction){if(!content)return;cp=this.getContentPaneByID(content);cp.wcCallbackInfo={"wcLoadCount":loadCount,"wcDrop":drop,"wcContent":content,"wcUserAction":userAction};if(!cp)return}else if(!actionInfo.wcHttpXML)return;if(wcHrefNotWC&&cp)cp.wcLoadPending=false;var doLoad=loader._paramN.length>0||action=="drop";if(!doLoad)doLoad=!loader._url.endsWith("/webconsole");if(doLoad){if(!wcHrefNotWC){if(actionInfo.wcActionName)loader.replaceParam(actionInfo.wcActionName,action);if(actionInfo.wcDropName)loader.replaceParam(actionInfo.wcDropName,
drop);if(actionInfo.wcContentName)loader.replaceParam(actionInfo.wcContentName,content);if(actionInfo.wcLayoutName)loader.replaceParam(actionInfo.wcLayoutName,layout)}loader.wcMultiFrames=this;loader.wcActionValue=actionInfo.wcActionValue;loader.wcDropValue=actionInfo.wcDropValue;loader.wcContentValue=actionInfo.wcContentValue;loader.load(this.doHttpCallback.bind(loader),cp)}else if(cp)cp.doEmptyContent()};
_p.doHttpCallback=function(rsp,page,selector,resourcename){var mf=this.wcMultiFrames;if(page&&page.wcContentFrame){var frame=page.wcContentFrame;var bNoMove=mf.wcFlags&wcMF.wcNoMoveFlag?true:false;frame.wcShowHeader=!mf.wcNoDragAndDropMode&&bNoMove?true:false}wcxParseXml(rsp,page,selector,resourcename);if(!page)return;var contentInfo=page.wcContentInfo;contentInfo.wcInitFilter=false;if(rsp.initfilter)contentInfo.wcInitFilter=true;var pageHeader=rsp.pageheader;var pageTitle=rsp.pagetitle;contentInfo.wcServerTitle=
true;page.setTitleText(pageHeader,null,pageTitle);contentInfo.wcPageIcon=rsp.pageicon;if(contentInfo.wcPageIcon)mf.updateFramesToolbar();var windowSize=rsp.winsize;if(windowSize){contentInfo.wcWindowSize=windowSize;if(page.wcContentFrame.wcFrameType=="list")page.wcContentFrame.wcFrameView.updateViewItems();else if(page.wcContentFrame.wcFrameType=="filters")page.setWindowSize(windowSize)}var contentItem=page.wcContentItem;if(contentItem&&contentItem.wcPopup){if(rsp.showpopup)contentItem.doPopupOpen();
if(rsp.closepopup)contentItem.wcPopup._element.ibxWidget("close")}if(rsp.data.item)for(var i=0;i<rsp.data.item.length;i++)if(rsp.data.item[i].type=="wcform"){var wcform=rsp.data.item[i];var fb=wcform.formid&&wcform.formid=="wcf_framebar";if(fb)mf.doUpdateFrameBar(page,wcform)}page.wcIsEmpty=false;if(page)page.doPostLoad()};
_p.doUpdateFrameBar=function(cp,item){if(cp){var contentInfo=cp.wcContentInfo;var wcServerActions=[];if(item){var rows=item.row;if(rows)for(var i=0;i<rows.length;i++){var items=rows[i].item;if(items)for(var j=0;j<items.length;j++){var itm=items[j];var itemType=itm.type;var itemText=itm.value;var itemDisabled=itm.disabled;var serverAction=itm.name;if(i==0)if(itemType=="wctext"){var fTitle=itm.text;var fTooltip="";var iDesc=itm.description;if(iDesc)fTooltip=iDesc.text;cp.setTitleText(fTitle,fTooltip)}else if(serverAction==
"refresh_action"){if(itemText)contentInfo.wcRefreshActionText=itemText}else if(serverAction=="maximize_action"){if(itemText)contentInfo.wcMaximizeActionText=itemText}else{if(serverAction=="remove_action")if(itemText)contentInfo.wcRemoveActionText=itemText}else{var xlink=itm.xlink[0];if(xlink){var pams=xlink.parameters;if(pams){var params=[];for(var k=0;k<pams.length;k++)params[pams[k].name]=pams[k].value;var tmp=params[cp.wcMultiFrames.wcActionInfo.wcActionName];if(tmp)serverAction=tmp}}var actionItem=
{};actionItem.wcServerAction=serverAction;actionItem.wcItemText=itemText;wcServerActions.push(actionItem)}}}}if(wcServerActions.length>0)contentInfo.wcServerActions=wcServerActions;var cv=cp.wcContentView;if(cv)if(cv.wcHoverTab){var hoverTab=cv.wcHoverTab;if(hoverTab&&hoverTab.wcHoverMenu){delete hoverTab.wcHoverMenu.wcContentPane;hoverTab.wcHoverMenu.dispose()}hoverTab.wcHoverMenu=hoverTab.createMenu()}}};
_p.doShowTemplateSelector=function(){var wcTemplateDialog=new WcMultiframesTemplateDialog(this);wcTemplateDialog.show()};_p.doShowGridTemplateSelector=function(){var wcGridTemplateDialog=new WcMultiframesGridTemplateDialog(this);wcGridTemplateDialog.show()};_p.doShowLayoutTree=function(evt){var wcLayoutTreeDialog=new WcMultiframesLayoutInfoDialog(this,true);var wcobj=$(evt.currentTarget).data("wcobj");var cp=wcobj&&wcobj instanceof WcMultiframesContentPane?wcobj.wcContentPane:null;wcLayoutTreeDialog.show(cp)};
_p.adjustLayout=function(userAction,newFrame){var adjustLayoutFailed=false;var container=this.wcRootContainer;if(container){adjustLayoutFailed=!container.adjustSizes(userAction);if(!adjustLayoutFailed)if(!this.wcParsingLayout)if(this.wcContentsList)for(var i=0;i<this.wcContentsList.length;i++){var cp=this.wcContentsList[i];var cv=cp.wcContentView;try{if(cv&&!cv._disposed)cv.doRefresh();else adjustLayoutFailed=true}catch(err){adjustLayoutFailed=true;if(window.console)console.log("error:",err)}}}return true};
_p.sendUpdateLayout=function(userAction){if(userAction=="INIT")this.wcActionInfo.wcActionValue="update";else if(userAction=="ADD")this.wcActionInfo.wcActionValue="add";else if(userAction=="COPY")this.wcActionInfo.wcActionValue="update";else if(userAction=="DROP")this.wcActionInfo.wcActionValue="drop";else if(userAction=="MFLAYOUT")this.wcActionInfo.wcActionValue="load";else if(userAction=="REFRESH")this.wcActionInfo.wcActionValue="refresh";else if(userAction=="REMOVE")this.wcActionInfo.wcActionValue=
"remove";else if(userAction=="REMOVEALL"){this.wcActionInfo.wcActionValue="remove";this.wcActionInfo.wcDropValue=" ";this.wcActionInfo.wcContentValue=" "}else if(userAction=="REPLACE")this.wcActionInfo.wcActionValue="update";else if(userAction=="RESIZE"){this.wcActionInfo.wcActionValue="resize";this.wcActionInfo.wcDropValue=" ";this.wcActionInfo.wcContentValue=" "}else if(userAction=="TABCHANGE"){this.wcActionInfo.wcActionValue="update";this.wcActionInfo.wcContentValue=" "}else if(this.wcActionInfo.wcActionValue!=
"load"&&this.wcActionInfo.wcActionValue!="refresh"){this.wcActionInfo.wcDropValue=" ";this.wcActionInfo.wcContentValue=" ";this.wcActionInfo.wcActionValue="update"}this.wcActionInfo.wcLayoutValue=this.getLayoutString();if(!this.wcNoDragAndDropMode)if(userAction!="RESIZE")this.renderContent();if(this.wcActionInfo.wcActionValue!="load"&&this.wcActionInfo.wcActionValue!="refresh"){var httpReq={};httpReq.wcAction=this.wcActionInfo.wcActionValue;httpReq.wcDropValue=this.wcActionInfo.wcDropValue;httpReq.wcContentValue=
this.wcActionInfo.wcContentValue;httpReq.wcUserAction=userAction;this.doHttpRequest(httpReq)}};_p.getLayoutString=function(){var layoutJson=this.wcRootContainer.getLayoutJson();var layoutStr=this.getExtendedInfo(layoutJson);return layoutStr};
_p.getExtendedInfo=function(layoutJson){var extendedInfo="";wcMF.wcSN+=1;extendedInfo='{"wcSN":'+wcMF.wcSN;extendedInfo+=',"wcThemeIndex":'+this.wcThemeIndex;extendedInfo+=',"wcLayout":'+JSON.stringify(layoutJson);if(this.wcFramesList){extendedInfo+=",";var framesInfoStr='"wcFramesInfo":[';for(var i=0;i<this.wcFramesList.length;i++){framesInfoStr+="{";var frameObj=this.wcFramesList[i];if(frameObj&&frameObj.wcFrameInfo){framesInfoStr+='"wcFrameID":"'+frameObj.wcFrameInfo.wcFrameID+'"';framesInfoStr+=
',"wcNotServerID":'+(frameObj.wcFrameInfo.wcNotServerID?"true":"false");framesInfoStr+=',"wcFrameClass":"'+frameObj.wcFrameInfo.wcFrameClass+'"';framesInfoStr+=',"wcFrameFlags":'+(frameObj.wcFrameInfo.wcFrameFlag?frameObj.wcFrameInfo.wcFrameFlag:0);if(frameObj.wcFrameInfo.wcFrameLabel)framesInfoStr+=',"wcFrameLabel":'+JSON.stringify(frameObj.wcFrameInfo.wcFrameLabel);if(frameObj.wcFrameInfo.wcFrameOrientation)framesInfoStr+=',"wcFrameOrientation":"'+frameObj.wcFrameInfo.wcFrameOrientation+'"'}framesInfoStr+=
"}";if(i<this.wcFramesList.length-1)framesInfoStr+=","}framesInfoStr+="]";extendedInfo+=framesInfoStr}if(this.wcContentsList){extendedInfo+=",";var contentsInfoStr='"wcContentsInfo":[';for(var i=0;i<this.wcContentsList.length;i++){contentsInfoStr+="{";var cp=this.wcContentsList[i];if(cp&&cp.wcContentInfo){contentsInfoStr+='"wcContentID":"'+cp.wcContentInfo.wcContentID+'"';contentsInfoStr+=',"wcNotServerID":'+(cp.wcContentInfo.wcNotServerID?"true":"false");contentsInfoStr+=',"wcContentFlags":'+(cp.wcContentInfo.wcOptionsFlag?
cp.wcContentInfo.wcOptionsFlag:0);if(cp.wcContentInfo.wcContentTitle)contentsInfoStr+=',"wcContentTitle":'+JSON.stringify(cp.wcContentInfo.wcContentTitle);if(cp.wcContentInfo.wcContentSubtitle)contentsInfoStr+=',"wcContentSubtitle":'+JSON.stringify(cp.wcContentInfo.wcContentSubtitle);if(cp.wcContentInfo.wcContentTooltip)contentsInfoStr+=',"wcContentTooltip":'+JSON.stringify(cp.wcContentInfo.wcContentTooltip);if(cp.wcContentInfo.wcWindowSize)contentsInfoStr+=',"wcWindowSize":"'+cp.wcContentInfo.wcWindowSize+
'"';var cv=cp.wcContentView;if(cv){var hoverMenu=cv.wcHoverTab?cv.wcHoverTab.wcHoverMenu:null;if(hoverMenu&&hoverMenu.wcHasServerActions){var ServerActions=[];var children=hoverMenu.getChildren();for(var j=0;j<children.length;j++){var mItem=children[j];if(mItem.wcServerAction){var wcActionItem={};wcActionItem.wcServerAction=mItem.wcServerAction;wcActionItem.wcItemText=mItem.getText();ServerActions.push(wcActionItem)}}contentsInfoStr+=',"wcServerActions":'+JSON.stringify(ServerActions)}}var wcParams=
{};var wcParamsObj=cp.wcContentInfo.wcParams;if(wcParamsObj&&wcParamsObj._paramN){wcParams._paramN=wcParamsObj._paramN.slice();wcParams._paramV=wcParamsObj._paramV.slice();contentsInfoStr+=',"wcParams":'+JSON.stringify(wcParams)}if(cp.wcContentInfo.wcUrl)contentsInfoStr+=',"wcUrl":'+JSON.stringify(cp.wcContentInfo.wcUrl)}contentsInfoStr+="}";if(i<this.wcContentsList.length-1)contentsInfoStr+=","}contentsInfoStr+="]";extendedInfo+=contentsInfoStr}extendedInfo+="}";return extendedInfo};
_p.doRefreshAll=function(){if(this.isRefreshing)return;this.isRefreshing=true;if(this.wcFramesList)for(var i=0;i<this.wcFramesList.length;i++){var frame=this.wcFramesList[i];var contentPanes=frame.wcContentPanes;if(contentPanes&&contentPanes.length>0)for(var j=0;j<contentPanes.length;j++){var cp=contentPanes[j];if(cp)if(cp.wcHasMultiFrame){var childMF=cp.getChildren()[0];if(childMF)childMF.doRefreshAll()}else{var cv=cp.wcContentView;if(cv&&cv.getVisible()&&cp.wcContentInfo&&cp.wcContentInfo.wcData){var data=
cp.wcContentInfo.wcData;if(data.indexOf("##")!=0)cp.doRefresh()}}}}this.isRefreshing=false};
_p.doRestore=function(notifyServer){var cv=this.wcMaximized.wcContentView;if(cv)$(cv._element).css({"z-index":"","position":"absolute","width":this.wcRestoreWidth,"height":this.wcRestoreHeight,"top":"","left":"","right":"","bottom":""});this.wcMaximized.doCheckResize();if(this.wcInPopupWindow){var popupTop=$(this.wcPopupWindow).data("wcPopupTop");var popupLeft=$(this.wcPopupWindow).data("wcPopupLeft");var popupWidth=$(this.wcPopupWindow).data("wcPopupWidth");var popupHeight=$(this.wcPopupWindow).data("wcPopupHeight");
$(this.wcPopupWindow).css({"top":popupTop+"px","left":popupLeft+"px","width":popupWidth+"px","height":popupHeight+"px","max-width":"","max-height":""})}this.wcMFMaxPanel.setVisible(false);this.wcMaximized=null;this.doMultiFrameResize()};_p.doWindowResize=function(){this.doCheckResize()};
_p.doCheckResize=function(){var currentTop=$(this.wcMFMainPanel._element).offset().top;var currentLeft=$(this.wcMFMainPanel._element).offset().left;var currentWidth=this.wcMFMainPanel.getWidth();var currentHeight=this.wcMFMainPanel.getHeight();if(currentWidth!=0&&currentHeight!=0)if(currentTop!=this.wcMainTop||currentLeft!=this.wcMainLeft||currentWidth!=this.wcMainWidth||currentHeight!=this.wcMainHeight){var initialShow=this.wcMainWidth==0&&this.wcMainHeight==0;var parent=$(this._element).parent();
if(parent.hasClass("wcx-popup-window-body"))initialShow=false;this.wcMainTop=currentTop;this.wcMainLeft=currentLeft;this.wcMainWidth=currentWidth;this.wcMainHeight=currentHeight;this.doMFstatus();this.doHideAllContentHeaders();this.doMultiFrameResize(initialShow)}};
_p.doMultiFrameResize=function(initialShow){if(this._disposed)return;if(this.wcParsingLayout)return;if(this.wcInFrameSplitting)return;var actionInfo=this.wcActionInfo;actionInfo.ActionValue="update";actionInfo.DropValue="";actionInfo.ContentValue="";clearTimeout(this.delayTimer);var that=this;this.delayTimer=setTimeout(function(){if(that&&that._disposed)return;that.adjustLayout(initialShow?"INITIAL_SHOW":"REFRESH",null);if(that.wcFramesList)for(var i=0;i<that.wcFramesList.length;i++){var frame=that.wcFramesList[i];
if(frame)frame.doFrameResize()}that.doCheckContentResize()},150)};_p.doMaxNotify=function(){var width=this.wcMFMaxNotifyPanel.getWidth();var height=this.wcMFMaxNotifyPanel.getHeight();var top=5;var left=parseInt((window.innerWidth-width)/2);var cssTop=top+"px";var cssLeft=left+"px";$(this.wcMFMaxNotifyPanel._element).css({"top":cssTop,"left":cssLeft});this.wcMFMaxNotifyPanel.setVisible(true);var mf=this;setTimeout(function(){mf.wcMFMaxNotifyPanel.setVisible(false)},2E3)};
_p.doCheckContentResize=function(){if(this.wcContentsList)for(var i=0;i<this.wcContentsList.length;i++){var cp=this.wcContentsList[i];var view=cp.wcContentView;if(view.getVisible())cp.doCheckResize()}};_p.doHideAllContentHeaders=function(){var contents=this.wcContentsList;for(var i=0;i<contents.length;i++){var cp=contents[i];var view=cp?cp.wcContentView:null;if(view)view.setContentHeaderVisible(false)}};
_p.doDragStart=function(evt,dragType,sourceObj){if(this.wcNoMove)return;this.wcDragDropInfo.wcDragType=dragType;if(dragType=="frame"){this.wcDragDropInfo.wcDragContent=null;this.wcDragDropInfo.wcDragFrame=sourceObj}else{this.wcDragDropInfo.wcDragContent=sourceObj;this.wcDragDropInfo.wcDragFrame=sourceObj.wcContentFrame}this.wcOverlay.wcDragStarted=true;this.wcOverlay.setVisible(true);this.wcOverlay.setCursor("move")};
_p.doDragEnd=function(evt,targetFrame){this.hideAllItemHighlighters();this.wcHighlight.setVisible(false);this.wcOverlay.setVisible(false);this.wcOverlay.wcDragStarted=false;this.wcOverlay.setCursor("");this.doCheckContentResize();return};_p.doOverlayMouseMove=function(e){if(e.buttons!=1){this.wcOverlay.wcIsResizing=false;this.wcOverlay.setVisible(false);if(this.wcOverlay.wcDragStarted){this.doDragEnd(e,null);return}}if(this.wcOverlay.wcDragStarted)this.doUpdateHighlight(e)};
_p.doOverlayMouseUp=function(e){if(this.wcOverlay.wcDragStarted){var targetFrame=this.doUpdateHighlight(e);var dragType=this.wcDragDropInfo.wcDragType;var sourceContent=this.wcDragDropInfo.wcDragContent;var sourceFrame=null;if(dragType=="frame")sourceFrame=this.wcDragDropInfo.wcDragFrame;else if(sourceContent&&sourceContent.wcContentFrame)sourceFrame=sourceContent.wcContentFrame;var sourceType=sourceFrame?sourceFrame.wcFrameType:"tab";var sourceID=sourceFrame?sourceFrame.wcFrameInfo.wcFrameID:"";
var sourceFlag=sourceFrame?sourceFrame.wcFrameInfo.wcFrameFlag:0;var stayInFrame=sourceFlag&wcMF.frame.wcStayInFrameFlag?true:false;var targetName=this.wcDragDropInfo.wcDropTarget;var dropPosition=this.wcDragDropInfo.wcDropPosition;if(sourceFrame)this.wcDragDropInfo.wcContainerSource=sourceFrame.wcContainer;if(targetFrame)this.wcDragDropInfo.wcContainerTarget=targetFrame.wcContainer;if(stayInFrame)if(sourceFrame==targetFrame){sourceContent=this.wcDragDropInfo.wcDragContent;dragType="content"}else{sourceContent=
null;dragType="frame"}else if(this.wcNoDragAndDropMode)if(sourceType=="list"||sourceType=="grid")if(this.wcDragDropInfo.wcDragFrame==targetFrame){sourceContent=this.wcDragDropInfo.wcDragContent;dragType="content"}else{sourceContent=null;dragType="frame"}if(targetName){if(targetName=="LIST"){if(sourceContent&&dropPosition!==false&&dropPosition!==undefined){var sourcePosition=sourceFrame.wcContentPanes.indexOf(sourceContent);if(dropPosition>-1)targetFrame.wcFrameView.doReorderItem(sourcePosition,dropPosition)}}else{var strData=
"";var userAction="";var actionInfo=this.wcActionInfo;actionInfo.wcTargetName="";actionInfo.wcActionValue="";actionInfo.wcDropValue=strData;actionInfo.wcContentValue="";var contentInfo={wcContentID:null,wcNotServerID:true,wcData:strData,wcOptionsFlag:0,wcContentTitle:"",wcContentTooltip:""};if(sourceContent){strData="";var sci=sourceContent.wcContentInfo;if(sci.wcData)strData=sci.wcData;contentInfo.wcContentID=sci.wcContentID;contentInfo.wcNotServerID=sci.wcNotServerID;contentInfo.wcData=sci.wcData;
contentInfo.wcOptionsFlag=sci.wcOptionsFlag;contentInfo.wcContentTitle=sci.wcContentTitle;contentInfo.wcContentSubtitle=sci.wcContentSubtitle;contentInfo.wcContentTooltip=sci.wcContentTooltip;if(sci.wcParams)contentInfo.wcParams=sci.wcParams;if(sci.wcOriginalFrameID)contentInfo.wcOriginalFrameID=sci.wcOriginalFrameID}if(targetFrame)if(targetName!="CONTENT"){actionInfo.wcTargetName=targetName;var targetIndex=["TOP","LEFT","RIGHT","BOTTOM","OUTER_TOP","OUTER_LEFT","OUTER_RIGHT","OUTER_BOTTOM"].indexOf(targetName);
if(targetIndex!=-1){var contentID=null;if(dragType=="frame"){userAction="MOVE";var contents=sourceFrame.wcContentPanes;if(contents){var cp=contents[0];if(cp){contentInfo=cp.wcContentInfo;contentID=contentInfo.wcContentID;strData=contentInfo.wcData}}dropPosition=null}else{userAction="ADD";if(sourceContent){userAction="MOVE";contentID=contentInfo.wcContentID}}var newFrame=null;var oldFlexItem=null;var sourceContainer=null;if(sourceFrame)if(dragType=="frame"){sourceContainer=sourceFrame.wcContainer;
oldFlexItem=sourceFrame.wcFlexItem;newFrame=sourceFrame}else{if(dragType=="content"&&!stayInFrame&&sourceFrame.wcFrameType=="list"&&sourceFrame.wcContentPanes.length<3){sourceFrame.doViewAsTabs();sourceType="tab"}newFrame=sourceFrame.moveContent(contentID,null,dragType,dropPosition);actionInfo.wcContentValue=contentInfo.wcContentID}else{if(!contentID)contentInfo.wcNotServerID=true;newFrame=this.createFrame(sourceType,contentID,false,!strData?"#494949":"#FFFFFF");contentID=newFrame.wcActiveID;contentInfo.wcContentID=
contentID;actionInfo.wcContentValue=contentID;var newCP=newFrame.addContent(contentInfo,dropPosition);if(newCP)if(newCP.wcIsEmpty)newCP.doEmptyContent()}this.wcInFrameSplitting=true;if(this.splitFrame(targetFrame,targetName,newFrame)){if(newFrame)this.wcDragDropInfo.wcContainerTarget=newFrame.wcContainer;if(sourceContainer)sourceContainer.removeItem(oldFlexItem);if(sourceType=="filters")newFrame.wcContainer.adjustSizes("INITIAL_FILTERS",true);this.adjustLayout("REFRESH",null)}else{userAction="";actionInfo.wcDropValue=
"";actionInfo.wcContentValue="";newFrame.removeThisFrame();targetFrame=null}this.wcInFrameSplitting=false;if(sourceType=="list")newFrame.doViewAsList()}}else{userAction="REPLACE";var contentID=contentInfo.wcContentID;var targetInfo=targetFrame.getActiveContentInfo();var cp=null;if(!sourceFrame&&targetInfo&&!targetInfo.wcData){userAction="ADD";contentID=targetInfo.wcContentID;cp=this.getContentPaneByID(contentID);cp.wcContentInfo=contentInfo;cp.wcContentInfo.wcContentID=contentID;cp.wcLoadPending=
true}else if(sourceFrame)if(sourceFrame==targetFrame){if(sourceContent&&dropPosition!==false&&dropPosition!==undefined)sourceFrame.wcFrameLayout.doReorderItem(sourceContent,dropPosition)}else{userAction="MOVE";sourceFrame.moveContent(contentID,targetFrame,dragType,dropPosition)}else{contentID=targetFrame.wcActiveID;if(!targetFrame.isFrameEmpty()){userAction="ADD";contentID=this.getNextContentID();contentInfo.wcNotServerID=true}contentInfo.wcContentID=contentID;cp=targetFrame.addContent(contentInfo,
dropPosition)}actionInfo.wcContentValue=contentID;if(!this.wcNoDragAndDropMode&&strData=="")if(cp)cp.doClearContent()}}if(targetFrame)this.sendUpdateLayout(userAction)}this.wcDragDropInfo.wcDragContent=null;this.wcDragDropInfo.wcDropFrame=null;this.wcDragDropInfo.wcDropLocation=null;this.doDragEnd(e,targetFrame)}e.preventDefault()};
_p.doUpdateHighlight=function(e){this.wcDragDropInfo.wcDragHiddenMove=false;this.wcDragDropInfo.wcDropFrame=null;this.wcDragDropInfo.wcDropTarget="";this.wcDragDropInfo.wcDropPosition=false;$(this.wcHighlight._element).css("background-color","#2a2a2a");var dragType=this.wcDragDropInfo.wcDragType;var dropTarget="";var sourceContent=this.wcDragDropInfo.wcDragContent;var sourceFrame=this.wcDragDropInfo.wcDragFrame;var sourceCount=sourceFrame?sourceFrame.getContentCount():0;var targetFrame=this.getDockingFrame(e);
var sameFrame=sourceFrame&&targetFrame&&sourceFrame==targetFrame;if(this.wcMaximized)targetFrame=null;if(this.wcInMultiFrame&&this.wcInMultiFrame.wcMaximized)targetFrame=null;if(this.wcInMultiFrame&&!this.wcNotRestricted)targetFrame=null;if(targetFrame){var sourceType=sourceFrame?sourceFrame.wcFrameType:null;var targetType=targetFrame.wcFrameType;var targetWidth=$(targetFrame._element).width();var targetHeight=$(targetFrame._element).height();var fullWidth=$(this._element).width();var fullHeight=
$(this._element).height();var frameTop=$(targetFrame._element).offset().top-$(this.wcMFMainPanel._element).offset().top;var frameLeft=$(targetFrame._element).offset().left-$(this.wcMFMainPanel._element).offset().left;var frameRight=$(this.wcMFMainPanel._element).offset().left+$(this.wcMFMainPanel._element).width()-($(targetFrame._element).offset().left+targetWidth);var frameBottom=$(this.wcMFMainPanel._element).offset().top+$(this.wcMFMainPanel._element).height()-($(targetFrame._element).offset().top+
targetHeight);this.wcHighlight.setTop(frameTop);this.wcHighlight.setLeft(frameLeft);this.wcHighlight.setRight(frameRight);this.wcHighlight.setBottom(frameBottom);this.wcHighlight.setVisible(true);this.hideAllItemHighlighters();if(sameFrame)dropTarget=this.updateHighlightSameFrame(e,targetFrame);var allowSplit=!(sameFrame&&dragType=="frame");if(!sameFrame||sourceType!="single"&&sourceCount>1){var cp=targetFrame.getActiveContentPane();var targetEmpty=cp&&cp.wcContentInfo&&!cp.wcContentInfo.wcData?true:
false;var stayInFrame=false;if(sourceFrame){var sourceFlag=sourceFrame.wcFrameInfo.wcFrameFlag;stayInFrame=sourceFlag&wcMF.frame.wcStayInFrameFlag?true:false;targetEmpty=false}var outerX=e.pageX-$(this._element).offset().left;var outerY=e.pageY-$(this._element).offset().top;var x=e.pageX-$(targetFrame._element).offset().left;var y=e.pageY-$(targetFrame._element).offset().top;if(!sourceFrame&&targetEmpty)allowSplit=false;if(sourceFrame&&sourceFrame.hasOneEmptyContent())allowSplit=false;if(dragType==
"content"&&targetType=="tab"&&y<this.wcTabHeight&&sourceType!="single")dropTarget="CONTENT";else if(allowSplit&&outerX<this.wcOuterSize){dropTarget="OUTER_LEFT";this.wcHighlight.setTop(0);this.wcHighlight.setLeft(0);this.wcHighlight.setRight(parseInt(fullWidth-this.wcOuterSize));this.wcHighlight.setBottom(0)}else if(allowSplit&&outerX>fullWidth-this.wcOuterSize){dropTarget="OUTER_RIGHT";this.wcHighlight.setTop(0);this.wcHighlight.setLeft(parseInt(fullWidth-this.wcOuterSize));this.wcHighlight.setRight(0);
this.wcHighlight.setBottom(0)}else if(allowSplit&&outerY<this.wcOuterSize){dropTarget="OUTER_TOP";this.wcHighlight.setTop(0);this.wcHighlight.setLeft(0);this.wcHighlight.setRight(0);this.wcHighlight.setBottom(parseInt(fullHeight-this.wcOuterSize))}else if(allowSplit&&outerY>fullHeight-this.wcOuterSize){dropTarget="OUTER_BOTTOM";this.wcHighlight.setTop(parseInt(fullHeight-this.wcOuterSize));this.wcHighlight.setLeft(0);this.wcHighlight.setRight(0);this.wcHighlight.setBottom(0)}else if(allowSplit&&x<
parseInt(targetWidth/3)){dropTarget="LEFT";this.wcHighlight.setRight(frameRight+parseInt(targetWidth/2))}else if(allowSplit&&x>targetWidth-parseInt(targetWidth/3)){dropTarget="RIGHT";this.wcHighlight.setLeft(frameLeft+parseInt(targetWidth/2))}else if(allowSplit&&y<parseInt(targetHeight/3)){dropTarget="TOP";this.wcHighlight.setBottom(frameBottom+parseInt(targetHeight/2))}else if(allowSplit&&y>targetHeight-parseInt(targetHeight/3)){dropTarget="BOTTOM";this.wcHighlight.setTop(frameTop+parseInt(targetHeight/
2))}else if(sourceType!="single"&&targetType!="single"&&!stayInFrame)if(sourceFrame){if(dragType=="content")dropTarget="CONTENT"}else dropTarget="CONTENT";if(sourceFrame&&sourceFrame.wcContainer){var actualCount=sourceFrame.wcContainer.getFramesCount(false);var visibleCount=sourceFrame.wcContainer.getFramesCount(true);if(visibleCount<=1&&actualCount!=visibleCount)if(dragType=="frame"||sourceCount<=1){this.wcDragDropInfo.wcDragContainer=sourceFrame.wcContainer;var containerObjs=sourceFrame.wcContainer.getChildren();
var frameIndex=containerObjs.indexOf(sourceFrame);this.wcDragDropInfo.wcDragHiddenMove=true}}}}else this.wcHighlight.setVisible(false);if(dropTarget){this.wcDragDropInfo.wcDropTarget=dropTarget;if(dropTarget!="LIST"){this.hideAllItemHighlighters();$(this.wcHighlight._element).css("background-color","#add8e6");if(dropTarget.indexOf("OUTER")==0)$(this.wcHighlight._element).css("background-color","#6d38e6")}}return targetFrame};
_p.updateHighlightSameFrame=function(e,targetFrame){var dragType=this.wcDragDropInfo.wcDragType;var dropTarget="";if(targetFrame)if(dragType=="content"){var targetType=targetFrame.wcFrameType;var x=e.pageX-$(targetFrame._element).offset().left;var y=e.pageY-$(targetFrame._element).offset().top;if(targetType=="tab");else if(targetType=="single")dropTarget="";else if(targetType=="list"){dropTarget="LIST";var orientation=targetFrame.wcFrameView.wcOrientation;var itemPos=targetFrame.wcFrameView.showItemHighlighter(orientation==
"HORIZONTAL"?x:y);if(itemPos==-1)dropTarget="";this.wcDragDropInfo.wcDropPosition=itemPos}else if(targetType=="grid")dropTarget=""}return dropTarget};_p.unhighlightAllFrames=function(){var frames=this.wcFramesList;for(var i=0;i<frames.length;i++){var frame=frames[i];frame.doHighlight(false)}};_p.hideAllItemHighlighters=function(){var frames=this.wcFramesList;for(var i=0;i<frames.length;i++){var frame=frames[i];if(frame&&frame.wcFrameType=="list"){var view=frame?frame.wcFrameView:null;if(view)view.hideItemHighlighter()}}};
_p.splitFrame=function(oldFrame,targetName,newFrame){var params={};params.container=oldFrame.wcContainer;params.orientation=params.container.wcOrientation;if(params.container){if(oldFrame&&!oldFrame._disposed){params.oldTop=oldFrame.wcFlexItem.getTop();params.oldLeft=oldFrame.wcFlexItem.getLeft();params.oldWidth=oldFrame.wcFlexItem.getWidth();params.oldHeight=oldFrame.wcFlexItem.getHeight();params.halfHeight=parseInt(params.oldHeight/2)+4;params.halfWidth=parseInt(params.oldWidth/2)+4;params.nextObj=
params.container.getNextObject(oldFrame)}if(targetName=="TOP"){if(params.orientation=="ROOT")params.orientation=params.container.wcOrientation="VERTICAL";return this.splitFrameTop(params,newFrame,oldFrame)}else if(targetName=="LEFT"){if(params.orientation=="ROOT")params.orientation=params.container.wcOrientation="HORIZONTAL";return this.splitFrameLeft(params,newFrame,oldFrame)}else if(targetName=="RIGHT"){if(params.orientation=="ROOT")params.orientation=params.container.wcOrientation="HORIZONTAL";
return this.splitFrameRight(params,newFrame,oldFrame)}else if(targetName=="BOTTOM"){if(params.orientation=="ROOT")params.orientation=params.container.wcOrientation="VERTICAL";return this.splitFrameBottom(params,newFrame,oldFrame)}else if(targetName=="OUTER_TOP")return this.splitFrameOuterTop(newFrame);else if(targetName=="OUTER_LEFT")return this.splitFrameOuterLeft(newFrame);else if(targetName=="OUTER_RIGHT")return this.splitFrameOuterRight(newFrame);else if(targetName=="OUTER_BOTTOM")return this.splitFrameOuterBottom(newFrame)}return false};
_p.splitFrameTop=function(params,newFrame,oldFrame){if(params.orientation=="VERTICAL"){$(params.container._element).removeClass("wcx-mfflex-horizontal");$(params.container._element).addClass("wcx-mfflex-vertical");newFrame.wcContainer=params.container;params.container.addItem(newFrame,oldFrame,true,true);newFrame.wcFlexItem.setTop(params.oldTop);newFrame.wcFlexItem.setHeight(params.halfHeight);oldFrame.wcFlexItem.setTop(params.oldTop+params.halfHeight);oldFrame.wcFlexItem.setHeight(params.halfHeight);
oldFrame.wcFlexItem._element.css("width","100%")}else{var oldFlexItem=oldFrame.wcFlexItem;var oldContainer=oldFrame.wcContainer;var newContainer=new WcMultiframesContainer(params.container.wcMultiFrames,"VERTICAL",params.container,oldFrame);newFrame.wcContainer=newContainer;oldFrame.wcContainer=newContainer;params.container.addItem(newContainer,params.nextObj,true,true);newContainer.wcFlexItem.setTop(params.oldTop);newContainer.wcFlexItem.setLeft(params.oldLeft);newContainer.wcFlexItem.setWidth(params.oldWidth);
newContainer.addItem(newFrame,null,true,true);newContainer.addItem(oldFrame,null,true,true);$(oldFlexItem._element).remove();oldContainer.removeItem(oldFlexItem);oldFlexItem.dispose();newFrame.wcFlexItem.setTop(0);newFrame.wcFlexItem.setHeight(params.halfHeight);oldFrame.wcFlexItem.setTop(params.halfHeight);oldFrame.wcFlexItem.setHeight(params.halfHeight)}return true};
_p.splitFrameLeft=function(params,newFrame,oldFrame){if(params.orientation=="HORIZONTAL"){$(params.container._element).removeClass("wcx-mfflex-vertical");$(params.container._element).addClass("wcx-mfflex-horizontal");newFrame.wcContainer=params.container;params.container.addItem(newFrame,oldFrame,true,true);newFrame.wcFlexItem.setLeft(params.oldLeft);newFrame.wcFlexItem.setWidth(params.halfWidth);oldFrame.wcFlexItem.setLeft(params.oldLeft+params.halfWidth);oldFrame.wcFlexItem.setWidth(params.halfWidth);
oldFrame.wcFlexItem._element.css("height","100%")}else{var oldFlexItem=oldFrame.wcFlexItem;var oldContainer=oldFrame.wcContainer;var newContainer=new WcMultiframesContainer(params.container.wcMultiFrames,"HORIZONTAL",params.container,oldFrame);newFrame.wcContainer=newContainer;oldFrame.wcContainer=newContainer;params.container.addItem(newContainer,params.nextObj,true,true);newContainer.wcFlexItem.setTop(params.oldTop);newContainer.wcFlexItem.setLeft(params.oldLeft);newContainer.wcFlexItem.setHeight(params.oldHeight);
newContainer.addItem(newFrame,null,true,true);newContainer.addItem(oldFrame,null,true,true);$(oldFlexItem._element).remove();oldContainer.removeItem(oldFlexItem);oldFlexItem.dispose();newFrame.wcFlexItem.setLeft(0);newFrame.wcFlexItem.setWidth(params.halfWidth);oldFrame.wcFlexItem.setLeft(params.halfWidth);oldFrame.wcFlexItem.setWidth(params.halfWidth)}return true};
_p.splitFrameRight=function(params,newFrame,oldFrame){if(params.orientation=="HORIZONTAL"){$(params.container._element).removeClass("wcx-mfflex-vertical");$(params.container._element).addClass("wcx-mfflex-horizontal");newFrame.wcContainer=params.container;params.container.addItem(newFrame,params.nextObj,true,true);newFrame.wcFlexItem.setLeft(params.oldLeft+params.halfWidth);newFrame.wcFlexItem.setWidth(params.halfWidth);oldFrame.wcFlexItem.setLeft(params.oldLeft);oldFrame.wcFlexItem.setWidth(params.halfWidth);
oldFrame.wcFlexItem._element.css("height","100%")}else{var oldFlexItem=oldFrame.wcFlexItem;var oldContainer=oldFrame.wcContainer;var newContainer=new WcMultiframesContainer(params.container.wcMultiFrames,"HORIZONTAL",params.container,oldFrame);newFrame.wcContainer=newContainer;oldFrame.wcContainer=newContainer;params.container.addItem(newContainer,params.nextObj,true,true);newContainer.wcFlexItem.setTop(params.oldTop);newContainer.wcFlexItem.setLeft(params.oldLeft);newContainer.wcFlexItem.setHeight(params.oldHeight);
newContainer.addItem(oldFrame,null,true,true);newContainer.addItem(newFrame,null,true,true);$(oldFlexItem._element).remove();oldContainer.removeItem(oldFlexItem);oldFlexItem.dispose();newFrame.wcFlexItem.setLeft(0);newFrame.wcFlexItem.setWidth(params.halfWidth);oldFrame.wcFlexItem.setLeft(params.halfWidth);oldFrame.wcFlexItem.setWidth(params.halfWidth)}return true};
_p.splitFrameBottom=function(params,newFrame,oldFrame){if(params.orientation=="VERTICAL"){$(params.container._element).removeClass("wcx-mfflex-horizontal");$(params.container._element).addClass("wcx-mfflex-vertical");newFrame.wcContainer=params.container;params.container.addItem(newFrame,params.nextObj,true,true);newFrame.wcFlexItem.setTop(params.oldTop+params.halfHeight);newFrame.wcFlexItem.setHeight(params.halfHeight);oldFrame.wcFlexItem.setTop(params.oldTop);oldFrame.wcFlexItem.setHeight(params.halfHeight);
oldFrame.wcFlexItem._element.css("width","100%")}else{var oldFlexItem=oldFrame.wcFlexItem;var oldContainer=oldFrame.wcContainer;var newContainer=new WcMultiframesContainer(params.container.wcMultiFrames,"VERTICAL",params.container,oldFrame);newFrame.wcContainer=newContainer;oldFrame.wcContainer=newContainer;params.container.addItem(newContainer,params.nextObj,true,true);newContainer.wcFlexItem.setTop(params.oldTop);newContainer.wcFlexItem.setLeft(params.oldLeft);newContainer.wcFlexItem.setWidth(params.oldWidth);
newContainer.addItem(oldFrame,null,true,true);newContainer.addItem(newFrame,null,true,true);$(oldFlexItem._element).remove();oldContainer.removeItem(oldFlexItem);oldFlexItem.dispose();newFrame.wcFlexItem.setTop(params.halfHeight);newFrame.wcFlexItem.setHeight(params.halfHeight);oldFrame.wcFlexItem.setTop(0);oldFrame.wcFlexItem.setHeight(params.halfHeight)}return true};
_p.splitFrameOuterTop=function(newFrame){var container=this.wcRootContainer;var fullHeight=$(container._element).height();if(fullHeight>0){var outerHeight=parseInt(fullHeight/4);if(container.wcOrientation=="ROOT")container.wcOrientation="VERTICAL";if(container.wcOrientation=="VERTICAL"){var nextFrame=null;var children=container.getChildren();for(var i=0;i<children.length;i++){var item=children[i];var obj=item.getChildren()[0];var oldTop=item.getTop();if(container.isObjectAFrame(obj)){if(!nextFrame)nextFrame=
obj;var newTop=outerHeight+parseInt(oldTop*(fullHeight-outerHeight)/fullHeight);item.setTop(newTop);item._element.css("width","100%");obj._element.css("width","100%")}}newFrame.wcContainer=container;container.addItem(newFrame,nextFrame,true,true);newFrame.wcFlexItem.setTop(0)}else{var oldRoot=this.wcRootContainer;this.wcRootContainer=this.wcMFMainPanel.insertNewRoot();oldRoot.wcFlexItem.setHeight(fullHeight-outerHeight);var newRoot=this.wcRootContainer;newRoot.addItem(newFrame,oldRoot,true,true);
newFrame.wcContainer=newRoot}newFrame.wcFlexItem.setHeight(outerHeight)}return true};
_p.splitFrameOuterLeft=function(newFrame){var container=this.wcRootContainer;var fullWidth=$(container._element).width();if(fullWidth>0){var outerWidth=parseInt(fullWidth/4);if(container.wcOrientation=="ROOT")container.wcOrientation="HORIZONTAL";if(container.wcOrientation=="HORIZONTAL"){var nextFrame=null;var children=container.getChildren();for(var i=0;i<children.length;i++){var item=children[i];var obj=item.getChildren()[0];var oldLeft=item.getLeft();if(container.isObjectAFrame(obj)){if(!nextFrame)nextFrame=
obj;var newLeft=outerWidth+parseInt(oldLeft*(fullWidth-outerWidth)/fullWidth);item.setLeft(newLeft);item._element.css("height","100%");obj._element.css("height","100%")}}newFrame.wcContainer=container;container.addItem(newFrame,nextFrame,true,true);newFrame.wcFlexItem.setLeft(0)}else{var oldRoot=this.wcRootContainer;this.wcRootContainer=this.wcMFMainPanel.insertNewRoot();oldRoot.wcFlexItem.setWidth(fullWidth-outerWidth);var newRoot=this.wcRootContainer;newRoot.addItem(newFrame,oldRoot,true,true);
newFrame.wcContainer=newRoot}newFrame.wcFlexItem.setWidth(outerWidth)}return true};
_p.splitFrameOuterRight=function(newFrame){var container=this.wcRootContainer;var fullWidth=$(container._element).width();if(fullWidth>0){var outerWidth=parseInt(fullWidth/4);if(container.wcOrientation=="ROOT")container.wcOrientation="HORIZONTAL";if(container.wcOrientation=="HORIZONTAL"){var previousFrame=null;var children=container.getChildren();for(var i=0;i<children.length;i++){var item=children[i];var obj=item.getChildren()[0];var oldLeft=item.getLeft();if(container.isObjectAFrame(obj)){previousFrame=
obj;var newLeft=parseInt(oldLeft*(fullWidth-outerWidth)/fullWidth);item.setLeft(newLeft);item._element.css("height","100%");obj._element.css("height","100%")}}newFrame.wcContainer=container;container.addItem(newFrame,null,true,true);newFrame.wcFlexItem.setLeft(0)}else{var oldRoot=this.wcRootContainer;this.wcRootContainer=this.wcMFMainPanel.insertNewRoot();oldRoot.wcFlexItem.setWidth(fullWidth-outerWidth);var newRoot=this.wcRootContainer;newRoot.addItem(newFrame,null,true,true);newFrame.wcContainer=
newRoot}newFrame.wcFlexItem.setWidth(outerWidth)}return true};
_p.splitFrameOuterBottom=function(newFrame){var container=this.wcRootContainer;var fullHeight=$(container._element).height();if(fullHeight>0){var outerHeight=parseInt(fullHeight/4);if(container.wcOrientation=="ROOT")container.wcOrientation="VERTICAL";if(container.wcOrientation=="VERTICAL"){var previousFrame=null;var children=container.getChildren();for(var i=0;i<children.length;i++){var item=children[i];var obj=item.getChildren()[0];var oldTop=item.getTop();if(container.isObjectAFrame(obj)){previousFrame=
obj;var newTop=parseInt(oldTop*(fullHeight-outerHeight)/fullHeight);item.setTop(newTop);item._element.css("width","100%");obj._element.css("width","100%")}}newFrame.wcContainer=container;container.addItem(newFrame,null,true,true);newFrame.wcFlexItem.setTop(0)}else{var oldRoot=this.wcRootContainer;this.wcRootContainer=this.wcMFMainPanel.insertNewRoot();oldRoot.wcFlexItem.setHeight(fullHeight-outerHeight);var newRoot=this.wcRootContainer;newRoot.addItem(newFrame,null,true,true);newFrame.wcContainer=
newRoot}newFrame.wcFlexItem.setHeight(outerHeight)}return true};_p.doMFOption_HoverTab=function(){var mf=this.wcMultiFrames;wcMF.wcHeaderLocation=this.wcValue;localStorage.setItem("mf,headerLocation",wcMF.wcHeaderLocation);mf.adjustLayout(null,null)};_p.doMFOption_FramesToolbar=function(){var mf=this.wcMultiFrames;wcMF.wcShowFramesToolbar=this.wcValue;localStorage.setItem("mf,showFramesToolbar",wcMF.wcShowFramesToolbar);mf.updateFramesToolbar()};
_p.doMFOption_MaxContent=function(){var mf=this.wcMultiFrames;wcMF.wcMaxContentPerFrame=parseInt(this.wcValue);localStorage.setItem("mf,maxContentPerFrame",wcMF.wcMaxContentPerFrame);if(wcMF.wcMaxContentPerFrame>0)for(var i=0;i<mf.wcFramesList.length;i++){var frameObj=mf.wcFramesList[i];if(frameObj.wcFrameInfo.wcRecentMode==0)frameObj.keepMaxContent(wcMF.wcMaxContentPerFrame)}};
_p.doMFstatus=function(){if(this.wcMFstatus!="ready"){var inIframe=window.self!==window.top;var width=$(this._element).width();var height=$(this._element).height();this.wcMFstatus=inIframe&&(width<=0||height<=0)?"pending":"ready";if(this.wcMFstatus=="ready"&&this.wcLoadPending&&this.wcLoadPending.length>0)for(var i=0;i<this.wcLoadPending.length;i++){var cp=this.wcLoadPending[i];if(cp){var loadOptions={};loadOptions.wcDoNotForceShow=true;loadOptions.wcDoRefresh=false;cp.doLoad(null,null,loadOptions)}}}return this.wcMFstatus};
function WcMultiframesFlexContainer(orientation,objtype){if(_wcconstructing)return;if(!objtype)objtype="WcMultiframesFlexContainer";WcxComponent.call(this,objtype);this._element.addClass("wcx-mfflex-container");this._element.addClass("wcx-mfflex-"+orientation.toLowerCase());this.wcOrientation=orientation}_p=wcInherit(WcMultiframesFlexContainer,WcxComponent);
_p.addItem=function(obj,beforeObj,isFlexItem,isResizable){var flexItem=new WcMultiframesFlexItem(isFlexItem,isResizable);var orientation=this.wcOrientation;if(isFlexItem&&isResizable){flexItem._element.css("position","absolute");if(orientation=="VERTICAL")flexItem._element.css("width","100%");else flexItem._element.css("height","100%")}this._element.removeClass("wcx-mfflex-vertical");this._element.removeClass("wcx-mfflex-horizontal");this._element.addClass("wcx-mfflex-"+orientation.toLowerCase());
flexItem.wcFlexContainer=this;$(flexItem._element).data("wcFlexObject",obj);$(flexItem._element).data("wcFlexContainer",this);obj.wcFlexItem=flexItem;flexItem.add(obj);if(beforeObj){var beforeItem=beforeObj?beforeObj.wcFlexItem:null;if(beforeItem){var index=this._children.indexOf(beforeItem);this._children.splice(index,0,flexItem);flexItem._element.insertBefore($(beforeItem._element)[0])}}else this.add(flexItem);if(isResizable)flexItem.initResizable(this);return flexItem};
_p.removeItem=function(item){var items=this.getChildren();for(var i=0;i<items.length;i++){var flexItem=items[i];if(flexItem==item){$(flexItem._element).remove();var index=this._children.indexOf(flexItem);if(index>=0)this._children.splice(index,1);flexItem.dispose();break}}};
_p.removeObject=function(obj){obj.wcIsHidden=true;var items=this.getChildren();for(var i=0;i<items.length;i++){var flexItem=items[i];var itemObj=flexItem.getChildren()[0];if(itemObj==obj){obj.dispose();$(flexItem._element).remove();this.remove(flexItem);flexItem.dispose();break}}};_p.getItem=function(obj){for(var i=0;i<this._children.length;i++){var item=this._children[i];var itemObj=item.getChildren()[0];if(itemObj==obj)return item}return null};
function WcMultiframesFlexItem(isFlexItem,isResizable){if(_wcconstructing)return;WcxComponent.call(this,"WcMultiframesFlexItem");this._element.addClass("wcx-mfflex-item");if(isFlexItem)this._element.addClass("wcx-mfflex-flexitem");this.wcIsResizable=isResizable;$(this._element).on("mouseenter",this.doMouseEnter.bind(this))}_p=wcInherit(WcMultiframesFlexItem,WcxComponent);_p._dispose=_p.dispose;_p.dispose=function(){try{$(this._element).resizable("destroy")}catch(err){}this._dispose.call(this)};
_p.initResizable=function(container){var orientation=container.wcOrientation;if(orientation=="VERTICAL")$(this._element).resizable({handles:"s",start:this.doFlexItemStart,resize:this.doFlexItemResize,stop:this.doFlexItemStop,minHeight:50});else $(this._element).resizable({handles:"e",start:this.doFlexItemStart,resize:this.doFlexItemResize,stop:this.doFlexItemStop,minWidth:110});$(this._element).data("wcFlexContainer",container);var wcObject=$(this._element).data("wcFlexObject");var resizable=$(this._element).children(".ui-resizable-handle");
$(resizable).css("background-color","transparent");$(resizable).css("border-right","1px solid #ddd");$(resizable).css("border-bottom","1px solid #ddd");$(resizable).data("wcFlexObject",wcObject);if(orientation=="VERTICAL"){$(resizable).addClass("top-splitter");$(resizable).css("bottom","0px")}else{$(resizable).addClass("left-splitter");$(resizable).css("right","0px")}$(resizable).css("display","");$(resizable).on("mouseenter",this.doResizableMouseEnter);$(resizable).on("mouseleave",this.doResizableMouseLeave);
$(resizable).on("mousedown",this.doResizableMouseDown);$(resizable).on("mouseup",this.doResizableMouseUp)};_p.updateResizable=function(container){var wcObject=$(this._element).data("wcFlexObject");if(wcObject){var mf=wcObject.wcMultiFrames;if(!mf.wcOverlay.wcIsResizing){$(this._element).resizable("destroy");this.initResizable(container)}}};
_p.doFlexItemStart=function(evt,ui){var wcObject=$(this).data("wcFlexObject");var mf=wcObject.wcMultiFrames;mf.wcOverlay.wcIsResizing=true;var wcContainer=$(this).data("wcFlexContainer");var thisItem=$(this)[0];this.resizeInfo={};this.resizeInfo.wcNextItem=null;var items=wcContainer.getChildren();var matchFound=false;for(var i=0;i<items.length;i++){var itm=items[i];var itemEl=itm._element[0];if(matchFound){if($(itemEl).is(":visible")){this.resizeInfo.wcNextItem=itemEl;break}}else if(itemEl==thisItem){matchFound=
true;this.resizeInfo.wcThisItem=itm}}if(this.resizeInfo.wcNextItem){var nextItem=this.resizeInfo.wcNextItem;this.resizeInfo.wcStartSize=wcContainer.wcOrientation=="VERTICAL"?$(this).height():$(this).width();this.resizeInfo.wcNextStartSize=wcContainer.wcOrientation=="VERTICAL"?$(nextItem).height():$(nextItem).width();var totalSize=this.resizeInfo.wcStartSize+this.resizeInfo.wcNextStartSize;if(wcContainer.wcOrientation=="VERTICAL"){var maxSize=totalSize-50;$(this).resizable({maxHeight:maxSize})}else{var maxSize=
totalSize-110;$(this).resizable({maxWidth:maxSize})}this.resizeTimer=null}};
_p.doFlexItemResize=function(evt,ui){var wcContainer=$(this).data("wcFlexContainer");var mf=wcContainer.wcMultiFrames;if(mf.wcOverlay.wcIsResizing){if(this.resizeInfo.wcNextItem){if(this.resizeTimer)clearTimeout(this.resizeTimer);var isHorizontal=wcContainer.wcOrientation=="HORIZONTAL";var totalSize=this.resizeInfo.wcStartSize+this.resizeInfo.wcNextStartSize;var currentSize=isHorizontal?$(this).width():$(this).height();var nextSize=totalSize-currentSize;var thisItem=this.resizeInfo.wcThisItem;var nextItem=
this.resizeInfo.wcNextItem;if(isHorizontal){var top=$(thisItem._element).offset().top-$(mf.wcMFMainPanel._element).offset().top;var left=$(thisItem._element).offset().left+$(thisItem._element).width()-$(mf.wcMFMainPanel._element).offset().left;var containerSize=wcContainer.getWidth();var percentage=parseInt(currentSize/containerSize*100);mf.wcMeasure1.setText(percentage+"%");mf.wcMeasure1.setTop(top+10);mf.wcMeasure1.setLeft(left-39);mf.wcMeasure1.setVisible(true);if(wcContainer.getFramesCount(true)==
2)percentage=100-percentage;else percentage=parseInt(nextSize/containerSize*100);mf.wcMeasure2.setText(percentage+"%");mf.wcMeasure2.setTop(top+10);mf.wcMeasure2.setLeft(left+11);mf.wcMeasure2.setVisible(true)}else{var top=$(thisItem._element).offset().top+$(thisItem._element).height()-$(mf.wcMFMainPanel._element).offset().top;var left=$(thisItem._element).offset().left-$(mf.wcMFMainPanel._element).offset().left;var containerSize=wcContainer.getHeight();var percentage=parseInt(currentSize/containerSize*
100);mf.wcMeasure1.setText(percentage+"%");mf.wcMeasure1.setTop(top-25);mf.wcMeasure1.setLeft(left+5);mf.wcMeasure1.setVisible(true);if(wcContainer.getFramesCount(true)==2)percentage=100-percentage;else percentage=parseInt(nextSize/containerSize*100);mf.wcMeasure2.setText(percentage+"%");mf.wcMeasure2.setTop(top+11);mf.wcMeasure2.setLeft(left+5);mf.wcMeasure2.setVisible(true)}var resizable=$(this).find(".ui-resizable-handle:visible");$(resizable).last().css("background-color","rgba(1,161,247,.5)");
var that=this;this.resizeTimer=setTimeout(function(){if(wcContainer.wcOrientation=="VERTICAL")$(nextItem).height(nextSize);else $(nextItem).width(nextSize);var wcObject=$(that).data("wcFlexObject");var isContainer=wcContainer.isObjectAContainer(wcObject);if(isContainer)wcObject.wcParentContainer.adjustSizes("REFRESH");else wcObject.wcContainer.adjustSizes("REFRESH")},0)}}else{mf.wcOverlay.wcIsResizing=false;mf.wcOverlay.setVisible(false)}};
_p.doFlexItemStop=function(evt,ui){var wcObject=$(this).data("wcFlexObject");var mf=wcObject.wcMultiFrames;this.resizeInfo={};mf.wcMeasure1.setVisible(false);mf.wcMeasure2.setVisible(false);mf.adjustLayout(null,null);mf.wcOverlay.wcIsResizing=false;mf.doCheckContentResize();var resizable=$(this).find(".ui-resizable-handle:visible");$(resizable).last().css("background-color","transparent");mf.sendUpdateLayout("RESIZE")};
_p.doMouseEnter=function(evt){if(this.wcIsResizable){var disabled=$(this._element).hasClass("ui-resizable-disabled");$(this._element).children(".ui-resizable-e").css("cursor",disabled?"default":"");$(this._element).children(".ui-resizable-s").css("cursor",disabled?"default":"")}};
_p.doResizableMouseEnter=function(evt){var wcObject=$(this).data("wcFlexObject");var disabled=wcObject&&wcObject.wcFlexItem?$(wcObject.wcFlexItem._element).hasClass("ui-resizable-disabled"):true;if(!disabled){var mf=wcObject.wcMultiFrames;if(mf.wcOverlay.wcDragStarted)return;if(evt.buttons==0){$(this).css("background-color","rgba(1,161,247,.5)");$(this).css("z-index","999")}}};_p.doResizableMouseLeave=function(evt){$(this).css("background-color","transparent");$(this).css("z-index","90")};
_p.doResizableMouseDown=function(evt){var wcObject=$(this).data("wcFlexObject");var mf=wcObject.wcMultiFrames;mf.doHideAllContentHeaders();mf.wcOverlay.setVisible(true);$(mf.wcOverlay._element).css("opacity",".01");$(mf.wcOverlay._element).css("background-color","white")};_p.doResizableMouseUp=function(evt){var wcObject=$(this).data("wcFlexObject");var mf=wcObject.wcMultiFrames;mf.wcOverlay.wcIsResizing=false;mf.wcOverlay.setVisible(false)};
function WcMultiframesTemplateDialog(mf){if(_wcconstructing)return;WcBaseDialog.call(this,mf);this.wcMultiFrames=mf;this.onClose(this.doCloseAction);var caption="";if(mf.wcCaption)caption+=mf.wcCaption+" - ";caption+=ibx.resourceMgr.getString("select_template");this.setOption("captionOptions",{"text":caption});this.wcCenterDiv=new WcxComponent("WcTemplateSelector");$(this.wcCenterDiv._element).css({"text-align":"center","margin":"0 auto"});this.add($(this.wcCenterDiv._element));this.wcTemplates=new WcxHBox;
this.wcTemplate0=new WcxVBox;var tBox0=this.wcTemplate0;$(tBox0._element).width(92);$(tBox0._element).height(92);tBox0.addEventListener("mouseover",this.mouseover,tBox0);tBox0.addEventListener("mouseout",this.mouseout,tBox0);tBox0.addEventListener("click",function(e){this.click(e,0)},this);tBox0.addEventListener("dblclick",function(e){this.dblclick(e,0)},this);this.wcTemplates.add(tBox0);var tBox0L=this.buildBoxIcon(tBox0,"black",70,null);$(tBox0L._element).css("margin","10px");var tSpacing0=new WcxVBox;
$(tSpacing0._element).width(20);this.wcTemplates.add(tSpacing0);this.wcTemplate1=new WcxVBox;var tBox1=this.wcTemplate1;$(tBox1._element).width(92);$(tBox1._element).height(92);tBox1.addEventListener("mouseover",this.mouseover,tBox1);tBox1.addEventListener("mouseout",this.mouseout,tBox1);tBox1.addEventListener("click",function(e){this.click(e,1)},this);tBox1.addEventListener("dblclick",function(e){this.dblclick(e,1)},this);this.wcTemplates.add(tBox1);var tBox1L=new WcxVBox;$(tBox1L._element).css("margin",
"10px");$(tBox1L._element).width(72);$(tBox1L._element).height(72);tBox1.add(tBox1L);var tBox1R1=new WcxHBox;$(tBox1R1._element).width(72);$(tBox1R1._element).height(24);tBox1L.add(tBox1R1);this.buildBoxIcon(tBox1R1,"black",null,24);this.buildBoxIcon(tBox1R1,"black",null,24);this.buildBoxIcon(tBox1R1,"black",null,24);this.buildBoxIcon(tBox1L,"black",70,48);var tSpacing1=new WcxVBox;$(tSpacing1._element).width(20);this.wcTemplates.add(tSpacing1);this.wcTemplate2=new WcxVBox;var tBox2=this.wcTemplate2;
$(tBox2._element).width(92);$(tBox2._element).height(92);tBox2.addEventListener("mouseover",this.mouseover,tBox2);tBox2.addEventListener("mouseout",this.mouseout,tBox2);tBox2.addEventListener("click",function(e){this.click(e,2)},this);tBox2.addEventListener("dblclick",function(e){this.dblclick(e,2)},this);this.wcTemplates.add(tBox2);var tBox2L=new WcxHBox;$(tBox2L._element).css("margin","10px");$(tBox2L._element).width(72);$(tBox2L._element).height(72);tBox2.add(tBox2L);var tBox2C1=new WcxVBox;$(tBox2C1._element).width(24);
$(tBox2C1._element).height(72);tBox2L.add(tBox2C1);this.buildBoxIcon(tBox2C1,"black",24,null);this.buildBoxIcon(tBox2C1,"black",24,null);this.buildBoxIcon(tBox2C1,"black",24,null);this.buildBoxIcon(tBox2L,"black",48,70);var tSpacing2=new WcxVBox;$(tSpacing2._element).width(20);this.wcTemplates.add(tSpacing2);this.wcTemplate3=new WcxVBox;var tBox3=this.wcTemplate3;$(tBox3._element).width(92);$(tBox3._element).height(92);tBox3.addEventListener("mouseover",this.mouseover,tBox3);tBox3.addEventListener("mouseout",
this.mouseout,tBox3);tBox3.addEventListener("click",function(e){this.click(e,3)},this);tBox3.addEventListener("dblclick",function(e){this.dblclick(e,3)},this);this.wcTemplates.add(tBox3);var tBox3L=new WcxVBox;$(tBox3L._element).css("margin","10px");$(tBox3L._element).width(72);$(tBox3L._element).height(72);tBox3.add(tBox3L);var tBox3R1=new WcxHBox;$(tBox3R1._element).width(72);$(tBox3R1._element).height(24);tBox3L.add(tBox3R1);this.buildBoxIcon(tBox3R1,"black",18,null);this.buildBoxIcon(tBox3R1,
"black",18,null);this.buildBoxIcon(tBox3R1,"black",18,null);this.buildBoxIcon(tBox3R1,"black",18,null);var tBox3R2=new WcxHBox;$(tBox3R2._element).width(72);$(tBox3R2._element).height(24);tBox3L.add(tBox3R2);this.buildBoxIcon(tBox3R2,"black",36,null);this.buildBoxIcon(tBox3R2,"black",36,null);this.buildBoxIcon(tBox3L,"black",70,24);var tSpacing3=new WcxVBox;$(tSpacing3._element).width(20);this.wcTemplates.add(tSpacing3);this.wcTemplate4=new WcxVBox;var tBox4=this.wcTemplate4;$(tBox4._element).width(92);
$(tBox4._element).height(92);tBox4.addEventListener("mouseover",this.mouseover,tBox4);tBox4.addEventListener("mouseout",this.mouseout,tBox4);tBox4.addEventListener("click",function(e){this.click(e,4)},this);tBox4.addEventListener("dblclick",function(e){this.dblclick(e,4)},this);this.wcTemplates.add(tBox4);var tBox4L=new WcxVBox;$(tBox4L._element).css("margin","10px");$(tBox4L._element).width(72);$(tBox4L._element).height(72);tBox4.add(tBox4L);var tBox4R1=new WcxHBox;$(tBox4R1._element).width(72);
$(tBox4R1._element).height(24);tBox4L.add(tBox4R1);this.buildBoxIcon(tBox4R1,"black",18,null);this.buildBoxIcon(tBox4R1,"black",18,null);this.buildBoxIcon(tBox4R1,"black",18,null);this.buildBoxIcon(tBox4R1,"black",18,null);var tBox4R2=new WcxHBox;$(tBox4R2._element).width(72);$(tBox4R2._element).height(24);tBox4L.add(tBox4R2);this.buildBoxIcon(tBox4R2,"black",18,null);this.buildBoxIcon(tBox4R2,"black",18,null);this.buildBoxIcon(tBox4R2,"black",18,null);this.buildBoxIcon(tBox4R2,"black",18,null);var tBox4R3=
new WcxHBox;$(tBox4R3._element).width(72);$(tBox4R3._element).height(24);tBox4L.add(tBox4R3);this.buildBoxIcon(tBox4R3,"black",18,null);this.buildBoxIcon(tBox4R3,"black",18,null);this.buildBoxIcon(tBox4R3,"black",18,null);this.buildBoxIcon(tBox4R3,"black",18,null);this.add($(this.wcTemplates._element))}_p=wcInherit(WcMultiframesTemplateDialog,WcBaseDialog);_p._show=_p.show;_p.show=function(){this._show.call(this);var mf=this.wcMultiFrames;this.click(null,0)};
_p.mouseover=function(){$(this._element).css("background-color","lightblue")};_p.mouseout=function(){$(this._element).css("background-color","")};
_p.click=function(e,iTemplate){this.wcSelectedTemplate=iTemplate;var selectBorder="2px solid black";$(this.wcTemplate0._element).css("border",iTemplate==0?selectBorder:"");$(this.wcTemplate1._element).css("border",iTemplate==1?selectBorder:"");$(this.wcTemplate2._element).css("border",iTemplate==2?selectBorder:"");$(this.wcTemplate3._element).css("border",iTemplate==3?selectBorder:"");$(this.wcTemplate4._element).css("border",iTemplate==4?selectBorder:"")};
_p.dblclick=function(e,iTemplate){this.click(e,iTemplate);if(e){var ok=$.Event(e);ok.type="keydown";ok.keyCode=13;$(this._element).trigger(ok)}};
_p.doCloseAction=function(evt,btn){var dlg=$(evt.target).data("wcobj");var iTemplate=0;if(btn=="ok")iTemplate=dlg.wcSelectedTemplate;var mf=dlg.wcMultiFrames;var layout="";var jsonObj={};var layoutCount=1;var frameCount=1;jsonObj.wcThemeIndex=0;jsonObj.wcModified=false;jsonObj.wcLayout={};jsonObj.wcFramesInfo=[];jsonObj.wcContentsInfo=[];switch(iTemplate){case 1:layoutCount=2;jsonObj.wcLayout=dlg.buildJsonContainer("V","L1",300,300,100);var c2=dlg.buildJsonContainer("H","L2",300,100,33);var f1=dlg.buildJsonFrame(jsonObj,
"LF1","1",100,100,33);c2.wcLayoutItems.push(f1);var f2=dlg.buildJsonFrame(jsonObj,"LF2","2",100,100,33);c2.wcLayoutItems.push(f2);var f3=dlg.buildJsonFrame(jsonObj,"LF3","3",100,100,33);c2.wcLayoutItems.push(f3);jsonObj.wcLayout.wcLayoutItems.push(c2);var f4=dlg.buildJsonFrame(jsonObj,"LF4","4",300,200,66);jsonObj.wcLayout.wcLayoutItems.push(f4);break;case 2:layoutCount=2;jsonObj.wcLayout=dlg.buildJsonContainer("H","L1",300,300,100);var c2=dlg.buildJsonContainer("V","L2",100,300,33);var f1=dlg.buildJsonFrame(jsonObj,
"LF1","1",100,100,33);c2.wcLayoutItems.push(f1);var f2=dlg.buildJsonFrame(jsonObj,"LF2","2",100,100,33);c2.wcLayoutItems.push(f2);var f3=dlg.buildJsonFrame(jsonObj,"LF3","3",100,100,33);c2.wcLayoutItems.push(f3);jsonObj.wcLayout.wcLayoutItems.push(c2);var f4=dlg.buildJsonFrame(jsonObj,"LF4","4",200,300,66);jsonObj.wcLayout.wcLayoutItems.push(f4);break;case 3:layoutCount=3;jsonObj.wcLayout=dlg.buildJsonContainer("V","L1",400,300,100);var c2=dlg.buildJsonContainer("H","L2",400,100,33);var f1=dlg.buildJsonFrame(jsonObj,
"LF1","1",100,100,25);c2.wcLayoutItems.push(f1);var f2=dlg.buildJsonFrame(jsonObj,"LF2","2",100,100,25);c2.wcLayoutItems.push(f2);var f3=dlg.buildJsonFrame(jsonObj,"LF3","3",100,100,25);c2.wcLayoutItems.push(f3);var f4=dlg.buildJsonFrame(jsonObj,"LF4","4",100,100,25);c2.wcLayoutItems.push(f4);jsonObj.wcLayout.wcLayoutItems.push(c2);var c3=dlg.buildJsonContainer("H","L3",400,100,33);var f5=dlg.buildJsonFrame(jsonObj,"LF5","5",200,100,50);c3.wcLayoutItems.push(f5);var f6=dlg.buildJsonFrame(jsonObj,
"LF6","6",200,100,50);c3.wcLayoutItems.push(f6);jsonObj.wcLayout.wcLayoutItems.push(c3);var f7=dlg.buildJsonFrame(jsonObj,"LF7","7",400,100,33);jsonObj.wcLayout.wcLayoutItems.push(f7);break;case 4:mf.doShowGridTemplateSelector(mf);return;default:layoutCount=1;jsonObj.wcLayout=dlg.buildJsonContainer("R","L1",100,100,100);var f1=dlg.buildJsonFrame(jsonObj,"LF1","1",100,100,100);jsonObj.wcLayout.wcLayoutItems.push(f1)}layout=JSON.stringify(jsonObj);mf.doMFLayout(layout);mf.wcLayoutIDCounter=layoutCount;
mf.wcActionInfo.wcDropValue="";mf.wcActionInfo.wcContentValue="";mf.sendUpdateLayout("INIT")};_p.buildJsonContainer=function(orientation,layoutID,wcWidth,wcHeight,wcSize){var jsonObj={};jsonObj.wcItemType="container";jsonObj.wcOrientation=orientation;jsonObj.wcLayoutID=layoutID;jsonObj.wcWidth=wcWidth;jsonObj.wcHeight=wcHeight;jsonObj.wcCurrentSize=wcSize;jsonObj.wcLayoutItems=[];return jsonObj};
_p.buildJsonFrame=function(rootObj,frameID,contentID,wcWidth,wcHeight,wcSize){var jsonFrame={};jsonFrame.wcItemType="frame";jsonFrame.wcFrameType="T";jsonFrame.wcFrameID=frameID;jsonFrame.wcActiveID=contentID;jsonFrame.wcWidth=wcWidth;jsonFrame.wcHeight=wcHeight;jsonFrame.wcCurrentSize=wcSize;jsonFrame.wcItems=[];var jsonContent={};jsonContent.wcItemType="content";jsonContent.wcContentID=contentID;jsonContent.wcWidth=wcWidth;jsonContent.wcHeight=wcHeight;jsonContent.wcCurrentSize=wcSize;jsonContent.wcData=
"";jsonFrame.wcItems.push(jsonContent);if(rootObj){var fi={};fi.wcFrameID=frameID;fi.wcNotServerID=true;fi.wcFrameClass=frameID;fi.wcFrameFlags=0;fi.wcIsTemplate=true;rootObj.wcFramesInfo.push(fi);var ci={};ci.wcContentID=contentID;ci.wcNotServerID=true;ci.ContentFlags=0;ci.ContentTitle="{ID:"+contentID+"}";rootObj.wcContentsInfo.push(ci)}return jsonFrame};
_p.buildBoxIcon=function(parentBox,borderColor,width,height){var childBox=new WcxComponent;if(borderColor){$(childBox._element).css("border","1px dashed "+borderColor);$(childBox._element).css("background-color","white")}if(width)$(childBox._element).width(width);else $(childBox._element).css("width","100%");if(height)$(childBox._element).height(height);else $(childBox._element).css("height","100%");parentBox.add(childBox);return childBox};
function WcMultiframesGridTemplateDialog(mf){if(_wcconstructing)return;WcBaseDialog.call(this);this.wcMultiFrames=mf;this.onClose(this.doCloseAction);this.setOption("captionOptions",{"text":ibx.resourceMgr.getString("mfo_grid_template")});this.selectCols=new WcxSelect;for(var i=1;i<=6;i++){var selectItem=new WcxSelectItem(i,i);this.selectCols.addItem(selectItem,i==4)}this.addOption(ibx.resourceMgr.getString("mfo_num_cols"),this.selectCols);this.selectRows=new WcxSelect;for(var i=1;i<=6;i++){var selectItem=
new WcxSelectItem(i,i);this.selectRows.addItem(selectItem,i==3)}this.addOption(ibx.resourceMgr.getString("mfo_num_rows"),this.selectRows);this.selectGroup=new WcxSelect;this.selectGroup0=new WcxSelectItem(ibx.resourceMgr.getString("mfo_cols_first"),0);this.selectGroup1=new WcxSelectItem(ibx.resourceMgr.getString("mfo_rows_first"),1);this.selectGroup.addItem(this.selectGroup0,true);this.selectGroup.addItem(this.selectGroup1,false);this.addOption(ibx.resourceMgr.getString("mfo_grp_frames"),this.selectGroup)}
_p=wcInherit(WcMultiframesGridTemplateDialog,WcBaseDialog);_p._show=_p.show;_p.show=function(){this._show.call(this);var mf=this.wcMultiFrames};
_p.doCloseAction=function(evt,btn){var dlg=$(evt.target).data("wcobj");var mf=dlg.wcMultiFrames;var cols=parseInt(dlg.selectCols.getUserValue());var rows=parseInt(dlg.selectRows.getUserValue());var grp=dlg.selectGroup.getUserValue();if(btn!="ok"){cols=1;rows=1}var layout="";if(cols*rows>1){var id=1;layout="["+(grp?"H":"V")+cols+","+rows+",,,:";for(var i=0;i<(grp?cols:rows);i++){layout+="["+(grp?"V":"H")+(grp?"1":cols)+","+(grp?rows:"1")+",,,:";for(var j=0;j<(grp?rows:cols);j++){layout+="[T1,1,,0,F"+
id+","+id+":";layout+="("+id+",1,1,,0)";layout+="]";id+=1}layout+="]"}layout+="]"}else if(btn=="ok")layout="[R1,1,,,:[H1,1,,,:[T1,1,,0,F1,1:(1,1,1,,0)]]]";mf.doMFLayout(layout);mf.wcActionInfo.wcDropValue="";mf.wcActionInfo.wcContentValue="";mf.sendUpdateLayout("INIT")};
function WcMultiframesLayoutInfoDialog(mf,showTree){if(_wcconstructing)return;WcBaseDialog.call(this);this.onClose(this.doCloseAction);this.wcMultiFrames=mf;$(this._element).data("current_mf",mf);this.setOption("captionOptions",{"text":"Layout Info"});var tabPane=this.createTabPane();var pageLayoutTree=this.addTabPage("Layout Tree",showTree);var pageLayoutDiagram=this.addTabPage("Layout Diagram",false);pageLayoutDiagram._element.css({"min-width":"300px","max-height":"400px","overflow-y":"auto"});
this.wcLayoutHeader=new WcxComponent;$(this.wcLayoutHeader._element).css("padding-bottom","10px");$(this.wcLayoutHeader._element).insertBefore(tabPane._element);this.wcLayoutTree=new WcxComponent;pageLayoutTree.add(this.wcLayoutTree);this.wcLayoutDiagram=new WcxComponent;pageLayoutDiagram.add(this.wcLayoutDiagram);this.wcLayoutDetail=new WcxComponent;this.wcLayoutDetail.setVisible(false);$(this.wcLayoutDetail._element).insertAfter(tabPane._element);var dialog=this;this._element.ready(function(){var width=
$(dialog._element).width();var height=$(dialog._element).height();dialog.setLeft(parseInt((window.innerWidth-width)/2));dialog.setTop(parseInt((window.innerHeight-height)/2));var glassPane=$(document.body).find(".ibx-popup-glass-pane");var titleBar=$(dialog._element).find(".ibx-title-bar-caption");titleBar.on("mousedown",function(){$(dialog._element).css("opacity",".2");glassPane.css("opacity",".05")});titleBar.on("mouseup",function(){$(dialog._element).css("opacity","");glassPane.css("opacity","")});
$(dialog._element).on("mousemove",function(evt){if(evt.which==0){$(dialog._element).css("opacity","");glassPane.css("opacity","")}})})}_p=wcInherit(WcMultiframesLayoutInfoDialog,WcBaseDialog);_p._show=_p.show;_p.show=function(cp){this._show.call(this);var mf=this.wcMultiFrames;this.wcHeaderEl=$(this.wcLayoutHeader._element);this.wcTreeEl=$(this.wcLayoutTree._element);this.wcDetailEl=$(this.wcLayoutDetail._element);this.wcDiagramEl=$(this.wcLayoutDiagram._element);this.doRefresh(mf,cp)};
_p.doCloseAction=function(evt,btn){var dlg=$(evt.target).data("wcobj");var mf=dlg.wcMultiFrames;var rp=mf.wcMFRefreshPanel;if(dlg&&btn=="ok"){mf.adjustLayout(null,null);mf.updateFramesToolbar()}mf=$(dlg._element).data("current_mf");mf.unhighlightAllFrames()};
_p.getLayoutTree=function(container,treeLevel){var indent="  ".repeat(treeLevel);var tree=indent+"- Container [Index="+this.wcNextIndex+", ";this.wcNextIndex+=1;tree+=container.wcOrientation;if(container.wcIsPersistent)tree+=", PERSISTENT";if(container.wcIsHidden)tree+=", HIDDEN";tree+="] \n";if(container){var children=container.getChildren();for(var i=0;i<children.length;i++){var item=children[i];var obj=item.getChildren()[0];if(obj._objtype=="WcMultiframesContainer")tree+=this.getLayoutTree(obj,
treeLevel+1);else if(obj._objtype=="WcMultiframesContentFrame"){tree+=indent+"  - Frame [";var frameType=$.trim(obj.wcFrameType);if(container.wcBlankFrame==obj)frameType="blank";else if(frameType=="")frameType="tab";tree+="Type="+frameType;if(obj.wcFrameInfo.wcFrameID)tree+=", ID="+obj.wcFrameInfo.wcFrameID;if(obj.wcIsHidden)tree+=", HIDDEN";tree+="]\n";var items=obj.wcContentPanes;if(items)for(var j=0;j<items.length;j++){var cp=items[j];if(cp){tree+=indent+"    - Content [";tree+="ID="+cp.wcContentInfo.wcContentID;
if(cp.wcContentView.wcIsHidden)tree+=", HIDDEN";if(cp.wcHasMultiFrame){tree+=", HAS-MULTIFRAME";if(cp.wcHasMultiFrame.wcNotRestricted)tree+="-NOT";tree+="-RESTRICTED"}tree+="]\n"}}}}}return tree};_p.createHeader=function(id,mf){var html="<span><b>ID="+id+"</b>";if(mf.wcInMultiFrame)html+=" [Parent: <span style='color:blue; cursor:pointer; text-decoration:underline'>"+mf.wcInMultiFrame.wcId+" </span>]";html+="</span>";var header=$(html);return header};
_p.createTree=function(rootContainer){var tree=$(this.getTreeHtml("5"));tree.data("objtype","container");tree.data("obj",rootContainer);this.buildTree(tree,rootContainer);return tree};
_p.buildTree=function(tree,container){if(container){var mf=container.wcMultiFrames;var text="Container";var subtext="[Index="+this.wcNextIndex+", ";var title="";this.wcNextIndex+=1;subtext+=container.wcOrientation;if(container.wcIsPersistent)subtext+=", PERSISTENT";if(container.wcIsHidden)subtext+=", HIDDEN";subtext+="]";var node=$(this.getNodeHtml(text,subtext,title));tree.append(node);var nodeChild=$("<div class='tree-child' />");node.append(nodeChild);var children=container.getChildren();for(var i=
0;i<children.length;i++){var item=children[i];var obj=item.getChildren()[0];if(obj._objtype=="WcMultiframesContainer"){var subtree=$(this.getTreeHtml("20"));subtree.data("objtype","container");subtree.data("obj",obj);nodeChild.append(subtree);this.buildTree(subtree,obj)}else if(obj._objtype=="WcMultiframesContentFrame"){var frameInfo=obj.wcFrameInfo;var frameFlags=frameInfo.wcFrameFlag;var frameTree=$(this.getTreeHtml("20"));text="Frame";subtext="[";title="";if(frameInfo.wcFrameID)subtext+="ID="+
frameInfo.wcFrameID;var frameType=$.trim(obj.wcFrameType);if(container.wcBlankFrame==obj)frameType="blank";else if(frameType=="")frameType="tab";subtext+=", Type="+frameType;if(obj.wcIsHidden){subtext+=", HIDDEN";if(obj.wcDelayLoad)subtext+=", LOAD-DELAYED"}if(!frameInfo.wcFrameLabel&&frameType=="single")subtext+=", <span style='color:red'>NO-LABEL</span>";if(frameInfo.wcIsTemplate)subtext+=", IS-TEMPLATE";var isFramePersistent=frameFlags&wcMF.frame.wcPersistentFrameFlag;subtext+="]";var frame=$(this.getNodeHtml(text,
subtext,title));frame.data("objtype","frame");frame.data("obj",obj);frameTree.append(frame);var frameChild=$("<div class='tree-child' />");frame.append(frameChild);var items=obj.wcContentPanes;if(items)for(var j=0;j<items.length;j++){var cp=items[j];if(cp){var contentInfo=cp.wcContentInfo;var flags=contentInfo.wcOptionsFlag;var contentTree=$(this.getTreeHtml("20"));text="Content";subtext="[";title="";subtext+="ID="+contentInfo.wcContentID;if(!mf.wcNoDragAndDropMode&&contentInfo.wcData)subtext+=", '"+
contentInfo.wcData+"'";if(!contentInfo.wcPageIcon&&!isFramePersistent)subtext+=", <span style='color:red'>NO-ICON</span>";if(!contentInfo.wcServerTitle&&frameType=="tab")subtext+=", <span style='color:red'>NO-TITLE</span>";if(cp.wcIsEmpty)subtext+=", ISEMPTY";if(cp.wcContentView.wcIsHidden)subtext+=", HIDDEN";if(cp.wcHasMultiFrame){subtext+=", <span style='color:blue; cursor:pointer; text-decoration:underline'>HAS-MF";if(cp.wcHasMultiFrame.wcNotRestricted)subtext+="-NOT";subtext+="-RESTRICTED</span>"}subtext+=
"]";var content=$(this.getNodeHtml(text,subtext,title));content.data("objtype","content");content.data("obj",cp);contentTree.append(content);if(cp.wcHasMultiFrame){contentTree.data("dlg",this);contentTree.data("mf",cp.wcHasMultiFrame);content.on("dblclick",this.showMF.bind(contentTree))}var contentChild=$("<div class='tree-child' />");content.append(contentChild);frameChild.append(contentTree)}}nodeChild.append(frameTree)}}}};
_p.getTreeHtml=function(marginLeft){return"<ul style='list-style:none; margin-top:3px; margin-left:"+marginLeft+"px; padding:0'>"};_p.getNodeHtml=function(text,subtext,title){return"<li style='list-style-type:none'><div class='tree-node'> - <b>"+text+"</b> <span style='font-family:monospace' title='"+title+"'>"+subtext+"</span></div></li>"};_p.createDiagram=function(rootContainer){var diagram=$("<div style='display:flex; min-height:200px'/>");this.buildDiagram(diagram,rootContainer);return diagram};
_p.buildDiagram=function(diagram,container){if(container){var orientation=container.wcOrientation[0];var containerD=$("<div style='display:flex; flex-direction:"+(orientation=="H"?"row":"column")+"; border:1px solid black; padding:4px; flex:1'/>");diagram.append(containerD);var children=container.getChildren();for(var i=0;i<children.length;i++){var child=children[i];var obj=child.getChildren()[0];if(obj._objtype=="WcMultiframesContentFrame"){var html="<div class='diagram-node' style='border:1px solid black; padding:10px; flex:1";
if(obj.wcIsHidden)html+="; background-color:#ccc";html+="'";html+=" title='"+obj.wcFrameInfo.wcFrameID+"'";html+="/>";var childD=$(html);containerD.append(childD);childD.data("objtype","frame");childD.data("frame",obj)}if(obj._objtype=="WcMultiframesContainer")this.buildDiagram(containerD,obj)}}};
_p.createDetail=function(obj){if(!obj)return"";var html="<table style='width:100%'><tr><th style='width:50%; text-align:left'><u>Name</u></th><th style='width:50%; text-align:left'><u>Value</u></th></tr>";if(obj instanceof WcMultiframes){var mfFlag=obj.wcFlags;html+=this.addDetail("Flags",""+mfFlag);html+=this.addDetail("Flag-NoDragAndDrop (1)",mfFlag&wcMF.wcNoDragAndDropFlag?"<b>true</b>":"false","font-size:smaller");html+=this.addDetail("Flag-EnableAutoRefresh (2)",mfFlag&wcMF.wcEnableAutoRefreshFlag?
"<b>true</b>":"false","font-size:smaller");html+=this.addDetail("Flag-NotRestricted (4)",mfFlag&wcMF.wcNotRestrictedFlag?"<b>true</b>":"false","font-size:smaller");html+=this.addDetail("Flag-NoMove (8)",mfFlag&wcMF.wcNoMoveFlag?"<b>true</b>":"false","font-size:smaller");html+=this.addDetail("Flag-ReadOnly (16)",mfFlag&wcMF.wcReadOnlyFlag?"<b>true</b>":"false","font-size:smaller")}else if(obj instanceof WcMultiframesContainer){var containerFlag=parseInt(obj.wcContainerFlags);var sizeInfo=obj.wcSizeInfo;
html+=this.addDetail("Flags",""+containerFlag);html+=this.addDetail("Flag-Persistent (16)",containerFlag&wcMF.container.wcPersistentFlag?"true":"false","font-size:smaller");html+=this.addDetail("InitialSize",sizeInfo.wcInitialSize?sizeInfo.wcInitialSize:"--")}else if(obj instanceof WcMultiframesContentFrame){var frameInfo=obj.wcFrameInfo;var frameFlag=frameInfo.wcFrameFlag;var sizeInfo=obj.wcSizeInfo;html+=this.addDetail("Frame ID",frameInfo.wcFrameID);html+=this.addDetail("Flags",frameFlag);html+=
this.addDetail("Flag-NoSwitchView (1)",frameFlag&wcMF.frame.wcNoSwitchViewFlag?"<b>true</b>":"false","font-size:smaller");html+=this.addDetail("Flag-PersistentFrame (2)",frameFlag&wcMF.frame.wcPersistentFrameFlag?"<b>true</b>":"false","font-size:smaller");html+=this.addDetail("Flag-CurrentlyHidden (4)",frameFlag&wcMF.frame.wcCurrentlyHiddenFlag?"<b>true</b>":"false","font-size:smaller");html+=this.addDetail("Flag-StayInFrame (8)",frameFlag&wcMF.frame.wcStayInFrameFlag?"<b>true</b>":"false","font-size:smaller");
html+=this.addDetail("Flag-DelayLoad (16)",frameFlag&wcMF.frame.wcDelayLoadFlag?"<b>true</b>":"false","font-size:smaller");html+=this.addDetail("Flag-NoFramesToolbar (32)",frameFlag&wcMF.frame.wcNoFramesToolbarFlag?"<b>true</b>":"false","font-size:smaller");html+=this.addDetail("Flag-DoAnimation (64)",frameFlag&wcMF.frame.wcDoAnimationFlag?"<b>true</b>":"false","font-size:smaller");html+=this.addDetail("InitialSize",sizeInfo.wcInitialSize?sizeInfo.wcInitialSize:"--");html+=this.addDetail("Label",
frameInfo.wcFrameLabel?frameInfo.wcFrameLabel:"--");html+=this.addDetail("ShowHeader",obj.wcShowHeader?"true":"false");if(!obj.wcIsHidden)html+=this.addDetail("Position",parseInt(obj.wcFlexItem.getLeft())+" , "+parseInt(obj.wcFlexItem.getTop()));if(!obj.wcIsHidden)html+=this.addDetail("Size",parseInt(obj.getWidth())+" x "+parseInt(obj.getHeight()))}else if(obj instanceof WcMultiframesContentPane){var contentInfo=obj.wcContentInfo;var contentFlag=contentInfo.wcOptionsFlag;html+=this.addDetail("Content ID",
contentInfo.wcContentID);html+=this.addDetail("Flags",contentFlag);html+=this.addDetail("Flag-DoNotReload (1)",contentFlag&wcMF.content.wcDoNotReload?"<b>true</b>":"false","font-size:smaller");html+=this.addDetail("Flag-CannotClose (2)",contentFlag&wcMF.content.wcCannotClose?"<b>true</b>":"false","font-size:smaller");html+=this.addDetail("Page-Header",contentInfo.wcServerTitle?contentInfo.wcContentTitle:"--");html+=this.addDetail("Page-Title",contentInfo.wcContentSubtitle?contentInfo.wcContentSubtitle:
"--");html+=this.addDetail("Page-Icon",contentInfo.wcPageIcon?contentInfo.wcPageIcon:"--");html+=this.addDetail("Window-Size",contentInfo.wcWindowSize?contentInfo.wcWindowSize:"--")}html+="</table>";return $(html)};_p.addDetail=function(name,value,style){var strStyle=style?" style='"+style+"'":"";var html="<tr"+strStyle+"><td style='min-width:200px;'>"+name+"</td><td>"+value+"</td></tr>";return html};
_p.headerClick=function(evt){var dlg=$(this._element);var wcObj=dlg.data("wcobj");var mf=dlg.data("current_mf");var ct=evt.currentTarget;dlg.find(".tree-node").css("background-color","");$(ct).css("background-color","lightblue");mf.unhighlightAllFrames();var detail=wcObj.createDetail(mf);if(detail){wcObj.wcDetailEl.empty();wcObj.wcDetailEl.append(detail)}wcObj.wcLayoutDetail.setVisible(detail)};
_p.treeNodeClick=function(evt){var dlg=$(this._element);var wcObj=dlg.data("wcobj");var mf=dlg.data("current_mf");var ct=evt.currentTarget;wcObj.wcHeaderEl.find("span").css("background-color","");dlg.find(".tree-node").css("background-color","");$(ct).css("background-color","lightblue");mf.unhighlightAllFrames();var detail=null;var objType=$(ct).closest("li").data("objtype");var obj=$(ct).closest("li").data("obj");if(objType){if(objType=="frame"&&!obj.wcHidden)obj.doHighlight(true)}else{objType=$(ct).closest("ul").data("objtype");
obj=$(ct).closest("ul").data("obj")}detail=wcObj.createDetail(obj);if(detail){wcObj.wcDetailEl.empty();wcObj.wcDetailEl.append(detail)}wcObj.wcLayoutDetail.setVisible(detail)};_p.diagramNodeClick=function(evt){var dlg=$(this._element);var wcObj=dlg.data("wcobj");var mf=dlg.data("current_mf");var ct=evt.currentTarget;mf.unhighlightAllFrames();var objType=$(ct).closest(".diagram-node").data("objtype");if(objType=="frame"){var frame=$(ct).closest(".diagram-node").data("frame");if(frame)this.clickTreeFrame(frame)}};
_p.clickTreeFrame=function(frame){var arr=this.wcTreeEl.find("li");for(var i=0;i<arr.length;i++){var li=arr[i];var obj=$(li).data("obj");if(obj&&obj==frame){var div=$(li).find("div.tree-node").first();div.trigger("click")}}if(!frame.wcHidden)frame.doHighlight(true)};_p.showMF=function(evt){var dlg=this.data("dlg");var mf=this.data("mf");$(dlg._element).data("current_mf",mf);dlg.doRefresh(mf)};
_p.doRefresh=function(mf,cp){var header=this.createHeader(mf.wcId,mf);this.wcHeaderEl.empty();this.wcHeaderEl.append(header);var headerSpan=this.wcHeaderEl.find("span");headerSpan.on("click",this.headerClick.bind(this));if(mf.wcInMultiFrame){headerSpan.data("dlg",this);headerSpan.data("mf",mf.wcInMultiFrame);headerSpan.on("dblclick",this.showMF.bind(headerSpan))}this.wcNextIndex=1;var tree=this.createTree(mf.wcRootContainer);this.wcTreeEl.empty();this.wcTreeEl.append(tree);this.wcTreeEl.find("div.tree-node").on("click",
this.treeNodeClick.bind(this));this.wcDetailEl=$(this.wcLayoutDetail._element);this.wcDetailEl.css("border","1px solid silver");var diagram=this.createDiagram(mf.wcRootContainer);this.wcDiagramEl.empty();this.wcDiagramEl.append(diagram);this.wcDiagramEl.find("div.diagram-node").on("click",this.diagramNodeClick.bind(this));if(cp){var frame=cp.wcContentFrame;if(frame)this.clickTreeFrame(frame)}};
function WcMultiframesRefreshPanel(mf){if(_wcconstructing)return;WcxComponent.call(this,"WcMultiframesRefreshPanel");this._element.addClass("wcx-mfrefreshpanel");this.wcMultiFrames=mf;this.wcRefreshInterval=null;this.wcRefreshSeconds=0;this.wcRefreshToolbar=new WcxHBox;this.wcRefreshToolbar.setTop(0);this.wcRefreshToolbar.setLeft(0);this.wcRefreshToolbar.setRight(0);this.wcRefreshToolbar.setBottom(0);this.wcRefreshToolbar._element.css("position","absolute");this.add(this.wcRefreshToolbar);this.wcRefreshStatus=
new WcxLabel(ibx.resourceMgr.getString("mfo_autorefresh")+": "+ibx.resourceMgr.getString("mfo_refresh_off"));this.wcRefreshStatus._setQaAttr("Auto-Refresh");this.wcRefreshStatus._element.addClass("wcx-mf-refreshstatus");this.wcRefreshStatus.setIcon("ds-icon-info");this.wcRefreshStatus.addEventListener("click",this.doSelectInterval,this);this.wcRefreshToolbar.add(this.wcRefreshStatus);this.wcRefreshAllBtn=wcCreateIconButton({"icon":wcapplication.imgstr.refresh});this.wcRefreshAllBtn._setQaAttr("Refresh");
this.wcRefreshAllBtn._element.addClass("wcx-mf-refreshstatus");$(this.wcRefreshAllBtn._element).attr("title",ibx.resourceMgr.getString("refresh"));this.wcRefreshAllBtn.addEventListener("click",mf.doRefreshAll,mf);this.wcRefreshToolbar.add(this.wcRefreshAllBtn);this.wcHBox=new WcxHBox;this.wcHBox._element.css("flex","1");this.wcRefreshToolbar.add(this.wcHBox);this.wcDropLabel=new WcxLabel("Drop action will");this.wcDropLabel._element.css("margin-top","7px");this.wcDropLabel._element.css("margin-right",
"3px");this.wcDropLabel.setVisible(false);this.wcRefreshToolbar.add(this.wcDropLabel);var strDropMenu="show context-menu";var strDropReplace="replace content";var strDropAdd="add content to frame";this.wcDropOption=new WcxSelect(true);var dropOption=localStorage.getItem("mf,dropOption");this.wcDropOption.setText(dropOption=="1"?strDropReplace:dropOption=="2"?strDropAdd:strDropMenu);this.wcDropMenu=new WcxSelectItem(strDropMenu,0);this.wcDropOption.addItem(this.wcDropMenu);this.wcDropReplace=new WcxSelectItem(strDropReplace,
1);this.wcDropOption.addItem(this.wcDropReplace);this.wcDropAdd=new WcxSelectItem(strDropAdd,2);this.wcDropOption.addItem(this.wcDropAdd);this.wcDropOption.setVisible(false);this.wcDropOption.addClosePopupEventListener(function(){localStorage.setItem("mf,dropOption",this.wcDropOption.getUserValue())},this);this.wcRefreshToolbar.add(this.wcDropOption)}_p=wcInherit(WcMultiframesRefreshPanel,WcxComponent);
_p.createMenu=function(){var rp=this;var menu=new WcxMenu;menu.wcInterval0=new WcxMenuItem(ibx.resourceMgr.getString("mfo_refresh_off"));menu.wcInterval0.setHighlighted(this.wcRefreshSeconds==0);menu.wcInterval0.addEventListener("click",function(){rp.changeInterval(0)},this);menu.addItem(menu.wcInterval0);menu.wcInterval10=new WcxMenuItem("10");menu.wcInterval10.setHighlighted(this.wcRefreshSeconds==10);menu.wcInterval10.addEventListener("click",function(){rp.changeInterval(10)},this);menu.addItem(menu.wcInterval10);
menu.wcInterval15=new WcxMenuItem("15");menu.wcInterval15.setHighlighted(this.wcRefreshSeconds==15);menu.wcInterval15.addEventListener("click",function(){rp.changeInterval(15)},this);menu.addItem(menu.wcInterval15);menu.wcInterval30=new WcxMenuItem("30");menu.wcInterval30.setHighlighted(this.wcRefreshSeconds==30);menu.wcInterval30.addEventListener("click",function(){rp.changeInterval(30)},this);menu.addItem(menu.wcInterval30);menu.wcInterval45=new WcxMenuItem("45");menu.wcInterval45.setHighlighted(this.wcRefreshSeconds==
45);menu.wcInterval45.addEventListener("click",function(){rp.changeInterval(45)},this);menu.addItem(menu.wcInterval45);menu.wcInterval60=new WcxMenuItem("60");menu.wcInterval60.setHighlighted(this.wcRefreshSeconds==60);menu.wcInterval60.addEventListener("click",function(){rp.changeInterval(60)},this);menu.addItem(menu.wcInterval60);return menu};
_p.doSelectInterval=function(e){var rp=this;if(this.wcMenu){delete this.wcMenu.wcContentPane;this.wcMenu.dispose()}this.wcMenu=this.createMenu();var el=this.wcRefreshStatus._element;this.wcMenu.setOption("position",{"my":"right top","at":"right bottom","collision":"flipfit flipfit","of":$(el)});this.wcMenu.setOption("close",function(){if(rp.wcRefreshSeconds>0)rp.startInterval();else rp.stopInterval()});this.pauseInterval();this.wcMenu.open()};
_p.changeInterval=function(seconds){this.wcRefreshSeconds=seconds;if(seconds>0)this.startInterval();else this.stopInterval()};_p.startInterval=function(){if(this.wcRefreshSeconds>0){this.wcRefreshStopped=false;this.wcRefreshStartTime=new Date;this.doInterval();var that=this;if(this.wcRefreshInterval)try{clearInterval(this.wcRefreshInterval)}catch(e){}this.wcRefreshInterval=setInterval(function(){that.doInterval(that)},1E3)}else this.stopInterval()};
_p.stopInterval=function(){this.pauseInterval();this.wcRefreshStatus.setText(ibx.resourceMgr.getString("mfo_autorefresh")+": "+ibx.resourceMgr.getString("mfo_refresh_off"))};_p.pauseInterval=function(){if(this.wcRefreshInterval)try{clearInterval(this.wcRefreshInterval)}catch(e){}this.wcRefreshInterval=null;this.wcRefreshStopped=true;this.wcRefreshStartTime=null;this.wcRefreshStatus.setText(ibx.resourceMgr.getString("mfo_autorefresh")+": --- ")};
_p.doInterval=function(){if(this.wcRefreshStopped)return;if(!this.wcRefreshStartTime)return;var mf=this.wcMultiFrames;if(this.wcRefreshSeconds>0){var now=new Date;var elapsed=Math.round((now.getTime()-this.wcRefreshStartTime.getTime())/1E3);var countdown=this.wcRefreshSeconds-elapsed;if(countdown<1){this.stopInterval();mf.doRefreshAll();this.startInterval()}else this.wcRefreshStatus.setText(ibx.resourceMgr.getString("mfo_autorefresh")+": "+countdown)}else this.stopInterval()};
function WcMultiframesBodyPanel(multiFrames){if(_wcconstructing)return;var orientation=multiFrames.wcInPage instanceof WcMultiframesContentPane?"horizontal":"vertical";this.wcIsHorizontal=orientation=="horizontal";WcMultiframesFlexContainer.call(this,orientation,"WcMultiframesBodyPanel");this._element.addClass("wcx-mfbodypanel");this.wcMultiFrames=multiFrames;this.wcMFFramesToolbar=new WcMultiframesFramesToolbar(multiFrames,orientation);this.wcMFFramesToolbar.setVisible(false);if(this.wcIsHorizontal)this.addItem(this.wcMFFramesToolbar);
this.wcMFMainPanel=new WcMultiframesMainPanel(multiFrames);this.wcRootContainer=this.wcMFMainPanel.wcRootContainer;this.wcHighlight=this.wcMFMainPanel.wcHighlight;this.wcMeasure1=this.wcMFMainPanel.wcMeasure1;this.wcMeasure2=this.wcMFMainPanel.wcMeasure2;this.addItem(this.wcMFMainPanel,null,true);if(!this.wcIsHorizontal)this.addItem(this.wcMFFramesToolbar);this.wcContentViews=this.wcMFMainPanel.wcContentViews}_p=wcInherit(WcMultiframesBodyPanel,WcMultiframesFlexContainer);
function WcMultiframesFramesToolbar(multiFrames,orientation){if(_wcconstructing)return;WcxComponent.call(this,"WcMultiframesFramesToolbar");this._element.addClass("wcx-multiframes-frames-toolbar");this._element.addClass("wcx-orientation-"+orientation);this.wcMultiFrames=multiFrames;this.wcOrientation=orientation}_p=wcInherit(WcMultiframesFramesToolbar,WcxComponent);
_p.addFramesToolbarBtn=function(frame){var frameBtn=new wcCreateIconButton({"icon":"ds-icon-toggle-"+(frame.wcIsHidden?"off":"on")});$(frameBtn._element).css("color",frame.wcIsHidden?"":"white");frameBtn._element.addClass("wcx-frame-btn");frameBtn.setEnabled(true);frameBtn.setTitle(this.getFrameCaption(frame));frameBtn.addEventListener("click",this.doFrameBtnClick,frameBtn);frameBtn.addEventListener("dblclick",this.doFrameBtnDblClick,frameBtn);frameBtn.addEventListener("mouseover",this.doFrameBtnMouseOver,
frameBtn);frameBtn.addEventListener("mouseout",this.doFrameBtnMouseOut,frameBtn);frame.wcFramesToolbarBtn=frameBtn;frame.wcFramesToolbarBtn.wcFramesToolbar=this;frame.wcFramesToolbarBtn.wcContentFrame=frame;frame.wcFramesToolbarBtn.wcMenu=this.createMenu(frame);frame.wcFramesToolbarBtn.wcHasMenu=true;this.setFramesToolbarButton(frame);this.add(frameBtn)};
_p.removeFramesToolbarBtn=function(frame){var children=this.getChildren();for(var i=children.length-1;i>=0;i--){var frameBtn=children[i];if(frameBtn.wcContentFrame==frame){frame.wcFramesToolbarBtn=null;frameBtn.removeEventListener("click",frame.toggle,frame);frameBtn.removeEventListener("mouseover",this.doFrameBtnMouseOver,frameBtn);this.remove(frameBtn)}}};
_p.createMenu=function(frame){var rp=this;var menu=new WcxMenu;var caption='"'+this.getFrameCaption(frame)+'"';menu.wcToggle=new WcxMenuItem((frame.wcIsHidden?ibx.resourceMgr.getString("show"):ibx.resourceMgr.getString("hide"))+" "+caption);menu.wcToggle.setIcon(frame.wcIsHidden?"ds-icon-show":"ds-icon-hide");$(menu.wcToggle._element).css("font-weight","bold");menu.wcToggle.addEventListener("click",frame.toggle,frame);menu.addItem(menu.wcToggle);menu.wcMaximize=new WcxMenuItem(ibx.resourceMgr.getString("maximize")+
" "+caption);menu.wcMaximize.setIcon(wcapplication.imgstr.max);var cp=frame.wcFramesToolbarBtn.wcNestedMF;if(cp)menu.wcMaximize.addEventListener("click",cp.doMaximize,cp);else menu.wcMaximize.setEnabled(false);menu.addItem(menu.wcMaximize);return menu};
_p.getFrameCaption=function(frame){var mf=this.wcMultiFrames;var caption="";if(frame.wcFrameInfo&&frame.wcFrameInfo.wcFrameLabel)caption=frame.wcFrameInfo.wcFrameLabel;else if(frame.wcContentPanes.length>0){var cp=frame.getActiveContentPane();if(cp&&cp.wcContentInfo)caption=cp.wcContentInfo.wcContentTitle}return caption};
_p.setFramesToolbarButton=function(frame){var btnVisible=false;if(frame.wcFramesToolbarBtn&&!frame.wcNoFramesToolbar){var count=frame.getContentCount();if(frame.hasOneEmptyContent())count=0;if(wcMF.wcShowFramesToolbar==0)if(frame.wcIsHidden&&count>0)btnVisible=true;else for(var j=0;j<frame.wcContentPanes.length;j++){var cp=frame.wcContentPanes[j];if(cp.wcHasMultiFrame&&cp.wcHasMultiFrame.wcNotRestricted){frame.wcFramesToolbarBtn.wcNestedMF=cp;btnVisible=true;break}}else if(wcMF.wcShowFramesToolbar==
2)if(count>0)btnVisible=true;frame.wcFramesToolbarBtn.setVisible(btnVisible);var cp=frame.getActiveContentPane();if(cp&&cp.wcContentInfo){var text=this.getFrameCaption(frame);if(!text)text=cp.wcContentInfo.wcContentTitle;frame.wcFramesToolbarBtn._setQaAttr(text);var icon=cp?cp.wcContentInfo.wcPageIcon:null;if(!icon)frame.wcIsHidden?"ds-icon-toggle-off":"ds-icon-toggle-on";frame.wcFramesToolbarBtn.setIcon(icon);$(frame.wcFramesToolbarBtn._element).css("color",frame.wcIsHidden?"":"white")}}else frame.wcFramesToolbarBtn.setVisible(btnVisible);
return btnVisible};_p.resetAllMenus=function(){var children=this.getChildren();for(var i=0;i<children.length;i++){var frameBtn=children[i];if(frameBtn.wcMenu){frameBtn.wcMenu.setVisible(false);frameBtn.wcMenu.dispose()}}};
_p.doRefresh=function(){var mf=this.wcMultiFrames;var wasVisible=this.getVisible();var hasFramesToolbarBtns=false;if(mf.wcNoDragAndDropMode)for(var i=0;i<mf.wcFramesList.length;i++){var frame=mf.wcFramesList[i];if(this.setFramesToolbarButton(frame))hasFramesToolbarBtns=true}this.setVisible(hasFramesToolbarBtns);if(wasVisible!=hasFramesToolbarBtns)mf.adjustLayout("REFRESH",null)};_p.doFrameBtnClick=function(e){this.wcMenu.setVisible(false);this.wcContentFrame.toggle()};
_p.doFrameBtnDblClick=function(e){this.wcMenu.setVisible(false);this.wcContentFrame.toggle()};
_p.doFrameBtnMouseOver=function(e){var framesToolbar=this.wcFramesToolbar;framesToolbar.resetAllMenus();if(this.wcHasMenu){this.wcMenu=framesToolbar.createMenu(this.wcContentFrame);$(this.wcMenu._element).on("mouseout",framesToolbar.doMenuMouseOut.bind(this.wcMenu));var el=this._element;var position;if(framesToolbar.wcOrientation=="horizontal")position={"my":"left top","at":"right top","collision":"flipfit flipfit","of":$(el)};else position={"my":"left bottom","at":"left top","collision":"flipfit flipfit",
"of":$(el)};this.wcMenu.setOption("position",position);this.wcMenu.open()}if(!this.wcContentFrame.wcIsHidden)this.wcContentFrame.doHighlight(true)};_p.doFrameBtnMouseOut=function(e){var framesToolbar=this.wcFramesToolbar;var x=e.offsetX;var y=e.offsetY;if(this.wcHasMenu)if(framesToolbar.wcOrientation=="horizontal"){if(x<29||y<1||y>20)this.wcMenu.setVisible(false)}else if(y>19||x<1||x>29)this.wcMenu.setVisible(false);this.wcContentFrame.doHighlight(false)};
_p.doMenuMouseOut=function(e){var x=e.offsetX;var y=e.offsetY;var width=$(this._element).width();var height=$(this._element).height();if(x<0||y<-5||x>width||y>height+10)this.setVisible(false)};
function WcMultiframesMainPanel(multiFrames){if(_wcconstructing)return;WcMultiframesFlexContainer.call(this,"horizontal","WcMultiframesMainPanel");this._element.addClass("wcx-mfmainpanel");this.wcMultiFrames=multiFrames;this.wcHighlight=new WcxComponent("WcMultiframesHighlight");this.wcHighlight._element.addClass("wcx-mfhighlight");this.wcHighlight.setVisible(false);this.add(this.wcHighlight);this.wcMeasure1=new WcxLabel;this.wcMeasure1._element.addClass("wcx-mfmeasure");this.wcMeasure1.setText("");
this.wcMeasure1.setVisible(false);this.add(this.wcMeasure1);this.wcMeasure2=new WcxLabel;this.wcMeasure2._element.addClass("wcx-mfmeasure");this.wcMeasure2.setText("");this.wcMeasure2.setVisible(false);this.add(this.wcMeasure2);this.wcRootContainer=new WcMultiframesContainer(this.wcMultiFrames,"ROOT",null,null);this.wcRootContainer._element.addClass("wcx-mfrootcontainer");this.wcRootContainer.wcContainer=null;this.add(this.wcRootContainer);this.wcContentViews=[]}
_p=wcInherit(WcMultiframesMainPanel,WcMultiframesFlexContainer);
_p.insertNewRoot=function(){var oldRoot=this.wcRootContainer;var newOrientation=oldRoot.wcOrientation=="VERTICAL"?"HORIZONTAL":"VERTICAL";var newRoot=new WcMultiframesContainer(this.wcMultiFrames,newOrientation,null,null);newRoot._element.addClass("wcx-mfrootcontainer");newRoot.wcContainer=null;newRoot.wcParentContainer=null;newRoot.wcIsRoot=true;newRoot.wcOrientation=newOrientation;oldRoot.wcContainer=newRoot;oldRoot.wcParentContainer=newRoot;oldRoot.wcIsRoot=false;$(newRoot._element).insertBefore($(oldRoot._element));
this.wcRootContainer=newRoot;newRoot.addItem(oldRoot,null,true,true);return newRoot};
function WcMultiframesContainer(multiFrames,orientation,parentContainer,starterFrame){if(_wcconstructing)return;var orient=orientation.toUpperCase();if(!orient)orient="HORIZONTAL";else if(orient=="v")orient="VERTICAL";else if(orient!="VERTICAL")orient="HORIZONTAL";WcMultiframesFlexContainer.call(this,orient,"WcMultiframesContainer");this._element.addClass("wcx-multiframes-container");this.wcMultiFrames=multiFrames;this.wcOrientation=orientation;this.wcParentContainer=parentContainer;this.wcHasFixedFrames=
false;this.wcIsRoot=orientation=="ROOT";this.wcSizeInfo={};this.wcSizeInfo.wcParsedWidth=null;this.wcSizeInfo.wcParsedHeight=null;this.wcSizeInfo.wcInitialSize=null;if(starterFrame){this.setTop(starterFrame.getTop());this.setLeft(starterFrame.getLeft())}}_p=wcInherit(WcMultiframesContainer,WcMultiframesFlexContainer);_p._dispose=_p.dispose;_p.dispose=function(){var mf=this.wcMultiFrames;this.removeAll();this._dispose.call(this)};
_p.parseLayout=function(layoutParam){if(layoutParam&&layoutParam.length>0){if(layoutParam[0]!="[")return false;if(layoutParam[layoutParam.length-1]!="]")return false;var orientation=layoutParam[1];if(orientation=="R")this.wcOrientation="ROOT";else if(orientation=="V")this.wcOrientation="VERTICAL";else if(orientation=="H")this.wcOrientation="HORIZONTAL";else return false;var pos=layoutParam.indexOf(":");var strParams=layoutParam.substring(2,pos);var arrParams=strParams.split(",");this.wcContainerFlags=
arrParams[3];var isPersistent=this.wcContainerFlags&wcMF.container.wcPersistentFlag?true:false;this.wcIsPersistent=isPersistent;var strFrames=pos+1<layoutParam.length-1?layoutParam.substring(pos+1,layoutParam.length-1):"";this.wcSizeInfo.wcClientWidth=this.wcSizeInfo.wcParsedWidth=parseInt(arrParams[0]);this.wcSizeInfo.wcClientHeight=this.wcSizeInfo.wcParsedHeight=parseInt(arrParams[1]);if(arrParams.length>2)this.wcSizeInfo.wcInitialSize=parseInt(arrParams[2]);if(arrParams.length>3)this.wcLayoutID=
arrParams[4];if(this.wcIsRoot){this.wcSizeInfo.wcClientWidth=this._element.width();this.wcSizeInfo.wcClientHeight=this._element.height()}else{var root=this.wcMultiFrames.wcRootContainer;if(root.wcSizeInfo.wcParsedWidth>0)this.wcSizeInfo.wcClientWidth=root.wcSizeInfo.wcClientWidth*this.wcSizeInfo.wcParsedWidth/root.wcSizeInfo.wcParsedWidth;if(root.wcSizeInfo.wcParsedHeight>0)this.wcSizeInfo.wcClientHeight=root.wcSizeInfo.wcClientHeight*this.wcSizeInfo.wcParsedHeight/root.wcSizeInfo.wcParsedHeight}var arrFrames=
this.parseFramesIntoArray(strFrames);if(arrFrames){var isFirstVisible=true;for(var i=0;i<arrFrames.length;i++){var frameParam=arrFrames[i];if(frameParam&&frameParam.length>0){if(frameParam[0]=="(");else if(frameParam[0]=="["){var objType=frameParam[1];if(objType=="V"||objType=="H"||objType=="R"){if(!this.parseContainerParam(frameParam,isFirstVisible))return false}else if(!this.parseFrameParam(frameParam,isFirstVisible))return false}else return false;if(this.wcLastParsedFrame&&!this.wcLastParsedFrame.wcIsHidden)isFirstVisible=
false}}if(isPersistent){var initWidth=this.wcSizeInfo.wcClientWidth;var initHeight=this.wcSizeInfo.wcClientHeight;this.createBlankFrame(initWidth,initHeight)}}else return false}return true};
_p.parseFramesIntoArray=function(strFrames){var arrFrames=[];if(strFrames.length>0){var strType="";var iLevel=0;var strF="";for(var i=0;i<strFrames.length;i++){var ch=strFrames[i];strF+=ch;if(strType=="")if(ch=="("||ch=="["){strType=ch;iLevel=1}else return null;else if(strType=="("){if(ch==")"){arrFrames.push(strF);strType="";iLevel=0;strF=""}}else if(strType=="[")if(ch=="]"){iLevel-=1;if(iLevel==0){arrFrames.push(strF);strType="";strF=""}}else if(ch=="[")iLevel+=1}}else return null;return arrFrames};
_p.parseFrameParam=function(frameParam,isFirstVisible){if(frameParam[frameParam.length-1]!="]")return false;var frameType="tab";if(frameParam[1]=="A")frameType="single";else if(frameParam[1]=="S")frameType="single";else if(frameParam[1]=="T")frameType="tab";else if(frameParam[1]=="L")frameType="list";else if(frameParam[1]=="F")frameType="filters";else if(frameParam[1]=="G")frameType="grid";frameParam=frameParam.substring(1,frameParam.length-1);var pos=frameParam.indexOf(":");var strFrameParams=frameParam.substring(1,
pos);var strContents=pos+1<frameParam.length-1?frameParam.substring(pos+1,frameParam.length):"";var frameArray=strFrameParams.split(",");if(frameArray.length<2)return false;var mf=this.wcMultiFrames;var root=mf.wcRootContainer;var rootWidth=root._element.width();var rootHeight=root._element.height();var parsedWidth=parseInt(frameArray[0]);var parsedHeight=parseInt(frameArray[1]);var initialSize=frameArray[2];var parsedFlag=frameArray.length>=3?parseInt(frameArray[3]):0;var bPersistentFrame=parsedFlag&
wcMF.frame.wcPersistentFrameFlag?true:false;if(bPersistentFrame)mf.wcHasPersistentFrame=true;var bCurrentlyHidden=parsedFlag&wcMF.frame.wcCurrentlyHiddenFlag?true:false;var bDelayLoad=parsedFlag&wcMF.frame.wcDelayLoadFlag?true:false;var bNoFramesToolbar=parsedFlag&wcMF.frame.wcNoFramesToolbarFlag?true:false;var bDoAnimation=parsedFlag&wcMF.frame.wcDoAnimationFlag?true:false;var parsedID=frameArray.length>=4?""+frameArray[4]:"";if(parsedID=="undefined")parsedID="";if(parsedID=="MFFFrame")mf.wcHasFiltersFrame=
true;var parsedActiveID=parsedID;if(frameType=="tab")parsedActiveID=frameArray.length>=5?""+frameArray[5]:parsedID;var scaledWidth=root.wcSizeInfo.wcParsedWidth>0?rootWidth*parsedWidth/root.wcSizeInfo.wcParsedWidth:parsedWidth;var scaledHeight=root.wcSizeInfo.wcParsedHeight>0?rootHeight*parsedHeight/root.wcSizeInfo.wcParsedHeight:parsedHeight;var frame=mf.createFrame(frameType,null,bPersistentFrame);this.addFrame(frame,scaledWidth,scaledHeight);frame.wcFrameType=frameType;frame.wcFrameInfo.wcFrameFlag=
parsedFlag;frame.wcFrameInfo.wcFrameID=parsedID;frame.wcFrameInfo.wcFrameClass=parsedID;frame.wcActiveID=parsedActiveID;frame.wcSizeInfo.wcParsedWidth=parsedWidth;frame.wcSizeInfo.wcClientWidth=scaledWidth;frame.wcSizeInfo.wcParsedHeight=parsedHeight;frame.wcSizeInfo.wcClientHeight=scaledHeight;frame.wcSizeInfo.wcInitialSize=initialSize;var arrContents=this.parseFramesIntoArray(strContents);if(arrContents&&arrContents.length>0)for(var i=0;i<arrContents.length;i++){var contentParam=arrContents[i];
var newFrame=this.parseFrameContentParam(contentParam,frame,frameType);if(newFrame!=frame){frame=newFrame;this.addFrame(frame,scaledWidth,scaledHeight)}}frame.wcDelayLoad=bDelayLoad;frame.wcNoFramesToolbar=bNoFramesToolbar;frame.wcDoAnimation=bDoAnimation;frame.wcIsHidden=bCurrentlyHidden;if(bPersistentFrame)frame.wcIsHidden=false;this.wcLastParsedFrame=frame;return true};
_p.parseFrameContentParam=function(contentParam,frame,frameType){var mf=this.wcMultiFrames;if(contentParam[0]!="(")return false;if(contentParam[contentParam.length-1]!=")")return false;contentParam=contentParam.substring(1,contentParam.length-1);var contentArray=contentParam.split(",");if(contentParam==""&&!frame);else{if(contentArray.length<4)return false;var contentID=contentArray[0];var parsedWidth=parseInt(contentArray[1]);var parsedHeight=parseInt(contentArray[2]);var data=contentArray[3];var optionsFlag=
contentArray.length>4?parseInt(contentArray[4]):0;var contentInfo={};if(!frame){frame=mf.createFrame(frameType,contentID,false,!data?"#494949":"#FFFFFF");frame.wcFrameType=frameType}contentInfo.wcContentID=contentID;contentInfo.wcParsedWidth=parsedWidth;contentInfo.wcParsedHeight=parsedHeight;contentInfo.wcData=data;contentInfo.wcOptionsFlag=optionsFlag;frame.addContent(contentInfo,false,true)}return frame};
_p.parseContainerParam=function(containerParam,isFirstVisible){var newContainer=new WcMultiframesContainer(this.wcMultiFrames,this.wcOrientation,this,null);this.addItem(newContainer,null,true,true);if(!newContainer.parseLayout(containerParam))return false;this.wcLastParsedFrame=newContainer;return true};
_p.parseArrangeObjects=function(){var top=0;var left=0;var right=0;var bottom=0;var current=0;var containers=[];var children=this.getChildren();for(var i=0;i<children.length;i++){var item=children[i];var obj=item.getChildren()[0];var objSize=0;if(this.wcOrientation=="VERTICAL"){objSize=parseInt(obj.wcSizeInfo.wcClientHeight);item._element.css("top",current+"px");item._element.css("left","0px");item._element.css("width","100%");item._element.css("height",objSize+"px");item._element.css("position",
"absolute");obj.wcSizeInfo.wcParsedTop=current;obj.wcSizeInfo.wcParsedLeft=0}else{objSize=parseInt(obj.wcSizeInfo.wcClientWidth);item._element.css("top","0px");item._element.css("left",current+"px");item._element.css("width",objSize+"px");item._element.css("height","100%");item._element.css("position","absolute");obj.wcSizeInfo.wcParsedTop=0;obj.wcSizeInfo.wcParsedLeft=current}current+=objSize;if(this.isObjectAContainer(obj))containers.push(obj)}for(var i=0;i<containers.length;i++){var obj=containers[i];
obj.parseArrangeObjects()}};
_p.getLayoutJson=function(){var layoutJson={};try{this.wcSizeInfo.wcClientLeft=this.getLeft();this.wcSizeInfo.wcClientTop=this.getTop();this.wcSizeInfo.wcClientWidth=this.getWidth();this.wcSizeInfo.wcClientHeight=this.getHeight()}catch(e){return""}layoutJson.wcItemType="container";var orientation=this.wcOrientation[0];layoutJson.wcOrientation=orientation;var layoutID=this.wcLayoutID;if(!layoutID)if(this.wcIsRoot)layoutID="L1";else{this.wcMultiFrames.wcLayoutIDCounter+=1;layoutID="L"+this.wcMultiFrames.wcLayoutIDCounter}this.wcLayoutID=
layoutID;layoutJson.wcLayoutID=this.wcLayoutID;layoutJson.wcWidth=this.wcSizeInfo.wcClientWidth;layoutJson.wcHeight=this.wcSizeInfo.wcClientHeight;if(this.wcParentContainer)if(!this.wcIsHidden){var wcCurrentSize=0;try{if(orientation=="V"){var contSize=this.wcParentContainer.getClientWidth();wcCurrentSize=parseInt(this.wcSizeInfo.wcClientWidth*100/contSize*100)/100}else{var contSize=this.wcParentContainer.getClientHeight();wcCurrentSize=parseInt(this.wcSizeInfo.wcClientHeight*100/contSize*100)/100}}catch(e){}layoutJson.wcCurrentSize=
wcCurrentSize}else{layoutJson.wcWidth=0;layoutJson.wcHeight=0;layoutJson.wcCurrentSize=0}if(this.wcSizeInfo.wcInitialSize)layoutJson.wcInitialSize=this.wcSizeInfo.wcInitialSize;var children=this.getChildren();if(children.length>0){var wcLayoutItems=[];for(var i=0;i<children.length;i++){var wcLayoutItem={};var isLayoutItem=false;var item=children[i];var obj=item.getChildren()[0];if(obj)if(obj._objtype=="WcMultiframesContainer"){isLayoutItem=true;wcLayoutItem=obj.getLayoutJson()}else if(obj._objtype==
"WcMultiframesContentFrame")if(!obj.wcIsBlankFrame){isLayoutItem=true;wcLayoutItem.wcItemType="frame";var frameType="T";if(obj.wcFrameType=="list")frameType="L";else if(obj.wcFrameType=="filters")frameType="F";else if(obj.wcFrameType=="single")frameType="S";wcLayoutItem.wcFrameType=frameType;var frameInfo=obj.wcFrameInfo;var frameID=frameInfo.wcFrameID;if(!frameID){frameID=this.wcMultiFrames.getNextFrameID();frameInfo.wcFrameID=frameID;frameInfo.wcNotServerID=true}if(frameID)wcLayoutItem.wcFrameID=
frameID;var activeID=obj.wcActiveID;if(activeID)wcLayoutItem.wcActiveID=activeID;obj.wcSizeInfo.wcClientLeft=obj.getLeft();obj.wcSizeInfo.wcClientTop=obj.getTop();obj.wcSizeInfo.wcClientWidth=obj.getWidth();obj.wcSizeInfo.wcClientHeight=obj.getHeight();wcLayoutItem.wcWidth=obj.wcSizeInfo.wcClientWidth;wcLayoutItem.wcHeight=obj.wcSizeInfo.wcClientHeight;if(!obj.wcIsHidden){if(orientation=="H"){var contSize=obj.wcContainer.getWidth();obj.wcSizeInfo.wcCurrentSize=parseInt(obj.wcSizeInfo.wcClientWidth*
100/contSize*100)/100}else{var contSize=obj.wcContainer.getHeight();obj.wcSizeInfo.wcCurrentSize=parseInt(obj.wcSizeInfo.wcClientHeight*100/contSize*100)/100}wcLayoutItem.wcCurrentSize=obj.wcSizeInfo.wcCurrentSize}else{wcLayoutItem.wcWidth=0;wcLayoutItem.wcHeight=0;wcLayoutItem.wcCurrentSize=0}if(obj.wcSizeInfo.wcInitialSize)wcLayoutItem.wcInitialSize=obj.wcSizeInfo.wcInitialSize;var bitFlag=wcMF.frame.wcCurrentlyHiddenFlag;var oldFrameFlag=frameInfo.wcFrameFlag;frameInfo.wcFrameFlag=!obj.wcIsHidden?
frameInfo.wcFrameFlag&~bitFlag:frameInfo.wcFrameFlag|bitFlag;var contentPanes=obj.wcContentPanes;if(contentPanes&&contentPanes.length>0){var wcItems=[];for(var j=0;j<contentPanes.length;j++){var wcItem={};var cp=contentPanes[j];if(cp){cp.wcClientWidth=cp.getWidth();cp.wcClientHeight=cp.getHeight();var contentInfo=cp.wcContentInfo;if(contentInfo){wcItem.wcItemType="content";wcItem.wcContentID=contentInfo.wcContentID;wcItem.wcWidth=cp.wcClientWidth;wcItem.wcHeight=cp.wcClientHeight;if(contentInfo.wcData!=
"undefined")wcItem.wcData=contentInfo.wcData;wcItems.push(wcItem)}}}wcLayoutItem.wcItems=wcItems}}if(isLayoutItem)wcLayoutItems.push(wcLayoutItem)}layoutJson.wcLayoutItems=wcLayoutItems}return layoutJson};_p.addFrame=function(frame,width,height){frame.wcContainer=this;var item=this.addItem(frame,null,true,true);if(width)item.setWidth(width);if(height)item.setHeight(height)};
_p.createBlankFrame=function(initWidth,initHeight){var allHidden=true;var children=this.getChildren();for(var i=0;i<children.length;i++){var item=children[i];var obj=item.getChildren()[0];if(obj._objtype=="WcMultiframesContentFrame"){if(!obj.wcIsHidden){allHidden=false;break}}else if(obj._objtype=="WcMultiframesContainer")if(obj.wcIsPersistent){allHidden=false;break}}if(allHidden){this.wcBlankFrame=this.wcMultiFrames.createFrame("t",null,true,"#FFFFFF");this.wcBlankFrame._element.addClass("wcx-mfblankframe");
this.wcBlankFrame.wcIsBlankFrame=true;this.addFrame(this.wcBlankFrame);$(this.wcBlankFrame._element).css("width","100%");$(this.wcBlankFrame._element).css("height","100%");$(this.wcBlankFrame.wcFlexItem._element).css("width","100%");$(this.wcBlankFrame.wcFlexItem._element).css("height","100%")}};
_p.getFramesCount=function(visibleOnly){var count=0;var children=this.getChildren();if(children&&children.length>0)if(visibleOnly)for(var i=0;i<children.length;i++)try{var item=children[i];var obj=item.getChildren()[0];if(obj._objtype=="WcMultiframesContainer"){if(obj.getFramesCount(true)>0)count+=1}else if(visibleOnly&&!obj.wcIsHidden)count+=1}catch(e){}else count=children.length;return count};
_p.isObjectAFrame=function(object){if(object){if(object._objtype=="WcMultiframesContentFrame")return true;if(object._objtype=="WcMultiframesContainer")return true}return false};_p.isObjectAContainer=function(object){if(object)if(object._objtype=="WcMultiframesContainer")return true;return false};_p.isObjectAContentFrame=function(object){if(object)if(object._objtype=="WcMultiframesContentFrame")return true;return false};
_p.isObjectUnknown=function(object){if(object)if(this.isObjectAFrame(object))return false;return true};_p.getPreviousObject=function(thisObject,visibleMode){var previous=null;var children=this.getChildren();if(children&&children.length>1)for(var i=0;i<children.length;i++)try{var item=children[i];var obj=item.getChildren()[0];if(obj==thisObject)return previous;else{if(visibleMode&&visibleMode==1&&obj.wcIsHidden)continue;if(visibleMode&&visibleMode==2&&!obj.wcIsHidden)continue;previous=obj}}catch(e){}return null};
_p.getNextObject=function(thisObject,visibleMode){var objFound=false;var children=this.getChildren();if(children&&children.length>1)for(var i=0;i<children.length;i++)try{var item=children[i];var obj=item.getChildren()[0];if(objFound){if(visibleMode&&visibleMode==1&&obj.wcIsHidden)continue;if(visibleMode&&visibleMode==2&&!obj.wcIsHidden)continue;return obj}if(obj==thisObject)objFound=true}catch(e){}return null};
_p.cleanOrphans=function(){var mf=this.wcMultiFrames;var parentContainer=this.wcParentContainer;var children=this.getChildren();for(var i=0;i<children.length;i++){var item=children[i];var obj=item.getChildren()[0];if(this.isObjectAContainer(obj))obj.cleanOrphans()}if(children.length==1){var item=children[0];var obj=item.getChildren()[0];if(obj)if(this.isObjectAContentFrame(obj)){if(parentContainer){var oldTop=this.wcFlexItem.getTop();var oldLeft=this.wcFlexItem.getLeft();var oldFlexItem=obj.wcFlexItem;
var newFlexItem=parentContainer.addItem(obj,this,true,true);newFlexItem.setTop(oldTop);newFlexItem.setLeft(oldLeft);if(parentContainer.wcOrientation=="VERTICAL"){obj.wcFlexItem.setHeight(this.wcFlexItem.getHeight());obj.wcFlexItem._element.css("width","100%");obj._element.css("width","100%")}else{obj.wcFlexItem.setWidth(this.wcFlexItem.getWidth());obj.wcFlexItem._element.css("height","100%");obj._element.css("height","100%")}oldFlexItem.wcFlexContainer.removeItem(oldFlexItem);parentContainer.removeItem(this.wcFlexItem);
obj.wcContainer=parentContainer;this.dispose();return true}}else if(this.isObjectAContainer(obj))if(obj.wcOrientation==this.wcOrientation){var containerChildren=obj.getChildren();while(containerChildren.length>0)try{var containerItem=containerChildren[0];var containerObj=containerItem.getChildren()[0];if(containerObj){this.addItem(containerObj,this,true,true);if(obj.wcOrientation=="VERTICAL")containerObj.setTop(this.getTop()+containerObj.getTop());else containerObj.setLeft(this.getLeft()+containerObj.getLeft());
containerObj.wcContainer=this;obj.removeItem(containerItem)}}catch(e){}this.removeItem(obj.wcFlexItem);obj.dispose();return true}}return false};_p.cleanChildClones=function(){var mf=this.wcMultiFrames;var parentContainer=this.wcParentContainer;var children=this.getChildren();for(var i=0;i<children.length;i++){var item=children[i];var obj=item.getChildren()[0];if(this.isObjectAContainer(obj))obj.cleanOrphans()}};
_p.adjustSizes=function(userAction,doNotRecurse,actionFrame){var mf=this.wcMultiFrames;var containers=[];var visibleFramesCount=this.getFramesCount(true);var sizeEvenly=false;var useInitialSize=false;var children=this.getChildren();if(children.length>0){var isHorizontal=this.wcOrientation=="HORIZONTAL";var oldContainerSize=isHorizontal?this.wcSizeInfo.wcClientWidth:this.wcSizeInfo.wcClientHeight;var newContainerSize=isHorizontal?this.getWidth():this.getHeight();var useSizeInfo=true;if(!mf.wcHasPersistentFrame||
true){if(userAction=="SHOW")userAction="INITIAL_SHOW";if(userAction=="HIDE")userAction="INITIAL_SHOW"}if(userAction=="SHOW"){if(newContainerSize==0)this.wcIsHidden=true;if(this.wcIsHidden){this.adjustSizesShowParents(actionFrame);return true}else sizeEvenly=this.adjustSizesShow(newContainerSize,actionFrame)}else if(userAction=="HIDE"){sizeEvenly=visibleFramesCount!=2;useInitialSize=this.adjustSizesHide(visibleFramesCount,actionFrame)}else if(userAction=="MOVE"){oldContainerSize=0;for(var i=0;i<children.length;i++){var item=
children[i];if(isHorizontal)oldContainerSize+=item.getWidth();else oldContainerSize+=item.getHeight()}}else if(userAction=="INITIAL_SHOW"||userAction=="INITIAL_FILTERS"){oldContainerSize=newContainerSize;sizeEvenly=false;useInitialSize=true}else{if(userAction=="REFRESH")useSizeInfo=false;if(!useSizeInfo||oldContainerSize==0){oldContainerSize=0;for(var i=0;i<children.length;i++){var item=children[i];var obj=item.getChildren()[0];if(!obj.wcIsHidden)oldContainerSize+=isHorizontal?item.getWidth():item.getHeight()}}}if(newContainerSize==
0&&oldContainerSize==0)return;this.wcSizeInfo.wcClientWidth=this.getWidth();this.wcSizeInfo.wcClientHeight=this.getHeight();var evenlySize=Math.round(newContainerSize/visibleFramesCount);if(visibleFramesCount>0){var hasFixedFrames=false;if(!sizeEvenly)if(oldContainerSize>0){var oldRemainingSize=oldContainerSize;var newRemainingSize=newContainerSize;var totalPercent=0;for(var i=0;i<children.length;i++){var item=children[i];var obj=item.getChildren()[0];if(!obj.wcIsHidden){obj.wcFixed=false;var initialSize=
""+obj.wcSizeInfo.wcInitialSize;var intSize=initialSize?parseInt(initialSize):false;if(initialSize&&initialSize.indexOf("pxr")>=0)if(!obj.wcSizeInfo.wcCurrentSize){oldRemainingSize-=intSize;newRemainingSize-=intSize;obj.wcAdjustedSize=intSize}else{useInitialSize=false;var pixelSize=isHorizontal?item.getWidth():item.getHeight();var percentSize=pixelSize/oldContainerSize*100;totalPercent+=percentSize}else if(initialSize&&initialSize!=""+intSize){oldRemainingSize-=intSize;newRemainingSize-=intSize;obj.wcAdjustedSize=
intSize;obj.wcFixed=true;hasFixedFrames=true}else totalPercent+=intSize}}if(totalPercent<=0)totalPercent=100;for(var i=0;i<children.length;i++){var item=children[i];var obj=item.getChildren()[0];if(!obj.wcAdjustedSize){var wcOldPixelSize=isHorizontal?item.getWidth():item.getHeight();if(useInitialSize){var initialSize=obj.wcSizeInfo.wcInitialSize;if(!initialSize&&actionFrame==obj){initialSize=33;obj.wcSizeInfo.wcInitialSize=initialSize}if(initialSize)wcOldPixelSize=newRemainingSize*(initialSize/totalPercent)}obj.wcAdjustedSize=
Math.round(wcOldPixelSize*newRemainingSize/oldRemainingSize)}}}else sizeEvenly=true;var currentPos=0;var lastObj=null;var lastVisibleFlexItem=null;for(var i=0;i<children.length;i++){var item=children[i];var obj=item.getChildren()[0];if(obj){var oldClientWidth=obj.wcSizeInfo.wcClientWidth;var oldClientHeight=obj.wcSizeInfo.wcClientHeight;if(isHorizontal){item.setTop(0);item.setBottom(0);item.setLeft(currentPos);if(!obj.wcIsHidden){var itemSize=evenlySize;if(!sizeEvenly)itemSize=obj.wcAdjustedSize;
item.setWidth(itemSize);item.wcWidth=itemSize;item.wcHeight=null;obj.wcSizeInfo.wcClientWidth=itemSize;obj.wcSizeInfo.wcClientHeight=this.getHeight();currentPos+=itemSize}}else{item.setLeft(0);item.setRight(0);item.setTop(currentPos);if(!obj.wcIsHidden){var itemSize=evenlySize;if(!sizeEvenly)itemSize=obj.wcAdjustedSize;item.setHeight(itemSize);item.wcWidth=null;item.wcHeight=itemSize;obj.wcSizeInfo.wcClientHeight=itemSize;obj.wcSizeInfo.wcClientWidth=this.getWidth();currentPos+=itemSize}}delete obj.wcAdjustedSize;
obj.setVisible(!obj.wcIsHidden);if(obj.wcIsHidden)$(obj.wcFlexItem._element).hide();else{$(obj.wcFlexItem._element).show();obj.wcFlexItem.updateResizable(obj.wcFlexItem.wcFlexContainer);if(obj.wcFixed)try{$(obj.wcFlexItem._element).resizable("disable")}catch(err){}lastVisibleFlexItem=obj.wcFlexItem}if(!obj.wcIsHidden)lastObj=obj;if(this.isObjectAContainer(obj)){if(obj.getFramesCount(true)<=0)if(!obj.wcIsPersistent)obj.wcIsHidden=true;if(isHorizontal)obj.wcSizeInfo.wcClientWidth=oldClientWidth;else obj.wcSizeInfo.wcClientHeight=
oldClientHeight;if(!doNotRecurse)containers.push(obj)}else if(this.isObjectAContentFrame(obj))if(userAction&&userAction!="LOAD")obj.wcFrameView.refreshFrameView()}}if(lastVisibleFlexItem&&lastVisibleFlexItem._element)try{$(lastVisibleFlexItem._element).resizable("disable")}catch(err){}if(hasFixedFrames){var currentPos=0;var lastPercentObj=null;for(var i=children.length-1;i>=0;i--){var item=children[i];var obj=item.getChildren()[0];if(!obj.wcIsHidden){if(lastPercentObj)try{$(obj.wcFlexItem._element).resizable("disable")}catch(err){}lastPercentObj=
obj;if(!obj.wcFixed)break;if(isHorizontal){$(obj.wcFlexItem._element).css("left","");obj.wcFlexItem.setRight(currentPos);currentPos+=obj.wcFlexItem.getWidth()}else{$(obj.wcFlexItem._element).css("top","");obj.wcFlexItem.setBottom(currentPos);currentPos+=obj.wcFlexItem.getHeight()}}}if(lastPercentObj)lastPercentObj.doFlex();if(this.wcIsRoot)mf.wcNoMove=true;this.wcHasFixedFrames=hasFixedFrames}}if(containers.length>0)for(var i=0;i<containers.length;i++){var obj=containers[i];if(userAction=="HIDE")userAction=
"RESIZE";obj.adjustSizes(userAction)}}return true};
_p.adjustSizesShow=function(newContainerSize,actionFrame){var mf=this.wcMultiFrames;var isHorizontal=this.wcOrientation=="HORIZONTAL";var result=false;var visibleCount=0;var children=this.getChildren();if(children.length>1){var targetFrame=this.getNextObject(actionFrame,1);if(actionFrame&&actionFrame.wcContainer==this){if(!actionFrame.wcContainer.wcIsPersistent){var initialSize=actionFrame.wcSizeInfo.wcInitialSize;if(!targetFrame||targetFrame.wcIsHidden)targetFrame=this.getPreviousObject(actionFrame,
1);if(targetFrame&&!targetFrame.wcIsHidden){var targetSize=isHorizontal?targetFrame.getWidth():targetFrame.getHeight();var newFrameSize=initialSize?newContainerSize*(initialSize/100):targetSize;if(initialSize&&newFrameSize<targetSize-100){actionFrame.wcAdjustedSize=newFrameSize;targetFrame.wcAdjustedSize=targetSize-newFrameSize}else{newFrameSize=initialSize?targetSize*(initialSize/100):targetSize;if(initialSize&&newFrameSize<targetSize){actionFrame.wcAdjustedSize=newFrameSize;targetFrame.wcAdjustedSize=
targetSize-newFrameSize}else{actionFrame.wcAdjustedSize=parseInt(targetSize/2);targetFrame.wcAdjustedSize=parseInt(targetSize/2)}}}}for(var i=0;i<children.length;i++){var item=children[i];var obj=item.getChildren()[0];if(obj.wcSizeInfo&&!obj.wcIsHidden){visibleCount+=1;if(actionFrame.wcContainer.wcIsPersistent){var objSize=obj.wcSizeInfo.wcInitialSize;if(objSize)obj.wcAdjustedSize=newContainerSize*(objSize/100);else result=true}else if(obj!=actionFrame&&obj!=targetFrame)obj.wcAdjustedSize=isHorizontal?
obj.getWidth():obj.getHeight()}}if(visibleCount<=1)result=true}}else result=true;return result};
_p.adjustSizesShowParents=function(frame){var mf=this.wcMultiFrames;var isHorizontal=this.wcOrientation=="HORIZONTAL";var vContainer=this;while(vContainer&&vContainer.wcIsHidden)vContainer=vContainer.wcParentContainer;if(vContainer){var children=vContainer.getChildren();var vHorizontal=vContainer.wcOrientation=="HORIZONTAL";var vWidth=vContainer.getWidth();var vHeight=vContainer.getHeight();var vFramesCount=vContainer.getFramesCount(true);if(vFramesCount<1)vFramesCount=1;if(vHorizontal)vWidth=vWidth/
vFramesCount;else vHeight=vHeight/vFramesCount;for(var i=0;i<children.length;i++){var item=children[i];var obj=item.getChildren()[0];if(!obj.wcIsHidden)if(vHorizontal){obj.wcFlexItem.setWidth(vWidth);obj.wcSizeInfo.wcClientWidth=vWidth;obj.wcFlexItem._element.css("height","100%")}else{obj.wcFlexItem.setHeight(vHeight);obj.wcSizeInfo.wcClientHeight=vHeight;obj.wcFlexItem._element.css("width","100%")}}var container=this;while(container.wcIsHidden){container.wcIsHidden=false;container.setVisible(true);
var parentContainer=container.wcParentContainer;if(parentContainer){isHorizontal=parentContainer.wcOrientation=="HORIZONTAL";if(isHorizontal){container.wcFlexItem.setWidth(vWidth);container.wcSizeInfo.wcClientWidth=vWidth;container.wcFlexItem._element.css("height","100%")}else{container.wcFlexItem.setHeight(vHeight);container.wcSizeInfo.wcClientHeight=vHeight;container.wcFlexItem._element.css("width","100%")}}container=parentContainer}frame.wcIsHidden=false;frame.setVisible(true);isHorizontal=frame.wcContainer.wcOrientation==
"HORIZONTAL";if(isHorizontal){frame.wcFlexItem.setLeft(0);frame.wcFlexItem.setWidth(vWidth);frame.wcSizeInfo.wcClientWidth=vWidth;frame.wcFlexItem._element.css("height","100%")}else{frame.wcFlexItem.setTop(0);frame.wcFlexItem.setHeight(vHeight);frame.wcSizeInfo.wcClientHeight=vHeight;frame.wcFlexItem._element.css("width","100%")}vContainer.adjustSizes("REFRESH")}return};
_p.adjustSizesHide=function(visibleFramesCount,actionFrame){var mf=this.wcMultiFrames;var actionInfo=mf.wcActionInfo;var isHorizontal=this.wcOrientation=="HORIZONTAL";var useInitialSize=false;if(actionFrame)if(visibleFramesCount==2){var actionSize=isHorizontal?actionInfo.wcActionWidth:actionInfo.wcActionHeight;var otherFrame=null;var children=this.getChildren();for(var i=0;i<children.length;i++){var item=children[i];var obj=item.getChildren()[0];if(obj&&obj instanceof WcMultiframesContentFrame&&!obj.wcIsHidden&&
obj!=actionFrame)otherFrame=obj}var otherSize=isHorizontal?otherFrame.getWidth():otherFrame.getHeight();otherFrame.wcAdjustedSize=otherSize+actionSize+1}else if(actionFrame.wcContainer==this)useInitialSize=true;return useInitialSize};
_p.doFlex=function(){if(this.wcIsRoot)return;var totalSize=0;var container=this.wcParentContainer;var isHorizontal=container.wcOrientation=="HORIZONTAL";if(container.wcIsRoot)if(isHorizontal)totalSize=container.getWidth();else totalSize=container.getHeight();else{var containerItem=container.wcFlexItem;if(isHorizontal)totalSize=containerItem.getWidth();else totalSize=containerItem.getHeight()}var flexObj=this;setTimeout(function(){var otherSize=0;var children=container.getChildren();for(var i=0;i<
children.length;i++){var item=children[i];var obj=item.getChildren()[0];if(!obj.wcIsHidden&&obj!=flexObj)if(isHorizontal)otherSize+=item.getWidth();else otherSize+=item.getHeight()}var flexSize=totalSize-otherSize;if(flexSize>0)if(isHorizontal)flexObj.wcFlexItem.setWidth(flexSize);else flexObj.wcFlexItem.setHeight(flexSize);flexObj.adjustSizes("REFRESH",null)},100)};
_p.doSlideAnimation=function(frame,action){if(!frame.wcDoAnimation)return;var animationDone=frame.wcAnimationDone;if(animationDone){frame.wcAnimationDone=false;return false}var count=this.getFramesCount();if(count==2&&frame.wcFrameType=="single"){this.wcSlideFrame=frame;var cp=frame.getActiveContentPane();var cv=cp.wcContentView;this.wcSlideView=cv;var nextObj=this.getNextObject(frame);if(this.wcOrientation=="VERTICAL")if(nextObj)this.wcSlideDirection="DOWN";else this.wcSlideDirection="UP";else if(nextObj)this.wcSlideDirection=
"RIGHT";else this.wcSlideDirection="LEFT";if(action=="SHOW"){cv.wcInShowAnimation=true;cv.wcInHideAnimation=false;cp.setVisible(false);setTimeout(function(){var dir=this.wcSlideDirection;var view=this.wcSlideView;var cp=view.wcContentPane;if(dir=="DOWN"||dir=="UP"){var height=$(view._element).height();if(dir=="DOWN")height=-height;cp._element.css({"top":height+"px","display":""})}else{var width=$(view._element).width();if(dir=="RIGHT")width=-width;cp._element.css({"left":width+"px","display":""})}setTimeout(function(){var dir=
this.wcSlideDirection;var view=this.wcSlideView;var cp=view.wcContentPane;cp.setVisible(true);if(dir=="DOWN"||dir=="UP")cp._element.css({"transition":"top 250ms"});else cp._element.css({"transition":"left 250ms"});cp.doTriggerResize();setTimeout(function(){var view=this.wcSlideView;var cp=view.wcContentPane;if(dir=="DOWN"||dir=="UP")cp._element.css({"top":"0"});else cp._element.css({"left":"0"})}.bind(this),0)}.bind(this),0)}.bind(this),0)}else if(!this.wcIsHidden){cv.wcInHideAnimation=true;cv.wcInShowAnimation=
false;setTimeout(function(){var dir=this.wcSlideDirection;var view=this.wcSlideView;var cp=view.wcContentPane;cp.wcSlideFrame=frame;if(dir=="DOWN"||dir=="UP")cp._element.css({"transition":"top 250ms"});else cp._element.css({"transition":"left 250ms"});setTimeout(function(){var dir=this.wcSlideDirection;var view=this.wcSlideView;var cp=view.wcContentPane;if(dir=="DOWN"||dir=="UP"){var height=$(view._element).height();if(dir=="DOWN")height=-height;cp._element.css({"top":height+"px"})}else{var width=
$(view._element).width();if(dir=="RIGHT")width=-width;cp._element.css({"left":width+"px"})}}.bind(this),0)}.bind(this),0)}return true}return false};
function WcMultiframesContentFrame(mf,frameType){if(_wcconstructing)return;WcMultiframesFlexContainer.call(this,"vertical","WcMultiframesContentFrame");this._element.addClass("wcx-multiframes-frame");this.wcMultiFrames=mf;this.wcFrameType=frameType?frameType:"tab";this.wcFrameInfo={};this.wcFrameInfo.wcFrameID="";this.wcFrameInfo.wcFrameClass="";this.wcFrameInfo.wcFrameFlag=0;this.wcFrameInfo.wcRecentMode=0;this.wcSizeInfo={};this.wcSizeInfo.wcParsedWidth=null;this.wcSizeInfo.wcParsedHeight=null;
this.wcSizeInfo.wcInitialSize=null;this.wcSizeInfo.wcCurrentSize=null;this.wcSizeInfo.wcListPageSize=3;this.wcIsHidden=false;this.wcFrameBar=new WcMultiframesFrameBar(this);this.wcFrameBar.setVisible(!mf.wcNoMove);this.add(this.wcFrameBar);if(this.wcFrameType=="single")this.wcFrameView=new WcMultiframesSingleView(this);else if(this.wcFrameType=="list")this.wcFrameView=new WcMultiframesListView(this);else if(this.wcFrameType=="filters")this.wcFrameView=new WcMultiframesFiltersView(this);else this.wcFrameView=
new WcMultiframesTabbedView(this);this.wcFrameView=this.wcFrameView;this.add(this.wcFrameView);this.wcHighlighter=new WcxComponent(this,"WcHighlighter");this.wcHighlighter._element.addClass("wcx-mfhighlight");this.wcHighlighter.setVisible(false);this.add(this.wcHighlighter);this.wcContentPanes=[]}_p=wcInherit(WcMultiframesContentFrame,WcMultiframesFlexContainer);_p._dispose=_p.dispose;
_p.dispose=function(){var mf=this.wcMultiFrames;if(mf&&mf.wcMFBodyPanel)mf.wcMFBodyPanel.wcMFFramesToolbar.removeFramesToolbarBtn(this);this.removeAll();this._dispose.call(this)};
_p.addContent=function(contentInfo,beforeIndex,inParsing){var mf=this.wcMultiFrames;var container=this.wcContainer;var frameView=this.wcFrameView;var tabButton=null;var contentPane=null;this.wcActiveID=contentInfo.wcContentID;contentPane=frameView.addContentPane(contentInfo);contentPane.setTitleText(contentInfo.wcContentTitle,contentInfo.wcContentTooltip,contentInfo.wcContentSubtitle);var max=0;if(this.wcFrameInfo.wcRecentMode==0)max=wcMF.wcMaxContentPerFrame;else if(this.wcFrameInfo.wcRecentMode==
1)max=1;this.keepMaxContent(max);frameView.wcActiveContentPane=contentPane;frameView.refreshFrameView();return contentPane};_p.getContentCount=function(){var count=0;try{count=this.wcContentPanes.length}catch(err){}return count};
_p.getActiveContentPane=function(){var frameView=this.wcFrameView;var activeCP=frameView.wcActiveContentPane;if(activeCP&&activeCP._disposed)activeCP=null;if(!activeCP){var count=this.wcContentPanes?this.wcContentPanes.length:0;if(count>0)activeCP=this.wcContentPanes[count-1];frameView.wcActiveContentPane=activeCP}return activeCP};_p.getActiveContentInfo=function(){var cp=this.getActiveContentPane();if(cp)return cp.wcContentInfo;else return null};
_p.isFrameEmpty=function(){var count=this.getContentCount();return count>0?false:true};_p.hasOneEmptyContent=function(){var count=this.getContentCount();if(count==1){var cp=this.wcContentPanes[0];if(cp&&cp.wcIsEmpty)return true}return false};
_p.removeThisFrame=function(removeAction){var mf=this.wcMultiFrames;var bPersistentFrame=this.wcFrameInfo.wcFrameFlag&wcMF.frame.wcPersistentFrameFlag?true:false;if(removeAction&&bPersistentFrame)this.hide();else{var container=this.wcContainer;if(container){var index=mf.wcFramesList.indexOf(this);if(index>=0)mf.wcFramesList.splice(index,1);container.removeObject(this);container.adjustSizes("REMOVE");container.cleanOrphans();mf.adjustLayout(null,null);if(container.wcIsRoot&&container.getFramesCount()<=
1)container.wcOrientation="ROOT"}}};_p.removeContent=function(contentID,keepFrame,keepContent){var frameView=this.wcFrameView;if(!keepContent)frameView.removeContentPane(contentID);var count=this.getContentCount();if(count<1){if(!keepFrame)this.removeThisFrame()}else frameView.refreshFrameView()};
_p.removeAllContent=function(){var mf=this.wcMultiFrames;var contents=this.wcContentPanes;var contentIDs="";var doMultipleAsSingleAction=!mf.wcNoDragAndDropMode;for(var i=contents.length-1;i>=0;i--){var cp=contents[i];if(cp&&cp.doRemove(true,doMultipleAsSingleAction)){if(contentIDs!="")contentIDs+=",";contentIDs+=cp.wcContentInfo.wcContentID}}if(doMultipleAsSingleAction&&contentIDs!=""){var actionInfo=mf.wcActionInfo;actionInfo.wcDropValue="";actionInfo.wcContentValue=contentIDs;mf.sendUpdateLayout("REMOVE")}};
_p.removeOtherContent=function(contentPane){var contents=this.wcContentPanes;for(var i=contents.length-1;i>=0;i--){var cp=contents[i];if(cp&&cp!=contentPane){var contentID=cp.wcContentInfo?cp.wcContentInfo.wcContentID:null;if(contentID)this.removeContent(contentID)}}};_p.removeContentToTheRight=function(contentPane){var contents=this.wcContentPanes;for(var i=contents.length-1;i>=0;i--){var cp=contents[i];if(cp&&cp!=contentPane){var contentID=cp.wcContentInfo?cp.wcContentInfo.wcContentID:null;if(contentID)this.removeContent(contentID)}else break}};
_p.keepMaxContent=function(max){if(this.wcFrameType=="filters")return;if(max>0){var count=this.wcContentPanes.length;while(count>max){var cp=this.wcContentPanes[0];this.removeContent(cp.wcContentInfo.wcContentID);if(this.wcContentPanes.length==count)break;count=this.wcContentPanes.length}}};
_p.hide=function(){var mf=this.wcMultiFrames;var container=this.wcContainer;if(mf.wcNoDragAndDropMode)if(!container.doSlideAnimation(this,"HIDE")){var wasHidden=this.wcIsHidden;this.wcIsHidden=true;this.setVisible(false);this.wcFrameView.refreshFrameView();if(!mf.wcParsingLayout){if(container){mf.wcActionInfo.wcActionWidth=this.getWidth();mf.wcActionInfo.wcActionHeight=this.getHeight();this.wcSizeInfo.wcClientHeight=0;this.wcSizeInfo.wcClientWidth=0;container.adjustSizes("HIDE",null,this)}if(wcMF.wcShowFramesToolbarMode!=
1)mf.updateFramesToolbar();if(container)if(container.wcIsPersistent)container.createBlankFrame();else if(container.getFramesCount(true)<=0){container.wcIsHidden=true;if(!container.wcIsRoot)container.setVisible(false);container.adjustSizes("RESIZE")}this.doFrameResize();mf.wcRootContainer.adjustSizes("REFRESH");var visibleFramesCount=container.getFramesCount(true);if(visibleFramesCount==0)mf.doMultiFrameResize()}}};
_p.show=function(userAction){var mf=this.wcMultiFrames;var container=this.wcContainer;if(container&&container.wcIsPersistent){if(container.wcBlankFrame){container.wcBlankFrame.removeThisFrame();delete container.wcBlankFrame}var isHorizontal=container.wcOrientation=="HORIZONTAL";$(this.wcFlexItem._element).css(isHorizontal?"height":"width","100%")}var wasHidden=this.wcIsHidden;this.wcIsHidden=false;this.setVisible(true);if(wasHidden)this.wcFrameView.refreshFrameView();if(!mf.wcParsingLayout){container.doSlideAnimation(this,
"SHOW");container.adjustSizes(userAction,null,this);if(wasHidden){while(container!=mf.wcRootContainer){container.wcIsHidden=false;container.setVisible(true);container=container.wcParentContainer}mf.adjustLayout("REFRESH",null);if(mf.wcFramesList)for(var i=0;i<mf.wcFramesList.length;i++){var frame=mf.wcFramesList[i];if(frame)frame.doFrameResize()}if(this.wcFrameType=="filters")setTimeout(function(){mf.adjustLayout("REFRESH",null)},0);else mf.wcRootContainer.adjustSizes("RESIZE")}var delayLoad=this.wcDelayLoad;
this.wcDelayLoad=false;for(var i=0;i<this.wcContentPanes.length;i++){var cp=this.wcContentPanes[i];if(cp){if(delayLoad)cp.doRefresh(true);if(!cp.wcIsHidden)cp.doTriggerResize()}}}if(wcMF.wcShowFramesToolbarMode!=1)mf.updateFramesToolbar()};_p.reopen=function(){var mf=this.wcMultiFrames;this.show("SHOW");mf.adjustLayout(null,null);mf.sendUpdateLayout("RESIZE")};_p.toggle=function(){var mf=this.wcMultiFrames;if(this.wcIsHidden)this.show("SHOW");else this.hide();mf.sendUpdateLayout("RESIZE")};
_p.moveContent=function(contentID,targetFrame,moveType,dropPosition){var mf=this.wcMultiFrames;var sourceContainer=this.wcContainer;var parentContainer=sourceContainer?sourceContainer.wcParentContainer:null;if(sourceContainer)sourceContainer.wcIsPersistent=false;var hadSourceID=!this.wcFrameInfo.wcNotServerID?true:false;var hadTargetID=targetFrame?!targetFrame.wcFrameInfo.wcNotServerID?true:false:false;var keepFrame=hadSourceID&&hadTargetID;if(!targetFrame){var frameType=this.wcFrameType;targetFrame=
mf.createFrame(frameType,contentID,false,contentID?"#FFFFFF":"#494949");targetFrame.wcFrameType=frameType;targetFrame.wcFrameInfo.wcFrameClass=this.wcFrameInfo.wcFrameClass;targetFrame.wcFrameInfo.wcNotServerID=true}if(moveType=="frame"||this.getContentCount()<=1)if(targetFrame.wcFrameInfo.wcNotServerID){targetFrame.wcFrameInfo.wcFrameID=this.wcFrameInfo.wcFrameID;targetFrame.wcFrameInfo.wcNotServerID=this.wcFrameInfo.wcNotServerID;targetFrame.wcFrameInfo.wcFrameFlag=this.wcFrameInfo.wcFrameFlag;
targetFrame.wcFrameInfo.wcFrameLabel=this.wcFrameInfo.wcFrameLabel}if(contentID){var view=this.cutContentView(contentID,keepFrame);targetFrame.pasteContentView(view,dropPosition);this.wcContainer.adjustSizes("MOVE");var contents=this.wcContentPanes;if(contents)if(moveType=="frame")while(contents&&contents.length>0){var cp=contents[0];contentID=cp.wcContentInfo.wcContentID;var lengthBefore=contents.length;view=this.cutContentView(contentID);targetFrame.pasteContentView(view);var lengthAfter=contents.length;
if(lengthAfter>=lengthBefore)break}}else if(moveType=="frame"&&this.isFrameEmpty())this.removeThisFrame();if(sourceContainer&&parentContainer){var parent=null;if(sourceContainer.getFramesCount()>0)parent=parentContainer;else if(parentContainer&&parentContainer.getFramesCount(true)==0)parent=parentContainer.wcParentContainer;if(parent)parent.adjustSizes("MOVE")}return targetFrame};
_p.cutContentView=function(contentID,keepFrame){var mf=this.wcMultiFrames;var cp=mf.getContentPaneByID(contentID);if(cp){var view=cp.wcContentView;var item=cp.wcContentItem;if(this.wcFrameType=="filters")cp.wcContentItem.saveFilterText();this.wcFrameView.cutContentItem(item);var count=this.getContentCount();var isTemplateFrame=this.wcFrameInfo.wcIsTemplate;if(isTemplateFrame&&count<1)keepFrame=true;this.removeContent(contentID,keepFrame,true);if(isTemplateFrame&&keepFrame)if(this.wcFrameType=="tab"){var cp=
this.wcFrameView.doAddNewTab();cp.setVisible(true);cp.wcContentView.setVisible(true);cp.wcContentItem.setVisible(true)}return view}};
_p.pasteContentView=function(view,beforeIndex){var mf=this.wcMultiFrames;var frameView=this.wcFrameView;var contentPane=view.wcContentPane;var contentInfo=contentPane.wcContentInfo;this.wcActiveID=contentInfo.wcContentID;var contentItem=null;var contentPanes=this.wcContentPanes;if(!mf.wcNoDragAndDropMode&&this.hasOneEmptyContent()){var oldContentView=contentPanes[0].wcContentView;contentItem=oldContentView.wcContentItem;oldContentView.dispose();contentPanes[0]=contentPane}else{contentItem=new WcMultiframesContentItem(frameView,
contentInfo,true);frameView.addContentItem(contentItem,contentInfo);contentPanes.push(contentPane)}contentItem.wcContentView=view;contentItem.wcContentPane=contentPane;if(this.wcFrameType=="filters")contentItem.loadFilterText();view.wcContentItem=contentItem;view.wcContentFrame=this;view.wcHoverTab.wcContentFrame=this;contentPane.wcContentItem=contentItem;contentPane.wcFrameView=frameView;contentPane.wcContentFrame=this;contentPane.setTitleText(contentInfo.wcContentTitle,contentInfo.wcContentTooltip,
contentInfo.wcContentSubtitle);frameView.wcActiveContentPane=contentPane;frameView.refreshFrameView();contentPane.wcContentItem.setVisible(true);contentPane.wcContentView.setVisible(true);contentPane.wcContentView.doRefresh()};_p.doViewMostRecent=function(){this.wcFrameInfo.wcRecentMode=1;this.keepMaxContent(1)};_p.doViewRecentMax=function(){this.wcFrameInfo.wcRecentMode=0;this.keepMaxContent(wcMF.wcMaxContentPerFrame)};_p.doViewAll=function(){this.wcFrameInfo.wcRecentMode=2;this.keepMaxContent(0)};
_p.doSwitchView=function(newFrameView){var mf=this.wcMultiFrames;var oldFrameView=this.wcFrameView;var oldCPs=oldFrameView.wcContentFrame.wcContentPanes;newFrameView.wcContentFrame.wcContentPanes=[];while(oldCPs.length>0){var cp=oldCPs[0];cp.wcFrameView=newFrameView;var item=cp.wcContentItem;item.wcFrameView=newFrameView;oldFrameView.removeContentItem(item,true);newFrameView.addContentItem(item,cp.wcContentInfo);oldCPs.splice(0,1);newFrameView.wcContentFrame.wcContentPanes.push(cp)}newFrameView.updateViewItems();
this.remove(oldFrameView);oldFrameView.dispose();this.add(newFrameView);this.wcFrameView=newFrameView;this.doFrameResize()};_p.doViewAsTabs=function(){this.wcFrameType="tab";this.doSwitchView(new WcMultiframesTabbedView(this))};_p.doViewAsList=function(orientation){this.wcFrameType="list";this.doSwitchView(new WcMultiframesListView(this,orientation))};
_p.doViewAsFilters=function(){this.wcFrameType="filters";this.wcContainer.adjustSizes("INITIAL_FILTERS",true);this.wcMultiFrames.adjustLayout("REFRESH",null);this.doSwitchView(new WcMultiframesFiltersView(this))};_p.doViewAutoOrientation=function(){this.doViewAsList("")};_p.doViewHorizontally=function(){this.doViewAsList("HORIZONTAL")};_p.doViewVertically=function(){this.doViewAsList("VERTICAL")};
_p.doFrameResize=function(){var mf=this.wcMultiFrames;if(mf.wcMaximized)return;var frameView=this.wcFrameView;var frameType=this.wcFrameType;if(frameType=="list"&&frameView.wcSetOrientation==""){var oldOrientation=frameView.wcOrientation;var newOrientation=oldOrientation;var frameHeight=this.getHeight();var frameWidth=this.getWidth();if(frameWidth>frameHeight)newOrientation="HORIZONTAL";else newOrientation="VERTICAL";if(oldOrientation!=newOrientation)frameView.changeOrientation(newOrientation)}frameView.refreshFrameView()};
_p.doHighlight=function(visible){this.wcHighlighter.setVisible(visible)};
_p.doFlex=function(){var container=this.wcContainer;var containerItem=container.wcFlexItem;if(containerItem){var flexObj=this;var isHorizontal=this.wcOrientation=="HORIZONTAL";setTimeout(function(){var totalSize=0;if(isHorizontal)totalSize=containerItem.getWidth();else totalSize=containerItem.getHeight();var otherSize=0;var children=container.getChildren();for(var i=0;i<children.length;i++){var item=children[i];var obj=item.getChildren()[0];if(!obj.wcIsHidden&&obj!=flexObj)if(isHorizontal)otherSize+=
item.getWidth();else otherSize+=item.getHeight()}var flexSize=totalSize-otherSize;if(flexSize>0)if(isHorizontal)flexObj.wcFlexItem.setWidth(flexSize);else flexObj.wcFlexItem.setHeight(flexSize);flexObj.wcFrameView.refreshFrameView()},100)}};_p.doCloseAllPopups=function(){var contents=this.wcContentPanes;for(var i=contents.length-1;i>=0;i--){var cp=contents[i];if(cp){var ci=cp.wcContentItem;if(ci&&ci.wcPopup)ci.wcPopup._element.ibxWidget("close")}}};
function WcMultiframesFrameBar(frame){if(_wcconstructing)return;WcxComponent.call(this,"WcMultiframesFrameBar");this._element.addClass("wcx-multiframes-framebar");this.wcContentFrame=frame;this.addEventListener("mouseover",this.doMouseOver,this);this.addEventListener("mouseout",this.doMouseOut,this);this.addEventListener("mousedown",this.doMouseDown,this)}_p=wcInherit(WcMultiframesFrameBar,WcxComponent);_p.setHighlight=function(highlight){this._element.css("background-color",highlight?"#fbe999":"")};
_p.doMouseOver=function(e){var mf=this.wcContentFrame.wcMultiFrames;if(mf.wcMaximized)return;if(mf.wcInMultiFrame&&mf.wcInMultiFrame.wcMaximized)return;if(mf.wcInMultiFrame&&!mf.wcNotRestricted)return;var y=e.pageY-$(this._element).offset().top;if(y<=5){this.setHighlight(true);this.setCursor("move")}};_p.doMouseOut=function(e){this.setHighlight(false);this.setCursor("")};
_p.doMouseDown=function(e){if(e){var frame=this.wcContentFrame;var mf=frame.wcMultiFrames;mf.doDragStart(e,"frame",frame);e.stopPropagation();e.preventDefault()}};function WcMultiframesBaseFrameView(objtype){if(_wcconstructing)return;if(!objtype)objtype="WcMultiframesBaseFrameView";WcxComponent.call(this,objtype);this._element.addClass("wcx-multiframes-frame-view");this.setTop(5);this.setLeft(0);this.setRight(0);this.setBottom(0);this._element.css("position","absolute")}
WcMultiframesBaseFrameView.wcMinimizeSize=100;_p=wcInherit(WcMultiframesBaseFrameView,WcxComponent);_p.addContentItem=function(contentItem,contentInfo){this.add(contentItem)};_p.removeContentItem=function(contentItem,detachOnly){var frame=this.wcContentFrame;var contentPane=contentItem.wcContentPane;if(contentPane&&!detachOnly){index=frame.wcContentPanes.indexOf(contentPane);if(index>=0)frame.wcContentPanes.splice(index,1)}if(contentItem)this.remove(contentItem)};
_p.cutContentItem=function(contentItem){var mf=this.wcMultiFrames;var frame=this.wcContentFrame;var cp=contentItem.wcContentPane;if(cp){index=frame.wcContentPanes.indexOf(cp);if(index>=0)frame.wcContentPanes.splice(index,1)}if(contentItem){contentItem.wcContentView=null;contentItem.wcContentPane=null;this.remove(contentItem);contentItem.dispose()}};
_p.getContentPane=function(contentID){var frame=this.wcContentFrame;var contentPane=null;var contentInfo=frame.getActiveContentInfo();if(!contentID&&contentInfo)contentID=contentInfo.wcContentID;if(!contentID)contentID=frame.wcActiveID;if(contentID)for(var i=0;i<frame.wcContentPanes.length;i++){var cp=frame.wcContentPanes[i];if(cp&&cp.wcContentInfo.wcContentID==contentID)return cp}return null};
_p.addContentPane=function(contentInfo){var mf=this.wcMultiFrames;var frame=this.wcContentFrame;var contentItem=new WcMultiframesContentItem(this,contentInfo);var contentPane=contentItem.wcContentPane;contentPane.wcContentInfo=contentInfo;frame.wcContentPanes.push(contentPane);mf.wcContentsList.push(contentPane);this.addContentItem(contentItem,contentInfo);return contentPane};
_p.removeContentPane=function(contentID){var mf=this.wcMultiFrames;var frame=this.wcContentFrame;var contentPane=this.getContentPane(contentID);var wasMaximized=mf.wcMaximized==contentPane;if(wasMaximized)mf.wcMaximized.doRestore();if(contentPane){contentPane.setVisible(false);var contentView=contentPane.wcContentView;if(contentView)contentView.setVisible(false);var contentItem=contentPane.wcContentItem;if(contentItem){contentItem.setVisible(false);this.removeContentItem(contentItem,false);contentItem.dispose();
if(contentView)contentView.dispose();this.refreshFrameView()}if(contentPane){var index=mf.wcContentsList.indexOf(contentPane);if(index>=0)mf.wcContentsList.splice(index,1);contentView=contentPane.wcContentView;if(contentView)contentView.dispose}}if(wasMaximized){var cp=frame.getActiveContentPane();if(cp)cp.doMaximize()}};
_p.updateContentPane=function(){var frame=this.wcContentFrame;if(frame.wcFrameType=="tab"){var contentPane=this.getContentPane();var items=this.getChildren();for(var i=0;i<items.length;i++){var ci=items[i];var cv=ci.wcContentView;var cp=ci.wcContentPane;ci.setVisible(cp==contentPane);cv.setVisible(cp==contentPane)}}};
_p.updateViewItems=function(){var frame=this.wcContentFrame;var frameWidth=frame.getWidth();var frameHeight=frame.getHeight();var items=this.getChildren();for(var i=0;i<items.length;i++){var obj=items[i];if(obj._objtype=="WcMultiframesContentItem"){obj.setTop(0);obj.setLeft(0);obj.setWidth(frameWidth);obj.setHeight(frameHeight);obj._element.css("position","absolute");obj.setVisible(true);var cp=obj.wcContentPane;var contentInfo=cp.wcContentInfo;cp.wcContentItem.setVisible(this.wcContentFrame.wcActiveID==
contentInfo.wcContentID)}}};_p.refreshFrameView=function(){var mf=this.wcMultiFrames;var frame=this.wcContentFrame;var items=this.getChildren();if(items)for(var i=0;i<items.length;i++){var ci=items[i];if(ci._objtype&&ci._objtype=="WcMultiframesContentItem"){ci.setTop(0);ci.setLeft(0);ci.setRight(0);ci.setBottom(0);var cv=ci.wcContentView;if(!mf.wcMaximized){ci.setVisible(false);if(cv){ci.setVisible(!frame.wcIsHidden);cv.wcIsHidden=frame.wcIsHidden}}if(cv){var cp=cv.wcContentPane;if(cp&&!cp.IsLoading)cv.doRefresh()}}}};
_p.addContentMenu=function(menu){var mf=this.wcMultiFrames;var cp=menu.wcContentPane;var contentInfo=cp.wcContentInfo;var isEmpty=contentInfo.wcData=="";if(contentInfo.wcAllowRefresh){menu.wcRefreshBtn=new WcxMenuItem(ibx.resourceMgr.getString("refresh"));menu.wcRefreshBtn.setEnabled(!isEmpty);menu.wcRefreshBtn.addEventListener("click",cp.doRefresh,cp);menu.addItem(menu.wcRefreshBtn)}var noMaximize=mf.wcMaximized||mf.wcInMultiFrame&&mf.wcInMultiFrame.wcMaximized;if(isEmpty)noMaximize=true;menu.wcMaximizeBtn=
new WcxMenuItem(ibx.resourceMgr.getString("maximize"));menu.wcMaximizeBtn.setEnabled(!noMaximize);menu.wcMaximizeBtn.addEventListener("click",cp.doMaximize,cp);menu.addItem(menu.wcMaximizeBtn)};
_p.addCloseMenu=function(menu){var mf=this.wcMultiFrames;var cp=menu.wcContentPane;var contentInfo=cp.wcContentInfo;var flags=contentInfo.wcOptionsFlag;var cannotClose=flags&wcMF.content.wcCannotClose;menu.wcRemoveBtn=new WcxMenuItem(ibx.resourceMgr.getString("close"));menu.wcRemoveBtn.setEnabled(!cannotClose);menu.wcRemoveBtn.addEventListener("click",function(){cp.doRemove(true)},cp);menu.addItem(menu.wcRemoveBtn)};
_p.addCloseAllMenu=function(menu){var mf=this.wcMultiFrames;var frame=this.wcContentFrame;var count=frame.getContentCount();if(count>1){menu.wcRemoveAllBtn=new WcxMenuItem(ibx.resourceMgr.getString("closeall"));menu.wcRemoveAllBtn.addEventListener("click",frame.removeAllContent,frame);menu.addItem(menu.wcRemoveAllBtn)}};
_p.addFrameMenu=function(menu){var mf=this.wcMultiFrames;var frame=this.wcContentFrame;var count=frame.getContentCount();if(mf.wcNoDragAndDropMode);else{var allEmpty=true;if(mf.wcContentsList.length>0)for(var i=0;i<mf.wcContentsList.length;i++){var cp=mf.wcContentsList[i];if(!cp.wcIsEmpty){allEmpty=false;break}}if(allEmpty){menu.addItem(new WcxMenuSeparator);menu.wcSelectTemplateBtn=new WcxMenuItem(ibx.resourceMgr.getString("select_template"));menu.wcSelectTemplateBtn.addEventListener("click",mf.doShowTemplateSelector,
mf);menu.addItem(menu.wcSelectTemplateBtn)}}};
_p.addViewAsMenu=function(menu){var frame=this.wcContentFrame;var flags=frame.wcFrameInfo.wcFrameFlag;if(flags&wcMF.frame.wcNoSwitchViewFlag)return;var isList=frame.wcFrameType=="list";var isHorizontal=false;var isVertical=false;if(isList){isHorizontal=this.wcSetOrientation=="HORIZONTAL"?true:false;isVertical=this.wcSetOrientation=="VERTICAL"?true:false}menu.addItem(new WcxMenuSeparator);menu.wcViewFrameAs=new WcxMenuItem(ibx.resourceMgr.getString("view_frame_as"));var viewFrameAsMenu=new WcxMenu;
menu.wcViewFrameAs.addSubMenu(viewFrameAsMenu);menu.addItem(menu.wcViewFrameAs);menu.wcViewAsTabs=new WcxMenuItem(ibx.resourceMgr.getString("view_as_tabs"));menu.wcViewAsTabs.addEventListener("click",frame.doViewAsTabs,frame);menu.wcViewAsTabs.setHighlighted(!isList);viewFrameAsMenu.addItem(menu.wcViewAsTabs);menu.wcViewAsList=new WcxMenuItem(ibx.resourceMgr.getString("view_as_list"));menu.wcViewAsList.addEventListener("click",frame.doViewAutoOrientation,frame);menu.wcViewAsList.setHighlighted(isList);
viewFrameAsMenu.addItem(menu.wcViewAsList);if(frame.wcFrameType=="list"){viewFrameAsMenu.addItem(new WcxMenuSeparator);menu.wcViewAutoOrientation=new WcxMenuItem(ibx.resourceMgr.getString("set_orientation"));menu.wcViewAutoOrientation.addEventListener("click",frame.doViewAutoOrientation,frame);menu.wcViewAutoOrientation.setHighlighted(isList&&!isHorizontal&&!isVertical);viewFrameAsMenu.addItem(menu.wcViewAutoOrientation);menu.wcViewHorizontally=new WcxMenuItem(ibx.resourceMgr.getString("arrange_hori"));
menu.wcViewHorizontally.addEventListener("click",frame.doViewHorizontally,frame);menu.wcViewHorizontally.setHighlighted(isList&&isHorizontal);viewFrameAsMenu.addItem(menu.wcViewHorizontally);menu.wcViewVertically=new WcxMenuItem(ibx.resourceMgr.getString("arrange_vert"));menu.wcViewVertically.addEventListener("click",frame.doViewVertically,frame);menu.wcViewVertically.setHighlighted(isList&&isVertical);viewFrameAsMenu.addItem(menu.wcViewVertically)}};
_p.addViewRecentMenu=function(menu){var frame=this.wcContentFrame;var count=frame.wcContentPanes.length;if(count<=1)menu.addItem(new WcxMenuSeparator);menu.wcKeepRecent=new WcxMenuItem(ibx.resourceMgr.getString("keep_recent"));var keepRecentMenu=new WcxMenu;menu.wcKeepRecent.addSubMenu(keepRecentMenu);menu.addItem(menu.wcKeepRecent);menu.wcMostRecent=new WcxMenuItem(ibx.resourceMgr.getString("view_most_recent"));menu.wcMostRecent.addEventListener("click",frame.doViewMostRecent,frame);menu.wcMostRecent.setHighlighted(frame.wcFrameInfo.wcRecentMode==
1);keepRecentMenu.addItem(menu.wcMostRecent);menu.wcRecentMax=new WcxMenuItem(ibx.resourceMgr.getString("view_maximum_set")+" ("+wcMF.wcMaxContentPerFrame+")");menu.wcRecentMax.addEventListener("click",frame.doViewRecentMax,frame);menu.wcRecentMax.setHighlighted(frame.wcFrameInfo.wcRecentMode==0);keepRecentMenu.addItem(menu.wcRecentMax);menu.wcViewAll=new WcxMenuItem(ibx.resourceMgr.getString("view_all"));menu.wcViewAll.addEventListener("click",frame.doViewAll,frame);menu.wcViewAll.setHighlighted(frame.wcFrameInfo.wcRecentMode==
2);keepRecentMenu.addItem(menu.wcViewAll)};
_p.addLayoutMenu=function(menu){var mf=this.wcMultiFrames;var frame=this.wcContentFrame;if(frame.wcFrameInfo.wcFrameID=="MFFFrame"){menu.wcViewAsFiltersMenuSeparator=new WcxMenuSeparator;menu.addItem(menu.wcViewAsFiltersMenuSeparator);menu.wcViewAsFilters=new WcxMenuItem("Switch to pop-up filters (Experimental)");menu.wcViewAsFilters.addEventListener("click",frame.doViewAsFilters,frame);menu.addItem(menu.wcViewAsFilters)}menu.wcLayoutMenuSeparator=new WcxMenuSeparator;menu.addItem(menu.wcLayoutMenuSeparator);
menu.wcLayoutOptions=new WcxMenuItem(ibx.resourceMgr.getString("layout_options"));var layoutOptionsMenu=new WcxMenu;menu.wcLayoutOptions.addSubMenu(layoutOptionsMenu);menu.addItem(menu.wcLayoutOptions);layoutOptionsMenu.wcHoverTab=new WcxMenuItem(ibx.resourceMgr.getString("mfo_hover_tab"));var hoverTabMenu=new WcxMenu;layoutOptionsMenu.wcHoverTab.addSubMenu(hoverTabMenu);layoutOptionsMenu.addItem(layoutOptionsMenu.wcHoverTab);layoutOptionsMenu.wcMaxContent=new WcxMenuItem(ibx.resourceMgr.getString("mfo_max_content"));
var maxContentMenu=new WcxMenu;layoutOptionsMenu.wcMaxContent.addSubMenu(maxContentMenu);layoutOptionsMenu.addItem(layoutOptionsMenu.wcMaxContent);hoverTabMenu.wcAboveContent=new WcxMenuItem(ibx.resourceMgr.getString("mfo_above_content"));hoverTabMenu.wcAboveContent.wcValue=false;hoverTabMenu.wcAboveContent.wcMultiFrames=mf;hoverTabMenu.wcAboveContent.addEventListener("click",mf.doMFOption_HoverTab,hoverTabMenu.wcAboveContent);hoverTabMenu.wcAboveContent.setHighlighted(!wcMF.wcHeaderLocation);hoverTabMenu.addItem(hoverTabMenu.wcAboveContent);
hoverTabMenu.wcOnTopOfContent=new WcxMenuItem(ibx.resourceMgr.getString("mfo_on_top_of_content"));hoverTabMenu.wcOnTopOfContent.wcValue=true;hoverTabMenu.wcOnTopOfContent.wcMultiFrames=mf;hoverTabMenu.wcOnTopOfContent.addEventListener("click",mf.doMFOption_HoverTab,hoverTabMenu.wcOnTopOfContent);hoverTabMenu.wcOnTopOfContent.setHighlighted(wcMF.wcHeaderLocation);hoverTabMenu.addItem(hoverTabMenu.wcOnTopOfContent);var maxArray=[2,3,4,5,10,20,30,40,50];for(var i=0;i<maxArray.length;i++){var max=maxArray[i];
var maxContent=new WcxMenuItem(""+max);maxContent.wcValue=max;maxContent.wcMultiFrames=mf;maxContent.addEventListener("click",mf.doMFOption_MaxContent,maxContent);maxContent.setHighlighted(wcMF.wcMaxContentPerFrame==max);maxContentMenu.addItem(maxContent)}menu.wcShowTreeBtn=new WcxMenuItem(ibx.resourceMgr.getString("layout_tree")+"...");menu.wcShowTreeBtn.wcContentPane=menu.wcContentPane;menu.wcShowTreeBtn.addEventListener("click",mf.doShowLayoutTree,mf);menu.addItem(menu.wcShowTreeBtn)};
function WcMultiframesSingleView(contentFrame){if(_wcconstructing)return;WcMultiframesBaseFrameView.call(this,"WcMultiframesSingleView");this._element.removeClass("wcx-multiframes-tabbed-frame");this._element.addClass("wcx-multiframes-single-frame");this.wcContentFrame=contentFrame;var mf=this.wcMultiFrames=contentFrame.wcMultiFrames;this.setTop(mf.wcNoContentMove?0:5);this.wcSingleHeader=new WcMultiframesSingleHeader(this);this.add(this.wcSingleHeader)}_p=wcInherit(WcMultiframesSingleView,WcMultiframesBaseFrameView);
_p._addContentPane=_p.addContentPane;_p.addContentPane=function(contentInfo){var frame=this.wcContentFrame;var cp=null;var contentPanes=frame.wcContentPanes;if(contentPanes.length>0){cp=contentPanes[0];var contentID=cp.wcContentInfo.wcContentID;cp.wcContentInfo=contentInfo;cp.wcContentInfo.wcContentID=contentID}else cp=this._addContentPane.call(this,contentInfo);this.wcActiveContentPane=cp;return cp};_p.addFrameMenu=function(menu){};_p._refreshFrameView=_p.refreshFrameView;
_p.refreshFrameView=function(){this._refreshFrameView.call(this);var mf=this.wcMultiFrames;var frame=this.wcContentFrame;this.setTop(mf.wcNoContentMove?0:5);var items=this.getChildren();if(items)for(var i=0;i<items.length;i++){var ci=items[i];if(ci._objtype&&ci._objtype=="WcMultiframesContentItem"){var cv=ci.wcContentView;if(cv){var cp=cv.wcContentPane;if(cp){frame.wcFrameView.wcSingleHeader.setVisible(frame.wcShowHeader);ci.setTop(frame.wcShowHeader?40:0);if(!cp.IsLoading)cv.doRefresh();return}}}}};
function WcMultiframesSingleHeader(singleView){if(_wcconstructing)return;WcxComponent.call(this,"WcMultiframesSingleHeader");this._element.addClass("wcx-multiframes-single-header");var frame=singleView.wcContentFrame;this.wcSingleView=singleView;$(this._element).css("height","39px");$(this._element).css("background-color","rgb(250, 250, 250)");$(this._element).css("border-bottom","1px solid rgb(218, 218, 218)");this.wcSingleToolbar=new WcxHBox;this.wcSingleToolbar.setTop(0);this.wcSingleToolbar.setLeft(5);
this.wcSingleToolbar.setRight(0);this.wcSingleToolbar.setBottom(0);this.add(this.wcSingleToolbar);var text="";if(frame&&frame.wcFrameInfo)text=frame.wcFrameInfo.wcFrameLabel;this.wcTitle=new WcxLabel(text);this.wcTitle._element.css("position","absolute");this.wcTitle.setTop(2);this.wcTitle.setLeft(0);this.wcTitle.setRight(20);this.wcSingleToolbar.add(this.wcTitle);this.wcMaximizeBtn=new wcCreateIconButton({"icon":"ds-icon-expand"});this.wcMaximizeBtn._element.css({"position":"absolute","right":"40px",
"padding":"12px","border-left":"1px solid rgb(218, 218, 218)"});this.wcMaximizeBtn.setRight(40);this.wcMaximizeBtn._setQaAttr("Maximize");this.wcMaximizeBtn.setEnabled(true);this.wcMaximizeBtn.addEventListener("click",this.doMaximizeBtnClick,this);this.wcSingleToolbar.add(this.wcMaximizeBtn);this.wcMenuBtn=new wcCreateIconButton({"icon":"ds-icon-setting"});this.wcMenuBtn._element.css({"position":"absolute","right":"0","padding":"12px","border-left":"1px solid rgb(218, 218, 218)"});this.wcMenuBtn._setQaAttr("Menu");
this.wcMenuBtn.setEnabled(true);this.wcMenuBtn.addEventListener("click",this.doMenuBtnClick,this);this.wcSingleToolbar.add(this.wcMenuBtn)}_p=wcInherit(WcMultiframesSingleHeader,WcxComponent);_p.doMaximizeBtnClick=function(e){var frame=this.wcSingleView.wcContentFrame;if(frame){var cp=frame.getActiveContentPane();if(cp)cp.doMaximize()}};
_p.doMenuBtnClick=function(e){var frame=this.wcSingleView.wcContentFrame;if(frame){var cp=frame.getActiveContentPane();var cv=cp?cp.wcContentView:null;var ht=cv?cv.wcHoverTab:null;if(ht){var loc=e.currentTarget;loc.wcContextClick=true;ht.doHoverMenuBtnClick(loc)}}};
function WcMultiframesTabbedView(contentFrame){if(_wcconstructing)return;WcMultiframesBaseFrameView.call(this,"WcMultiframesTabbedView");this._element.addClass("wcx-multiframes-tabbed-frame");this.wcContentFrame=contentFrame;var mf=this.wcMultiFrames=contentFrame.wcMultiFrames;this.setTop(mf.wcNoContentMove?0:5);this.wcTabPane=new WcxTabPane;var frame=contentFrame;var tp=this.wcTabPane;tp.addEventListener("ibx_change",function(evt,selected){if(selected&&typeof selected.style==="object"){var cp=$(selected).data("wcContentItem").wcContentPane;
if(cp&&frame){frame.wcFrameView.wcActiveContentPane=cp;frame.wcActiveID=cp.wcContentInfo.wcContentID;if(frame.wcFrameView)frame.wcFrameView.refreshFrameView()}}},tp);this.wcTabPane._element.addClass("wcx-tab-pane");this.wcTabPane._element.css("width","100%");this.wcTabPane._element.css("height","100%");this.add(this.wcTabPane)}_p=wcInherit(WcMultiframesTabbedView,WcMultiframesBaseFrameView);_p._addContentItem=_p.addContentItem;
_p.addContentItem=function(contentItem,contentInfo){var frame=this.wcContentFrame;var tabPage=new WcxTabPage(contentInfo.wcContentID);$(tabPage._element).data("wcContentItem",contentItem);$(tabPage._element).data("wcContentFrame",frame);this.wcTabPane.addPage(tabPage,true);contentItem.wcTabPage=tabPage;tabPage.addClickEventListenerToCloseButton(this.doTabClose,contentItem);tabPage.add(contentItem);var tabButton=tabPage.getInstance()._tabButton;tabButton.addClass("wcx-cursor-contextmenu");tabPage.addEventListenerToTabButton("contextmenu",
function(e){var el=e.currentTarget;var cv=contentItem?contentItem.wcContentView:null;var wcHoverTab=cv?cv.wcHoverTab:null;if(wcHoverTab){e.wcContextClick=true;e.wcContextComponent=e.currentTarget;wcHoverTab.doHoverMenuBtnClick(e)}})};_p._removeContentItem=_p.removeContentItem;_p.removeContentItem=function(contentItem,detachOnly){if(contentItem){this._removeContentItem.call(this,contentItem,detachOnly);var tabPage=contentItem.wcTabPage;this.wcTabPane.removePage(tabPage)}};_p._cutContentItem=_p.cutContentItem;
_p.cutContentItem=function(contentItem){if(contentItem){this._cutContentItem.call(this,contentItem);var tabPage=contentItem.wcTabPage;this.wcTabPane.removePage(tabPage)}};_p._refreshFrameView=_p.refreshFrameView;
_p.refreshFrameView=function(){this._refreshFrameView.call(this);var mf=this.wcMultiFrames;if(!mf.wcMaximized){var frame=this.wcContentFrame;var container=frame.wcContainer;var isBlankFrame=container?frame==container.wcBlankFrame:false;var frameIsHidden=frame.wcIsHidden;if(isBlankFrame)this.wcTabPane.setVisible(true);else{var count=frame.wcContentPanes.length;this.wcTabPane.setVisible(count!=1);if(count==1){var cp=frame.wcContentPanes[0];if(cp){var cv=cp.wcContentView;if(cv){cv.wcIsHidden=frameIsHidden;
cv.doRefresh()}}}else{var activeCP=frame.getActiveContentPane();if(activeCP)for(var i=0;i<frame.wcContentPanes.length;i++){var cp=frame.wcContentPanes[i];if(cp){var cv=cp.wcContentView;var show=cp==activeCP&&!frameIsHidden;cv.wcIsHidden=!show;cv.doRefresh()}}}}}};_p._addContentMenu=_p.addContentMenu;
_p.addContentMenu=function(menu){this._addContentMenu.call(this,menu);var cp=menu.wcContentPane;var count=this.wcContentFrame.getContentCount();if(count>1){menu.wcMoveTabLeftBtn=new WcxMenuItem(ibx.resourceMgr.getString("move_tab_left"));menu.wcMoveTabLeftBtn.setEnabled(true);menu.wcMoveTabLeftBtn.addEventListener("click",cp.doMoveTabLeft,cp);menu.addItem(menu.wcMoveTabLeftBtn,menu.wcRemoveBtn);menu.wcMoveTabRightBtn=new WcxMenuItem(ibx.resourceMgr.getString("move_tab_right"));menu.wcMoveTabRightBtn.setEnabled(true);
menu.wcMoveTabRightBtn.addEventListener("click",cp.doMoveTabRight,cp);menu.addItem(menu.wcMoveTabRightBtn,menu.wcRemoveBtn)}};_p._addCloseMenu=_p.addCloseMenu;
_p.addCloseMenu=function(menu){var mf=this.wcMultiFrames;var count=this.wcContentFrame.getContentCount();var cp=menu.wcContentPane;var flags=cp.wcContentInfo.wcOptionsFlag;var cannotClose=flags&wcMF.content.wcCannotClose;if(count>1)menu.addItem(new WcxMenuSeparator);this._addCloseMenu.call(this,menu);if(count>1){menu.wcRemoveOtherBtn=new WcxMenuItem(ibx.resourceMgr.getString("closetabs"));menu.wcRemoveOtherBtn.addEventListener("click",cp.doRemoveOther,cp);menu.addItem(menu.wcRemoveOtherBtn,menu.wcRemoveAllBtn);
menu.wcRemoveRightBtn=new WcxMenuItem(ibx.resourceMgr.getString("closeright"));menu.wcRemoveRightBtn.addEventListener("click",cp.doRemoveRight,cp);menu.addItem(menu.wcRemoveRightBtn,menu.wcRemoveAllBtn);this.addCloseAllMenu(menu)}};_p._addFrameMenu=_p.addFrameMenu;_p.addFrameMenu=function(menu){this._addFrameMenu.call(this,menu);var frame=this.wcContentFrame;var count=frame.getContentCount();if(count>1)this.addViewAsMenu(menu);this.addViewRecentMenu(menu)};
_p.doReorderItem=function(fromIndex,toIndex){var mf=this.wcMultiFrames;var frame=this.wcContentFrame;this.wcTabPane.moveTab(fromIndex,toIndex);WcMultiframes._reorderArray(frame.wcContentPanes,fromIndex,toIndex);mf.sendUpdateLayout("MOVE")};_p.doMouseMove=function(e){var mf=this.wcMultiFrames;var frame=this.wcContentFrame;var layout=frame.wcFrameView;var count=layout.wcContentPanes.length;if(count==0)mf.doHideAllContentHeaders()};
_p.doTabClose=function(e){var cp=this.wcContentPane;var top=cp._element.find(".wcx-content").children();if(top)for(var i=0;i<top.length;++i){var wcobj=$(top[i]).data("wcobj");if(wcobj&&typeof wcobj.okToClose==="function"){var msg=wcobj.okToClose();if(msg!=null&&msg!=""){var options={};options.statusType="warn";options.okText=ibx.resourceMgr.getString("IBX_STR_OK");options.noText=ibx.resourceMgr.getString("IBX_STR_NO");options.caption=ibx.resourceMgr.getString("warning");options.message=msg+"\n\n"+
ibx.resourceMgr.getString("doyouwanttocontinue");var dlg=$.ibi.ibxDialog.createConfirmDialog(options);dlg.ibxDialog("open").on("ibx_close",function(e,btn){if(btn=="ok")cp.doRemove(true)});return}}}cp.doRemove(true)};
_p.doAddNewTab=function(){var frame=this.wcContentFrame;var nextID=this.wcMultiFrames.getNextContentID();var contentInfo={wcContentID:null,wcData:"",wcOptionsFlag:0,wcContentTitle:"",wcContentTooltip:""};contentInfo.wcContentID=nextID;contentInfo.wcNotServerID=true;var cp=frame.addContent(contentInfo);var contentItem=cp.wcContentItem;contentItem.setVisible(true);cp.doEmptyContent();return cp};
function WcMultiframesListView(contentFrame,orientation){if(_wcconstructing)return;WcMultiframesBaseFrameView.call(this,"WcMultiframesListView");this._element.addClass("wcx-multiframes-listview-frame");this.wcContentFrame=contentFrame;var mf=this.wcMultiFrames=contentFrame.wcMultiFrames;this.setTop(mf.wcNoContentMove?0:5);this.wcSetOrientation=orientation;this.wcContentFrame.wcFrameInfo.wcFrameOrientation=orientation;var frameWidth=contentFrame.getWidth();var frameHeight=contentFrame.getHeight();
if(orientation)this.wcOrientation=orientation;else if(frameWidth>frameHeight)this.wcOrientation="HORIZONTAL";else this.wcOrientation="VERTICAL";this.wcListHeader=new WcMultiframesListHeader(this);this.add(this.wcListHeader);this.wcListBody=new WcxComponent("wcListBody");this.wcListBody._element.addClass("wcx-mf-listbody");this.wcListBody._element.css("position","absolute");this.wcListBody.setTop(0);this.wcListBody.setLeft(0);this.wcListBody.setRight(0);this.wcListBody.setBottom(0);this.add(this.wcListBody);
this.wcItemHighlighter=new WcxComponent("wcItemHighlighter");this.wcItemHighlighter._element.addClass("wcx-mfhighlight");this.wcItemHighlighter._element.css("position","absolute");this.add(this.wcItemHighlighter);contentFrame.setTop(0)}_p=wcInherit(WcMultiframesListView,WcMultiframesBaseFrameView);_p._addContentItem=_p.addContentItem;
_p.addContentItem=function(contentItem,contentInfo){this.wcListBody.add(contentItem);var mf=this.wcMultiFrames;var frame=this.wcContentFrame;var flags=frame.wcFrameInfo.wcFrameFlag;frame.wcFrameInfo.wcFrameFlag=flags&~wcMF.frame.wcHItemsResizedFlag&~wcMF.frame.wcVItemsResizedFlag;if(!mf.wcParsingLayout){this.updateViewItems();if(frame)frame.doFrameResize()}};_p._removeContentItem=_p.removeContentItem;
_p.removeContentItem=function(contentItem,detachOnly){if(contentItem){this._removeContentItem.call(this,contentItem,detachOnly);this.wcListBody.remove(contentItem)}};_p._cutContentItem=_p.cutContentItem;_p.cutContentItem=function(contentItem){if(contentItem){this._cutContentItem.call(this,contentItem);this.wcListBody.remove(contentItem)}};
_p.updateViewItems=function(){var mf=this.wcMultiFrames;if(!mf.wcMaximized){var frame=this.wcContentFrame;if(frame&&!frame.wcIsHidden){var count=this.wcContentFrame.wcContentPanes.length;var contentSizes=[];var totalSizeSet=0;var notSetCount=0;var notSetSize=0;var flags=frame.wcFrameInfo.wcFrameFlag;var itemsResized=false;var listBody=this.wcListBody;var listBodyWidth=listBody.getWidth();var listBodyHeight=listBody.getHeight();var listBodySize=0;if(!this.wcSetOrientation)if(frame.getWidth()>frame.getHeight())this.wcOrientation=
"HORIZONTAL";else this.wcOrientation="VERTICAL";var isHorizontal=this.wcOrientation=="HORIZONTAL";if(isHorizontal){itemsResized=flags&wcMF.frame.wcHItemsResizedFlag?true:false;listBodySize=listBodyWidth}else{itemsResized=flags&wcMF.frame.wcVItemsResizedFlag?true:false;listBodySize=listBodyHeight}var itemIndex=1;var items=this.wcListBody.getChildren();for(var i=0;i<items.length;i++){var ci=items[i];if(ci._objtype=="WcMultiframesContentItem"){if(i<items.length-1)ci.updateResizable(isHorizontal);var itemSize=
null;var cp=ci.wcContentPane;var contentInfo=cp?cp.wcContentInfo:null;if(itemsResized)if(isHorizontal){if(!ci.wcItemWidth)ci.wcItemWidth=contentInfo?contentInfo.wcParsedWidth:null;itemSize=ci.wcItemWidth}else{if(!ci.wcItemHeight)ci.wcItemHeight=contentInfo?contentInfo.wcParsedHeight:null;itemSize=ci.wcItemHeight}else if(cp){var windowSize=cp.wcContentInfo.wcWindowSize;if(windowSize&&!isHorizontal)if(windowSize=="SIZE_XSMALL")itemSize=150;else if(windowSize=="SIZE_SMALL")itemSize=200;else if(windowSize==
"SIZE_LARGE")itemSize=400;else if(windowSize=="SIZE_XLARGE")itemSize=500}if(itemSize==null)notSetCount+=1;contentSizes.push(itemSize);totalSizeSet+=itemSize;var cv=ci.wcContentView;if(cv)$(cv._element).attr("item_index",itemIndex);itemIndex+=1}}if(notSetCount>0)notSetSize=parseInt((listBodySize-totalSizeSet)/notSetCount);totalSizeSet=0;for(var i=0;i<contentSizes.length;i++){var itemSize=contentSizes[i];if(itemSize==null)itemSize=notSetSize;totalSizeSet+=itemSize;contentSizes[i]=itemSize}for(var i=
0;i<contentSizes.length;i++){var itemSize=contentSizes[i];itemSize=totalSizeSet>0?itemSize*listBodySize/totalSizeSet:itemSize;contentSizes[i]=itemSize}var itemPos=0;var obj=null;for(var i=0;i<items.length;i++){obj=items[i];if(obj._objtype=="WcMultiframesContentItem"){var itemSize=parseInt(contentSizes[i])-1;obj.wcSizeInfo={};obj.wcSizeInfo.wcIsLastItem=i==items.length-1;obj.wcSizeInfo.wcIsHorizontal=isHorizontal;if(isHorizontal){obj.wcSizeInfo.wcTop=0;obj.wcSizeInfo.wcLeft=itemPos;obj.wcSizeInfo.wcWidth=
itemSize;obj.wcSizeInfo.wcHeight=listBodyHeight}else{obj.wcSizeInfo.wcTop=itemPos;obj.wcSizeInfo.wcLeft=0;obj.wcSizeInfo.wcWidth=listBodyWidth;obj.wcSizeInfo.wcHeight=itemSize}$(obj._element).css("right","");$(obj._element).css("bottom","");obj.setTop(obj.wcSizeInfo.wcTop);obj.setLeft(obj.wcSizeInfo.wcLeft);obj.setWidth(obj.wcSizeInfo.wcWidth);obj.setHeight(obj.wcSizeInfo.wcHeight);obj.setVisible(true);var cv=obj.wcContentView;if(cv)cv.doRefresh();if(itemSize)itemPos+=itemSize}}}}};
_p._refreshFrameView=_p.refreshFrameView;
_p.refreshFrameView=function(){this._refreshFrameView.call(this);var mf=this.wcMultiFrames;if(!mf.wcMaximized){this.updateViewItems();var frame=this.wcContentFrame;if(frame){var list=this.getChildren();for(var i=0;i<list.length;i++){var listBody=list[i];if(listBody&&listBody._objtype=="wcListBody"){var items=listBody.getChildren();var showHeader=items.length>1;this.wcListHeader.setVisible(showHeader);this.wcListBody.setTop(showHeader?39:0);for(var j=0;j<items.length;j++){var ci=items[j];if(ci&&ci._objtype==
"WcMultiframesContentItem"){var show=!frame.wcIsHidden;var cv=ci.wcContentView;if(cv){show=!cv.wcisHidden;cv.wcIsHidden=!show;cv.doRefresh()}ci.setVisible(show)}}}}}}};_p._addContentMenu=_p.addContentMenu;
_p.addContentMenu=function(menu){this._addContentMenu.call(this,menu);var isHorizontal=this.wcOrientation=="HORIZONTAL"?true:false;var cp=menu.wcContentPane;var count=this.wcContentFrame.getContentCount();if(count>1){menu.wcMoveUpLeftBtn=new WcxMenuItem(isHorizontal?ibx.resourceMgr.getString("mvl"):ibx.resourceMgr.getString("mvu"));menu.wcMoveUpLeftBtn.setEnabled(true);menu.wcMoveUpLeftBtn.addEventListener("click",cp.doMoveTabLeft,cp);menu.addItem(menu.wcMoveUpLeftBtn,menu.wcRemoveBtn);menu.wcMoveDownRightBtn=
new WcxMenuItem(isHorizontal?ibx.resourceMgr.getString("mvr"):ibx.resourceMgr.getString("mvd"));menu.wcMoveDownRightBtn.setEnabled(true);menu.wcMoveDownRightBtn.addEventListener("click",cp.doMoveTabRight,cp);menu.addItem(menu.wcMoveDownRightBtn,menu.wcRemoveBtn)}};_p._addCloseMenu=_p.addCloseMenu;
_p.addCloseMenu=function(menu){var mf=this.wcMultiFrames;var count=this.wcContentFrame.getContentCount();var cp=menu.wcContentPane;var flags=cp.wcContentInfo.wcOptionsFlag;var cannotClose=flags&wcMF.content.wcCannotClose;if(count>1)menu.addItem(new WcxMenuSeparator);this._addCloseMenu.call(this,menu);if(count>1){menu.wcRemoveOtherBtn=new WcxMenuItem(ibx.resourceMgr.getString("closeothers"));menu.wcRemoveOtherBtn.addEventListener("click",cp.doRemoveOther,cp);menu.addItem(menu.wcRemoveOtherBtn,menu.wcRemoveAllBtn);
this.addCloseAllMenu(menu)}};_p._addFrameMenu=_p.addFrameMenu;_p.addFrameMenu=function(menu){this._addFrameMenu.call(this,menu);var frame=this.wcContentFrame;var count=frame.getContentCount();if(count>1)this.addViewAsMenu(menu);this.addViewRecentMenu(menu)};
_p.setOrientation=function(orientation){var frame=this.wcContentFrame;if(orientation!="HORIZONTAL"&&orientation!="VERTICAL")orientation="";this.wcSetOrientation=orientation;frame.wcFrameInfo.wcFrameOrientation=orientation.length>0?orientation[0]:"";if(orientation==""){var frameHeight=frame.getHeight();var frameWidth=frame.getWidth();if(frameWidth>frameHeight)orientation="HORIZONTAL";else orientation="VERTICAL"}this.wcOrientation=orientation};
_p.changeOrientation=function(orientation){this.wcOrientation=orientation;this.updateViewItems()};_p.doReorderItem=function(fromIndex,toIndex){var mf=this.wcMultiFrames;var frame=this.wcContentFrame;var children=this.wcListBody.getChildren();WcMultiframes._reorderArray(children,fromIndex,toIndex);WcMultiframes._reorderArray(frame.wcContentPanes,fromIndex,toIndex);mf.sendUpdateLayout("MOVE");this.updateViewItems();if(frame)frame.doFrameResize()};
_p.showItemHighlighter=function(pos){var mf=this.wcMultiFrames;this.hideItemHighlighter();var listBody=this.wcListBody;var currIndex=null;var items=listBody.getChildren();for(var i=0;i<items.length;i++){var ci=items[i];if(ci._objtype=="WcMultiframesContentItem"){var cp=ci.wcContentPane;var iTop=ci.getTop();var iLeft=ci.getLeft();var iHeight=ci.getHeight();var iWidth=ci.getWidth();var orientation=listBody.wcOrientation;var itemPos=orientation=="HORIZONTAL"?iLeft+iWidth:iTop+iHeight;if(pos<itemPos){this.wcItemHighlighter.setTop(iTop);
this.wcItemHighlighter.setLeft(iLeft);this.wcItemHighlighter.setWidth(iWidth);this.wcItemHighlighter.setHeight(iHeight);if(mf.wcDragDropInfo.wcDragContent==cp){$(this.wcItemHighlighter._element).css("background-color","#ffffff");currIndex=-1}else{$(this.wcItemHighlighter._element).css("background-color","#4242f4");currIndex=i}this.wcItemHighlighter.setVisible(true);break}}}return currIndex};_p.hideItemHighlighter=function(){this.wcItemHighlighter.setVisible(false)};
function WcMultiframesListHeader(listView){if(_wcconstructing)return;WcxComponent.call(this,"WcMultiframesListHeader");this._element.addClass("wcx-multiframes-list-header");var frame=listView.wcContentFrame;this.wcListView=listView;$(this._element).css("height","39px");$(this._element).css("background-color","rgb(250, 250, 250)");$(this._element).css("border-bottom","1px solid rgb(218, 218, 218)");this.wcListToolbar=new WcxHBox;this.wcListToolbar.setTop(0);this.wcListToolbar.setLeft(5);this.wcListToolbar.setRight(0);
this.wcListToolbar.setBottom(0);this.add(this.wcListToolbar);var text="";if(frame&&frame.wcFrameInfo)text=frame.wcFrameInfo.wcFrameLabel;this.wcTitle=new WcxLabel(text);this.wcTitle._element.css("position","absolute");this.wcTitle.setTop(2);this.wcTitle.setLeft(0);this.wcTitle.setRight(20);this.wcListToolbar.add(this.wcTitle);this.wcCloseBtn=new wcCreateIconButton({"icon":"close"});this.wcCloseBtn._element.css("position","absolute");this.wcCloseBtn.setRight(0);this.wcCloseBtn._setQaAttr("Close All");
this.wcCloseBtn.setEnabled(true);this.wcCloseBtn.addEventListener("click",this.doCloseBtnClick,this);this.wcListToolbar.add(this.wcCloseBtn)}_p=wcInherit(WcMultiframesListHeader,WcxComponent);_p.doCloseBtnClick=function(){var frame=this.wcListView.wcContentFrame;if(frame)frame.removeAllContent()};
function WcMultiframesFiltersView(contentFrame){if(_wcconstructing)return;WcMultiframesBaseFrameView.call(this,"WcMultiframesFiltersView");this._element.addClass("wcx-multiframes-filtersview-frame");this.wcContentFrame=contentFrame;this.wcMultiFrames=contentFrame.wcMultiFrames;this.wcFiltersBody=null}_p=wcInherit(WcMultiframesFiltersView,WcMultiframesBaseFrameView);_p._addContentItem=_p.addContentItem;
_p.addContentItem=function(contentItem,contentInfo){var mf=this.wcMultiFrames;var actionInfo=mf.wcActionInfo;var frame=this.wcContentFrame;if(this.wcFiltersBody==null){this.wcOrientation="VERTICAL";var container=frame.wcContainer;if(container)this.wcOrientation=container.wcOrientation=="VERTICAL"?"HORIZONTAL":"VERTICAL";else if(actionInfo&&actionInfo.wcTargetName){var targetName=actionInfo.wcTargetName;if(targetName=="TOP"||targetName=="BOTTOM"||targetName=="OUTER_TOP"||targetName=="OUTER_BOTTOM")this.wcOrientation=
"HORIZONTAL"}if(this.wcOrientation=="HORIZONTAL")this.wcFiltersBody=new WcxHCarousel;else this.wcFiltersBody=new WcxVCarousel;this.wcFiltersBody.setOption("floatButtons",true);this.wcFiltersBody.setOption("hideDisabledButtons",true);this.wcFiltersBody.setOption("prevNextButtonPos","ends");this.wcFiltersBody._element.addClass("wcx-mf-filtersbody");$(this.wcFiltersBody._element).css("position","");this.wcFiltersBody.setTop(0);this.add(this.wcFiltersBody)}contentItem.createFilterItem(contentInfo);if(this.wcFiltersBody)this.wcFiltersBody.addItem(contentItem);
if(!mf.wcParsingLayout){this.updateViewItems();if(frame)frame.doFrameResize()}};_p._removeContentItem=_p.removeContentItem;_p.removeContentItem=function(contentItem,detachOnly){if(contentItem){this._removeContentItem.call(this,contentItem,detachOnly);this.wcFiltersBody.remove(contentItem)}};_p._cutContentItem=_p.cutContentItem;_p.cutContentItem=function(contentItem){if(contentItem){this._cutContentItem.call(this,contentItem);this.wcFiltersBody.remove(contentItem)}};
_p.updateViewItems=function(){var mf=this.wcMultiFrames;if(!mf.wcMaximized){var frame=this.wcContentFrame;if(frame&&!frame.wcIsHidden){var count=this.wcContentFrame.wcContentPanes.length;var contentSizes=[];var totalSizeSet=0;var flags=frame.wcFrameInfo.wcFrameFlag;var filtersBody=this.wcFiltersBody;var filtersBodyWidth=filtersBody.getWidth();var filtersBodyHeight=filtersBody.getHeight();var container=frame.wcContainer;if(container)if(container.wcOrientation=="VERTICAL")this.wcOrientation="HORIZONTAL";
else this.wcOrientation="VERTICAL";var isHorizontal=this.wcOrientation=="HORIZONTAL";var itemIndex=1;var items=this.wcFiltersBody.getAllItems();for(var i=0;i<items.length;i++){var ci=$(items[i]).data("wcobj");if(ci._objtype=="WcMultiframesContentItem"){var itemSize=isHorizontal?180:50;contentSizes.push(itemSize);totalSizeSet+=itemSize;var cv=ci.wcContentView;if(cv)$(cv._element).attr("item_index",itemIndex);itemIndex+=1}}var itemPos=0;var obj=null;for(var i=0;i<items.length;i++){obj=$(items[i]).data("wcobj");
if(obj._objtype=="WcMultiframesContentItem"){var itemSize=parseInt(contentSizes[i])-1;obj.wcSizeInfo={};obj.wcSizeInfo.wcIsLastItem=i==items.length-1;obj.wcSizeInfo.wcIsHorizontal=isHorizontal;if(isHorizontal){obj.wcSizeInfo.wcTop=0;obj.wcSizeInfo.wcLeft=itemPos;obj.wcSizeInfo.wcWidth=itemSize;obj.wcSizeInfo.wcHeight=filtersBodyHeight}else{obj.wcSizeInfo.wcTop=itemPos;obj.wcSizeInfo.wcLeft=0;obj.wcSizeInfo.wcWidth=filtersBodyWidth;obj.wcSizeInfo.wcHeight=itemSize}$(obj._element).css("right","");$(obj._element).css("bottom",
"");$(obj._element).css("top",(isHorizontal?"0":obj.wcSizeInfo.wcTop)+"px");$(obj._element).css("left",(isHorizontal?obj.wcSizeInfo.wcLeft:"0")+"px");$(obj._element).css("height",isHorizontal?"100%":obj.wcSizeInfo.wcHeight+"px");$(obj._element).css("width",isHorizontal?obj.wcSizeInfo.wcWidth+"px":"100%");obj.setVisible(true);var cv=obj.wcContentView;if(cv)cv.doRefresh();if(itemSize)itemPos+=itemSize}}}}};_p._refreshFrameView=_p.refreshFrameView;
_p.refreshFrameView=function(){this._refreshFrameView.call(this);var mf=this.wcMultiFrames;if(!mf.wcMaximized){this.updateViewItems();var frame=this.wcContentFrame;if(frame){var filters=this.getChildren();for(var i=0;i<filters.length;i++){var filtersBody=filters[i];if(filtersBody){var items=[];if(filtersBody._objtype=="ibxHCarousel"||filtersBody._objtype=="ibxVCarousel"){var jItems=filtersBody.getAllItems();for(var jIndex=0;jIndex<jItems.length;jIndex++){var wcobj=$(jItems[jIndex]).data("wcobj");
if(wcobj)items.push(wcobj)}}else items=filtersBody.getChildren();for(var j=0;j<items.length;j++){var ci=items[j];if(ci&&ci._objtype=="WcMultiframesContentItem"){var show=!frame.wcIsHidden;ci.setVisible(show);var cv=ci.wcContentView;if(cv){cv.wcIsHidden=true;cv.doRefresh()}}}}}}}};
function WcMultiframesContentItem(frameView,contentInfo,doNotCreateNewView){if(_wcconstructing)return;WcxComponent.call(this,"WcMultiframesContentItem");this._element.addClass("wcx-multiframes-content-item");this.wcFrameView=frameView;var frame=this.wcContentFrame=this.wcFrameView.wcContentFrame;var mf=this.wcMultiFrames=this.wcFrameView.wcMultiFrames;var frameWidth=frame.getWidth();var frameHeight=frame.getHeight();this.wcSizeInfo={wcTop:0,wcLeft:0,wcWidth:frameWidth,wcHeight:frameHeight};this.setTop(0);
this.setLeft(0);this.setRight(0);this.setBottom(0);this._element.css("position","absolute");this._element.css("display","flex");this.wcIsResizable=false;$(this._element).on("mouseenter",this.doMouseEnter.bind(this));if(!doNotCreateNewView){this.wcContentView=new WcMultiframesContentView(this,contentInfo);this.wcContentView.addEventListener("filterchanged",this.doFilterChanged,this);this.wcContentPane=this.wcContentView.wcContentPane;this.wcMultiFrames.wcMFMainPanel.add(this.wcContentView)}if(frame.wcFrameType==
"filters"){this.createFilterItem(contentInfo);this.wcPopup=new WcPopupBox;this.wcPopup._element.addClass("wcx-multiframes-filter-popup");this.wcPopup._element.ibxWidget({"modal":true});this.wcPopup._element.ibxWidget({"destroyOnClose":false});this.wcPopup._element.ibxWidget({"resizable":true});$(this.wcPopup._element).css("background-color","white");this.wcPopup.addEventListener("filtercreated",this.doFilterCreated,this);this.wcPopup.addEventListener("filterchanged",this.doFilterChanged,this);this.wcPopup.addEventListener("filtercontrolcreated",
this.doFilterControlCreated,this);this.wcPopup._element.on("ibx_close",this.doPopupClose.bind(this));this.wcPopup._element.on("resizestop",this.doPopupResize.bind(this));var cp=this.wcContentPane;if(cp){cp.setWindowSize(cp.wcContentInfo.wcWindowSize);if(cp._element){$(cp._element).css("margin-bottom","16px");$(cp._element).css("border-bottom","1px solid #cccccc")}}}}_p=wcInherit(WcMultiframesContentItem,WcxComponent);_p._dispose=_p.dispose;
_p.dispose=function(){try{var resizable=$(this._element).children(".ui-resizable-handle");if(resizable&&resizable.length>0)$(this._element).resizable("destroy")}catch(err){}delete this.wcContentPane;if(this.wcContentView){this.wcContentView.setVisible(false);var main=this.wcMultiFrames.wcMFMainPanel;if(main&&!main._disposed)main.remove(this.wcContentView);var x=this.wcContentView;if(x)x.dispose();delete this.wcContentView}if(this.wcPopup){this.wcPopup.setVisible(false);this.wcPopup.removeAll();this.wcPopup._element.off("ibx_close",
this.doPopupClose.bind(this));this.wcPopup._element.off("resizestop",this.doPopupResize.bind(this));this.wcPopup._element.ibxWidget("close");this.wcPopup.dispose();delete this.wcPopup}this._dispose.call(this)};
_p.createFilterItem=function(contentInfo){var frame=this.wcContentFrame;this.removeAll();this.wcFilterItem=new WcxVBox;this.wcFilterItem._element.addClass("wcx-mf-filteritem");this.wcFilterItem.setVisible(true);this.wcFilterItem.addEventListener("click",this.doPopupOpen,this);this.add(this.wcFilterItem);this.wcFilterLabel=new WcxLabel;this.wcFilterLabel._element.addClass("wcx-filterlabel");this.wcFilterItem.add(this.wcFilterLabel);this.wcFilterValue=new WcxLabel;this.wcFilterValue._element.addClass("wcx-filtervalue");
this.wcFilterItem.add(this.wcFilterValue);this.wcFilterClose=new wcCreateIconButton({"icon":"ds-icon-times"});this.wcFilterClose._element.addClass("wcx-filterclose");this.wcFilterClose._setQaAttr("Hide");this.wcFilterClose.addEventListener("click",this.doFilterCloseClicked,this);this.wcFilterItem.add(this.wcFilterClose);var thisObj=this;setTimeout(function(){var cv=thisObj.wcContentView;if(cv){var cp=cv.wcContentPane;var cInfo=cp.wcContentInfo;if(cp&&cInfo)cp.setTitleText(cInfo.wcContentTitle,cInfo.wcContentTooltip,
cInfo.wcContentSubtitle)}},50)};_p.saveFilterText=function(){var contentInfo=this.wcContentPane.wcContentInfo;contentInfo.wcFilterLabelText=this.wcFilterLabel.getText();contentInfo.wcFilterValueText=this.wcFilterValue.getText()};_p.loadFilterText=function(){var contentInfo=this.wcContentPane.wcContentInfo;this.wcFilterLabel.setText(contentInfo.wcFilterLabelText);this.wcFilterValue.setText(contentInfo.wcFilterValueText)};
_p.initResizable=function(isHorizontal){if(isHorizontal)$(this._element).resizable({handles:"e",start:this.doContentItemStart,resize:this.doContentItemResize,stop:this.doContentItemStop,minWidth:110});else $(this._element).resizable({handles:"s",start:this.doContentItemStart,resize:this.doContentItemResize,stop:this.doContentItemStop,minHeight:50});var resizable=$(this._element).children(".ui-resizable-handle");this.wcIsResizable=true;$(resizable).css("background-color","#eeeeee");$(resizable).data("wcContentItem",
this);if(isHorizontal)$(resizable).css("right","0px");else $(resizable).css("bottom","0px");$(resizable).css("display","");$(resizable).on("mouseenter",this.doResizableMouseEnter);$(resizable).on("mouseleave",this.doResizableMouseLeave)};_p.updateResizable=function(isHorizontal){var mf=this.wcMultiFrames;if(!mf.wcOverlay.wcIsItemResizing){var resizable=$(this._element).children(".ui-resizable-handle");if(resizable&&resizable.length>0)$(this._element).resizable("destroy");this.initResizable(isHorizontal)}};
_p.doContentItemStart=function(evt,ui){var resizable=$(this).children(".ui-resizable-handle");var wcContentItem=$(resizable).data("wcContentItem");var mf=wcContentItem.wcMultiFrames;mf.wcOverlay.wcIsItemResizing=true;mf.wcOverlay.setVisible(true);var frameView=wcContentItem.wcFrameView;var listBody=frameView.wcListBody;var thisItem=$(this)[0];this.resizeInfo={};this.resizeInfo.wcNextItem=null;var items=listBody.getChildren();var matchFound=false;for(var i=0;i<items.length;i++){var itm=items[i];var itemEl=
itm._element[0];if(matchFound){if($(itemEl).is(":visible")){this.resizeInfo.wcNextItem=itm;break}}else if(itemEl==thisItem){matchFound=true;this.resizeInfo.wcThisItem=itm}}if(this.resizeInfo.wcNextItem){var nextItem=this.resizeInfo.wcNextItem;this.resizeInfo.wcStartSize=frameView.wcOrientation=="VERTICAL"?$(this).height():$(this).width();this.resizeInfo.wcNextStartSize=frameView.wcOrientation=="VERTICAL"?$(nextItem._element).height():$(nextItem._element).width();var totalSize=this.resizeInfo.wcStartSize+
this.resizeInfo.wcNextStartSize;if(frameView.wcOrientation=="VERTICAL"){var maxSize=totalSize-50;$(this).resizable({maxHeight:maxSize})}else{var maxSize=totalSize-110;$(this).resizable({maxWidth:maxSize})}this.resizeTimer=null}};
_p.doContentItemResize=function(evt,ui){var resizable=$(this).children(".ui-resizable-handle");if(!resizable)debugger;var wcContentItem=$(resizable).data("wcContentItem");if(!wcContentItem)debugger;var mf=wcContentItem.wcMultiFrames;var frameView=wcContentItem.wcFrameView;if(mf.wcOverlay.wcIsItemResizing){if(this.resizeInfo.wcNextItem){if(this.resizeTimer)clearTimeout(this.resizeTimer);var isHorizontal=frameView.wcOrientation=="HORIZONTAL";var totalSize=this.resizeInfo.wcStartSize+this.resizeInfo.wcNextStartSize;
var currentStart=isHorizontal?$(this).position().left:$(this).position().top;var currentSize=isHorizontal?$(this).width():$(this).height();var nextSize=totalSize-currentSize;var thisItem=this.resizeInfo.wcThisItem;var nextItem=this.resizeInfo.wcNextItem;var that=this;this.resizeTimer=setTimeout(function(){var frame=wcContentItem.wcContentFrame;if(frameView.wcOrientation=="VERTICAL"){nextItem.setTop(currentStart+currentSize);$(nextItem._element).height(nextSize);thisItem.wcItemHeight=$(thisItem._element).height();
nextItem.wcItemHeight=$(nextItem._element).height();frame.wcFrameInfo.wcFrameFlag=frame.wcFrameInfo.wcFrameFlag|wcMF.frame.wcVItemsResizedFlag}else{nextItem.setLeft(currentStart+currentSize);$(nextItem._element).width(nextSize);thisItem.wcItemWidth=$(thisItem._element).width();nextItem.wcItemWidth=$(nextItem._element).width();frame.wcFrameInfo.wcFrameFlag=frame.wcFrameInfo.wcFrameFlag|wcMF.frame.wcHItemsResizedFlag}wcContentItem.wcContentView.doRefresh();nextItem.wcContentView.doRefresh()},5)}}else{mf.wcOverlay.wcIsResizing=
false;mf.wcOverlay.setVisible(false)}};_p.doContentItemStop=function(evt,ui){var resizable=$(this).children(".ui-resizable-handle");var wcContentItem=$(resizable).data("wcContentItem");var mf=wcContentItem.wcMultiFrames;var nextItem=this.resizeInfo.wcNextItem;wcContentItem.wcContentView.doRefresh();nextItem.wcContentView.doRefresh();this.resizeInfo={};mf.doCheckContentResize();mf.wcOverlay.wcIsItemResizing=false;mf.wcOverlay.setVisible(false);mf.sendUpdateLayout("RESIZE")};
_p.doMouseEnter=function(evt){if(this.wcIsResizable){var disabled=$(this._element).hasClass("ui-resizable-disabled");$(this._element).children(".ui-resizable-e").css("cursor",disabled?"default":"");$(this._element).children(".ui-resizable-s").css("cursor",disabled?"default":"")}};
_p.doResizableMouseEnter=function(evt){var wcContentItem=$(this).data("wcContentItem");var disabled=wcContentItem?$(wcContentItem._element).hasClass("ui-resizable-disabled"):true;if(!disabled){var mf=wcContentItem.wcMultiFrames;if(mf.wcOverlay.wcDragStarted)return;mf.wcOverlay.setVisible(true);$(this).css("background-color","silver");$(this).css("z-index","999")}};
_p.doResizableMouseLeave=function(evt){if(evt.buttons!=1){var wcContentItem=$(this).data("wcContentItem");var mf=wcContentItem.wcMultiFrames;mf.wcOverlay.setVisible(false);$(this).css("background-color","#eeeeee");$(this).css("z-index","90")}};
_p.doPopupOpen=function(evt){if(this.wcPopup){var cp=this.wcContentPane;if(cp){if(cp.wcContentFrame)cp.wcContentFrame.doCloseAllPopups();$(cp._element).appendTo($(this.wcPopup._content._element))}var location=null;if(this.wcFrameView.wcOrientation=="VERTICAL")this.wcPopup._element.ibxWidget({"position":{"my":"left top","at":"right top","collision":"flipfit flipfit","of":this._element}});else location=this._element;this.wcPopup.open(location);if(cp){var mf=cp.wcMultiFrames;if(!mf.wcOverlay.wcIsResizing)cp.doTriggerResize()}}};
_p.doPopupClose=function(evt){document.activeElement.blur();if(this.wcContentPane){$(this.wcContentPane._element).appendTo($(this.wcContentView._element));this.wcPopup._element.off("ibx_close",this.doPopupClose.bind(this))}};_p.doPopupResize=function(evt){var mf=this.wcContentPane.wcMultiFrames;if(!mf.wcOverlay.wcIsResizing)this.wcContentPane.doTriggerResize()};
_p.doFilterCreated=function(filterLabel,filterValue){var contentInfo=this.wcContentPane?this.wcContentPane.wcContentInfo:null;if(contentInfo){if(filterLabel){contentInfo.wcContentTitle=filterLabel;if(this.wcFilterLabel)this.wcFilterLabel.setText(filterLabel)}if(contentInfo.wcInitFilter){var val=contentInfo.wcContentSubtitle;var initVal=val?val:filterValue?filterValue:"";if(initVal=="\t"||initVal==" ")initVal="";if(this.wcFilterValue&&initVal){this.wcFilterValue.setText(initVal);contentInfo.wcContentSubtitle=
initVal}contentInfo.wcInitFilter=false}else{if(contentInfo.wcContentSubtitle!="\t")contentInfo.wcContentSubtitle=null;if(filterLabel){contentInfo.wcContentSubtitle=filterValue;if(this.wcFilterValue)this.wcFilterValue.setText(filterValue)}else{var value=filterValue?filterValue:contentInfo.wcLastFilterValue;if(this.wcFilterValue)this.wcFilterValue.setText(value?value:"")}}}if(this.wcFilterValue)$(this.wcFilterValue._element).removeClass("wcx-linethrough")};
_p.doFilterControlCreated=function(islinethrough){var contentInfo=this.wcContentPane?this.wcContentPane.wcContentInfo:null;if(contentInfo)if(contentInfo.wcContentSubtitle!="\t")contentInfo.wcContentSubtitle=null;if(this.wcFilterValue)if(islinethrough)$(this.wcFilterValue._element).addClass("wcx-linethrough")};
_p.doFilterChanged=function(filterValue,notInitial){var contentInfo=this.wcContentPane?this.wcContentPane.wcContentInfo:null;if(contentInfo){var val=contentInfo.wcContentSubtitle;if(val){if(val=="\t"){if(!notInitial&&this.wcFilterValue)this.wcFilterValue.setText(filterValue?filterValue:"");return}if(val==" "){if(this.wcFilterValue)this.wcFilterValue.setText("");contentInfo.wcContentSubtitle=null}return}contentInfo.wcLastFilterValue=filterValue}if(this.wcFilterValue)this.wcFilterValue.setText(filterValue?
filterValue:"")};_p.doFilterCloseClicked=function(evt){var cp=this.wcContentPane;if(cp){var closed=false;var el=$(cp._element).find(".wcx-wcfilter");if(el&&el.length>0){var wcfilter=el.data("wcobj");if(wcfilter)closed=wcfilter.doCloseLink()}if(!closed)cp.doRemove()}};
function WcMultiframesContentView(contentItem,contentInfo){if(_wcconstructing)return;WcxComponent.call(this,"WcMultiframesContentView");this._element.addClass("wcx-multiframes-content-view");this.wcContentItem=contentItem;this.wcContentFrame=contentItem.wcContentFrame;this.wcMultiFrames=contentItem.wcMultiFrames;this.wcContentPane=new WcMultiframesContentPane(this,contentInfo);this.add(this.wcContentPane);this.wcHoverTab=new WcMultiframesHoverTab(this);this.wcHoverTab.setVisible(false);this.add(this.wcHoverTab)}
_p=wcInherit(WcMultiframesContentView,WcxComponent);_p._dispose=_p.dispose;_p.dispose=function(){var mf=this.wcMultiFrames;mf.wcMFMainPanel.remove(this);this._dispose.call(this)};
_p.doRefresh=function(){var mf=this.wcMultiFrames;if(!mf||mf._disposed)return;var frame=this.wcContentFrame;var frameType=frame.wcFrameType;var item=this.wcContentItem;var cp=this.wcContentPane;var main=mf.wcMFMainPanel;var count=frame.getContentCount();var isVisible=!this.wcIsHidden;var rootOffsetTop=$(mf.wcRootContainer._element).offset().top;var rootOffsetLeft=$(mf.wcRootContainer._element).offset().left;var frameOffsetTop=$(frame._element).offset().top;var frameOffsetLeft=$(frame._element).offset().left;
var itemOffsetTop=$(item._element).offset().top;var itemOffsetLeft=$(item._element).offset().left;var top=itemOffsetTop-rootOffsetTop;var left=itemOffsetLeft-rootOffsetLeft;var flexWidth=frame.wcFlexItem?frame.wcFlexItem.wcWidth:null;var width=parseInt(flexWidth?flexWidth:$(item._element).width());var flexHeight=frame.wcFlexItem?frame.wcFlexItem.wcHeight:null;var height=parseInt($(item._element).height());if(frameType=="tab"){if(count<=1){top=frameOffsetTop-rootOffsetTop+(mf.wcNoContentMove?0:5);
left=frameOffsetLeft-rootOffsetLeft;if(!width)width=parseInt($(frame._element).width());if(!height)height=parseInt($(frame._element).height())-(mf.wcNoContentMove?0:5)}}else if(frameType=="list"){if(!item.wcSizeInfo.wcIsLastItem)if(item.wcSizeInfo.wcIsHorizontal)width-=7;else height-=7}else;var hasMultiSubFrames=cp.wcHasMultiFrame&&cp.wcHasMultiFrame.wcFramesList&&cp.wcHasMultiFrame.wcFramesList.length>1;if(!mf.wcNoContentMove&&hasMultiSubFrames){$(frame.wcFrameView._element).css("border","1px solid #ccc");
top=top+1;left=left+1;width=width-2;height=height-2}if(mf.wcParsingLayout){top=frame.wcSizeInfo.wcParsedTop;left=frame.wcSizeInfo.wcParsedLeft}if(!mf.wcMaximized){var wasVisible=this.getVisible();if(!this.wcWidth)this.wcWidth=$(this._element).width();if(!this.wcHeight)this.wcHeight=$(this._element).height();if(!this.wcHideAnimation){this.setVisible(isVisible);$(this._element).css("top",top+"px");$(this._element).css("left",left+"px");$(this._element).css("position","absolute");if(!wasVisible&&isVisible||
this.wcWidth!=width||this.wcHeight!=height){if(this.wcWidth!=width)this.wcWidth=width;if(this.wcHeight!=height)this.wcHeight=height;$(this._element).css("width",width+"px");$(this._element).css("height",height+"px");if(!mf.wcOverlay.wcIsResizing)cp.doTriggerResize()}}}};
_p.updateContentHeader=function(){var mf=this.wcMultiFrames;if(!mf||mf._disposed)return;if(mf.wcParsingLayout)return;var cp=this.wcContentPane;if(cp.wcIsLoading)return;var popups=$("body>.ibx-popup:visible:not(.pop-closed)");var popupCount=popups?popups.length:0;var windows=$("body>.wcx-popup-window:visible:not(.pop-closed)");var windowCount=windows?windows.length:0;if(windowCount>0)popupCount=popupCount-windowCount;$(this.wcHoverTab._element).removeClass("wcx-header-popdown");$(this.wcHoverTab._element).removeClass("wcx-header-popup");
if(wcMF.wcHeaderLocation)$(this.wcHoverTab._element).addClass("wcx-header-popdown");else $(this.wcHoverTab._element).addClass("wcx-header-popup");var show=mf.wcActiveView==this;if(cp.wcHasMultiFrame&&cp.wcHasMultiFrame.wcNotRestricted)show=false;if(mf.wcInMultiFrame&&!mf.wcNotRestricted)show=false;if(mf.wcMaximized)show=false;if(popupCount>0)show=false;if(mf.wcInPopupWindow){if(mf.wcFramesList&&mf.wcFramesList.length<5)show=false;if(mf.wcInitialHiddenFrames<3)show=false}if(mf.wcNoMove){var frame=
this.wcContentFrame;if(frame.wcFrameType=="tab"){if(frame.getContentCount()!=1)show=false}else show=false}this.setContentHeaderVisible(show)};_p.setContentHeaderVisible=function(visible){var mf=this.wcMultiFrames;this.wcHoverTab.setVisible(visible);this.wcHoverTab.doRefresh()};
function WcMultiframesHoverTab(ownerObj){if(_wcconstructing)return;WcxComponent.call(this,"WcMultiframesHoverTab");this._element.addClass("wcx-multiframes-hover-tab");this.wcContentView=ownerObj;this.wcContentFrame=ownerObj.wcContentFrame;this.wcMultiFrames=this.wcContentFrame.wcMultiFrames;this.wcIsMenuVisible=false;this.wcHoverOutHeight=4;this.wcHoverOverHeight=20;this.wcHoverMode=true;this.setHeight(this.wcHoverMode?this.wcHoverOutHeight:this.wcHoverOverHeight);this.wcHoverToolbar=new WcxHBox;
this.wcHoverToolbar.setTop(0);this.wcHoverToolbar.setLeft(5);this.wcHoverToolbar.setRight(0);this.wcHoverToolbar.setBottom(0);this.wcHoverToolbar.setVisible(!this.wcHoverMode);this.add(this.wcHoverToolbar);this.wcMoveIcon=new wcCreateIconButton({"icon":"ds-icon-move-freeform"});this.wcMoveIcon._setQaAttr("Move");this.wcMoveIcon.addEventListener("mousedown",this.doMouseDown,this);this.wcHoverToolbar.add(this.wcMoveIcon);this.wcHoverMenuBtn=new wcCreateIconButton({"icon":wcapplication.imgstr.menu});
this.wcHoverMenuBtn._setQaAttr("Menu");this.wcHoverMenuBtn.setEnabled(true);$(this.wcHoverMenuBtn._element).attr("title",ibx.resourceMgr.getString("options"));this.wcHoverMenuBtn.addEventListener("click",this.doHoverMenuBtnClick,this);this.wcHoverToolbar.add(this.wcHoverMenuBtn);this.wcMaximizeBtn=new wcCreateIconButton({"icon":wcapplication.imgstr.max});this.wcMaximizeBtn._setQaAttr("Maximize");this.wcMaximizeBtn.setEnabled(true);$(this.wcMaximizeBtn._element).attr("title",ibx.resourceMgr.getString("maximize"));
this.wcMaximizeBtn.addEventListener("click",this.doMaximizeBtnClick,this);this.wcHoverToolbar.add(this.wcMaximizeBtn);this.wcCloseBtn=new wcCreateIconButton({"icon":"close"});this.wcCloseBtn._setQaAttr("Close");this.wcCloseBtn.setEnabled(true);this.wcCloseBtn.addEventListener("click",this.doCloseBtnClick,this);this.wcHoverToolbar.add(this.wcCloseBtn);this.addEventListener("mouseover",this.doMouseOver,this);this.addEventListener("mouseout",this.doMouseOut,this)}_p=wcInherit(WcMultiframesHoverTab,WcxComponent);
_p.createMenu=function(){var frame=this.wcContentFrame;var mf=frame.wcMultiFrames;var hoverMenu=new WcxMenu;var addSeparator=false;if(addSeparator){hoverMenu.wcSeparator=new WcxMenuSeparator;hoverMenu.add(hoverMenu.wcSeparator)}if(this.addMultiframeMenu(hoverMenu))addSeparator=true;this.updateContentMenu(hoverMenu);return hoverMenu};
_p.addMultiframeMenu=function(menu){var frame=this.wcContentFrame;var cp=null;if(this.wcContentView)cp=this.wcContentView.wcContentPane;else cp=frame.getActiveContentPane();menu.wcContentPane=cp;frame.wcFrameView.addContentMenu(menu);frame.wcFrameView.addCloseMenu(menu);frame.wcFrameView.addFrameMenu(menu);frame.wcFrameView.addLayoutMenu(menu)};
_p.updateContentMenu=function(menu){var cp=null;if(this.wcContentView)cp=this.wcContentView.wcContentPane;else cp=this.wcContentFrame.getActiveContentPane();var contentInfo=cp.wcContentInfo;if(contentInfo){var wcServerActions=contentInfo.wcServerActions;menu.wcHasServerActions=wcServerActions&&wcServerActions.length>0;if(menu.wcHasServerActions){menu.wcOptionsSeparator=new WcxMenuSeparator;menu.addItem(menu.wcOptionsSeparator);for(var i=0;i<wcServerActions.length;i++){var actionItem=wcServerActions[i];
var serverAction=actionItem.wcServerAction;var itemText=actionItem.wcItemText;var serverBtn=new WcxMenuItem(itemText);$(serverBtn._element).data("wcServerAction",serverAction);serverBtn.addEventListener("click",cp.doServerAction,cp);menu.addItem(serverBtn)}}}};
_p.doMenuBeforeShow=function(menu){var frame=this.wcContentFrame;var mf=frame.wcMultiFrames;var cp=this.wcContentView?this.wcContentView.wcContentPane:null;var count=frame.getContentCount();var currIndex=frame.wcContentPanes.indexOf(cp);var isNotFirst=currIndex>0;var isNotLast=currIndex<count-1;if(frame.wcFrameType=="tab"){if(count>1){if(menu.wcMoveTabLeftBtn)menu.wcMoveTabLeftBtn.setEnabled(isNotFirst);if(menu.wcMoveTabRightBtn)menu.wcMoveTabRightBtn.setEnabled(isNotLast);if(menu.wcRemoveRightBtn)menu.wcRemoveRightBtn.setEnabled(isNotLast)}}else if(frame.wcFrameType==
"list"){if(menu.wcMoveUpLeftBtn){menu.wcMoveUpLeftBtn.setEnabled(isNotFirst);menu.wcMoveUpLeftBtn.setVisible(count>1?true:false)}if(menu.wcMoveDownRightBtn){menu.wcMoveDownRightBtn.setEnabled(isNotLast);menu.wcMoveDownRightBtn.setVisible(count>1?true:false)}}};
_p.doHoverMenuBtnClick=function(e){var frame=this.wcContentFrame;var mf=frame.wcMultiFrames;if(this.wcHoverMenu){delete this.wcHoverMenu.wcContentPane;this.wcHoverMenu.dispose()}this.wcHoverMenu=this.createMenu();var el=this.wcHoverMenu._element;var location=$(this._element);if(e.wcContextClick)if(e.wcContextComponent)location=$(e.wcContextComponent);else location=e;var wcHoverTab=this;wcHoverTab.wcIsMenuVisible=true;this.wcHoverMenu.setOption("position",{"my":"left top","at":"left bottom","collision":"flipfit flipfit",
"of":location});this.wcHoverMenu.setOption("beforeopen",function(){wcHoverTab.doMenuBeforeShow(wcHoverTab.wcHoverMenu)});this.wcHoverMenu.setOption("close",function(){wcHoverTab.wcIsMenuVisible=false;wcHoverTab.doMouseOut();mf.wcOverlay.setVisible(false)});this.wcHoverMenu.open()};_p.doCloseBtnClick=function(){var mf=this.wcMultiFrames;var cv=this.wcContentView;cv.setContentHeaderVisible(false);var cp=cv.wcContentPane;if(cp)cp.doRemove(true)};
_p.doMaximizeBtnClick=function(){var mf=this.wcMultiFrames;var cv=this.wcContentView;cv.setContentHeaderVisible(false);var cp=cv.wcContentPane;if(cp&&!cp.wcIsEmpty)cp.doMaximize()};
_p.doRefresh=function(){var mf=this.wcMultiFrames;var buttonWidth=18;var hoverTabWidth=buttonWidth*4+2;var cp=this.wcContentView?this.wcContentView.wcContentPane:null;if(cp)try{this.wcMoveIcon.setVisible(!mf.wcNoMove);this.wcHoverMenuBtn.setVisible(!mf.wcNoMove);if(mf.wcNoMove)hoverTabWidth-=buttonWidth*2;var contentInfo=cp.wcContentInfo;var noMaximize=mf.wcMaximized||mf.wcInMultiFrame&&mf.wcInMultiFrame.wcMaximized||mf.wcNoMove;this.wcMaximizeBtn.setEnabled(!noMaximize);this.wcMaximizeBtn.setVisible(!noMaximize);
if(noMaximize)hoverTabWidth-=buttonWidth;var flags=contentInfo.wcOptionsFlag;var cannotClose=flags&wcMF.content.wcCannotClose;this.wcCloseBtn.setEnabled(!cannotClose);this.wcCloseBtn.setVisible(!cannotClose);if(cannotClose)hoverTabWidth-=buttonWidth}catch(e){}this.setWidth(hoverTabWidth);var frame=this.wcContentFrame;if(frame){var viewEl=this.wcContentView._element;var viewWidth=$(viewEl).width();if(wcMF.wcHeaderLocation&&!mf.wcNoMove){var left=viewWidth-hoverTabWidth-42;if(left<0)left=0;this.setLeft(left);
$(this._element).css("top","0px");$(this._element).css("bottom","")}else{var viewTop=$(viewEl).offset().top;var viewLeft=$(viewEl).offset().left;if(viewTop<=0){viewTop=$(frame._element).offset().top;viewLeft=$(frame._element).offset().left}var count=frame.wcContentPanes.length;var bottom=$(window).height()-viewTop;var left=viewLeft+(viewWidth-hoverTabWidth)-25;if(count==1||frame.wcFrameType=="list")bottom=bottom-3;$(this._element).css("top","");$(this._element).css("bottom",parseInt(bottom+this.wcHoverOutHeight-
1)+"px");this.setLeft(left)}}var tip=ibx.resourceMgr.getString("close");if(frame.wcFrameType=="single")tip=ibx.resourceMgr.getString("hide");$(this.wcCloseBtn._element).attr("title",tip)};_p.doMouseOver=function(e){this.setHeight(this.wcHoverOverHeight);this.wcHoverToolbar.setVisible(true);$(this.wcMoveIcon._element).css("cursor","move");$(this.wcMoveIcon._element).find("div").css("cursor","move")};
_p.doMouseOut=function(e){if(!this.wcIsMenuVisible){this.setHeight(this.wcHoverMode?this.wcHoverOutHeight:this.wcHoverOverHeight);this.wcHoverToolbar.setVisible(!this.wcHoverMode)}};_p.doMouseDown=function(e){if(e){var mf=this.wcMultiFrames;if(mf.wcNoDragAndDropMode)mf.doDragStart(e,"frame",this.wcContentFrame);else mf.doDragStart(e,"content",this.wcContentView.wcContentPane);e.stopPropagation();e.preventDefault()}};
function WcMultiframesContentPane(contentView,contentInfo){if(_wcconstructing)return;WcxWidget.call(this);this._element.addClass("wcx-multiframes-content-pane");$(this._element).data("wcContentPane",this);this.wcContentView=contentView;this.wcContentView._setQaAttr(contentInfo.wcContentID);this.wcContentItem=contentView.wcContentItem;this.wcFrameView=this.wcContentItem.wcFrameView;this.wcContentFrame=this.wcContentItem.wcContentFrame;this.wcMultiFrames=this.wcContentItem.wcMultiFrames;var mf=this.wcMultiFrames;
this.wcIsEmpty=true;this.wcContentInfo=contentInfo;if(mf.wcParsingLayout)this.wcContentInfo.wcOriginalContent=true;this.wcContentInfo.wcAllowRefresh=!mf.wcNoDragAndDropMode;if(!mf.wcNoDragAndDropMode){this.setDragOverEventListener(this.doDragOver);this.setDropEventListener(this.doDrop.bind(this))}$(this._element).on("keyup",this.doKeyUp.bind(this));$(this._element).on("mouseenter",this.doMouseEnter.bind(this));$(this._element).on("mouseleave",this.doMouseLeave.bind(this));this.addEventListener("mousedown",
this.doMouseDown,this);$(this._element).on("transitionend",function(){var frame=this.wcContentFrame;this._element.css({"transition":"","top":"","left":""});var view=this.wcContentView;if(view.wcInShowAnimation){view.wcInShowAnimation=false;view.doRefresh()}if(view.wcInHideAnimation)if(frame){view.wcInHideAnimation=false;frame.wcAnimationDone=true;frame.hide()}view.wcInShowAnimation=false;view.wcInHideAnimation=false}.bind(this));this.addEventListener("contextmenu",function(e){if(e.shiftKey&&e.ctrlKey){e.preventDefault();
e.stopPropagation();e.wcContextClick=true;mf.doShowLayoutTree(e)}},this);var isRedirect=this.wcContentInfo.wcOptionsFlag&WcMultiframesContentPane.wcIsRedirectFlag?true:false;this.wcLoadPending=!isRedirect;if(isRedirect){var cp=this;setTimeout(function(){cp.doRefresh()},0)}}_p=wcInherit(WcMultiframesContentPane,WcxWidget);_p._dispose=_p.dispose;_p.dispose=function(){$(this._element).off("dragover",this.doDragOver);$(this._element).off("drop",this.doDrop);this.removeAll();this._dispose.call(this)};
_p.close=function(){var mf=this.wcMultiFrames;if(mf.wcMaximized==this)mf.doRestore();this.doRemove(false);var cv=this.wcContentView;if(cv&&!cv.wcInHideAnimation){var frame=this.wcContentFrame;if(frame.wcFrameType=="single")this.doEmptyContent()}};
_p.setTitleText=function(titleText,tooltipText,subtitleText){var frame=this.wcContentFrame;var contentInfo=this.wcContentInfo;if(titleText&&$.trim(titleText))contentInfo.wcContentTitle=titleText;else if(!contentInfo.wcContentTitle){var strTitle="";var strID=contentInfo.wcContentID;if(isNaN(strID))strTitle=$.trim(strID);if(strTitle==""){var frameID=frame.wcFrameID;if(frameID)strTitle=frameID+" "+strID;else strTitle="(ID:"+strID+")"}contentInfo.wcContentTitle=strTitle}if(tooltipText)contentInfo.wcContentTooltip=
tooltipText;if(subtitleText){if(subtitleText==" ")subtitleText="";else if(subtitleText=="\t"){var wcxFilter=$(this._element).find(".wcx-wcfilter");if(wcxFilter&&wcxFilter.length>0){var wcobj=wcxFilter.data("wcobj");if(wcobj)wcobj.doFilterUpdate()}}var regexp=new RegExp("&amp;","ig");subtitleText=subtitleText?subtitleText.replace(regexp,"&"):"";contentInfo.wcContentSubtitle=subtitleText}else contentInfo.wcContentSubtitle=null;var item=this.wcContentView.wcContentItem;if(item)if(frame.wcFrameType==
"tab"){if(!item.wcTabPage._disposed)item.wcTabPage.setOption("tabOptions",{text:contentInfo.wcContentTitle});try{var tabPage=item.wcTabPage._element;if(tooltipText)if(!$(tabPage).hasClass(".tpg-hidden"))tabPage.setTitle(tooltipText)}catch(e){}}else if(frame.wcFrameType=="filters"){if(contentInfo.wcContentTitle)item.wcFilterLabel.setText(contentInfo.wcContentTitle);if(subtitleText&&subtitleText!="\t")item.wcFilterValue.setText(subtitleText)}};
_p.setWindowSize=function(windowSize){var frame=this.wcContentFrame;var contentInfo=this.wcContentInfo;contentInfo.wcWindowSize=windowSize;if(frame.wcFrameType=="filters"){var item=this.wcContentView.wcContentItem;if(item&&item.wcPopup){var popupWidth=650;var popupHeight=400;if(windowSize=="SIZE_XSMALL"){popupWidth=350;popupHeight=250}else if(windowSize=="SIZE_SMALL"){popupWidth=350;popupHeight=300}else if(windowSize=="SIZE_LARGE"){popupWidth=700;popupHeight=500}else if(windowSize=="SIZE_XLARGE"){popupWidth=
800;popupHeight=600}$(item.wcPopup._element).css("width",popupWidth+"px");$(item.wcPopup._element).css("height",popupHeight+"px")}}};_p.setAllowRefresh=function(params){var contentInfo=this.wcContentInfo;if(contentInfo)if(params){contentInfo.wcAllowRefresh=true;contentInfo.wcParams=params}else contentInfo.wcAllowRefresh=false;var mf=this.wcMultiFrames;var enabled=mf.hasRefreshableContent();if(mf.wcRefreshAllBtn)mf.wcRefreshAllBtn.setEnabled(enabled)};
_p.doRefresh=function(forceRefresh){var mf=this.wcMultiFrames;var contentInfo=this.wcContentInfo;if(contentInfo.wcAllowRefresh||!mf.wcNoDragAndDropMode||forceRefresh===true){var loadOptions={};loadOptions.wcDoNotForceShow=true;loadOptions.wcDoRefresh=true;this.doLoad(null,null,loadOptions)}};
_p.doLoad=function(params,doMerge,loadOptions){var mf=this.wcMultiFrames;if(mf.doMFstatus()!="ready"){try{if(mf.wcLoadPending)mf.wcLoadPending.push(this)}catch(e){}return}var contentInfo=this.wcContentInfo;var frame=this.wcContentFrame;if(frame.wcDelayLoad)return;var doNotForceShow=false;var doRefresh=false;if(params)if(contentInfo.wcIsLoadingNew||!doMerge){if(!contentInfo.wcOriginalContent){contentInfo.wcParams=params;contentInfo.wcUrl=params._url}contentInfo.wcIsLoadingNew=false}if(loadOptions){doNotForceShow=
loadOptions.wcDoNotForceShow;doRefresh=loadOptions.wcDoRefresh}if(!doNotForceShow){if(mf.wcMaximized&&mf.wcMaximized!=this)mf.doMaxNotify();this.setVisible(true);if(frame){this.wcLoadPending=true;frame.show(frame.wcIsHidden?"SHOW":"LOAD")}}if(contentInfo){if(!mf.wcNoDragAndDropMode)this.removeAll();var httpReqOptions={};httpReqOptions.wcAction=doRefresh?"refresh":"load";httpReqOptions.wcDropValue=contentInfo.wcData;httpReqOptions.wcContentValue=contentInfo.wcContentID;if(loadOptions&&loadOptions.wcResourceBundleName)httpReqOptions.wcResourceBundleName=
loadOptions.wcResourceBundleName;if(loadOptions&&loadOptions.wcResourceSelector)httpReqOptions.wcResourceSelector=loadOptions.wcResourceSelector;if(params){httpReqOptions.wcParams=params;httpReqOptions.wcDoMerge=doMerge;mf.wcActionInfo.wcContentValue=contentInfo.wcContentID;mf.sendUpdateLayout("ADD")}if(contentInfo.wcParams)httpReqOptions.wcContentParams=contentInfo.wcParams;if(loadOptions&&loadOptions.wcLoadingMessage)httpReqOptions.wcLoadingMessage=loadOptions.wcLoadingMessage;this.wcHasMultiFrame=
null;this.wcIsLoading=true;this.wcContentView._element.css("display","");mf.wcActionInfo.wcLayoutValue=mf.getLayoutString();mf.doHttpRequest(httpReqOptions);if(!doNotForceShow&&frame&&frame.wcFrameType=="tab")this.wcContentItem.wcTabPage.selectTab()}var view=this.wcContentView;if(view)view.doRefresh()};
_p.doPostLoad=function(params,doMerge,internalOptions){var mf=this.wcMultiFrames;var frame=this.wcContentFrame;var frameID=frame.wcFrameInfo.wcFrameID;if(frameID)$(frame._element).attr("frame_id",frameID);if(frameID){$(this.wcContentView._element).attr("frame_id",frameID);$(this._element).addClass("wcx-mff-"+frameID)}var contentID=this.wcContentInfo.wcContentID;if(contentID){$(this.wcContentView._element).attr("content_id",contentID);$(this._element).addClass("wcx-mfc-"+contentID)}this.wcLoadPending=
false;this.wcIsLoading=false;if(!this._disposed)this.wcContentView.doRefresh();frame.wcFrameView.refreshFrameView();mf.updateFramesToolbar()};
_p.doRemove=function(isUserAction,isMultiple){var frame=this.wcContentFrame;var container=frame.wcContainer;var mf=container.wcMultiFrames;var notClosable=frame.wcFrameInfo.wcFrameFlag&2?true:false;var wasEmpty=frame.hasOneEmptyContent();var data="";var contentInfo=this.wcContentInfo;if(contentInfo)data=contentInfo.wcData;var contentID=contentInfo.wcContentID;var flags=contentInfo.wcOptionsFlag;var cannotClose=flags&wcMF.content.wcCannotClose;if(cannotClose)return false;if(frame.wcFrameType=="single"){frame.hide();
notClosable=true}else frame.removeContent(contentID,true,false);var count=frame.getContentCount();if(count<=0){var isTemplateFrame=frame.wcFrameInfo.wcIsTemplate;if(mf.wcNoDragAndDropMode)if(frame.wcFrameInfo.wcFrameID){if(!notClosable)frame.hide()}else{if(!notClosable)frame.removeThisFrame(true)}else if(!notClosable)if(wasEmpty||!isTemplateFrame)frame.removeThisFrame(true);else frame.wcFrameView.doAddNewTab()}var container=frame.wcContainer;if(container.wcIsPersistent)if(container.wcBlankFrame&&
container.wcBlankFrame.wcIsHidden)isUserAction=false;if(isUserAction){var userAction="CLOSE";if(frame.getContentCount()<=0)userAction="HIDE";frame.wcContainer.adjustSizes(userAction)}if(!isMultiple){var actionInfo=mf.wcActionInfo;actionInfo.wcDropValue=data;actionInfo.wcContentValue=contentID;mf.sendUpdateLayout("REMOVE")}mf.adjustLayout("REFRESH",null);return true};
_p.doRemoveOther=function(){var frame=this.wcContentFrame;frame.removeOtherContent(this);var container=frame.wcContainer;var mf=container.wcMultiFrames;mf.adjustLayout("REMOVE",null);mf.sendUpdateLayout("REMOVE")};_p.doRemoveRight=function(){var frame=this.wcContentFrame;frame.removeContentToTheRight(this);var container=frame.wcContainer;var mf=container.wcMultiFrames;mf.adjustLayout("REMOVE",null);mf.sendUpdateLayout("REMOVE")};
_p.doMaximize=function(){var mf=this.wcMultiFrames;if(mf.wcMaximized)return;mf.wcMaximized=this;mf.wcRestoreWidth=$(this.wcContentView._element).width();mf.wcRestoreHeight=$(this.wcContentView._element).height();var contentTitle=this.wcContentInfo.wcContentTitle;if(mf.wcInPopupWindow){mf.wcPopupWindow=$(mf._element).closest(".wcx-popup-window");if(mf.wcPopupWindow){$(mf.wcPopupWindow).data("wcPopupTop",$(mf.wcPopupWindow).position().top);$(mf.wcPopupWindow).data("wcPopupLeft",$(mf.wcPopupWindow).position().left);
$(mf.wcPopupWindow).data("wcPopupWidth",$(mf.wcPopupWindow).width());$(mf.wcPopupWindow).data("wcPopupHeight",$(mf.wcPopupWindow).height());$(mf.wcPopupWindow).css({"top":"0px","left":"0px","width":"100%","height":"100%","max-width":"100%","max-height":"100%"})}}mf.wcMFMaxPanel.setVisible(true);var cv=this.wcContentView;if(cv){cv.setVisible(true);$(cv._element).css({"z-index":1E3,"position":"fixed","width":"","height":"","top":"26px","left":"0px","right":"0px","bottom":"17px"});cv.wcHoverTab.setVisible(false)}this.doCheckResize()};
_p.doMoveTabLeft=function(){var frame=this.wcContentFrame;var currIndex=frame.wcContentPanes.indexOf(this);if(currIndex>=0){var newIndex=currIndex-1;if(newIndex<0)newIndex=0;frame.wcFrameView.doReorderItem(currIndex,newIndex)}};_p.doMoveTabRight=function(){var frame=this.wcContentFrame;var currIndex=frame.wcContentPanes.indexOf(this);var newIndex=currIndex+1;if(newIndex>frame.wcContentPanes.length)newIndex=frame.wcContentPanes.length;frame.wcFrameView.doReorderItem(currIndex,newIndex)};
_p.doClearContent=function(notifyServer){this.wcContentInfo.wcData="";this.wcContentInfo.wcContentTitle="";this.wcContentInfo.wcContentSubtitle="";this.wcContentInfo.wcContentTooltip="";this.doEmptyContent();if(notifyServer){var actionInfo=this.wcMultiFrames.wcActionInfo;actionInfo.wcContentValue=this.wcContentInfo.wcContentID;this.wcMultiFrames.adjustLayout(null,null);this.wcMultiFrames.sendUpdateLayout("REMOVE")}};
_p.doEmptyContent=function(){var mf=this.wcMultiFrames;this.removeAll();this.wcIsEmpty=true;this.wcTipPanel=new WcxVBox;this.wcTipPanel.wcIsEmptyContentDiv=true;this.wcTipPanel._element.addClass("wc-empty-content");this.wcTipPanel.setTop(0);this.wcTipPanel.setLeft(0);$(this.wcTipPanel._element).css("width","100%");$(this.wcTipPanel._element).css("height","100%");this.wcTipPanel.setVisible(true);this.wcTipLabel=new WcxLabel;$(this.wcTipLabel._element).css("margin","auto");this.wcTipLabel.setText(mf.wcTipText);
this.wcTipPanel.add(this.wcTipLabel);this.add(this.wcTipPanel);var labelText=$(this.wcTipLabel._element).find(".ibx-label-text");if(labelText){labelText.css("white-space","");labelText.css("text-align","center")}};_p.doDragOver=function(evt){evt.preventDefault();evt.stopPropagation();var e=evt.originalEvent;var dt=e.dataTransfer;dt.dropEffect="copy";e.preventDefault()};
_p.doDrop=function(evt){evt.preventDefault();evt.stopPropagation();var e=evt.originalEvent;var dt=e.dataTransfer;var rowid=dt.getData("text");if(rowid){this.wcRowID=rowid;var mf=this.wcMultiFrames;var dropOption=localStorage.getItem("mf,dropOption");if(e.ctrlKey)dropOption="2";if(e.which!=1)dropOption="0";if(this.wcIsEmpty)dropOption="1";if(dropOption=="1")this.doDropReplace();else if(dropOption=="2")this.doDropAdd();else{var dropMenu=new WcxMenu;dropMenu.wcReplaceBtn=new WcxMenuItem("Replace content");
dropMenu.wcReplaceBtn.addEventListener("click",this.doDropReplace,this);dropMenu.addItem(dropMenu.wcReplaceBtn);dropMenu.wcAddBtn=new WcxMenuItem("Add content to frame");dropMenu.wcAddBtn.addEventListener("click",this.doDropAdd,this);dropMenu.addItem(dropMenu.wcAddBtn);dropMenu.wcSeparator=new WcxMenuSeparator;dropMenu.addItem(dropMenu.wcSeparator);dropMenu.wcTopBtn=new WcxMenuItem("Split frame and add to top");dropMenu.wcTopBtn.wcTargetName="TOP";dropMenu.wcTopBtn.addEventListener("click",this.doDropSplit,
this);dropMenu.addItem(dropMenu.wcTopBtn);dropMenu.wcLeftBtn=new WcxMenuItem("Split frame and add to left");dropMenu.wcLeftBtn.wcTargetName="LEFT";dropMenu.wcLeftBtn.addEventListener("click",this.doDropSplit,this);dropMenu.addItem(dropMenu.wcLeftBtn);dropMenu.wcRightBtn=new WcxMenuItem("Split frame and add to right");dropMenu.wcRightBtn.wcTargetName="RIGHT";dropMenu.wcRightBtn.addEventListener("click",this.doDropSplit,this);dropMenu.addItem(dropMenu.wcRightBtn);dropMenu.wcBottomBtn=new WcxMenuItem("Split frame and add to bottom");
dropMenu.wcBottomBtn.wcTargetName="BOTTOM";dropMenu.wcBottomBtn.addEventListener("click",this.doDropSplit,this);dropMenu.addItem(dropMenu.wcBottomBtn);dropMenu.setOption("position",{"my":"left top","at":"left bottom","collision":"flipfit flipfit","of":e});dropMenu.setOption("close",function(){mf.wcOverlay.setVisible(false)});dropMenu.open()}}};
_p.doServerAction=function(e){var mf=this.wcMultiFrames;var itmEl=e.currentTarget;if(itmEl){var serverAction=$(itmEl).data("wcServerAction");if(serverAction){var contentInfo=this.wcContentInfo;var httpReq={};httpReq.wcIsServerAction=true;httpReq.wcAction=serverAction;httpReq.wcDropValue=contentInfo.wcData;httpReq.wcContentValue=contentInfo.wcContentID;mf.doHttpRequest(httpReq)}}};
_p.doCheckResize=function(){var mf=this.wcMultiFrames;if(!this.wcContentWidth)this.wcContentWidth=0;if(!this.wcContentHeight)this.wcContentHeight=0;var currentWidth=this.getWidth();var currentHeight=this.getHeight();if(currentWidth!=this.wcContentWidth||currentHeight!=this.wcContentHeight){this.wcContentWidth=currentWidth;this.wcContentHeight=currentHeight;if(!mf.wcOverlay.wcIsResizing)this.doTriggerResize()}};
_p.doTriggerResize=function(eventName){var mf=this.wcMultiFrames;if(this.wcLoadPending)return;var children=this.getChildren();for(var i=0;i<children.length;i++){var obj=children[i];try{if(obj._element)$(obj._element).trigger(eventName?eventName:"resize")}catch(e){}}};
_p.doKeyUp=function(e){var frame=this.wcContentFrame;var frameInfo=frame.wcFrameInfo;var frameFlags=frameInfo.wcFrameFlag;var bDoAnimation=frameFlags&wcMF.frame.wcDoAnimationFlag?true:false;var key=e.keyCode;if(key==27){if(wcapplication.wcPreventMFClose)bDoAnimation=false;if(bDoAnimation)this.close()}wcapplication.wcPreventMFClose=false};
_p.doMouseEnter=function(e){var mf=this.wcMultiFrames;if(!mf.wcMaximized){mf.doHideAllContentHeaders();if(this.wcContentView){mf.wcActiveView=this.wcContentView;this.wcContentView.updateContentHeader()}}};
_p.doMouseLeave=function(e){var mf=this.wcMultiFrames;var x=e.pageX-$(this._element).offset().left;var y=e.pageY-$(this._element).offset().top;var that=this;if(x<0||x>$(this._element).width()||y<0||y>$(this._element).height())setTimeout(function(){var hoverHeight=that.wcContentView.wcHoverTab.getHeight();if(hoverHeight<10){mf.wcActiveView=null;that.wcContentView.updateContentHeader()}},100)};_p.doMouseDown=function(e){e.stopPropagation()};
_p.doDropReplace=function(e){var rowid=this.wcRowID;this.wcContentInfo.wcData=rowid;this.wcContentInfo.wcParams=null;var contentID=this.wcContentInfo.wcContentID;var mf=this.wcMultiFrames;mf.wcActionInfo.wcDropValue=rowid;mf.wcActionInfo.wcContentValue=contentID;mf.sendUpdateLayout("DROP")};
_p.doDropAdd=function(e){var mf=this.wcMultiFrames;var rowid=this.wcRowID;var contentInfo={};contentID=mf.getNextContentID();contentInfo.wcContentID=contentID;contentInfo.wcData=rowid;contentInfo.wcNotServerID=true;contentInfo.wcOptionsFlag=0;contentInfo.wcIsLoadingNew=true;var frame=this.wcContentFrame;frame.addContent(contentInfo);mf.wcActionInfo.wcDropValue=rowid;mf.wcActionInfo.wcContentValue=contentID;mf.sendUpdateLayout("DROP")};
_p.doDropSplit=function(e){var targetName=$(e.currentTarget).data("wcobj").wcTargetName;if(!targetName)return;var mf=this.wcMultiFrames;var rowid=this.wcRowID;var contentInfo={};contentInfo.wcData=rowid;contentInfo.wcNotServerID=true;contentInfo.wcOptionsFlag=0;contentInfo.wcIsLoadingNew=true;var contentID=null;var strData=true;var newFrame=mf.createFrame("tab",contentID,false,!strData?"#494949":"#FFFFFF");contentID=newFrame.wcActiveID;contentInfo.wcContentID=contentID;var newCP=newFrame.addContent(contentInfo);
if(newCP)if(newCP.wcIsEmpty)newCP.doEmptyContent();var targetFrame=this.wcContentFrame;if(mf.splitFrame(targetFrame,targetName,newFrame)){mf.adjustLayout("REFRESH",null);mf.wcActionInfo.wcDropValue=rowid;mf.wcActionInfo.wcContentValue=contentID;mf.sendUpdateLayout("DROP")}};
function wcBuildFrameControlMenuArray(){var menuArray=[];var topMFs=$(".wcx-multiframe").filter(function(){return $(this).parents(".wcx-multiframe").length===0&&$(this).parents(".wcx-popup-window").length===0});for(var i=0;i<topMFs.length;i++){var obj=topMFs[i];var mf=obj?$(obj).data("wcobj"):null;if(mf){mf.wcIsTopMF=true;mf.buildViewFramesMenuArray(menuArray)}}return menuArray}
function wcxParsePartialTree(rsp,wcnode){if(wcPreProcess(rsp,false)!=true)return;var wcnodeid=wcnode.id;if(rsp.data)for(var i=0;i<rsp.data.item.length;++i)if(rsp.data.item[i].type=="wctree"){var wctree=rsp.data.item[i];var treeType=wctree.type;for(var j=0;j<wctree.node.length;++j)if(wctree.node[j].cat==="tree"){wctree.node[j]._popupnodes=wcnode._popupnodes;var targetNode=wcnode.jqobj;targetNode.ibxWidget("remove");var tree=targetNode.closest(wctree.monotree?".wcx-mono-tree":".wcx-tree");if(tree){var wcobj=
tree.data("wcobj");if(wcobj)wcobj.buildSubNodes(targetNode,wctree.node[j],wctree.dragname);targetNode.ibxWidget("toggleExpanded",true)}break}break}}
function wcGetBreadCrumb(row){var wcnode=$(row).data("wcobj");var breadcrumb=[];var info={"text":wcnode.label?wcnode.label.text:"","obj":$(row)};var siblings=[];var p=$(row).ibxWidget("parentNode");var s=$(p).ibxWidget("children");for(var i=0;i<s.length;++i){var n=$(s[i]).data("wcobj");siblings.push({"text":n.label?n.label.text:"","obj":$(s[i])})}info.siblings=siblings;info.contextmenu=$(row).data("wccontextmenu");breadcrumb.push(info);while(p){var thisrow=$(p).data("wcobj");siblings=[];info={"text":thisrow.label?
thisrow.label.text:"","obj":$(p)};var parent=$(p).ibxWidget("parentNode");if(parent){s=$(parent).ibxWidget("children");for(var i=0;i<s.length;++i){var n=$(s[i]).data("wcobj");siblings.push({"text":n.label?n.label.text:"","obj":$(s[i])})}info.siblings=siblings}info.contextmenu=$(p).data("wccontextmenu");breadcrumb.push(info);p=parent}breadcrumb.reverse();return{"breadcrumb":breadcrumb}}
function WcTree(wcitem){if(_wcconstructing)return;WcxVBox.call(this);$(this._element).on("mousedown",this.doMouseDown.bind(this));this.wcPaging=wcitem.paging;var btns=wcGetTopButtons(wcitem);if(btns){var bar=new WcToolBar(this);bar.addButtons(btns);this.add(bar)}this.monotree=wcitem.monotree;this.wcIsMonoTree=false;if(wcitem.monotree){this.wcIsMonoTree=true;this._element.addClass("wcx-mono-tree");this.ibxtree=new WcxMonoTree(this.doExpandCollapse);this.ibxtree.setOption("singleClickExpand",true);
this.ibxtree.setOption("selType","multi")}else{this._element.addClass("wcx-tree");this.ibxtree=new WcxTree(this.doExpandCollapse)}this.ibxtree._element.addClass("ibfs-tree").attr("tabindex","0");if(wcitem.searchable){var searchBox=new WcxHBox;searchBox._element.addClass("ibfs-tree-search-box").css("width","100%");this.wcKeyTimeout=null;this.wcSearchEdit=new WcxTextField("");this.wcSearchEdit._element.addClass("ibfs-tree-search-edit");this.wcSearchEdit.setOption("ctrlType","search");this.wcSearchEdit.setOption("autoSize",
false);this.wcSearchEdit.setOption("placeholder",ibx.resourceMgr.getString("search"));this.wcSearchEdit.addTextChangedEventListener(this.doSearchTextChanged.bind(this));this.wcSearchEdit._element.on("mouseup",this.doSearchTextMouseUp.bind(this));searchBox.add(this.wcSearchEdit);this.wcSearchEdit._element.find("input").attr("qa","searchinput");var searchBtn=new WcxLabel(null,null,"ds-icon-search");searchBtn._element.addClass("ibfs-tree-search-btn");searchBox.add(searchBtn);this.add(searchBox);this.wcResultsLoaded=
false;if(wcitem.monotree){this._element.addClass("wcx-mono-tree");this.ibxSearchTree=new WcxMonoTree(this.doExpandCollapse);this.ibxSearchTree.setOption("singleClickExpand",true);this.ibxSearchTree.setOption("selType","multi")}else{this._element.addClass("wcx-tree");this.ibxSearchTree=new WcxTree(this.doExpandCollapse)}this.ibxSearchTree.setVisible(false);this.add(this.ibxSearchTree)}this.add(this.ibxtree);this.wcLoadingPane=new WcxWaiting;this.wcLoadingPane.setVisible(false);this.add(this.wcLoadingPane);
for(var i=0;i<wcitem.node.length;++i)if(wcitem.node[i].cat=="tree"){wcitem.node[i]._popupnodes=wcitem.node;this.buildRootNode(wcitem.node[i],wcitem.dragname);break}setTimeout(function(tree){if(tree.selectednode){tree.ibxtree._element.ibxSelectionManager("selected",tree.selectednode,true).ibxSelectionManager("focus",tree.selectednode,true);tree._element.trigger("wcclick",wcGetBreadCrumb(tree.selectednode))}else if(!tree.wcIsMonoTree&&!tree._disposed)tree._element.trigger("wcclick",wcGetBreadCrumb(tree.ibxtree._element.ibxWidget("rootNodes")))},
300,this)}_p=wcInherit(WcTree,WcxVBox);
_p.buildRootNode=function(wcnode,dragname,path){if(!this.wcIsMonoTree&&this.wcRootNode)this.ibxtree._element.ibxWidget("remove",this.wcRootNode);this.wcStartNode=null;this.wcCurrentNode=null;this.wcRootNode=this.buildNode(wcnode,dragname,path);this.wcRootNode.ibxWidget("option","hasParent",false);if(this.wcRootNode.wcNoLabelNode)this._element.addClass("wcx-no-root-label");this.ibxtree.addNode(this.wcRootNode);if(this.wcCurrentNode)this.wcCurrentNode.ibxWidget("expanded",true);else if(this.wcStartNode)this.wcStartNode.ibxWidget("expanded",
true)};
_p.buildNode=function(wcnode,dragname,path){var wcNodeText=wcnode.label?wcnode.label.text:"";var wcNodeTitle=wcnode.title?wcnode.title:"";var wcIsFolder=wcnode.group=="folder";var wcIsSelected=wcnode.selected?true:false;if(path&&path.length>0){path=path+wcNodeText;if(wcIsFolder)path+="/";wcNodeText=path}var treeNode=this.ibxtree.createNode({text:wcNodeText,glyphClasses:wcIsFolder?"ds-icon-folder":null,isfolder:wcIsFolder,expanded:!this.monotree&&(wcnode.expanded||wcnode.state=="1")?true:false});if(this.monotree)treeNode.addClass("ibfs-tree-browser-node");
wcAttachTooltip(treeNode,wcNodeTitle,"center-right","");treeNode.addClass("ibfs-tree-node");treeNode.attr("wcnode",wcnode.id);if(!wcIsFolder)treeNode.find(".tnode-label").addClass("ibfs-file");treeNode.data("wcnode",wcnode);treeNode.data("dragname",dragname);treeNode.wcIsFolder=wcIsFolder;wcnode.jqobj=treeNode;if(!this.wcStartNode||wcIsFolder&&wcIsSelected)this.wcStartNode=treeNode;if(this.ibxtree.wcCurrentNodeID==wcnode.id)this.wcCurrentNode=treeNode;if(wcIsSelected)this.selectednode=treeNode;var icon,
iconColor;var image;if(wcnode.open_image)image=wcnode.open_image;else image=wcnode.image;if(image){icon=image.src;iconColor=image.color}if(icon&&!wcIsFolder){var tNode=treeNode.ibxWidget("instance");var label=tNode.nodeLabel;if(wcxIsIconFont(icon)){var font=wcxGetIconFontName(icon);label.ibxWidget({"glyph":font.name,"glyphClasses":font.class})}else{label.ibxWidget({"icon":icon});label._iconname=icon;if(iconColor)label.css("color",iconColor)}}treeNode.on("ibx_dragstart",this.doDragStart.bind(this));
treeNode.data("wcobj",wcnode);treeNode.data("wccontextmenu",false);var haslink=false;if(wcnode.label){var popupxlink,nodexlink;if(wcnode.label.xlink){for(var i=0;i<wcnode.label.xlink.length;i++){var link=wcnode.label.xlink[i];if(link.method=="popup")popupxlink=link;else if(link.method)nodexlink=link}wcnode._objtype="wcnode";if(popupxlink){popupxlink._popupnodes=wcnode._popupnodes;popupxlink.parentNode=wcnode;treeNode.on("mouseenter mouseleave",function(){$(treeNode).toggleClass("wcx-cursor-contextmenu")});
wcAttachLinksTo(treeNode,[popupxlink],"dblclick");wcAttachLinksTo(treeNode,[popupxlink],"contextmenu");wcAttachLinksTo(treeNode,[popupxlink],"wcfirstmenuitem");treeNode.on("ibx_keydown",function(e){if(e.originalEvent.data.keyCode==93){$(this).triggerHandler("contextmenu");e.stopPropagation()}});treeNode.data("wccontextmenu",true)}if(nodexlink){nodexlink.jqobj=treeNode;nodexlink.parentNode=wcnode;haslink=true;treeNode.on("ibx_keydown ibx_click wcselect",{"xlink":[nodexlink],"wctree":this._element},
function(e){if(e.type==="ibx_keydown")if(e.originalEvent.data.keyCode!==$.ui.keyCode.ENTER&&e.originalEvent.data.keyCode!==$.ui.keyCode.SPACE)return;if(typeof this.wcTimeoutId==="undefined"){this.wcTimeoutId=setTimeout(function(e,xlink){delete this.wcTimeoutId;wcHandleClick.bind(xlink)(e.originalEvent?e.originalEvent.data:e)}.bind(this),400,e,e.data.xlink);e.data.wctree.trigger("wcclick",wcGetBreadCrumb(this))}if(e.type==="wcselect")$($(this).ibxWidget("tree")).ibxSelectionManager("selected",$(this),
true);e.stopPropagation()});treeNode.on("ibx_keydown",function(e){if(e.originalEvent.data.keyCode==$.ui.keyCode.ENTER){$(this).triggerHandler("click");e.stopPropagation()}})}}else treeNode.on("contextmenu",function(evt){evt.preventDefault();evt.stopPropagation()})}else{treeNode.addClass("wcx-no-label-node");treeNode.wcNoLabelNode=true}if(!haslink)treeNode.on("wcselect",{"wctree":this._element},function(e){e.data.wctree.trigger("wcclick",wcGetBreadCrumb(this));$($(this).ibxWidget("tree")).ibxSelectionManager("selected",
$(this),true);e.stopPropagation()});if(wcnode.node)this.buildSubNodes(treeNode,wcnode,dragname,path);return treeNode};
_p.buildSubNodes=function(targetNode,wcnode,dragname,path){var childnodes=wcnode.node;if(childnodes)for(var i=0;i<childnodes.length;i++){childnodes[i]._popupnodes=wcnode._popupnodes;var treeNode=this.buildNode(childnodes[i],dragname,path);if(path){if(!this.wcIsMonoTree||!treeNode.wcIsFolder){treeNode.addClass("wcx-search-node");this.ibxSearchTree._element.append(treeNode)}}else targetNode.ibxWidget("add",treeNode)}};
_p.doExpandCollapse=function(evt){var targetNode=$(evt.target);var wcnode=targetNode?targetNode.data("wcnode"):null;if(targetNode&&wcnode)this.wcCurrentNodeID=wcnode.id;var evtType=evt.type;if(evtType=="ibx_beforeexpand")if(wcnode)if(!targetNode.ibxWidget("hasChildren")){wcnode._objtype="wcnode";var link=wcnode.open_image.xlink;if(link){link[0].parentNode=wcnode;wcSubmitLink(link[0])}}};
_p.doDragStart=function(evt){var e=evt.originalEvent;var dt=e.dataTransfer;dt.setDragImage(null,"center","center");var wcnode=null;var targetNode=$(e.currentTarget);var value="";var nodeLabel=targetNode.find(".tnode-label.ibx-sm-selected");if(nodeLabel&&nodeLabel.length>0){var selected=targetNode.closest(this.monotree?".wcx-mono-tree":".wcx-tree").find(".wcx-tree-node > .tnode-label.ibx-sm-selected");for(var i=0;i<selected.length;i++){var node=$(selected[i]).parent();wcnode=node.data("wcnode");if(value!=
"")value+=" ";value+=wcnode.dragvalue}var img=$("<div>").addClass("wcx-dragimage");for(var i=0;i<nodeLabel.length;++i)img.append(nodeLabel[i].cloneNode(true).innerHTML);dt.setDragImage(img[0],20,20)}else{wcnode=targetNode.data("wcnode");value=wcnode.dragvalue}if(value!="undefined"){var dragtypes=[];if(wcnode&&wcnode.dragtypes){dt.setData("dragtype",wcnode.dragtypes);dragtypes=wcnode.dragtypes.split(",")}dragtypes.push("text");var dvalue=value;var dragname=targetNode.data("dragname");if(dragname)dvalue=
dragname+"="+value;for(var i=0;i<dragtypes.length;i++){var dtype=dragtypes[i];dt.setData(dtype,dvalue)}}else evt.preventDefault()};_p.doSearchTextChanged=function(){if(this.wcResultsLoaded)this.doSearchLoad();else{if(this.wcKeyTimeout)clearTimeout(this.wcKeyTimeout);this.wcKeyTimeout=setTimeout(function(){this.doSearchLoad()}.bind(this),500)}};
_p.doSearchLoad=function(){if(this.wcTreeLoading)return;var searchText=this.wcSearchEdit.getText().toLowerCase();var expandedNode=this.ibxtree._element.find(".tnode-expanded");if(searchText.length>0){this.ibxtree.setVisible(false);this.ibxSearchTree.setVisible(true);if(expandedNode.length>0)expandedNode.css("display","none");if(this.wcSearchNode)this.wcSearchNode._element.css("display","inline-block");if(!this.wcResultsLoaded){if(this.wcPaging){var flags=this.wcPaging.flags;if(!(flags&4096)&&flags&
16384){this.wcLoadingPane.setVisible(true);this.wcTreeLoading=true;var xlinks=this.wcPaging.xlink;if(xlinks&&xlinks.length>=1){var link=xlinks[0];var xml=new WcLoader(link.url);for(var i=0;i<link.parameters.length;i++)xml.addParam(link.parameters[i].name,link.parameters[i].value);var otherparams={};otherparams[this.wcPaging.actionname]="PgPattSet";xml.addParam(otherparams);xml.load(this.doHttpCallback.bind(this),null);return}}}this.buildSearchResults()}var searchNodes=this.ibxSearchTree._element.find(".wcx-search-node");
searchNodes.css("display","none");for(var i=0;i<searchNodes.length;i++){var node=searchNodes[i];var nodeText=$(node).find(".ibx-label-text").text();var foundIndex=nodeText.toLowerCase().indexOf(searchText);if(foundIndex>0){$(node).css("display","");var foundText=nodeText.substr(foundIndex,searchText.length);var highlightedText="<span class='wcx-grid-search-highlighted'>"+foundText+"</span>";nodeText=nodeText.replace(foundText,highlightedText);var label=$(node).find(".ibx-label-text");label.html(nodeText)}}}else{this.ibxtree.setVisible(true);
this.ibxSearchTree.setVisible(false);expandedNode.css("display","")}};_p.doSearchTextMouseUp=function(){var $input=$(this.wcSearchEdit._element).find("input");var oldValue=$input.val();if(oldValue=="")return;setTimeout(function(){var newValue=$input.val();if(newValue==""){this.wcSearchEdit.setText("");this.doSearchTextChanged()}}.bind(this),1)};
_p.doHttpCallback=function(rsp){if(!rsp||!rsp.data)return null;for(var i=0;i<rsp.data.item.length;i++)if(rsp.data.item[i].type=="wctree"){var wcitem=rsp.data.item[i];var wcnode=wcitem.node[0];this.buildRootNode(wcnode,wcitem.dragname);this.buildSearchResults();this.wcTreeLoading=false;this.wcLoadingPane.setVisible(false);this.wcSearchEdit._element.focus();this.doSearchTextChanged();return}};
_p.buildSearchResults=function(){var wcnode=this.wcRootNode.data("wcnode");var dragname=this.wcRootNode.data("dragname");this.buildSubNodes(null,wcnode,dragname,"/");this.wcResultsLoaded=true};_p.doMouseDown=function(evt){wcClearTextSelection()};
function WcToolBar(){if(_wcconstructing)return;WcxHBox.call(this);this.wcUseExtTB=false;this._element.addClass("wcx-toolbar");for(var i=0;i<arguments.length;++i)if(typeof arguments[i]==="boolean")this.wcUseExtTB=arguments[i];else this.parentobj=arguments[i];$(this._element).on("mousedown",this.doMouseDown.bind(this));this.left=new WcxHBox;this.left._element.addClass("wcx-toolbar-left");this.add(this.left);this.right=new WcxHBox;this.right._element.addClass("wcx-toolbar-right");this.add(this.right);
this._ribbonbtns=[];this._vtoolbarbtns=[]}_p=WcToolBarProto=wcInherit(WcToolBar,WcxHBox);
_p.dispose=function(){if(wcapplication.toppage&&wcapplication.toppage.mainframe&&wcapplication.toppage.mainframe.ribbon)for(var i=0;i<this._ribbonbtns.length;++i)wcapplication.toppage.mainframe.ribbon.removeButton(this._ribbonbtns[i]);delete this._ribbonbtns;if(wcapplication.toppage&&wcapplication.toppage.mainframe&&wcapplication.toppage.mainframe.contentframe&&wcapplication.toppage.mainframe.contentframe.vtoolbar)for(var i=0;i<this._vtoolbarbtns.length;++i)wcapplication.toppage.mainframe.contentframe.vtoolbar.removeButton(this._vtoolbarbtns[i]);
delete this._vtoolbarbtns;WcxHBox.prototype.dispose.call(this.left);WcxHBox.prototype.dispose.call(this.right);WcxHBox.prototype.dispose.call(this)};_p.addStyle=function(){this.right._element.addClass("wcx-toolbar-decoration");$("<div></div>").addClass("wcx-toolbar-line").appendTo(this.right._element)};
_p.getParams=function(){var params=new Object;var items=this.left.getChildren();for(var i=0;i<items.length;i++){var itm=items[i];if(itm&&itm.getParams)params=wcGetParams(itm,params)}var items=this.right.getChildren();for(var i=0;i<items.length;i++){var itm=items[i];if(itm&&itm.getParams)params=wcGetParams(itm,params)}return params};
_p.addButtons=function(xml,stretch){var wcform=xml;if(wcform.toolbarstyle==1)this.addStyle();var rows=xml.row;if(rows==null||rows.length==0)return;var items=rows[0].item;if(items==null||items.length==0)return;var wcitem;var width=Math.floor(100/items.length);for(var i=0;i<items.length;++i){var item=items[i];item._objtype=item.type;if(item.location&&(item.location==1||item.location==3)){if(wcapplication&&wcapplication.toppage&&wcapplication.toppage.mainframe&&wcapplication.toppage.mainframe.ribbon){wcitem=
wcapplication.toppage.mainframe.ribbon.addButton(item);this._ribbonbtns.push(item)}}else if(item.location&&item.location==2){if(wcapplication&&wcapplication.toppage&&wcapplication.toppage.mainframe&&wcapplication.toppage.mainframe.contentframe){wcitem=wcapplication.toppage.mainframe.contentframe.vtoolbar.addButton(item);this._vtoolbarbtns.push(item)}}else{var right=false;if(item._objtype==="wcbutton"){wcitem=wcCreateIconButton(item);if(item.value)wcitem._element.addClass("wcx-toolbar-textbutton");
if(item.position&&item.position=="right")right=true;this._updateStyle(wcitem._element)}else{if(item.position_right)right=true;wcitem=wcBuild(item);if(item.type==="wcbreadcrumb")this._element.addClass("breadcrumb");if(item._objtype=="wcfilepicker")this._updateStyle(wcitem._element.children(".ibx-button-simple"));else this._updateStyle(wcitem._element)}if(stretch)wcitem._element.css("flex-basis",width+"%").css("padding-left","0px").css("padding-right","0px");this.addItem(wcitem,right)}if(item.updatable&&
wcitem)wcitem.setWcId(item.name)}};_p.addItem=function(wcitem,right){wcitem._element.addClass("wcx-toolbar-item");this._updateStyle(wcitem._element);if(!wcitem.xlink)wcitem._element.addClass("wcx-toolbar-item-nonselectable");if(right)this.right.add(wcitem);else this.left.add(wcitem)};
_p.addSearchHandler=function(handler){this.searchbtn=new wcCreateIconButton({"icon":wcapplication.imgstr.find,"title":ibx.resourceMgr.getString("find")});this.searchbtn._element.addClass("wcx-toolbar-item");this._updateStyle(this.searchbtn._element);this.searchbtn.addEventListener("click",function(e){handler(e)});this.right.add(this.searchbtn)};_p.openSearch=function(){this.searchbtn._element.click()};_p.enableSearchButton=function(enabled){this.searchbtn.setEnabled(enabled)};
_p.addControlButton=function(btn,first){btn._element.addClass("wcx-toolbar-item");this._updateStyle(btn._element);if(first)this.right.prepend(btn);else this.right.add(btn)};_p.addExtButton=function(btn){btn._element.addClass("wcx-toolbar-item");if(this.ext)this.ext.add(btn)};
_p.addMultiframeButtons=function(){var tb_el=this._element;var mfs=$(tb_el).parents(".wcx-multiframe");if(mfs&&mfs.length>1){var mf_el=mfs[0];var mf=$(mf_el).data("wcobj");if(mf&&mf instanceof WcMultiframes)if(!mf.wcNotRestricted){var cps=$(tb_el).closest(".wcx-multiframes-content-pane");if(cps&&cps.length>0){var cp_el=cps[0];var cp=$(cp_el).data("wcobj");if(cp&&cp instanceof WcMultiframesContentPane){var contentInfo=cp.wcContentInfo;var flags=contentInfo.wcOptionsFlag;var cannotClose=flags&wcMF.content.wcCannotClose?
true:false;if(!cannotClose){var frame=cp.wcContentFrame;if(frame&&frame.wcFrameType=="single"){var frameInfo=frame.wcFrameInfo;var frameFlags=frameInfo.wcFrameFlag;var isFramePersistent=frameFlags&wcMF.frame.wcPersistentFrameFlag?true:false;if(!isFramePersistent){var closeBtn=new wcCreateIconButton({"icon":wcapplication.imgstr.close,"title":ibx.resourceMgr.getString("close")});closeBtn.addEventListener("click",function(){frame.hide();mf.sendUpdateLayout("RESIZE")});closeBtn._element.addClass("wcx-toolbar-item");
this.right.add(closeBtn)}}}}}}}};_p.doMouseDown=function(evt){wcClearTextSelection()};
_p._updateStyle=function(el){if(!this._element.hasClass("wcx-toolbar-large"))if(this.parentobj&&(el.hasClass("ibx-button-simple")||el.hasClass("ibx-button"))){if(this.parentobj._element.hasClass("wcx-wctable")||this.parentobj._element.hasClass("wcx-texteditor"))el.addClass("common-btn btn-toolbar");else if(this.parentobj._element.hasClass("wcx-graph"))el.addClass("common-btn btn-toolbar");else if(this.parentobj._element.hasClass("wcx-wcform-toolbar"))el.addClass("common-btn btn-toolbar");if(!el.hasClass("btn-active"))el.addClass("btn-default")}else if(el.hasClass("wcx-label-text")&&
el.hasClass("wcxlink"))el.addClass("common-btn btn-link btn-default").attr("role","link").attr("tabindex","0");else if(el.hasClass("wcx-multiitem")){var children=el.children();for(var i=0;i<children.length;++i)this._updateStyle($(children[i]))}};
function WcToolBarExtended(){if(_wcconstructing)return;WcxHBox.call(this);this.wcUseExtTB=true;this._element.addClass("wcx-ext-toolbar");for(var i=0;i<arguments.length;i++)if(typeof arguments[i]==="boolean")this.wcUseExtTB=arguments[i];else this.parentobj=arguments[i];$(this._element).on("mousedown",this.doMouseDown.bind(this));this.left=new WcxHBox;this.left._element.addClass("wcx-toolbar-left");this.add(this.left);this.right=new WcxHBox;this.right._element.addClass("wcx-toolbar-right");this.add(this.right);
this.ext=new WcxHBox;this.ext._element.addClass("wcx-toolbar-ext");this.add(this.ext);this._ribbonbtns=[];this._vtoolbarbtns=[]}_p=wcInherit(WcToolBarExtended,WcxHBox);
_p.dispose=function(){if(wcapplication.toppage&&wcapplication.toppage.mainframe&&wcapplication.toppage.mainframe.ribbon)for(var i=0;i<this._ribbonbtns.length;++i)wcapplication.toppage.mainframe.ribbon.removeButton(this._ribbonbtns[i]);delete this._ribbonbtns;if(wcapplication.toppage&&wcapplication.toppage.mainframe&&wcapplication.toppage.mainframe.contentframe&&wcapplication.toppage.mainframe.contentframe.vtoolbar)for(var i=0;i<this._vtoolbarbtns.length;++i)wcapplication.toppage.mainframe.contentframe.vtoolbar.removeButton(this._vtoolbarbtns[i]);
delete this._vtoolbarbtns;WcxHBox.prototype.dispose.call(this.left);WcxHBox.prototype.dispose.call(this.right);WcxHBox.prototype.dispose.call(this.ext);WcxHBox.prototype.dispose.call(this)};_p.addStyle=function(){this.ext._element.addClass("wcx-ext-toolbar-decoration");this.ext._element.css("padding-right","16px");$("<div></div>").addClass("wcx-toolbar-line").appendTo(this.ext._element)};
_p.getParams=function(){var params=new Object;var items=this.left.getChildren();for(var i=0;i<items.length;i++){var itm=items[i];if(itm&&itm.getParams)params=wcGetParams(itm,params)}var items=this.right.getChildren();for(var i=0;i<items.length;i++){var itm=items[i];if(itm&&itm.getParams)params=wcGetParams(itm,params)}var items=this.ext.getChildren();for(var i=0;i<items.length;i++){var itm=items[i];if(itm&&itm.getParams)params=wcGetParams(itm,params)}return params};
_p.addExtButton=function(btn){btn._element.addClass("wcx-toolbar-item");this._updateStyle(btn._element);if(this.ext)this.ext.add(btn)};_p.addButtons=WcToolBarProto.addButtons;_p.addItem=WcToolBarProto.addItem;_p.addSearchHandler=WcToolBarProto.addSearchHandler;_p.openSearch=WcToolBarProto.openSearch;_p.enableSearchButton=WcToolBarProto.enableSearchButton;_p.addControlButton=WcToolBarProto.addControlButton;_p.addMultiframeButtons=WcToolBarProto.addMultiframeButtons;_p.doMouseDown=WcToolBarProto.doMouseDown;
_p._updateStyle=WcToolBarProto._updateStyle;
function WcTable(item){if(_wcconstructing)return;WcxVBox.call(this);this._element.addClass("wcx-wctable");this.paging=item.paging;var searchStr=ibx.resourceMgr.getString("search");this.searchbox=$("<input type='text'></input>").attr("qa","searchinput").attr("tabindex","0").attr("placeholder",searchStr).attr("aria-label",searchStr);var searchText=wcapplication.wcLastTableSearchText;if(searchText)$(this.searchbox).val(searchText);this.searchbox.keyup(function(e){if(e.keyCode==$.ui.keyCode.TAB)return;
if(this.searchbox.timerid){clearTimeout(this.searchbox.timerid);delete this.searchbox.timerid}if(e.keyCode==$.ui.keyCode.ENTER)this.jqgrid.search(this.searchbox.val());else this.searchbox.timerid=setTimeout(function(grid){delete grid.searchbox.timerid;if(!grid.gotall&&grid.paging&&!(grid.paging.flags&4096)&&grid.paging.flags&16384){var xlinks=grid.paging.xlink;if(xlinks&&xlinks.length>=1){grid.gotall=true;grid.searchbox.prop("disabled",true);wcapplication.wcLastTableSearchText=grid.searchbox.val();
xlinks[0].jqobj=grid._element;xlinks[0].getOtherParams=function(){var p={};p[this.paging.actionname]="PgPattSet";p[this.paging.searchname]=this.searchbox.val();return p}.bind(grid);wcExecLink(xlinks[0])}return}grid.jqgrid.search(grid.searchbox.val())},400,this)}.bind(this));var flags=item.flags;this.flags=flags;if(flags&64&&!(flags&65536)||flags&131072)this.iconviewok=true;else this.iconviewok=false;if(flags&16){this.tree=true;this.sortable=false}else{this.tree=false;this.sortable=item.sortable}var rowinfo;
if(flags&32768)rowinfo=new WcxLabel("",true);else rowinfo=null;var btns=wcGetTopButtons(item);if(btns||item.searchable||rowinfo!=null||flags&256){var bar=new WcToolBar(this);if(item.toolbarstyle==1)bar.addStyle();if(flags&256){this.contextmenucontainer=new WcxHBox;this.contextmenucontainer._element.addClass("wcx-grid-toolbar-contextmenucontainer");bar.addItem(this.contextmenucontainer,true)}if(btns)bar.addButtons(btns);if(rowinfo!=null)bar.addItem(rowinfo);if(bar){this.toolbar=bar;this.prepend(bar)}}this.tableid=
item.id;this.wcitem=item;this.dropxlinkxml=item.xlinkd;this.dragname=item.dragname;if(item.dragcolumn!==undefined)this.dragcolumn=item.dragcolumn;this.dropname=item.dropname;this.coldragname=item.coldragname;this.coldropname=item.coldropname;this.dropmiddlename=item.dropmiddlename;this.expandstatesname=item.expandstatesname;if(item.rowhighlightname)this.rowhighlightname=item.rowhighlightname;if(item.colhighlightname)this.colhighlightname=item.colhighlightname;this.dropheadvalue=item.dropheadvalue;
this.droptailvalue=item.droptailvalue;this.clickable=item.clickable;this.cantremovedcol=[];this.draggable=false;this._element.attr("wctable",this.tableid);this._element.addClass("wcx-wctable-"+this.tableid);var nrow=item.nrow;if(nrow<=0)return;var rows=item.table_row;var headers;if(rows[0].childNodes)headers=new wcTableRow(rows[0]);else headers=rows[0];this.jqgrid=new WcGrid(item.hint);maxcols=0;this.headercells=headers.table_cell;this.othercols=item.othercolumns;if(this.othercols)wcapplication.setLocalStorageItem("grid,"+
this.tableid+",hiddencol","");var hc=wcapplication.getLocalStorageItem("grid,"+this.tableid+",hiddencol");if(hc){var array=hc.split(",");for(var j=0;j<array.length;++j)if(array[j]=="true")this.jqgrid.hideThisColumn(j,true);else{this.jqgrid.hideThisColumn(j,false);++maxcols}}else for(var j=0;j<this.headercells.length;++j)if(this.headercells[j].hidecolumn)this.jqgrid.hideThisColumn(j,true);else{this.jqgrid.hideThisColumn(j,false);++maxcols}for(var j=0;j<this.headercells.length;++j)this.cantremovedcol[j]=
this.headercells[j].cantremoved;var maxrow;if(flags&32768){if(nrow>1){if(item._page)rows[1]._page=item._page;this.charts=wcParseTableRow(rows[1],this)}for(var i=2;i<nrow;++i){var row=rows[i];if(item._page)row._page=item._page;this.jqgrid.addRow(wcParseTableRow(row,this))}maxrow=nrow-2}else{for(var i=1;i<nrow;++i){var row=rows[i];if(item._page)row._page=item._page;this.jqgrid.addRow(wcParseTableRow(row,this))}maxrow=nrow-1}if(item.class)this.jqgrid._element.addClass(item.class);this.jqgrid.setGridId(this.tableid);
this.add(this.jqgrid);btns=wcGetBottomButtons(item);if(btns){var bar=new WcToolBar(this);bar.addButtons(btns);this.jqgrid.addBottom(bar)}else if(flags&4096)this.jqgrid.setLastRowBorder(true);if(this.paging)this.add(new WcPagingToolbar(this.paging,this));this.jqgrid.setPaging(this.paging);this.jqgrid.setMaxCols(maxcols);if(flags&32768)this.jqgrid.showCharts(true,rowinfo);else this.jqgrid.showCharts(false);this.jqgrid.setMaxRows(maxrow);this.jqgrid.showHeaders(!(flags&2048));this.jqgrid.setSingleSectionOnly(flags&
4);this.jqgrid.setScrollRowIntoView(item.scrollrow);this.jqgrid.setScrollColIntoView(this._convertToDisplayIdx(item.scrollcolumn));this.jqgrid.setSelectedColumn(this._convertToDisplayIdx(item.selectedcol));this.jqgrid.enableColumnHighlight(item.colhilight|item.colhighlightname);this.jqgrid.setContextMenu(this.contextmenucontainer);this.jqgrid.setDragColumn(this.dragcolumn);if(!this.tree&&item.border)this.jqgrid.addBorder();if(item.height){this.jqgrid.setHeight(item.height);this._element.css("flex",
"none")}if(flags&131072)this.jqgrid.gridview=true;if(flags&65536)this.jqgrid.setView("icon");else if(this.iconviewok)this.jqgrid.setView(wcapplication.getLocalStorageItem("grid,"+this.tableid+",view"));if(flags&512)this.jqgrid.setView("dropbox");if(flags&2)this.jqgrid.setPlain(true);if(flags&262144)this.jqgrid.disableHighlight(true);if(flags&8192)this.jqgrid.setHStretch(true);if(flags&16384)this.jqgrid.addGridLine(true);if(flags&4096){this.jqgrid.setHStretch(true);this.jqgrid.setPlain(true)}if(item.colortag)this.jqgrid.colortag=
true;if(item.showall)this.jqgrid.showall=true;if(item.rowheight)this.jqgrid.setRowHeight(item.rowheight);if(this.tree)this.jqgrid.setTreeCol(item.treecol);if(item.samecolwidth)this.jqgrid.samecolwidth=true;if(item.viewcontrol&&this.toolbar){if(this.iconviewok){var vbtn;if(this.jqgrid.getView()=="icon")vbtn=new wcCreateIconButton({"icon":"ds-icon-justified","title":ibx.resourceMgr.getString("listview")});else vbtn=new wcCreateIconButton({"icon":"ds-icon-grid-1","title":ibx.resourceMgr.getString("gridview")});
this.toolbar.addControlButton(vbtn);vbtn._element.on("click",vbtn,function(e){if(this.jqgrid.getView()=="icon"){e.data.setIcon("ds-icon-grid-1");e.data.setTitle(ibx.resourceMgr.getString("gridview"));setQaAttrToElement(e.data._element,ibx.resourceMgr.getString("gridview"));wcapplication.setLocalStorageItem("grid,"+this.tableid+",view","list");if(this.choosecolbtn)this.choosecolbtn._element.show();this.jqgrid.setView("list")}else{e.data.setIcon("ds-icon-justified");e.data.setTitle(ibx.resourceMgr.getString("listview"));
setQaAttrToElement(e.data._element,ibx.resourceMgr.getString("listview"));wcapplication.setLocalStorageItem("grid,"+this.tableid+",view","icon");if(this.choosecolbtn)this.choosecolbtn._element.hide();this.jqgrid.setView("icon")}this.jqgrid.draw()}.bind(this))}if(this.headercells.length>0){this.choosecolbtn=new wcCreateIconButton({"icon":"wc_select_columns.svg","title":ibx.resourceMgr.getString("choosecol")});this.toolbar.addControlButton(this.choosecolbtn);this.wcSelectColTitle=item.selectcoltitle?
item.selectcoltitle:null;this.choosecolbtn._element.on("click",function(e){this._showColumnSelection()}.bind(this));if(this.jqgrid.getView()=="icon")this.choosecolbtn._element.hide()}}this.hasInlineSearchBox=false;if(this.toolbar&&item.searchable)if(!this.tree||item.searchboxstyle==1){var hbox=new WcxHBox;hbox._element.addClass("wcx-grid-toolbar-searchbox");hbox._element.append(this.searchbox);var removeSearchStr=ibx.resourceMgr.getString("removesearchstr");var img=new WcxLabel(null,null,"ds-icon-times");
img.setTitle(removeSearchStr);img._element.addClass("common-btn btn-link btn-default close-btn").attr("tabindex","0").ibxWidget("setAccessibility",true,{role:"button"}).attr("aria-label",removeSearchStr);img._element.on("click",this.searchbox,function(e){e.data.val("");e.data.triggerHandler($.Event("keyup",{which:13}))});hbox._element.append(img._element);img=new WcxLabel(null,null,"ds-icon-search");hbox._element.append(img._element);this.toolbar.addItem(hbox,true);this.hasInlineSearchBox=true}else if(item.searchboxstyle==
2){var hbox=new WcxHBox;hbox._element.addClass("wcx-grid-toolbar-underneathsearchbox");hbox._element.append(this.searchbox);var img=new WcxLabel(null,null,"ds-icon-search");hbox._element.append(img._element);this.insertAfter(hbox,this.toolbar);if(btns==null)bar=null}else{this.hiddensearchbox=true;bar.addSearchHandler(function(e){if(this.jqgrid.searchboxcontainer){this.jqgrid.closeSearchPanel();return}if(this.paging&&!(this.paging.flags&4096)&&this.paging.flags&16384){var xlinks=this.paging.xlink;
if(xlinks&&xlinks.length>=1){xlinks[0].jqobj=this._element;xlinks[0].getOtherParams=function(){var p={};p[this.paging.actionname]="PgPattSet";return p}.bind(this);wcExecLink(xlinks[0]);return}}this.jqgrid.openSearchPanel(this.paging?this.paging.searchvalue:null)}.bind(this))}this.jqgrid.runRowDropXlink=function(rowid,colid,data,coldata,middle){if(!data||data=="")return;var link=JSON.parse(JSON.stringify(this.dropxlinkxml));var s=data.indexOf("=");if(s>0){link.jqobj=this._element;wcAddParameter(link,
data.substring(0,s),data.substring(s+1));wcAddParameter(link,this.dropname,rowid);if(this.dropmiddlename&&middle)wcAddParameter(link,this.dropmiddlename,"y");if(this.coldropname)wcAddParameter(link,this.coldropname,colid);if(coldata&&coldata!=""){s=coldata.indexOf("=");if(s>0)wcAddParameter(link,coldata.substring(0,s),coldata.substring(s+1))}var p=wcGetOtherParams.bind(this)();if(p)for(var k in p)if(k&&p.hasOwnProperty(k))wcAddParameter(link,k,p[k]);wcSubmitLink(link)}}.bind(this);this.jqgrid.isClickable=
function(){return this.rowhighlightname||this.clickable?true:false}.bind(this);this.jqgrid.isTableDraggable=function(){return this.dragname||this.draggable}.bind(this);this.jqgrid.getTableDragName=function(){return this.dragname}.bind(this);this.jqgrid.getTableColDragName=function(){return this.coldragname}.bind(this);this.jqgrid.isTableDroppable=function(){if(this.dropxlinkxml&&this.dropname)return true;return false}.bind(this);this.jqgrid.isBodyDroppable=function(){if(this.dropxlinkxml&&this.dropname&&
this.droptailvalue)return true;return false}.bind(this);this.jqgrid.isRowMiddleDroppable=function(){if(this.dropxlinkxml&&this.dropname&&this.dropmiddlename)return true;return false}.bind(this);this.jqgrid.isHeaderDroppable=function(){if(this.dropxlinkxml&&this.dropname&&this.dropheadvalue)return true;return false}.bind(this);this.jqgrid.runBodyDropXlink=function(data,coldata){var link=JSON.parse(JSON.stringify(this.dropxlinkxml));var s=data.indexOf("=");if(s>0){link.jqobj=this._element;wcAddParameter(link,
data.substring(0,s),data.substring(s+1));wcAddParameter(link,this.dropname,this.droptailvalue);if(coldata&&coldata!=""){s=coldata.indexOf("=");if(s>0)wcAddParameter(link,coldata.substring(0,s),coldata.substring(s+1))}var p=wcGetOtherParams.bind(this)();if(p)for(var k in p)if(k&&p.hasOwnProperty(k))wcAddParameter(link,k,p[k]);wcSubmitLink(link)}}.bind(this);this.jqgrid.runHeaderDropXlink=function(data,coldata){var link=JSON.parse(JSON.stringify(this.dropxlinkxml));var s=data.indexOf("=");if(s>0){link.jqobj=
this._element;wcAddParameter(link,data.substring(0,s),data.substring(s+1));wcAddParameter(link,this.dropname,this.dropheadvalue);if(coldata&&coldata!=""){s=coldata.indexOf("=");if(s>0)wcAddParameter(link,coldata.substring(0,s),coldata.substring(s+1))}var p=wcGetOtherParams.bind(this)();if(p)for(var k in p)if(k&&p.hasOwnProperty(k))wcAddParameter(link,k,p[k]);wcSubmitLink(link)}}.bind(this);this.jqgrid.getBodyCellXlinks=function(x,y){if(this.jqgrid.neworder)y=this.jqgrid.neworder[y];var idx=0;for(var i=
0;i<this.jqgrid.rows[y].cells.length;++i)if(!this.jqgrid.hiddencol[i]&&idx++==x){if(this.jqgrid.rows[y].cells[i]==null)return null;if(this.jqgrid.rows[y].cells[i].xlink&&this.wcitem._page)for(var j=0;j<this.jqgrid.rows[y].cells[i].xlink.length;j++)if(this.wcitem._page._rsp.data&&this.wcitem._page._rsp.data.share)this.jqgrid.rows[y].cells[i].xlink[j]._popupnodes=this.wcitem._page._rsp.data.share.node;if(this.jqgrid.rows[y].cells[i].xlink)for(var k=0;k<this.jqgrid.rows[y].cells[i].xlink.length;k++)this.jqgrid.rows[y].cells[i].xlink[k].parentNode=
this.jqgrid.rows[y].cells[i];return this.jqgrid.rows[y].cells[i].xlink}return null}.bind(this);this.jqgrid.getBodyCell=function(x,y){if(this.jqgrid.neworder)y=this.jqgrid.neworder[y];var idx=0;for(var i=0;i<this.jqgrid.rows[y].cells.length;++i)if(!this.jqgrid.hiddencol[i]&&idx++==x){if(this.jqgrid.rows[y].cells[i]==null)return"";var first=null;if(this.jqgrid.rows[y].items[i]&&!(this.jqgrid.rows[y].items[i][0]instanceof WcHidden)){first=this.jqgrid.rows[y].items[i][0];if(first.setEnabled)first.setEnabled(this.jqgrid.rows[y].enabled>
0)}else{this.jqgrid.rows[y].items[i]=null;var el=this.jqgrid.rows[y].cells[i].item;if(el)for(var k=0;k<el.length;++k){var obj=wcBuild(el[k]);if(obj){obj._element.removeClass("wcxlink");var eobj=null;if(obj instanceof WcTextOnly){if(obj.textwrapped)obj.setWrap(false);if(this.jqgrid.rows[y].cells[i].xlinkedit&&this.jqgrid.rows[y].cells[i].xlinkedit.inline)eobj=obj._element}else if(obj instanceof WcText){if(obj.textwrapped)obj.label.setWrap(false);if(this.jqgrid.rows[y].cells[i].xlinkedit&&this.jqgrid.rows[y].cells[i].xlinkedit.inline)eobj=
obj._element}else if(obj instanceof WcImage){if(this.jqgrid.rows[y].cells[i].xlinkedit&&this.jqgrid.rows[y].cells[i].xlinkedit.inline)eobj=obj._element}else if(obj instanceof WcInputText)setTimeout(function(){var input=obj._element.find("input");input.on("blur",function(evt){$(this.jqgrid.body._element).attr("tabindex","0")}.bind(this))}.bind(this),0);else if(obj instanceof WcButton){obj._element.addClass("common-btn btn-toolbar");if(!obj._element.hasClass("btn-active"))obj._element.addClass("btn-default")}else if(obj instanceof
WcMultiItem){var children=obj.getChildren();for(var n=0;n<children.length;++n)if(children[n]instanceof WcButton){var el=children[n]._element;el.addClass("common-btn btn-toolbar");if(!el.hasClass("btn-active"))el.addClass("btn-default")}}else if(obj instanceof WcCheckBox){obj.wcTable=this;obj._element.ready(function(){var wcGrid=this.wcTable.jqgrid;wcGrid.wcHasCheckboxSelect=false;var input=$(this._element).find("input");var hasCheckboxSelect=$(input).closest(".wcx-checkbox-select");if(hasCheckboxSelect&&
hasCheckboxSelect.length){wcGrid.wcHasCheckboxSelect=true;wcGrid.setPlain(true);this.checkbox.addEventListener("click",function(){var allrows=wcGrid.body._element.find(".wcx-grid-body-row");for(var i=0;i<allrows.length;i++){var row=$(allrows[i]);var chkboxchk=row.find(".wcx-checkbox.checked");var isChecked=chkboxchk&&chkboxchk.length;if(isChecked)row.addClass("wcx-selected").attr("aria-selected","true");else row.removeClass("wcx-selected").attr("aria-hidden","true").removeAttr("aria-selected");wcGrid._getRow(parseInt(row.attr("row"))).selected=
isChecked}}.bind(this))}}.bind(obj))}if(eobj)setTimeout(function(eobj,xlink){eobj.closest(".wcx-grid").data("wcobj").editing=true;eobj.ibxWidget("startEditing",{editOnFocus:true}).one("ibx_changed ibx_canceledit",xlink,function(e){delete $(this).closest(".wcx-grid").data("wcobj").editing;if(e.type=="ibx_changed")if(e.originalEvent.data!=""&&e.originalEvent.data!=$(e.target).ibxWidget("preEditValue")){wcAddParameter(e.data,e.data.inline.inline_param,e.originalEvent.data);wcExecLink(e.data)}else{$(e.currentTarget).ibxWidget("option",
"text","");$(e.currentTarget).ibxWidget("option","text",$(e.target).ibxWidget("preEditValue"))}})},0,eobj,this.jqgrid.rows[y].cells[i].xlinkedit);if(k==0){first=obj;first.setTitle(this.jqgrid.rows[y].cells[i].title)}if(obj.getParams){if(!this.jqgrid.rows[y].items[i])this.jqgrid.rows[y].items[i]=[];this.jqgrid.rows[y].items[i].push(obj);if(this.jqgrid.rows[y].disabled)if(obj instanceof WcCheckBox&&obj.checkbox.getChecked()&&obj.xlinks)for(var n=0;n<obj.xlinks.length;++n){if(obj.xlinks[n].method=="row_toggle"||
obj.xlinks[n].method=="row_top")this.jqgrid.rows[y].enabled++}else if(obj instanceof WcComboBox||obj instanceof WcSelect||obj instanceof WcInputText)obj.setEnabled(false);obj._element.attr("wctable",this.tableid).attr("wcrow",y);obj._element.addClass("wcx-wctable-"+this.tableid);if(this.jqgrid.rows[y].enabled>0&&obj.setEnabled)obj.setEnabled(true)}}}}if(first==null)return"";if(this.jqgrid.getView()=="icon"){if(first instanceof WcText||first instanceof WcTextOnly){first=new WcxLabel(first.text);first.setIcon("ds-icon-help")}else if(!(first instanceof
WcImage))return"";first.setTitle(first.getText())}return first._element}return""}.bind(this);this.jqgrid.getChartCell=function(x){var idx=0;for(var i=0;i<this.charts.cells.length;++i)if(!this.jqgrid.hiddencol[i]&&idx++==x){if(this.charts.cells[i]==null)return"";var first=null;var el=this.charts.cells[i].item;if(el)for(var k=0;k<el.length;++k){var obj=wcBuild(el[k]);if(obj&&k==0){first=obj;first.setTitle(this.charts.cells[i].title)}}if(first==null)return"";return first._element}return""}.bind(this);
this.jqgrid.isHeaderCellWidthFixed=function(x){var idx=0;for(var i=0;i<this.headercells.length;++i)if(!this.jqgrid.hiddencol[i]&&idx++==x)return!this.headercells[i].flexiblewidth;return true}.bind(this);this.jqgrid.isHeaderCellHighlighted=function(x){var idx=0;for(var i=0;i<this.headercells.length;++i)if(!this.jqgrid.hiddencol[i]&&idx++==x)return this.headercells[i].highlightcolumn?true:false;return false}.bind(this);this.jqgrid.getHeaderTagText=function(x){var idx=0;for(var i=0;i<this.headercells.length;++i)if(!this.jqgrid.hiddencol[i]&&
idx++==x){if(this.headercells[i].colortext)return this.headercells[i].colortext;return""}return""}.bind(this);this.jqgrid.getHeaderTagColor=function(x){var idx=0;for(var i=0;i<this.headercells.length;++i)if(!this.jqgrid.hiddencol[i]&&idx++==x){if(this.headercells[i].colortag)return this.headercells[i].colortag;return""}return""}.bind(this);this.jqgrid.getHeaderItem=function(x){var idx=0;for(var i=0;i<this.headercells.length;++i)if(!this.jqgrid.hiddencol[i]&&idx++==x){var el=this.headercells[i].item;
if(el&&el.length>0){var obj=wcBuild(el[0]);if(obj==null)continue;obj.setTitle(this.headercells[i].title);var hbox=new WcxHBox;var sortbox;var vbox;if(this.flags&32768){vbox=new WcxVBox;sortbox=new WcxHBox;vbox.add(hbox);vbox.add(sortbox);if(obj instanceof WcxLabel){var l=new WcxLabel(obj.getText());sortbox.add(l);obj.setText("")}}else sortbox=hbox;hbox.add(obj);if(this.sortable&&!(obj instanceof WcCheckBox)&&!this.headercells[i].nosort){var iconname;if(this.sortcol==i)if(this.sortorder==0)iconname=
"ds-icon-arrow-down";else iconname="ds-icon-arrow-up";else iconname="ds-icon-move-vertical";var btn=new wcCreateIconButton({"icon":iconname});btn.setEnabled(false);btn._element.addClass("wcx-grid-sort-btn");sortbox.add(btn);sortbox._element.on("click",{"col":i,"numericsort":typeof this.headercells[i].numericsort!=="undefined"?this.headercells[i].numericsort:false,"button":btn},function(e){if(this.sortcol==e.data.col)if(this.sortorder==0){this.sortorder=1;e.data.button.setIcon("ds-icon-arrow-up")}else{if(this.sortorder==
1){delete this.sortcol;e.data.button.setIcon("ds-icon-move-vertical")}}else{this.sortcol=e.data.col;this.numericsort=e.data.numericsort;this.sortorder=0;var col=this.jqgrid.headerrow.find(".wcx-grid-header-cell .wcx-grid-sort-btn");for(var j=0;j<col.length;++j)$(col[j]).data("wcobj").setIcon("ds-icon-move-vertical");e.data.button.setIcon("ds-icon-arrow-down")}this._sort();this.jqgrid.draw(true);if(this.jqgrid.bodyrows&&this.jqgrid.body._element.innerHeight()!=0){this.jqgrid.lasttopposition=0;if(this.jqgrid.getView()==
"list")this.jqgrid._scrollGrid(e)}}.bind(this))}if(this.headercells[i].xlink){var btn=new wcCreateIconButton({"icon":"ds-icon-setting"});if(this.flags&32768)hbox.add(btn);else{var newbox=new WcxHBox;newbox._element.css("justify-content","space-between");newbox.add(hbox);newbox.add(btn);hbox=newbox}btn._element.on("click",this.headercells[i],function(e){e.stopPropagation();var xlinks=e.data.xlink;if(xlinks){for(var k=0;k<xlinks.length;k++){if(this.wcitem._page._rsp.data&&this.wcitem._page._rsp.data.share)xlinks[k]._popupnodes=
this.wcitem._page._rsp.data.share.node;xlinks[k].jqobj=this._element;xlinks[k].getOtherParams=wcGetOtherParams}wcHandleClick.bind(xlinks)(e)}}.bind(this))}if(this.flags&32768)return vbox._element;return hbox._element}}return""}.bind(this);this._element.ready(function(){var wcContent=$(this._element).parent(".wcx-content");if(wcContent&&wcContent.length)wcContent.addClass("wcx-has-wctable")}.bind(this));this._element.resize(function(e){e.stopPropagation();this.jqgrid.resize();this._resizeSearchBox();
if(this.jqgrid.bodyrows&&this.jqgrid.body._element.innerHeight()!=0)if(this.jqgrid.getView()=="icon")this.jqgrid._scrollIcon(e);else if(this.jqgrid.getView()=="dropbox")this.jqgrid._scrollDropbox();else this.jqgrid._scrollGrid(e)}.bind(this));setTimeout(function(reposition){var xlinks=this.wcitem.xlink;if(xlinks)for(var i=0;i<xlinks.length;++i){xlinks[i].jqobj=this._element;xlinks[i].nofocus=true;wcSubmitLink(xlinks[i])}if(this.paging&&this.paging.flags&1){this.jqgrid.search(this.paging.searchvalue);
if(this.hiddensearchbox&&this.toolbar)this.toolbar.openSearch();if(this.paging.searchvalue)this.searchbox.val(this.paging.searchvalue)}else this.jqgrid.draw(reposition);var searchText=wcapplication.wcLastTableSearchText;if(searchText){$(this.searchbox).val(searchText);this.jqgrid.search(searchText);setTimeout(function(){$(this.searchbox).focus()}.bind(this),500)}wcapplication.wcLastTableSearchText="";if(this.jqgrid.viewmode=="icon"){var jqobjs=$(this._element).find(".wcx-grid-iconview-cell");if(jqobjs&&
jqobjs.length)jqobjs.attr("role","gridcell")}else{var jqobjs=$(this._element).find(".wcx-grid-body-row-cell");if(jqobjs&&jqobjs.length)jqobjs.attr("role","gridcell")}this._resizeSearchBox();$(this._element).find(".wcx-text-field input").bind("mouseenter",function(){var $this=$(this);if(this.offsetWidth<this.scrollWidth)$this.attr("title",$this.val());else $this.removeAttr("title")});$(this._element).trigger("tableready")}.bind(this),0,item.keeplastlocation)}_p=wcInherit(WcTable,WcxVBox);
_p.getParams=function(){var params=new Object;if(this.toolbar)params=wcGetParams(this.toolbar,params);var l=this.jqgrid.rows.length;for(var i=0;i<l;++i)if(this.jqgrid.rows[i].enabled>0){var n=this.jqgrid.rows[i].items.length;for(var j=0;j<n;++j)if(this.jqgrid.rows[i].items[j]===undefined){if(this.jqgrid.rows[i].cells[j]){var el=this.jqgrid.rows[i].cells[j].item;if(el)for(var k=0;k<el.length;++k){var obj=wcBuild(el[k]);if(obj&&obj.getParams)params=wcGetParams(obj,params)}}}else if(this.jqgrid.rows[i].items[j]!==
null)for(var k=0;k<this.jqgrid.rows[i].items[j].length;++k)params=wcGetParams(this.jqgrid.rows[i].items[j][k],params)}var p=wcGetOtherParams.bind(this)();if(p)for(var k in p)if(k&&p.hasOwnProperty(k))params[k]=p[k];return params};_p.unSelectAll=function(){for(var i=0;i<this.jqgrid.rows.length;++i)if(this.jqgrid.rows[i].selected)this.jqgrid.rows[i].selected=false;this.jqgrid.body._element.find(".wcx-selected").each(function(){$(this).triggerHandler("wcunselect")})};
_p.takeFocus=function(){if(this.jqgrid){var el=this.jqgrid._element;setTimeout(function(){el.focus()},0);return true}return false};_p.isRowEnabled=function(indexstr){if(!indexstr)return false;return this.jqgrid.rows[parseInt(indexstr)].enabled>0};
_p.enableRow=function(indexstr,enabled,rowtop){var idx;if(typeof indexstr=="number")idx=indexstr;else{if(!indexstr)return;idx=parseInt(indexstr)}if(idx<0){for(i=0;i<this.jqgrid.rows.length;++i)this.enableRow(i,enabled);return}if(this.jqgrid.neworder)idx=this.jqgrid.neworder[idx];var row=this.jqgrid.rows[idx];if(enabled==true)row.enabled++;else if(--row.enabled<0)row.enabled=0;for(var j=0;j<row.items.length;++j)if(row.items[j])for(var k=0;k<row.items[j].length;++k)if(row.items[j][k].setEnabled)row.items[j][k].setEnabled(row.enabled>
0)};_p.uncheckRadio=function(name,id){for(i=0;i<this.jqgrid.rows.length;++i){var n=this.jqgrid.rows[i].items.length;for(var j=0;j<n;++j)if(this.jqgrid.rows[i].items[j])for(var k=0;k<this.jqgrid.rows[i].items[j].length;++k)if(this.jqgrid.rows[i].items[j][k]instanceof WcRadio&&this.jqgrid.rows[i].items[j][k].getName()==name&&this.jqgrid.rows[i].items[j][k]._id!=id)this.jqgrid.rows[i].items[j][k].radio.setChecked(false)}};
_p.checkGroup=function(name,checked){var i;if(this.jqgrid.showall==false){this.jqgrid.showall=true;this.jqgrid.draw(true)}for(i=0;i<this.jqgrid.rows.length;++i){var n=this.jqgrid.rows[i].items.length;for(var j=0;j<n;++j)if(this.jqgrid.rows[i].items[j])for(var k=0;k<this.jqgrid.rows[i].items[j].length;++k)if(this.jqgrid.rows[i].items[j][k]instanceof WcCheckBox){var attr=this.jqgrid.rows[i].items[j][k]._element.attr("wcgroup");if(attr){var groups=attr.split(",");for(var l=0;l<groups.length;++l)if(groups[l]==
name&&this.jqgrid.rows[i].items[j][k].checkbox.getChecked()!=checked){var found=true;if(this.jqgrid.searchstr&&checked){found=false;for(var m=0;m<this.jqgrid.rows[i].cells.length;++m)if(!this.jqgrid.hiddencol[m]){var text=this.jqgrid.getCellText(m,i);if(text!=""&&this.jqgrid.srchregexp.test($("<div></div>").text(text).html())){found=true;break}}}if(found)this.jqgrid.rows[i].items[j][k].checkbox._element.trigger("click");break}}}}};
_p._resizeSearchBox=function(){var maxWidth=300;var minWidth=40;var delta=79+42+10;var tableWidth=this._element.prop("clientWidth");var rightToolbar=$(this._element.find(".wcx-toolbar-right")[0]);var rightWidth=Math.floor(rightToolbar.innerWidth());var newWidth=Math.min(maxWidth,Math.floor(rightWidth/2));if(newWidth<minWidth+delta)newWidth=rightWidth-delta;rightToolbar.css({"padding-right":""});if(this.hasInlineSearchBox)rightToolbar.css({"min-width":"160px"});if(newWidth<=minWidth){newWidth=minWidth;
rightToolbar.addClass("wcx-toolbar-minwidth");rightToolbar.css({"padding-right":"0px"})}this.searchbox.width(newWidth)};_p._convertToDisplayIdx=function(n){if(n==null||n===undefined)return-1;var idx=-1;if(n>=0)for(var i=0;i<this.jqgrid.hiddencol.length&&i<=n;++i)if(!this.jqgrid.hiddencol[i])++idx;return idx};
_p.setSelected=function(fn){this.jqgrid.selectedfn=function(){var rows=[];var all=this.jqgrid.body._element.find(".wcx-selected");for(var i=0;i<all.length;++i)rows.push(parseInt($(all[i]).attr("row")));var selected=[];for(var i=0;i<rows.length;++i){var val=null;var idx;if(this.jqgrid.neworder)idx=this.jqgrid.neworder[rows[i]];else idx=rows[i];var row=this.jqgrid.rows[idx];for(var j=0;j<row.items.length;++j){if(!row.items[j])continue;for(var k=0;k<row.items[j].length;++k)if(row.items[j][k]instanceof
WcHidden){val=row.items[j][k].getUserData();break}if(val!=null)break}if(val==null)val=row.cells[0].item[0].text;if(val!=null)selected.push(val)}fn(selected)}.bind(this)};
_p._resetToDefaults=function(){if(this.othercols){var link=JSON.parse(JSON.stringify(this.othercols.xlink));link.jqobj=this._element;wcAddParameter(link,this.othercols.paramname,-1);wcSubmitLink(link)}else{var maxcols=0;this.jqgrid.hiddencol=[];for(var j=0;j<this.headercells.length;++j)if(this.headercells[j].hidecolumn)this.jqgrid.hideThisColumn(j,true);else{this.jqgrid.hideThisColumn(j,false);++maxcols}this.jqgrid.setMaxCols(maxcols);this.jqgrid.draw();wcapplication.setLocalStorageItem("grid,"+this.tableid+
",hiddencol",this.jqgrid.hiddencol.toString())}};
_p._sort=function(){if(this.sortcol===undefined){delete this.jqgrid.neworder;return}var data=[];var i=0;for(;i<this.jqgrid.rows.length;++i)data.push({"value":this._getCellSortValue(this.sortcol,i),"idx":i});if(this.sortorder==0)if(this.numericsort)data.sort(function(a,b){return b.value-a.value});else data.sort(function(a,b){if(a.value>b.value)return-1;if(b.value>a.value)return 1;return 0});else if(this.numericsort)data.sort(function(a,b){return a.value-b.value});else data.sort(function(a,b){if(a.value>
b.value)return 1;if(b.value>a.value)return-1;return 0});this.jqgrid.neworder=[];for(var i=0;i<data.length;++i)this.jqgrid.neworder.push(data[i].idx)};_p._getCellSortValue=function(x,y){if(this.numericsort){var c=this.jqgrid.rows[y].cells[x];if(c==null)return 0;if(typeof c.sortvalue!=="undefined")return c.sortvalue;var el=this.jqgrid.rows[y].cells[x].item;if(!el||el.length==0)return 0;if(el[0].text)return el[0].text.toLowerCase();return 0}return this.jqgrid.getCellText(x,y).toLowerCase()};
_p._showColumnSelection=function(){var d=new WcxDialog(null,"okcancelcustom");d._element.addClass("wcx-mf-dialog");d.setCaption(ibx.resourceMgr.getString("choosecol"));var vbox=new WcxVBox;d.addItem(vbox);this.wcColSelDlg=d.getInstance();this.wcColSelDlg.btnOK.addClass("common-btn btn-solid btn-default");this.wcColSelDlg.btnOK.css({order:1});this.wcColSelDlg.btnOK.attr("qa",this.wcColSelDlg.btnOK.text());this.wcColSelDlg.btnCancel.addClass("common-btn btn-ghost btn-default");this.wcColSelDlg.btnCancel.attr("qa",
this.wcColSelDlg.btnCancel.text());this.wcColSelDlg.btnCustom.addClass("common-btn btn-link btn-default");this.wcColSelDlg.btnCustom.text(ibx.resourceMgr.getString("resetd"));this.wcColSelDlg.btnCustom.attr("qa",ibx.resourceMgr.getString("resetd"));d._element.on("ibx_custom",function(e){this._resetToDefaults();this.wcColSelDlg.close()}.bind(this));var grid=new WcGrid;grid.wctable=this;vbox.add(grid);vbox.setHeight(300);if(this.othercols){d._element.css("width","400px");if(this.othercols.selectcoltitle)d.setCaption(this.othercols.selectcoltitle);
this.othercolsvalue=[];var cols=this.othercols.name;for(var i=0;i<cols.length;++i){this.othercolsvalue[i]=false;for(var j=this.othercols.showtheseonly?0:1;j<this.headercells.length;++j){var el=this.headercells[j].item;if(el&&el.length>0&&el[0].text==cols[i]){this.othercolsvalue[i]=true;break}}}grid.setMaxCols(2);grid.setMaxRows(cols.length+(this.othercols.showtheseonly?0:1));grid.getHeaderItem=function(x){if(x==0){var i;for(i=0;i<this.wctable.othercolsvalue.length;++i)if(!this.wctable.othercolsvalue[i])break;
var checkbox=new WcxCheckBoxSimple(i==this.wctable.othercolsvalue.length);checkbox._element.addClass("wc-grid-colsel-hcheckbox");checkbox.grid=this;checkbox._element.on("click",function(){var c=this.grid._element.find(".wc-grid-colsel-bcheckbox");for(var i=0;i<c.length;++i)$(c[i]).data("wcobj").setChecked(this.getChecked());for(var i=0;i<this.grid.wctable.othercolsvalue.length;++i)this.grid.wctable.othercolsvalue[i]=this.getChecked()}.bind(checkbox));return checkbox._element}var l=new WcxLabel(ibx.resourceMgr.getString("title"));
return l._element};grid.getBodyCell=function(x,y){if(!this.wctable.othercols.showtheseonly){if(y==0){if(x==0){var checkbox=new WcxCheckBoxSimple(true);checkbox.setEnabled(false);return checkbox._element}var l=new WcxLabel(this.wctable.headercells[0].item[0].text);return l._element}--y}var cols=this.wctable.othercols.name;if(x==0){var checkbox=new WcxCheckBoxSimple(this.wctable.othercolsvalue[y]);checkbox._element.addClass("wc-grid-colsel-bcheckbox");checkbox.grid=this;checkbox.colid=y;checkbox._element.on("click",
function(){this.grid.wctable.othercolsvalue[this.colid]=this.getChecked();var total=0;for(var i=0;i<this.grid.wctable.othercolsvalue.length;++i)if(this.grid.wctable.othercolsvalue[i])++total;this.grid._element.find(".wc-grid-colsel-hcheckbox").data("wcobj").setChecked(total==this.grid.wctable.othercolsvalue.length)}.bind(checkbox));return checkbox._element}var l=new WcxLabel(cols[y].replace(/\n/g," "));return l._element}}else{d._element.css("width","500px");this.newhiddencol=this.jqgrid.hiddencol.slice(0);
grid.setMaxCols(3);var r=0;for(var i=0;i<this.headercells.length;++i){var el=this.headercells[i].item;if(el&&el.length>0)++r}grid.setMaxRows(r);grid.getHeaderItem=function(x){if(x==0){var i;for(i=0;i<this.wctable.newhiddencol.length;++i)if(this.wctable.newhiddencol[i])break;var checkbox=new WcxCheckBoxSimple(i==this.wctable.newhiddencol.length);checkbox._element.addClass("wc-grid-colsel-hcheckbox");checkbox.grid=this;checkbox._element.on("click",function(){var c=this.grid._element.find(".wc-grid-colsel-bcheckbox");
for(var i=0;i<c.length;++i)if(!this.grid.wctable.cantremovedcol[i])$(c[i]).data("wcobj").setChecked(this.getChecked());for(var i=0;i<this.grid.wctable.newhiddencol.length;++i)if(!this.grid.wctable.cantremovedcol[i])this.grid.wctable.newhiddencol[i]=!this.getChecked()}.bind(checkbox));return checkbox._element}var l;if(x==1)l=new WcxLabel(ibx.resourceMgr.getString("title"));else l=new WcxLabel(ibx.resourceMgr.getString("desc"));return l._element};grid.getBodyCell=function(x,idx){var y;for(y=0;y<this.wctable.headercells.length;++y){var el=
this.wctable.headercells[y].item;if(el&&el.length>0)if(--idx<0)break}if(idx>=0)return"";if(x==0){var checkbox=new WcxCheckBoxSimple(!this.wctable.newhiddencol[y]);checkbox._element.addClass("wc-grid-colsel-bcheckbox");checkbox.grid=this;checkbox.colid=y;checkbox._element.on("click",function(){this.grid.wctable.newhiddencol[this.colid]=!this.getChecked()}.bind(checkbox));if(this.wctable.cantremovedcol[y])checkbox.setEnabled(false);return checkbox._element}var l;if(x==1){var el=this.wctable.headercells[y].item;
if(!el||el.length==0)l=new WcxLabel("");else l=new WcxLabel(el[0].text.replace(/\n/g," "))}else l=new WcxLabel(this.wctable.headercells[y].title);return l._element}}d.onClose(function(e,btn){if(btn!="ok")return;if(this.othercols){var val="";for(var i=0;i<this.othercolsvalue.length;++i)if(this.othercolsvalue[i])val="1"+val;else val="0"+val;var link=JSON.parse(JSON.stringify(this.othercols.xlink));link.jqobj=this._element;wcAddParameter(link,this.othercols.paramname,val);wcSubmitLink(link);return}if(this.newhiddencol){var maxcols=
0;this.jqgrid.hiddencol=this.newhiddencol.slice(0);for(var i=0;i<this.jqgrid.hiddencol.length;++i)if(!this.jqgrid.hiddencol[i])++maxcols;this.jqgrid.setMaxCols(maxcols);this.jqgrid.draw();wcapplication.setLocalStorageItem("grid,"+this.tableid+",hiddencol",this.jqgrid.hiddencol.toString())}}.bind(this));d.show();grid.draw()};
function wcGetOtherParams(){var p=null;var wctable;if(this instanceof WcTable)wctable=this;else{if(!this.jqobj)return null;var jqtable=this.jqobj.closest(".wcx-wctable");wctable=jqtable.data("wcobj");if(!wctable)return null}if(wctable.jqgrid.rows.length==0)return null;if(wctable.rowhighlightname){var v="";p=new Object;for(var i=0;i<wctable.jqgrid.rows.length;++i)if(wctable.jqgrid.rows[i].selected)if(v=="")v=wctable.jqgrid.rows[i].rowid;else v+=" "+wctable.jqgrid.rows[i].rowid;p[wctable.rowhighlightname]=
v}if(wctable.colhighlightname&&wctable.jqgrid.allhighlightedcol.length>0){var v="";if(p==null)p=new Object;var all=wctable.jqgrid.allhighlightedcol.slice();all.sort(function(a,b){return a-b});for(var i=0;i<all.length;++i)if(v=="")v=all[i].toString();else v+=" "+all[i].toString();p[wctable.colhighlightname]=v}if(wctable.jqgrid.tree)if(wctable.expandstatesname){if(p==null)p=new Object;var v="";for(var j=0;j<wctable.jqgrid.rows.length;++j)if(wctable.jqgrid.rows[j].folder==true&&wctable.jqgrid.isFolderOpen(j)==
true)if(v!="")v+=" "+wctable.jqgrid.rows[j].rowid;else v=wctable.jqgrid.rows[j].rowid;p[wctable.expandstatesname]=v}return p}
function wcParseTableRow(xml,wctable){var tablerow;if(xml.childNodes)tablerow=new wcTableRow(xml);else tablerow=xml;tablerow._objtype="wctablerow";var cells=tablerow.table_cell;var rowobj=new Object;if(typeof tablerow.open!=="undefined")rowobj.folderrow=true;rowobj.disabled=tablerow.row_disabled;rowobj.enabled=rowobj.disabled?0:1;rowobj.id=tablerow.id;rowobj.rowid=tablerow.rowid;rowobj.parentid=tablerow.parent?tablerow.parent:"";rowobj.numchildren=tablerow.children;rowobj.open=tablerow.open;rowobj.level=
tablerow.level?tablerow.level:0;rowobj.draggable=wctable.dragcolumn===undefined?!tablerow.nondraggable:false;rowobj.items=new Array(wctable.headercells.length);rowobj.cells=[];rowobj.xlinks=tablerow.xlink;if(tablerow._page&&rowobj.xlinks)for(var i=0;i<rowobj.xlinks.length;i++){var rowlink=rowobj.xlinks[i];rowlink.parentNode=tablerow;if(tablerow._page){rowlink._page=tablerow._page;if(rowlink.method=="popup")if(tablerow._page._rsp&&tablerow._page._rsp.data&&tablerow._page._rsp.data.share)rowlink._popupnodes=
tablerow._page._rsp.data.share.node}}rowobj.highlighted=tablerow.highlighted;rowobj.selected=tablerow.selected;rowobj.dragtypes=tablerow.dragtypes;rowobj.dragvalue=tablerow.dragvalue;if(rowobj.dragvalue)wctable.draggable=true;if(tablerow.xlinke){rowobj.expandxlink=tablerow.xlinke;rowobj.expandxlink.jqobj=wctable._element}if(tablerow.xlinkc){rowobj.collapsexlink=tablerow.xlinkc;rowobj.collapsexlink.jqobj=wctable._element}if((wctable.rowhighlightname||wctable.colhighlightname)&&rowobj.xlinks)for(var i=
0;i<rowobj.xlinks.length;++i)rowobj.xlinks[i].getOtherParams=wcGetOtherParams;if(rowobj.numchildren>0)rowobj.folder=true;else if(typeof rowobj.open!="undefined"&&rowobj.open==false&&rowobj.xlinks){rowobj.folder=false;for(var k=0;k<rowobj.xlinks.length;++k)if(rowobj.xlinks[k].method=="post"&&rowobj.xlinks[k].http_target=="TARGET_TREE_FOLDER"){rowobj.folder=true;break}}else rowobj.folder=false;var idx=0;for(var j=0;j<cells.length;++j){var el=cells[j].item;if(el&&el.length>0)rowobj.cells[idx]=cells[j];
else rowobj.cells[idx]=null;++idx;var colspan=1;if(cells[j].colspan)colspan=cells[j].colspan;for(var k=1;k<colspan;++k)rowobj.cells[idx++]=null}tablerow.rowobj=rowobj;return rowobj}
function wcxParsePartialTreeGrid(rsp,wctablerow){if(wcPreProcess(rsp,false)!=true)return;if(wctablerow==null)return;var tbrowobj=null;if(!(wctablerow._objtype=="wctablerow")){if(!(wctablerow instanceof WcxWidget||wctablerow._objtype=="wctablerow"))return;tbrowobj=wctablerow.wcrow}else tbrowobj=wctablerow.rowobj;if(tbrowobj==null)return;var idx=parseInt(tbrowobj.jqobj.attr("row"));if(idx==-1)return;var wctable=null;if(rsp.data.item)for(var i=0;i<rsp.data.item.length;++i)if(rsp.data.item[i].type=="wctable"){wctable=
rsp.data.item[i];break}if(wctable!=null){var wcxtable=tbrowobj.jqobj.closest(".wcx-wctable").data("wcobj");var counter=0;for(var i=idx+1;i<wcxtable.jqgrid.rows.length;++i){if(wcxtable.jqgrid.rows[i].parentid==wcxtable.jqgrid.rows[idx].parentid)break;var j;for(j=0;j<idx;++j)if(wcxtable.jqgrid.rows[i].parentid==wcxtable.jqgrid.rows[j].id||wcxtable.jqgrid.rows[i].parentid==wcxtable.jqgrid.rows[j].parentid)break;if(j<idx)break;++counter}if(counter>0){wcxtable.jqgrid.rows.splice(idx+1,counter);wcxtable.jqgrid.removeTreeRows(idx,
counter)}var children=0;var rows=wctable.table_row;if(!rows)return;if(rows.length>0)wcxtable.jqgrid.body._element.attr("tabindex","0");for(var j=0;j<rows.length;++j){if(wctablerow._page)rows[j]._page=wctablerow._page;var rowobj=wcParseTableRow(rows[j],wcxtable);if(rowobj.parentid==""){rowobj.level=wcxtable.jqgrid.rows[idx].level+1;rowobj.parentid=tbrowobj.id;++children}else for(var k=idx+j;k>idx;--k)if(rowobj.parentid==wcxtable.jqgrid.rows[k].id){rowobj.level=wcxtable.jqgrid.rows[k].level+1;break}wcxtable.jqgrid.rows.splice(idx+
j+1,0,rowobj)}wcxtable.jqgrid.rows[idx].numchildren=children;wcxtable.jqgrid.insertTreeRows(idx,rows.length);var icon=tbrowobj.jqobj.find(".wcx-grid-body-tree-row-folder").data("wcobj");if(icon)if(icon.getIcon()!="remove")icon.setIcon("remove");wcxtable.jqgrid.resetColumnWidth()}}
function WcGrid(text){if(_wcconstructing)return;WcxComponent.call(this,"WcGrid");this._element.addClass("wcx-grid").attr("tabindex","-1");if(text)$("<div></div>").addClass("wcx-grid-background-text").text(text).appendTo(this._element);this.dragcolumn=-1;this.nohighlight=false;this.allhighlightedcol=[];this.bodyheight=0;this.viewmode="list";this.showheaders=true;this.showcharts=false;this.highlightedcol=-1;this.clicktohighlightcol=false;this.suggestedrowheight=0;this.lasttopposition=0;this.rows=[];
this.hiddencol=[];this.showall=false;this.border=false;this.gridline=false;this.plain=false;this.hstretch=false;this.hscrollbar=true;this.vstretch=true;this.lastrowborder=false;this.header=new WcxWidget;this.header._element.addClass("wcx-grid-header").appendTo(this._element).keydown(this,this._doKeyDownHeader.bind(this));this.headerrow=$("<div></div>").addClass("wcx-grid-header-row").appendTo(this.header._element);this.body=new WcxWidget;this.body._element.addClass("wcx-grid-body").appendTo(this._element).keydown(this,
this._doKeyDownBody.bind(this));this.body._element.ibxWidget("setAccessibility",true,{role:"grid"});wcAddDragDropScroller($(this.body._element));this.body._element.scroll(this,function(e){var jqgrid=e.data;if(jqgrid.getView()=="icon")jqgrid._scrollIcon(e);else if(jqgrid.getView()=="dropbox")jqgrid._scrollDropbox();else jqgrid._scrollGrid(e)});this._element.focus(function(){setTimeout(this._focusthis.bind(this),0)}.bind(this));this.body._element.focus(this._focusthis.bind(this))}
_p=wcInherit(WcGrid,WcxComponent);
_p.resetAllBodyState=function(){for(var j=0;j<this.rows.length;j++){var y=j;if(this.neworder)y=this.neworder[j];var row=this.rows[y];if(row){row.state=null;rowEl=this.body._element.find(".wcx-grid-body-row[row="+y+"]");if(rowEl.length>0)rowEl.removeClass("ds-danger ds-success ds-warn")}for(var x=0;x<row.cells.length;x++){var cell=row.cells[x];if(cell)cell.state=null;else cell={};var cellEl=this.body._element.find(".wcx-grid-body-row[row="+y+"]").children(".c"+x);if(cellEl.length>0)cellEl.removeClass("ds-danger ds-success ds-warn")}}};
_p.setBodyRowState=function(y,state){if(this.rows.length==0)return;if(y>=this.rows.length)return;if(this.neworder)y=this.neworder[y];var row=this.rows[y];if(row){row.state=state;rowEl=this.body._element.find(".wcx-grid-body-row[row="+y+"]");if(rowEl.length>0){rowEl.removeClass("ds-danger ds-success ds-warn");if(state=="invalid")rowEl.addClass("ds-danger");else if(state=="valid")rowEl.addClass("ds-success");else if(state=="warning")rowEl.addClass("ds-warn")}}};
_p.setBodyCellText=function(x,y,value){if(this.rows.length==0||y>this.rows.length)return;if(this.neworder)y=this.neworder[y];var idx=0;for(var i=0;i<this.rows[y].cells.length;++i)if(!this.hiddencol[i]&&idx++==x){if(this.rows[y].cells[i]){this.rows[y].items[i]=null;var el=this.rows[y].cells[i].item;if(el&&el.length>0)if(el[0].type==="wctext")el[0].text=value;else if(el[0].type==="wcinputtext")el[0].value=value;else if(el[0].type==="wcselect")el[0].value=value;else if(el[0].type==="wcimage")el[0].text=
value}var cell=this.body._element.find(".wcx-grid-body-row[row="+y+"]").children(".c"+x);if(cell.length>0){cell.children().detach();if(this.rows[y].cells[i])cell.append(this.getBodyCell(x,y));else cell.append($("<div></div>").ibxLabel({"text":value}))}break}};
_p.setBodyCellState=function(x,y,state){if(this.rows.length==0)return;if(y>=this.rows.length)return;if(this.neworder)y=this.neworder[y];var idx=0;for(var i=0;i<this.rows[y].cells.length;++i)if(!this.hiddencol[i]&&idx++==x){if(this.rows[y].cells[i]!==undefined){if(this.rows[y].cells[i]==null)this.rows[y].cells[i]={};this.rows[y].cells[i].state=state}var cell=this.body._element.find(".wcx-grid-body-row[row="+y+"]").children(".c"+x);if(cell.length>0){cell.removeClass("ds-danger ds-success ds-warn");
if(state=="invalid")cell.addClass("ds-danger");else if(state=="valid")cell.addClass("ds-success");else if(state=="warning")cell.addClass("ds-warn")}break}};
_p.getCellText=function(x,y){if(this.rows.length==0)return"";if(this.rows[y].cells[x]==null)return"";if(this.rows[y].items[x]&&!(this.rows[y].items[x][0]instanceof WcHidden)){if(this.rows[y].items[x][0].getText)return this.rows[y].items[x][0].getText();return""}var el=this.rows[y].cells[x].item;if(el)for(var k=0;k<el.length;++k){if(el[k].type=="wcinputtext")return el[k].value;if(el[k].type=="wcselect"){var v=el[k].initial_text;if(!v||v==null||v==""){var options=el[k].option;if(options)for(var i=0;i<
options.length;++i)if(options[i].selected)return options[i].text;return""}return v}if(el[k].text)return el[k].text}return""};_p.addRow=function(r){this.rows.push(r)};_p.setGridId=function(id){this.gridid=id};_p.setPaging=function(paging){if(paging)this.paging=paging};_p.closeSearchPanel=function(){if(this.searchboxcontainer){this.searchboxcontainer.detach();delete this.searchboxcontainer}};
_p.openSearchPanel=function(text){if(!this.searchboxcontainer){var searchbox=this._element.closest(".wcx-wctable").data("wcobj").searchbox;this.searchboxcontainer=$("<div></div>").addClass("wcx-grid-searchbox").append(searchbox).appendTo(this._element);this.searchboxcontainer.searchbox=searchbox;searchbox.val(text?text:this.searchstr?this.searchstr:"");var button=new WcxButtonSimple(null,"ds-icon-times");button._element.addClass("wcx-grid-searchbox-button");button.setTitle(ibx.resourceMgr.getString("cancel"));
button._element.on("click",function(){if(this.searchboxcontainer.searchbox.val()==""){this.closeSearchPanel();return}this.searchboxcontainer.searchbox.val("");this.searchboxcontainer.searchbox.focus();this.search("")}.bind(this));this.searchboxcontainer.append(button._element)}this.searchboxcontainer.searchbox.focus()};
_p.scrollColumnIntoView=function(cidx){if(cidx<0)return;var cells=this.headerrow.find(".wcx-grid-header-cell.c"+cidx);if(cells.length<=0)return;var scrollleft=this.body._element.scrollLeft();var last=$(cells[0]).position().left+$(cells[0]).outerWidth();if(last>scrollleft+this.body._element.outerWidth())this.body._element.scrollLeft(last-this.body._element.outerWidth()+20);else{var offset=$(cells[0]).position().left-scrollleft;if(offset<0)this.body._element.scrollLeft(scrollleft+offset)}};
_p.setSelectedColumn=function(cidx){if(cidx)this.highlightedcol=cidx};_p.enableColumnHighlight=function(enable){this.clicktohighlightcol=enable};_p.setContextMenu=function(c){if(c)this.contextmenucontainer=c};_p.setDragColumn=function(c){if(c!==undefined)this.dragcolumn=c};
_p.highlightColumn=function(headername){if(!headername)return;headername=headername.replace(/,/g,"\n");var cells=this.headerrow.find(".wcx-grid-header-cell");for(var i=0;i<cells.length;++i){var label=$(cells[i]).find(".ibx-label-text");for(var j=0;j<label.length;++j)if($(label[j]).text()==headername)for(var cidx=0;cidx<this.maxcols;++cidx)if($(cells[i]).hasClass("c"+cidx)){this.highlightedcol=cidx;this._highlightThisColumn(this.highlightedcol,true,false);return cidx}}return-1};
_p.setSingleSectionOnly=function(value){if(typeof value=="boolean")this.singleselect=value;else if(typeof value=="number")this.singleselect=value!==0};_p.setHeight=function(x){this.bodyheight=x};_p.setMaxCols=function(x){this.maxcols=x};_p.setMaxRows=function(y){this.maxrows=y};_p.setTreeCol=function(x){this.treecol=x;this.tree=true};_p.getView=function(){return this.viewmode};
_p.setView=function(value){if(!value||value!="icon"&&value!="list"&&value!="dropbox")return;this.viewmode=value;if(value=="dropbox"){this.setPlain(true);this.setHStretch(true)}};_p.disableHighlight=function(value){this.nohighlight=value};_p.setPlain=function(value){this.plain=value};_p.setLastRowBorder=function(value){this.lastrowborder=value};_p.setVStretch=function(value){this.vstretch=value};_p.setHStretch=function(value){this.hstretch=value;this.hscrollbar=!value};
_p.addGridLine=function(value){this.gridline=value};_p.addBorder=function(){this.showborder=true;this.header._element.addClass("wcx-border-top");if(this.footer){this.footer._element.addClass("wcx-border-bottom");this.body._element.addClass("wcx-border-middle")}else this.body._element.addClass("wcx-border-bottom");this._element.addClass("wcx-border");if(this.chartrow)this.chartrow.addClass("wcx-border-middle")};_p.showHeaders=function(value){this.showheaders=value};
_p.showCharts=function(value,label){this.showcharts=value;if(this.showcharts){this.rowinfolabel=label;this.chartrow=$("<div></div>").addClass("wcx-grid-chart-row").insertAfter(this.header._element);if(this.gridid){var h=wcapplication.getSessionStorageItem("grid,"+this.gridid+",chartheight");if(h)this.chartrow.height(parseInt(h))}this.splitter=$("<div>").ibxHSplitter({"resize":"first"}).insertAfter(this.chartrow).addClass("top-splitter");this.splitter.on("ibx_resize",this,function(e){var obj=$(e.currentTarget);
var grid=e.data;if(grid.gridid)wcapplication.setSessionStorageItem("grid,"+grid.gridid+",chartheight",grid.chartrow.outerHeight());grid._updateRowInfoLabel()})}};_p.setScrollRowIntoView=function(num){if(typeof num!=="undefined")this.scrollrow=num};_p.setScrollColIntoView=function(num){if(num&&num>=0)this.scrollcol=num};_p.setRowHeight=function(num){if(typeof num!="undefined")this.suggestedrowheight=num};
_p.isFolderOpen=function(idx){if(!this.allrows||this.allrows[idx].openfolder!=true)return false;return true};
_p.search=function(str){if(!str)delete this.searchstr;else{var s=str.trim();if(s==="")delete this.searchstr;else{this.searchstr=s;var str=$("<div></div>").text(this.searchstr).html().replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&");var searchstr='(<div class="ibx-label-text"[^>]*>[^<]*?)('+str+")(.*?</div>)";this.rplregexp=new RegExp(searchstr,"ig");this.srchregexp=new RegExp(str,"i")}}this.searchcount=0;if(this.showborder&&this.viewmode!="icon"&&!this.tree)this.body._element.css("flex-grow","1");this.draw(true);
wcAriaSpeak(this.searchcount+" results found below based on search criteria "+this.searchstr);return this.searchcount>0};
_p.draw=function(reposition){if(this.rows.length>0)this.body._element.attr("tabindex","0");this.lastheight=this._element.outerHeight();this.lastwidth=this._element.outerWidth();if(!this.showheaders||this.viewmode=="icon")this.header._element.hide();else this.header._element.show();if(!this.setdrop){this.setdrop=true;if(this.isHeaderDroppable()){this.header._element.on("ibx_dragover",function(e){e=e.originalEvent;var dt=e.dataTransfer;dt.dropEffect="copy";e.preventDefault()});this.header._element.on("ibx_drop",
function(e){e=e.originalEvent;var dt=e.dataTransfer;var rowid=dt.getData("text");if(rowid!="")this.runHeaderDropXlink(rowid,dt.getData("colindex"))}.bind(this))}if(this.isBodyDroppable()){this.body._element.on("ibx_dragover",function(e){e=e.originalEvent;var dt=e.dataTransfer;dt.dropEffect="copy";e.preventDefault();var gc=this._element.closest(".wcx-graph-content");if(gc&&gc.length>0){var wcobj=gc.data("wcobj");if(wcobj instanceof WcGraphContent)wcobj.doGridDragOver(e)}}.bind(this));this.body._element.on("ibx_drop",
function(e){e=e.originalEvent;var dt=e.dataTransfer;var rowid=dt.getData("text");if(rowid!=""&&e.offsetY>this.rowpane.outerHeight())this.runBodyDropXlink(rowid,dt.getData("colindex"))}.bind(this))}}this.allloaded=false;this.heightset=false;if(this.viewmode=="list"){this.rowheight=Math.max(32,this.suggestedrowheight);if(!this.tree){this._element.addClass("wcx-list");if(this.rowheight==32)this._element.addClass("wcx-standard")}this._drawList(reposition)}else if(this.viewmode=="icon"){this._element.removeClass("wcx-list");
this.rowheight=110;this._drawIcon()}else if(this.viewmode=="dropbox"){this._element.removeClass("wcx-list");this.tree=false;this.rowheight=Math.max(32,this.suggestedrowheight);this._drawList()}var topheight=this._setHeights();this._adjustHeight();this._updateRowInfoLabel();if(this.viewmode=="list"){if(this.maxrows>0){this._element.css("min-height",topheight+this.rowheight+"px");if(this.bodyheight>0)this._element.css("max-height",topheight+this.rowheight*this.bodyheight+"px");setTimeout(function(){this._resetBorder()}.bind(this),
0)}}else if(this.viewmode=="icon")if(this.bodyheight>0){var rh;if(this.maxrows>0){var cell=this.rowpane.find(".wcx-grid-iconview-cell");if(cell.length>0)rh=$(cell[0]).outerHeight(true);else rh=this.rowheight}else rh=this.rowheight;this._element.css("height",topheight+rh*this.bodyheight+20+"px")}if(this.scrollrow&&this.scrollrow!=0){var nr;if(this.tree)nr=this.allrows[this.scrollrow].location-1;else nr=this.scrollrow;var p=nr*this.rowheight-Math.ceil(this.body._element.innerHeight()/2-this.rowheight);
if(p<0)p=nr*this.rowheight;this.body._element.scrollTop(p);this.scrollrow=0}if(!reposition)this._resetBorder();if(this.viewmode=="icon")return;if(ibxPlatformCheck.isIE)this.resetColumnWidth();if(this.hasselectbox||ibxPlatformCheck.isIE)setTimeout(function(rep){var content=$(this._element).closest(".wcx-content");if(content&&content.length>0)setTimeout(function(){content.triggerHandler("resize")}.bind(this),0);this.colwidthok=false;this.resetColumnWidth();if(this.viewmode=="list"&&rep){var scroll=
wcapplication.getSessionStorageItem("grid,"+this.gridid+",scrolltop");if(scroll)this.body._element.scrollTop(parseInt(scroll));scroll=wcapplication.getSessionStorageItem("grid,"+this.gridid+",scrollleft");if(scroll)this.body._element.scrollLeft(parseInt(scroll))}else{wcapplication.removeSessionStorageItem("grid,"+this.gridid+",scrollleft");wcapplication.removeSessionStorageItem("grid,"+this.gridid+",scrolltop")}if(this.scrollcol&&this.scrollcol!=0){this.scrollColumnIntoView(this.scrollcol);this.scrollcol=
0}}.bind(this),0,reposition);else{this.resetColumnWidth();if(this.viewmode=="list"&&reposition){var scroll=wcapplication.getSessionStorageItem("grid,"+this.gridid+",scrolltop");if(scroll)this.body._element.scrollTop(parseInt(scroll));scroll=wcapplication.getSessionStorageItem("grid,"+this.gridid+",scrollleft");if(scroll)this.body._element.scrollLeft(parseInt(scroll))}else{wcapplication.removeSessionStorageItem("grid,"+this.gridid+",scrollleft");wcapplication.removeSessionStorageItem("grid,"+this.gridid+
",scrolltop")}if(this.scrollcol&&this.scrollcol!=0){this.scrollColumnIntoView(this.scrollcol);this.scrollcol=0}}};
_p.resize=function(){if(!this.colwidth)return;var h=this._element.outerHeight();var w=this._element.outerWidth();if(h==0||w==0)return;this.lastheight=h;this.lastwidth=w;if(!this.colwidthok){for(var i=0;i<this.colwidth.length;++i)if(this.colwidth[i]!=0){this.colwidthok=true;break}if(!this.colwidthok)this._getAllColumnWidth()}if(this.header._element.is(":visible")){this.headerrow.css("height","");var c=this.headerrow.find(".wcx-grid-header-cell");for(var j=0;j<c.length;++j){var h=$(c[j]).outerHeight();
if(h>this.maxheaderheight)this.maxheaderheight=h}this._setHeights()}if(this.displaycols<this.maxcols){var len=0;var i;var viewlen=this.body._element.innerWidth();for(i=0;i<this.displaycols;++i)len+=this.colwidth[i];if(viewlen>len){for(i=this.displaycols;i<this.maxcols;++i){if(this.showcharts)len+=200;else len+=this.colwidth[i];this._insertColumns(this.displaycols,i);this.displaycols=i+1;if(len>viewlen)break}this.updatecolwidth=true}}if(this.bodyrows&&this.bodyrows.length<this.maxrows){var maxviewrows=
Math.ceil(this.body._element.innerHeight()/this.rowheight);if(maxviewrows>this.bodyrows.length){var lastbodyrow=this.firstbodyrow==0?this.bodyrows.length-1:this.firstbodyrow-1;if(lastbodyrow>=0){var idx=parseInt(this.bodyrows[lastbodyrow]._element.attr("row"))+1;var more=maxviewrows-this.bodyrows.length+10;if(more+this.bodyrows.length>this.maxrows)more=this.maxrows-this.bodyrows.length;if(idx<this.maxrows){var i;var ok;var location;if(this.tree)for(;idx<this.maxrows;++idx){if((location=this.allrows[idx].location)!=
-1)break}else location=Math.floor(parseInt(this.bodyrows[lastbodyrow]._element.css("top"))/this.rowheight)+1;if(idx<this.maxrows){for(i=0;i<more;++i){var row=this._appendNewBodyRow();this.bodyrows.splice(lastbodyrow+i+1,0,row);while((ok=this._showThisRow(idx++,lastbodyrow+i+1,location))==false)if(idx==this.maxrows)break;if(idx==this.maxrows){if(!ok){row._element.remove();this.bodyrows.splice(lastbodyrow+i+1,1)}break}++location}if(this.firstboydrow!=0)this.firstboydrow+=i;this.updatecolwidth=true}}}}}this.updatecolwidth=
true;setTimeout(function(){this.colwidthok=false;this.resetColumnWidth();this._adjustHeight();this._updateRowInfoLabel();this._resetBorder()}.bind(this),0)};_p.removeTreeRows=function(idx,numrows){this.maxrows-=numrows;this.allrows.splice(idx+1,numrows)};
_p.insertTreeRows=function(idx,numrows){this.maxrows+=numrows;this.allrows[idx].files=0;for(var j=0;j<numrows;++j){var status=new Object;status.files=0;status.parent=this.allrows[idx];var i=idx+j+1;var row=this._getRow(i);if(row.folder==true)if(row.open)status.openfolder=true;else status.openfolder=false;for(var k=i-1;k>idx;--k)if(row.parentid==this._getRow(k).id){status.parent=this.allrows[k];break}this.allrows.splice(i,0,status)}this.allrows[idx].openfolder=true;this._showTreeRows(idx)};
_p.resetColumnWidth=function(){this._getAllColumnWidth();this._adjustColumnWidth()};_p.addBottom=function(wcitem){this.footer=new WcxWidget;this.footer._element.addClass("wcx-grid-footer").appendTo(this._element);this.footer.add(wcitem)};_p.hideThisColumn=function(y,hide){this.hiddencol[y]=hide};_p._getRow=function(y){if(this.neworder)y=this.neworder[y];return this.rows[y]};
_p._getBodyRowState=function(y){if(this.rows.length==0)return"";if(this.neworder)y=this.neworder[y];var row=this.rows[y];return row?row.state:""};_p._getBodyCellColorWidth=function(x,y){if(this.rows.length==0)return null;if(this.neworder)y=this.neworder[y];var idx=0;for(var i=0;i<this.rows[y].cells.length;++i)if(!this.hiddencol[i]&&idx++==x){if(this.rows[y].cells[i]==null)return null;return this.rows[y].cells[i].colorwidth}return null};
_p._getBodyCellColor=function(x,y){if(this.rows.length==0)return null;if(this.neworder)y=this.neworder[y];var idx=0;for(var i=0;i<this.rows[y].cells.length;++i)if(!this.hiddencol[i]&&idx++==x){if(this.rows[y].cells[i]==null)return null;return this.rows[y].cells[i].color}return null};
_p._getBodyCellAlign=function(x,y){if(this.rows.length==0)return"left";if(this.neworder)y=this.neworder[y];var idx=0;for(var i=0;i<this.rows[y].cells.length;++i)if(!this.hiddencol[i]&&idx++==x){if(this.rows[y].cells[i]==null)return"left";return this.rows[y].cells[i].align}return"left"};
_p._getBodyCellState=function(x,y){if(this.rows.length==0)return"";if(this.neworder)y=this.neworder[y];var idx=0;for(var i=0;i<this.rows[y].cells.length;++i)if(!this.hiddencol[i]&&idx++==x){if(this.rows[y].cells[i]==null||this.rows[y].cells[i].state===undefined)return"";return this.rows[y].cells[i].state}return""};
_p._getBodyCellText=function(x,y){if(this.rows.length==0)return"";if(this.neworder)y=this.neworder[y];var idx=0;for(var i=0;i<this.rows[y].cells.length;++i)if(!this.hiddencol[i]&&idx++==x)return this.getCellText(i,y);return""};
_p._focusthis=function(){var grid=this;if(grid.plain||grid.viewmode=="dropbox")return;row=grid.body._element.find(".wcx-selected");if(row.length!=0){$(row[0]).focus();return}var selector;if(grid.viewmode=="icon")selector=".wcx-grid-iconview-cell";else if(grid.tree)selector=".wcx-grid-body-tree-row";else selector=".wcx-grid-body-row";var allrows=grid.body._element.find(selector);allrows.sort(function(a,b){return parseInt($(a).attr("row"))-parseInt($(b).attr("row"))});for(var i=0;i<allrows.length;++i)if($(allrows[i]).position().top>=
0){var el=allrows[i];$(el).focus();var caption=$(el).attr("title");wcAriaSpeak(caption+" Button");break}};_p._resetBorder=function(){if(this.showborder&&this.viewmode!="icon"&&!this.tree){var h=this.rowpane.outerHeight(true);if(h<this.body._element.outerHeight(true)){if(this.maxrows==0)h=this.rowheight;var i=0;this.body._element.css("flex-grow","0");this.body._element.outerHeight(h);while(this.body._element.height()<h){++i;this.body._element.outerHeight(h+i)}}}};
_p._setHeights=function(){var height=0;if(this.showheaders&&this.viewmode!="icon"){height+=this.maxheaderheight;this.headerrow.height(height);this.header._element.height(height);var mh=height+2;this.header._element.css("min-height",mh.toString()+"px")}if(this.chartrow){height+=this.chartrow.outerHeight();height+=this.splitter.outerHeight()}return height};_p._scrollIcon=function(e){};_p._scrollDropbox=function(e){};
_p._scrollGrid=function(e){var x=this.body._element.scrollLeft();wcapplication.setSessionStorageItem("grid,"+this.gridid+",scrollleft",x);if(x>0&&this.displaycols<this.maxcols){var i;var range={};var total=0;for(i=0;i<this.maxcols;++i){if(this.showcharts)total+=200;else total+=this.colwidth[i];if(x<total){range.from=i;break}}var viewlen=this.body._element.innerWidth();total=0;range.to=this.maxcols;for(i=range.from;i<this.maxcols;++i){if(this.showcharts)total+=200;else total+=this.colwidth[i];if(viewlen<
total){range.to=i+1;break}}if(range.from>this.displaycols||range.to>this.displaycols){this.firstdisplaycols=range.from;this.nextdisplaycols=range.to;if(this.scrollcoltimer)clearTimeout(this.scrollcoltimer);this.scrollcoltimer=setTimeout(function(){this._insertColumns(this.firstdisplaycols,this.nextdisplaycols);this.displaycols=this.nextdisplaycols+1;this._adjustColumnWidth();delete this.scrollcoltimer}.bind(this),30)}}this.headerrow.css("left",0-x+"px");if(this.chartrow)this.chartrow.css("left",0-
x+"px");this._scrollGridVertical()};
_p._updateRowInfoLabel=function(){if(!this.rowinfolabel)return;var txt=this.maxrows+" "+ibx.resourceMgr.getString("row");if(this.maxrows>1){var first=0;if(this.bodyrows.length>0){var idx=this.firstbodyrow;while(true){var bodyRow=this.bodyrows[idx];var bodyRowEl=bodyRow?bodyRow._element:null;if(bodyRowEl){var position=bodyRowEl.position();if(position.top+this.rowheight/2>0){first=parseInt(bodyRowEl.attr("row"));break}}if(++idx==this.bodyrows.length)idx=0;if(idx==this.firstbodyrow)break}}var last=Math.min(this.maxrows,
Math.round(.2+this.body._element[0].clientHeight/this.rowheight)+first);if(last>0)txt+="&nbsp;&nbsp;&nbsp;&nbsp;"+(first+1)+" - "+last+" "+ibx.resourceMgr.getString("shown")}this.rowinfolabel.setText(txt)};
_p._scrollGridVertical=function(){wcapplication.setSessionStorageItem("grid,"+this.gridid+",scrolltop",this.body._element.scrollTop());if(this.bodyrows.length==this.maxrows||this.allloaded){this._updateRowInfoLabel();return}var top=this.rowpane.position().top;if(this.lasttopposition==top)return;this.lasttopposition=top;if(this.scrollrowtimer)clearTimeout(this.scrollrowtimer);this.scrollrowtimer=setTimeout(function(){this._updateRowsAfterScroll();delete this.scrollrowtimer}.bind(this),0)};
_p._updateRowsAfterScroll=function(){var lastbodyrow;var position=this.bodyrows[this.firstbodyrow]._element.position();if(position.top>0){var maxviewrows=Math.ceil(this.body._element.innerHeight()/this.rowheight);var nrows=Math.ceil(position.top/this.rowheight);var idx=parseInt(this.bodyrows[this.firstbodyrow]._element.attr("row"))-1;var i;if(nrows>=this.bodyrows.length)if(this.searchstr)i=0;else{this.firstbodyrow=0;if(maxviewrows>this.bodyrows.length)i=0;else i=nrows-this.bodyrows.length}else i=
0;idx-=i;var location;if(this.searchstr)location=Math.floor(parseInt(this.bodyrows[this.firstbodyrow]._element.css("top"))/this.rowheight)-1;else if(this.tree)for(;idx>=0;--idx){if((location=this.allrows[idx].location)!=-1)break}else location=idx;if(idx<0){this._updateRowInfoLabel();return}var okay;for(;i<nrows;++i){var row=null;lastbodyrow=this.firstbodyrow==0?this.bodyrows.length-1:this.firstbodyrow-1;if(maxviewrows>=this.bodyrows.length+1){row=this._appendNewBodyRow();this.bodyrows.splice(lastbodyrow+
1,0,row);++lastbodyrow}do okay=this._showThisRow(idx--,lastbodyrow,location);while(okay==false&&idx>=0);if(okay)this.firstbodyrow=lastbodyrow;else if(row){row._element.remove();this.bodyrows.splice(lastbodyrow+1,1)}if(idx<0)break;--location}this.updatecolwidth=true;this.resetColumnWidth();this._updateRowInfoLabel();return}lastbodyrow=this.firstbodyrow==0?this.bodyrows.length-1:this.firstbodyrow-1;position=this.bodyrows[lastbodyrow]._element.position();if(position.top+this.rowheight<this.body._element.innerHeight()){var idx=
parseInt(this.bodyrows[lastbodyrow]._element.attr("row"))+1;var nrows=Math.ceil((this.body._element.innerHeight()-(position.top+this.rowheight))/this.rowheight);var i;if(nrows>=this.bodyrows.length)if(this.searchstr)i=0;else{this.firstbodyrow=0;i=nrows-this.bodyrows.length}else i=0;idx+=i;var location;if(this.searchstr)location=Math.floor(parseInt(this.bodyrows[lastbodyrow]._element.css("top"))/this.rowheight)+1;else if(this.tree)for(;idx<this.maxrows;++idx){if((location=this.allrows[idx].location)!=
-1)break}else location=idx;if(idx>=this.maxrows){this._updateRowInfoLabel();return}var okay;for(;i<nrows;++i){do okay=this._showThisRow(idx++,this.firstbodyrow,location);while(okay==false&&idx<this.maxrows);if(okay)this.firstbodyrow=this.firstbodyrow==this.bodyrows.length-1?0:this.firstbodyrow+1;if(idx==this.maxrows)break;++location}this.resetColumnWidth();if(this.searchstr&&!this.heightset){this.rowpane.height((location+(okay?1:0)+this.maxrows-idx)*this.rowheight);if(idx==this.maxrows)this.heightset=
true}}};
_p._drawIcon=function(){this.body._element.empty();this.rowpane=$("<div></div>").attr("aria-live","polite").appendTo(this.body._element);this.rowpane.addClass("wcx-grid-rowpane");if(this.nohighlight)this.rowpane.addClass("nohighlight");if(this.gridview){this.folderpane=$("<div></div>").appendTo(this.rowpane);this.folderpane.addClass("wcx-grid-iconview-folderpane");this.folderpanetitle=$("<div>"+ibx.resourceMgr.getString("folders")+"</div>").appendTo(this.folderpane);this.folderpanetitle.addClass("wcx-grid-iconview-title").attr("aria-hidden","true");
this.folderpanecontent=$("<div></div>").appendTo(this.folderpane);this.filepane=$("<div></div>").appendTo(this.rowpane);this.filepane.addClass("wcx-grid-iconview-filepane").addClass("wcx-grid-iconview-large");this.filepanetitle=$("<div>"+ibx.resourceMgr.getString("items")+"</div>").appendTo(this.filepane);this.filepanetitle.addClass("wcx-grid-iconview-title").attr("aria-hidden","true");this.filepanecontent=$("<div></div>").appendTo(this.filepane)}else{this.filepane=$("<div></div>").appendTo(this.rowpane);
this.filepane.addClass("wcx-grid-iconview-filepane").addClass("wcx-grid-iconview-small");this.filepanecontent=$("<div></div>").appendTo(this.filepane)}var total=0;for(var i=0;i<this.maxrows;++i){if(this.searchstr){if(this.srchregexp.test($("<div></div>").text(this._getBodyCellText(0,i)).html())==false)continue;this.searchcount+=1}++total;var icon=new WcxWidget;icon._element.addClass("wcx-grid-iconview-cell").attr("tabindex","-1").attr("role","button");icon._element.attr("row",i);icon._element.attr("aria-rowindex",
i+1);icon.wcrow=this._getRow(i);var element=this.getBodyCell(0,i);if(this.gridview){icon.setTitle(element.attr("title"));if(icon.wcrow.folderrow){if(this.searchstr)element=element.html(element.html().replace(this.rplregexp,"$1<span class='wcx-grid-search-highlighted'>$2</span>$3"));icon._element.append(element);this.folderpanecontent.append(icon._element)}else{this.filepanecontent.append(icon._element);var wcobj=element.data("wcobj");var label=new WcxLabel(wcobj.getText());label._element.addClass("wcx-thumbnail-text");
if(this.searchstr)label._element=label._element.html(label._element.html().replace(this.rplregexp,"$1<span class='wcx-grid-search-highlighted'>$2</span>$3"));wcobj.setText("");icon._element.append($("<div></div>").addClass("wcx-thumbnail-top"));var div=$("<div></div>").addClass("wcx-grid-iconview-large-content");div.append($("<div></div>").addClass("wcx-thumbnail").append(wcobj._element));div.append(label._element);icon._element.append(div);if(wcobj._wcdescription){var desc=new WcxLabel(wcobj._wcdescription);
desc._element.addClass("wcx-thumbnail-description");icon._element.append(desc._element);icon._element.on("mouseover",function(){$(this).children(".wcx-thumbnail-description").css("display","block")});icon._element.on("mouseout",function(){$(this).children(".wcx-thumbnail-description").css("display","none")})}}}else{icon.setTitle(element.attr("title"));this.filepanecontent.append(icon._element);var wcobj=element.data("wcobj");var label=new WcxLabel(wcobj.getText());label._element.addClass("wcx-thumbnail-text");
if(this.searchstr)label._element=label._element.html(label._element.html().replace(this.rplregexp,"$1<span class='wcx-grid-search-highlighted'>$2</span>$3"));wcobj.setText("");icon._element.append($("<div></div>").addClass("wcx-thumbnail").append(wcobj._element));icon._element.append(label._element)}icon._element.on("click dblclick contextmenu",this,wcClickTableRow);icon._element.on("wcunselect",icon,function wcUnselectIcon(e){var el=e.data;el._element.attr("aria-hidden","true").removeAttr("aria-selected");
el._element.removeClass("wcx-selected");var wcgrid=el._element.closest(".wcx-grid").data("wcobj");if(wcgrid&&wcgrid.contextmenucontainer)wcgrid.contextmenucontainer._element.empty()});this._setDragDrop(icon);if(this.isClickable())this._handleRowSelection(icon);if(icon.wcrow){if(icon.wcrow.selected){icon._element.addClass("wcx-selected");icon._element.removeAttr("aria-hidden").attr("aria-selected","true")}else icon._element.triggerHandler("wcunselect");if(icon.wcrow.highlighted)icon._element.addClass("wcx-highlighted");
else icon._element.removeClass("wcx-highlighted");icon._element.ibxWidget({"draggable":icon.wcrow.draggable});icon.wcrow.jqobj=icon._element}icon._element.attr("aria-hidden","false")}if(this.gridview){if(this.filepanecontent.is(":empty"))this.filepane.hide();if(this.folderpanecontent.is(":empty"))this.folderpane.hide()}};
_p._drawList=function(reposition){this.body._element.children().detach();if(!reposition||this.headerrow.children().length==0){this.headerrow.empty();this.updatecolwidth=true;this.colwidth=[];this.colwidthok=false;this.colwidthfixed=[];this.maxheaderheight=0;var multiline=false;for(var j=0;j<this.maxcols;++j){var c=$("<div></div>").addClass("wcx-grid-header-cell").addClass("c"+j).appendTo(this.headerrow);var container=$("<div></div>").append(this.getHeaderItem(j));c.append("<div></div>").append(container);
if(!multiline&&c.height()>=32)multiline=true;if(this.colortag){c.children().first().width(4);var el=$("<div></div>").addClass("wcx-grid-header-cell-colortext");container.append(el);var val=this.getHeaderTagColor(j);if(val!=""){el.css("color",val);c.children().first().css("background-color",val)}val=this.getHeaderTagText(j);if(val!="")el.text(val)}if(this.isHeaderCellHighlighted(j))c.addClass("highlighted");var v="-1";if(j==0&&c.children().length>0){var events=$._data(c.children()[0],"events");if(events&&
events.click)v="0"}c.attr("tabindex",v);this.colwidthfixed.push(this.isHeaderCellWidthFixed(j));var h=c.outerHeight();if(h>this.maxheaderheight)this.maxheaderheight=h;if(j==this.maxcols-1&&this.hstretch)c.css("border-right","0px");var w=Math.ceil(c.outerWidth());if(w>0){this.colwidthok=true;if(this.gridline)++w}this.colwidth[j]=w;if(this.chartrow){var cell=new WcxComponent;cell._element.appendTo(this.chartrow).addClass("wcx-grid-chart-row-cell").addClass("c"+j);cell._element.attr("contentpage","y");
if(j==this.maxcols-1&&this.hstretch)cell._element.css("border-right","0px")}}if(multiline)this.headerrow.find(".wcx-grid-header-cell > div:nth-child(2)").css("justify-content","space-between")}else{if(typeof this.colwidth==="undefined"){this.colwidth=[];this.colwidthok=false}if(typeof this.colwidthfixed==="undefined")this.colwidthfixed=[]}if(this.chartrow&&this.gridline)this.chartrow.addClass("wcx-grid-gridline");this.bodyrows=[];this.firstbodyrow=0;if(this.hscrollbar===false)this.body._element.css("overflow-x",
"hidden");var nrow;this.rowpane=$("<div></div>").attr("aria-live","polite").appendTo(this.body._element);this.rowpane.addClass("wcx-grid-rowpane");if(this.nohighlight)this.rowpane.addClass("nohighlight");this.displaycols=this.maxcols;if(!this.showall&&this.colwidthok){var w=this.body._element.innerWidth();if(w>0){var len=0;for(var i=0;i<this.colwidth.length;++i){len+=this.colwidth[i];if(len>w){this.displaycols=i+1;break}}}}if(this.chartrow)for(var i=0;i<this.displaycols;++i)this._insertChart(i);if(!this.showall&&
(this.viewmode=="tree"||this.viewmode=="list")){var h=this.body._element.innerHeight();if(this.chartrow)h+=this.chartrow.outerHeight();var r=Math.ceil(h/this.rowheight)+(this.searchstr?20:10);nrow=Math.min(r%2==0?r:r+1,this.maxrows)}else nrow=this.maxrows;if(this.tree){var size=0;this.allrows=[];for(var i=0;i<this.maxrows;++i){var row=this._getRow(i);var status=new Object;status.files=0;if(this.searchstr){if(row.folder==true)status.openfolder=true;if(row.parentid!="")for(var j=i-1;j>=0;--j)if(row.parentid==
this._getRow(j).id){status.parent=this.allrows[j];break}status.location=size++}else{if(row.folder==true)if(row.open)status.openfolder=true;else status.openfolder=false;var hidden=false;if(row.parentid!="")for(var j=i-1;j>=0;--j)if(row.parentid==this._getRow(j).id){status.parent=this.allrows[j];var p=status.parent;while(p){if(p.openfolder==false){hidden=true;break}p=p.parent}break}if(!hidden)status.location=size++;else status.location=-1}this.allrows[i]=status}this.rowpane.height(size*this.rowheight);
if(this.searchstr)nrow=size;else nrow=Math.min(nrow,size)}else{if(this.gridline)this.headerrow.addClass("wcx-grid-gridline");this.rowpane.height(this.maxrows*this.rowheight)}var folders=[];var ok;var j=0;var location;if(this.tree&&this.allrows.length>0)location=this.allrows[j].location;else location=j;for(var i=0;i<nrow;++i){this.bodyrows.push(this._appendNewBodyRow());do{if(this.tree&&this.searchstr){while(folders.length>0&&this.allrows[j].parent!=folders[folders.length-1]){if(folders[folders.length-
1].files>0||folders[folders.length-1].matched)break;this.bodyrows[this.bodyrows.length-1]._element.children().detach();this.bodyrows[this.bodyrows.length-1]._element.remove();this.bodyrows.splice(i,1);folders.pop();--location;--i}if(this._getRow(j).folder)folders.push(this.allrows[j])}ok=this._showThisRow(j++,i,location)}while(ok==false&&j<this.maxrows);if(j==this.maxrows){if(!ok){this.bodyrows[this.bodyrows.length-1]._element.children().detach();this.bodyrows[this.bodyrows.length-1]._element.remove();
this.bodyrows.splice(i,1);--i}if(this.tree&&this.searchstr)while(folders.length>0){if(folders[folders.length-1].files>0||folders[folders.length-1].matched)break;this.bodyrows[this.bodyrows.length-1]._element.children().detach();this.bodyrows[this.bodyrows.length-1]._element.remove();this.bodyrows.splice(i,1);folders.pop();--i}break}++location}if(this.searchstr){var totalrows=this.bodyrows.length+this.maxrows-j;this.rowpane.height(totalrows*this.rowheight);if(this.maxrows==j)this.allloaded=true}this._highlightThisColumn(this.highlightedcol,
true,false);if(!this.searchstr&&nrow==this.maxrows)this.showall=true};
_p._highlightThisColumn=function(cidx,onlythisone,removeit){if(cidx<0)return;var found=false;for(var i=0;i<this.allhighlightedcol.length;++i)if(this.allhighlightedcol[i]==cidx){found=true;break}if(onlythisone){this.rowpane.find(".wcx-grid-body-row-cell").each(function(){$(this).removeClass("wcx-selected")});this.headerrow.find(".wcx-grid-header-cell").each(function(){$(this).removeClass("wcx-selected")});this.allhighlightedcol=[];if(found&&removeit)return;this.allhighlightedcol.push(cidx)}else if(!found)this.allhighlightedcol.push(cidx);
var col=this.rowpane.find(".wcx-grid-body-row-cell.c"+cidx);for(var j=0;j<col.length;++j)$(col[j]).addClass("wcx-selected");col=this.headerrow.find(".wcx-grid-header-cell.c"+cidx);for(var j=0;j<col.length;++j)$(col[j]).addClass("wcx-selected")};_p._insertChart=function(col){var cc=this.chartrow.find(".wcx-grid-chart-row-cell.c"+col);if(cc.length>0&&$(cc[0]).children("*").length>0)return;var element=this.getChartCell(col);if(element!="")$(cc[0]).append(element)};
_p._insertColumns=function(first,last){if(this.chartrow)for(var i=first;i<=last;++i)this._insertChart(i);if(this.tree)selector=".wcx-grid-body-tree-row";else selector=".wcx-grid-body-row";var hl=-1;var rows=this.body._element.find(selector);for(var k=0;k<rows.length;++k){var row=$(rows[k]);var rowstate=this._getBodyRowState(k);if(rowstate=="invalid")cell.addClass("ds-danger");else if(rowstate=="valid")cell.addClass("ds-success");else if(rowstate=="warning")cell.addClass("ds-warn");for(var i=first;i<=
last;++i){if($(rows[k]).children(".c"+i).length>0)continue;var y=parseInt($(rows[k]).attr("row"));var cell=$("<div></div>").addClass("wcx-grid-body-row-cell").addClass("c"+i);if(this.isHeaderCellHighlighted(i))cell.addClass("highlighted");if(i==this.highlightedcol){cell.addClass("wcx-selected");hl=i}var element=this.getBodyCell(i,y);if(this.searchstr)if(element!="")if(element.hasClass("wcx-select")||element.hasClass("wcx-inputtext")){element.addClass("wcx-grid-search-highlighted-input");cell.append(element)}else cell.append(element.html(element.html().replace(this.rplregexp,
"$1<span class='wcx-grid-search-highlighted'>$2</span>$3")));else cell.append(element);else{if(element!="")element.removeClass("wcx-grid-search-highlighted-input");cell.append(element)}var state=this._getBodyCellState(i,y);if(state=="invalid")cell.addClass("ds-danger");else if(state=="valid")cell.addClass("ds-success");else if(state=="warning")cell.addClass("ds-warn");var align=this._getBodyCellAlign(i,y);if(align=="right")cell.css("justify-content","flex-end");else if(align=="center")cell.css("justify-content",
"center");else cell.css("justify-content","flex-start");var xlinks=this.getBodyCellXlinks(i,y);if(xlinks){cell.on("click dblclick contextmenu",xlinks,wcClickTableCell);cell.on("mouseenter mouseleave",xlinks,wcMouseOverTableCell);cell.css("text-decoration","underline")}else cell.css("text-decoration","");if(this.clicktohighlightcol)cell.on("click",i,wcHighlightColumn);var color=this._getBodyCellColor(i,y);if(color){var bk=$("<div></div>").css("background-color",color).addClass("wcx-grid-body-row-cell-bk").height(this.rowheight);
var width=this._getBodyCellColorWidth(i,y);if(width!=null){bk.css("width",width*100+"%");bk.css("min-width","1px")}else bk.css("width","100%");cell.prepend(bk);cell.css("border-color",color)}$(rows[k]).append(cell);w=Math.ceil(cell.outerWidth());if(w>0&&this.gridline)++w;if(w>this.colwidth[i])this.colwidth[i]=w;else cell.outerWidth(this.colwidth[i]);this.updatecolwidth=true}}if(hl>-1)this.headerrow.find(".wcx-grid-header-cell.c"+hl).each(function(){$(this).addClass("wcx-selected")})};
_p._doKeyDownHeader=function(event){if(event.which!=13&&event.which!=37&&event.which!=39)return;if(event.ctrlKey)return;if(event.which==39)$(event.target).next(".wcx-grid-header-cell").focus();else if(event.which==37)$(event.target).prev(".wcx-grid-header-cell").focus();else if(event.which==13){var children=$(event.target).children();if(children.length>0)children[0].click()}};
_p._doKeyDownBody=function(event){if(event.which!==$.ui.keyCode.ENTER&&event.which!==$.ui.keyCode.SPACE&&event.which!==$.ui.keyCode.END&&event.which!==$.ui.keyCode.HOME&&event.which!==$.ui.keyCode.LEFT&&event.which!==$.ui.keyCode.UP&&event.which!==$.ui.keyCode.RIGHT&&event.which!==$.ui.keyCode.DOWN&&event.which!=93&&event.which!=107&&event.which!=109)return;if(event.ctrlKey)return;var viewmode=event.data.viewmode;var selector;if(viewmode=="icon")selector=".wcx-grid-iconview-cell";else if(event.data.tree)selector=
".wcx-grid-body-tree-row";else selector=".wcx-grid-body-row";var allrows=event.data.body._element.find(selector);allrows.sort(function(a,b){return parseInt($(a).attr("row"))-parseInt($(b).attr("row"))});var row=event.data.body._element.find(selector+":focus");var target;if(event.which==32&&this.editing==true)return;event.preventDefault();event.stopPropagation();if(event.which===$.ui.keyCode.ENTER||event.which===$.ui.keyCode.SPACE){if(row.length==1&&event.which===$.ui.keyCode.SPACE){event.type="click";
event.data._selectThisRow(event,$(row[0]),selector);$(row[0]).click()}else{var r=row.data("wcobj");if(!r)return;var hasNonPopup=false;var xlinks=r.wcrow.xlinks;if(xlinks&&xlinks.length>0)for(var i=0;i<xlinks.length;i++){var x=xlinks[i];if(x.method=="popup")continue;hasNonPopup=true;break}if(row.length==1){event.data._selectThisRow(event,$(row[0]),selector);if(hasNonPopup)$(row[0]).click();else $(row[0]).dblclick()}}if(event.data.selectedfn)event.data.selectedfn()}else if(event.which===$.ui.keyCode.END){if(row.length==
0)for(var i=0;i<allrows.length;++i){if($(allrows[i]).position().top>=0){target=$(allrows[i]);break}}else{var currentrow;var lastid=0;for(var i=0;i<row.length;++i){var id=parseInt($(row[i]).attr("row"));if(id>=lastid){lastid=id;currentrow=$(row[i])}}if(lastid==event.data.maxrows-1)return;event.data.body._element.scrollTop(event.data.body._element.children().innerHeight()-event.data.body._element.innerHeight());if(viewmode=="list"){event.data._scrollGridVertical();allrows=event.data.body._element.find(selector);
allrows.sort(function(a,b){return parseInt($(a).attr("row"))-parseInt($(b).attr("row"))})}target=$(allrows[allrows.length-1])}event.data._selectThisRow(event,target,selector)}else if(event.which===$.ui.keyCode.HOME){if(row.length==0)for(var i=0;i<allrows.length;++i){if($(allrows[i]).position().top>=0){target=$(allrows[i]);break}}else{var currentrow;var lastid=event.data.maxrows-1;for(var i=0;i<row.length;++i){var id=parseInt($(row[i]).attr("row"));if(id<=lastid){lastid=id;currentrow=$(row[i])}}if(lastid==
0)return;event.data.body._element.scrollTop(0);if(viewmode=="list"){event.data._scrollGridVertical();allrows=event.data.body._element.find(selector);allrows.sort(function(a,b){return parseInt($(a).attr("row"))-parseInt($(b).attr("row"))})}target=$(allrows[0])}event.data._selectThisRow(event,target,selector)}else if(event.which==107){if(row.length!=1)return;if(event.data.tree&&row.data("wcobj").wcrow.folder==true&&viewmode!="dropbox")if(row.find(".wcx-grid-body-tree-row-folder").data("wcobj").getIcon()!=
"remove")event.data._toggleTreeRow(row)}else if(event.which==109){if(row.length!=1)return;if(event.data.tree&&row.data("wcobj").wcrow.folder==true&&viewmode!="dropbox")if(row.find(".wcx-grid-body-tree-row-folder").data("wcobj").getIcon()=="remove")event.data._toggleTreeRow(row)}else if(event.which==93)wcClickTableRow(event,row);else if(viewmode=="icon"){var iconWidth=row.outerWidth(true);var parentDiv=row.parent();var parentWidth=parentDiv.width();var iconsPerRow=iconWidth>0?Math.floor(parentWidth/
iconWidth):1;if(event.which===$.ui.keyCode.UP){if(row.length==0)for(var i=0;i<allrows.length;++i){if($(allrows[i]).position().top>=0){target=$(allrows[i]);break}}else{var currentrow;var lastid=event.data.maxrows-1;for(var i=0;i<row.length;++i){var id=parseInt($(row[i]).attr("row"));if(id<=lastid){lastid=id;currentrow=$(row[i])}}if(lastid<iconsPerRow)return;var position=currentrow.position();if(position.top-event.data.rowheight<0)event.data.body._element.scrollTop(event.data.body._element.scrollTop()-
event.data.rowheight);var idx;for(idx=0;idx<allrows.length;++idx)if(parseInt($(allrows[idx]).attr("row"))==lastid)break;if(idx==0)return;target=$(allrows[idx-iconsPerRow])}event.data._selectThisRow(event,target,selector)}else if(event.which===$.ui.keyCode.DOWN){if(row.length==0)for(var i=0;i<allrows.length;++i){if($(allrows[i]).position().top>=0){target=$(allrows[i]);break}}else{var currentrow;var lastid=0;for(var i=0;i<row.length;++i){var id=parseInt($(row[i]).attr("row"));if(id>=lastid){lastid=
id;currentrow=$(row[i])}}if(lastid>event.data.maxrows-iconsPerRow)return;var position=currentrow.position();if(position.top+2*event.data.rowheight>event.data.body._element.innerHeight())event.data.body._element.scrollTop(event.data.body._element.scrollTop()+event.data.rowheight);var idx;for(idx=0;idx<allrows.length;++idx)if(parseInt($(allrows[idx]).attr("row"))==lastid)break;if(idx==allrows.length-1)return;target=$(allrows[idx+iconsPerRow])}event.data._selectThisRow(event,target,selector)}if(event.which===
$.ui.keyCode.LEFT){if(row.length==0)for(var i=0;i<allrows.length;++i){if($(allrows[i]).position().top>=0){target=$(allrows[i]);break}}else{var currentrow;var lastid=event.data.maxrows-1;for(var i=0;i<row.length;++i){var id=parseInt($(row[i]).attr("row"));if(id<=lastid){lastid=id;currentrow=$(row[i])}}if(lastid==0)return;var position=currentrow.position();if(position.top-event.data.rowheight<0)event.data.body._element.scrollTop(event.data.body._element.scrollTop()-event.data.rowheight);var idx;for(idx=
0;idx<allrows.length;++idx)if(parseInt($(allrows[idx]).attr("row"))==lastid)break;if(idx==0)return;target=$(allrows[idx-1])}event.data._selectThisRow(event,target,selector)}else if(event.which===$.ui.keyCode.RIGHT){if(row.length==0)for(var i=0;i<allrows.length;++i){if($(allrows[i]).position().top>=0){target=$(allrows[i]);break}}else{var currentrow;var lastid=0;for(var i=0;i<row.length;++i){var id=parseInt($(row[i]).attr("row"));if(id>=lastid){lastid=id;currentrow=$(row[i])}}if(lastid==event.data.maxrows-
1)return;var position=currentrow.position();if(position.top+2*event.data.rowheight>event.data.body._element.innerHeight())event.data.body._element.scrollTop(event.data.body._element.scrollTop()+event.data.rowheight);var idx;for(idx=0;idx<allrows.length;++idx)if(parseInt($(allrows[idx]).attr("row"))==lastid)break;if(idx==allrows.length-1)return;target=$(allrows[idx+1])}event.data._selectThisRow(event,target,selector)}}else if(event.which===$.ui.keyCode.UP){if(row.length==0)for(var i=0;i<allrows.length;++i){if($(allrows[i]).position().top>=
0){target=$(allrows[i]);break}}else{var currentrow;var lastid=event.data.maxrows-1;for(var i=0;i<row.length;++i){var id=parseInt($(row[i]).attr("row"));if(id<=lastid){lastid=id;currentrow=$(row[i])}}if(lastid==0)return;var position=currentrow.position();if(position.top-event.data.rowheight<0){event.data.body._element.scrollTop(event.data.body._element.scrollTop()-event.data.rowheight);if(viewmode=="list"){event.data._scrollGridVertical();allrows=event.data.body._element.find(selector);allrows.sort(function(a,
b){return parseInt($(a).attr("row"))-parseInt($(b).attr("row"))})}}var idx;for(idx=0;idx<allrows.length;++idx)if(parseInt($(allrows[idx]).attr("row"))==lastid)break;if(idx==0)return;target=$(allrows[idx-1])}event.data._selectThisRow(event,target,selector)}else if(event.which===$.ui.keyCode.DOWN){if(row.length==0)for(var i=0;i<allrows.length;++i){if($(allrows[i]).position().top>=0){target=$(allrows[i]);break}}else{var currentrow;var lastid=0;for(var i=0;i<row.length;++i){var id=parseInt($(row[i]).attr("row"));
if(id>=lastid){lastid=id;currentrow=$(row[i])}}if(lastid==event.data.maxrows-1)return;var position=currentrow.position();if(position.top+2*event.data.rowheight>event.data.body._element.innerHeight()){event.data.body._element.scrollTop(event.data.body._element.scrollTop()+event.data.rowheight);if(viewmode=="list"){event.data._scrollGridVertical();allrows=event.data.body._element.find(selector);allrows.sort(function(a,b){return parseInt($(a).attr("row"))-parseInt($(b).attr("row"))})}}var idx;for(idx=
0;idx<allrows.length;++idx)if(parseInt($(allrows[idx]).attr("row"))==lastid)break;if(idx==allrows.length-1)return;target=$(allrows[idx+1])}event.data._selectThisRow(event,target,selector)}else if(event.which===$.ui.keyCode.LEFT){if(row.length!=1)return;if(event.data.tree&&row.data("wcobj").wcrow.folder==true&&viewmode!="dropbox")if(row.find(".wcx-grid-body-tree-row-folder").data("wcobj").getIcon()=="remove")event.data._toggleTreeRow(row);else{event.which=38;this._doKeyDownBody(event)}}else if(event.which===
$.ui.keyCode.RIGHT){if(row.length!=1)return;if(event.data.tree&&row.data("wcobj").wcrow.folder==true&&viewmode!="dropbox")if(row.find(".wcx-grid-body-tree-row-folder").data("wcobj").getIcon()!="remove")event.data._toggleTreeRow(row);else{event.which=40;this._doKeyDownBody(event)}}if(target){var inputs=target.find("input");if(inputs&&inputs.length>0)inputs[0].focus()}};
_p._getAllColumnWidth=function(){var maxcols=Math.min(this.maxcols,this.displaycols);var resetall;if((this.viewmode=="dropbox"||this.tree)&&this.maxcols==1)resetall=true;else resetall=false;for(var i=0;i<maxcols;++i){this.colwidth[i]=0;var all=this._element.find(".c"+i);for(var j=0;j<all.length;++j){var w=$(all[j]).attr("cwidth");if(!w||parseInt(w)==0||resetall){$(all[j]).css("width","");$(all[j]).css("min-width","");var selectbox=$(all[j]).find(".wcx-select");if(selectbox.length>0){w=Math.ceil($(selectbox[0]).data("wcobj")._element.outerWidth(true));
if(w==0)w=Math.ceil($(all[j]).outerWidth(true));else w+=Math.ceil($(all[j]).innerWidth()-$(all[j]).width())}else{var multiitem=$(all[j]).find(".wcx-multiitem");if(multiitem.length>0){w=0;var children=$(multiitem[0]).data("wcobj")._children;for(var k=0;k<children.length;++k)w+=Math.ceil(children[k]._element.outerWidth(true));w+=Math.ceil($(all[j]).innerWidth()-$(all[j]).width())}else if(resetall)w=this._element.outerWidth(true);else w=Math.ceil($(all[j]).outerWidth(true))}$(all[j]).attr("cwidth",w)}else w=
parseInt(w);if(w>this.colwidth[i]){this.colwidth[i]=w;this.updatecolwidth=true}}}};
_p._showTreeRows=function(idx){var i;for(i=0;i<this.bodyrows.length;++i)if(parseInt(this.bodyrows[i]._element.attr("row"))==idx)break;if(i==this.bodyrows.length)return;var size=this.allrows[idx].location+1;for(var j=idx+1;j<this.maxrows;++j){var hidden=false;var p=this.allrows[j].parent;while(p){if(p.openfolder==false){hidden=true;break}p=p.parent}if(hidden)this.allrows[j].location=-1;else this.allrows[j].location=size++}this.rowpane.height(size*this.rowheight);var maxbodyrows=Math.min(Math.ceil(this.body._element.innerHeight()/
this.rowheight)+5,this.maxrows);var ok;var location;if(this.tree)location=this.allrows[idx++].location+1;else location=++idx;while(true){if(++i==this.bodyrows.length)i=0;if(i==this.firstbodyrow){if(this.bodyrows.length>=maxbodyrows)break;if(i==0)i=this.bodyrows.length-1;else{this.firstbodyrow=i+1;i-=1}var bodyrow=this._createNewBodyRow();bodyrow._element.insertAfter(this.bodyrows[i]._element);this.bodyrows.splice(i+1,0,bodyrow);++i}while((ok=this._showThisRow(idx++,i,location))==false)if(idx==this.maxrows)break;
if(idx==this.maxrows){if(ok)++i;if(i<=this.bodyrows.length-1)if(i>this.firstbodyrow){for(var j=i;j<this.bodyrows.length;++j){this.bodyrows[j]._element.children().detach();this.bodyrows[j]._element.remove()}this.bodyrows.splice(i,this.bodyrows.length-i);if(this.firstbodyrow>0){for(var j=0;j<this.firstbodyrow;++j){this.bodyrows[j]._element.children().detach();this.bodyrows[j]._element.remove()}this.bodyrows.splice(0,this.firstbodyrow);this.firstbodyrow=0}}else{for(var j=i;j<this.firstbodyrow;++j){this.bodyrows[j]._element.children().detach();
this.bodyrows[j]._element.remove()}this.bodyrows.splice(i,this.firstbodyrow-i);this.firstbodyrow=i}break}++location}this.updatecolwidth=true;this._adjustColumnWidth()};_p._appendNewBodyRow=function(){var bodyrow=this._createNewBodyRow();bodyrow._element.appendTo(this.rowpane);return bodyrow};
_p._createNewBodyRow=function(){var bodyrow=new WcxWidget;bodyrow._element.height(this.rowheight);bodyrow._element.ibxWidget("setAccessibility",true,{role:"row"}).attr("tabindex","-1");if(!this.tree){bodyrow._element.addClass("wcx-grid-body-row");if(this.viewmode=="list"&&!this.plain)bodyrow._element.addClass("wcx-grid-body-row-normal");else if(this.viewmode=="dropbox")bodyrow._element.addClass("wcx-grid-body-row-dropbox")}else bodyrow._element.addClass("wcx-grid-body-tree-row");if(this.gridline)bodyrow._element.addClass("wcx-grid-gridline");
bodyrow._element.on("click dblclick contextmenu",this,wcClickTableRow);bodyrow._element.on("mouseenter mouseleave",bodyrow,wcMouseOverTableRow);if(this.isClickable()&&(this.viewmode=="dropbox"||!this.plain))this._handleRowSelection(bodyrow);var hl=-1;var maxcols=Math.min(this.maxcols,this.displaycols);var dragcolumn=-1;if(this.isTableDraggable())dragcolumn=this.dragcolumn;for(var j=0;j<maxcols;++j){var cell=$("<div></div>");if(dragcolumn==j)cell.ibxWidget();cell.addClass("wcx-grid-body-row-cell").addClass("c"+
j).appendTo(bodyrow._element);if(this.isHeaderCellHighlighted(j))cell.addClass("highlighted");if(j==this.highlightedcol){hl=j;cell.addClass("wcx-selected")}if(j==this.maxcols-1&&this.hstretch)cell.css("border-right","0px")}if(hl>-1)this.headerrow.find(".wcx-grid-header-cell.c"+hl).each(function(){$(this).addClass("wcx-selected")});this._setDragDrop(bodyrow,dragcolumn>=0);return bodyrow};
_p._dragstart=function(e){if(this.editing)return false;e=e.originalEvent;var dt=e.dataTransfer;var dragImage=$("<div></div>")[0];var dragLeft=-5;if(this.isTableDraggable()){var value="";var thisrow=$(e.currentTarget);if(thisrow.hasClass("wcx-grid-body-row-cell"))thisrow=thisrow.parent();if(this.wcHasCheckboxSelect){var allrows=this.body._element.find(".wcx-grid-body-row");allrows.removeClass("wcx-selected").attr("aria-hidden","true").removeAttr("aria-selected");var chks=thisrow.closest(".wcx-grid-body").find(".wcx-checkbox.checked");
if(chks.length>0)for(var j=0;j<chks.length;++j){var row=$(chks[j]).closest(".wcx-grid-body-row");row.addClass("wcx-selected").attr("aria-selected","true");var wcrow=row.data("wcobj").wcrow;var v=wcrow.dragvalue?wcrow.dragvalue:wcrow.rowid;if(value=="")value=v;else value+=" "+v}else return false}else if(thisrow.hasClass("wcx-selected")){var s=thisrow.closest(".wcx-grid-body").find(".wcx-selected");for(var j=0;j<s.length;++j){var v=$(s[j]).data("wcobj").wcrow.dragvalue?$(s[j]).data("wcobj").wcrow.dragvalue:
$(s[j]).data("wcobj").wcrow.rowid;if(value=="")value=v;else value+=" "+v}}else value=thisrow.data("wcobj").wcrow.dragvalue?thisrow.data("wcobj").wcrow.dragvalue:thisrow.data("wcobj").wcrow.rowid;var dragtypes=[];if(this.tree){var wcrow=thisrow.data("wcobj").wcrow;if(wcrow&&wcrow.dragtypes){dt.setData("dragtype",wcrow.dragtypes);dragtypes=wcrow.dragtypes.split(",")}dragtypes.push("text")}var txt=this.getTableDragName();if(txt&&txt!="")txt+="="+value;else txt=value;dt.setData("text",txt);if(this.tree)for(var i=
0;i<dragtypes.length;i++){var dtype=dragtypes[i];dt.setData(dtype,txt)}var cell=null;var name=this.getTableColDragName();if(name&&name!=""){var left=e.clientX-thisrow.offset().left;var offsetx=0;for(var i=0;i<this.displaycols;++i){offsetx+=this.colwidth[i];if(left<offsetx){dt.setData("colindex",name+"="+i);cell=thisrow.find(".wcx-grid-body-row-cell.c"+i);break}}}if(cell==null)cell=thisrow.find(".wcx-grid-body-row-cell").first();var paddingLeft=0;var folder=cell.find(".wcx-grid-body-tree-row-folder");
if(folder&&folder.length>0)paddingLeft=parseInt(folder.css("padding-left"));else dragLeft=30;$(dragImage).html(cell.html());$(dragImage).css("display","flex");dragLeft=dragLeft-e.offsetX-paddingLeft;var gc=this._element.closest(".wcx-graph-content");if(gc&&gc.length>0){var wcobj=gc.data("wcobj");if(wcobj instanceof WcGraphContent)wcobj.doGridStartDrag(e,txt)}}if(this.tree){dt.setDragImage(null,"center","center");var value="";var nodeLabel=this.body._element.find(".wcx-grid-body-tree-row.wcx-selected");
if(nodeLabel&&nodeLabel.length>0){var img=$("<div>").addClass("wcx-dragimage");for(var i=0;i<nodeLabel.length;i++)img.append(nodeLabel[i].cloneNode(true).innerHTML);img.find(".wcx-grid-body-row-cell").css("position","relative");img.find(".wcx-grid-body-tree-row-folder").css("display","none");img.find(".wcx-image").css("flex-direction","column");img.find(".wcx-image>.ibx-label-icon").css("font-size","24px");dt.setDragImage(img[0],20,20)}}else dt.setDragImage(dragImage,dragLeft,-5)};
_p._setDragDrop=function(bodyrow,dragcell){if(!dragcell)bodyrow._element.on("ibx_dragstart",this._dragstart.bind(this));if(this.isTableDroppable()){bodyrow._element.on("ibx_dragover",function(e){e=e.originalEvent;var dt=e.dataTransfer;dt.dropEffect="copy";e.preventDefault();var target=$(e.currentTarget);target.addClass("wcx-dragover").removeClass("wcx-dragovermiddle");if(this.isRowMiddleDroppable()){var low=Math.floor(this.rowheight/3);if(e.offsetY>=low&&e.offsetY<low*2)target.addClass("wcx-dragovermiddle")}}.bind(this));
bodyrow._element.on("ibx_dragleave",function(e){e=e.originalEvent;$(e.currentTarget).removeClass("wcx-dragover wcx-dragovermiddle")});bodyrow._element.on("ibx_drop",function(e){e=e.originalEvent;var dt=e.dataTransfer;var middle=false;if(this.isRowMiddleDroppable()){var low=Math.floor(this.rowheight/3);if(e.offsetY>=low&&e.offsetY<low*2)middle=true}var colid=-1;var left=e.clientX-$(e.currentTarget).offset().left;var offsetx=0;for(var i=0;i<this.displaycols;++i){offsetx+=this.colwidth[i];if(left<offsetx){colid=
i;break}}$(e.currentTarget).data("wcobj").wcrow.selected=true;$(e.currentTarget).addClass("wcx-selected").removeAttr("aria-hidden").attr("aria-selected","true");$(e.currentTarget).removeClass("wcx-dragover wcx-dragovermiddle");this.runRowDropXlink($(e.currentTarget).data("wcobj").wcrow.rowid,colid,dt.getData("text"),dt.getData("colindex"),middle)}.bind(this))}};
_p._adjustHeight=function(){if(!this.vstretch&&!this.tree&&this.bodyrows.length==this.maxrows){var h=2;if(this.bodyrows.length>0)h+=this.bodyrows[this.bodyrows.length-1]._element.position().top+this.bodyrows[this.bodyrows.length-1]._element.outerHeight(true);if(h<this.body._element.innerHeight()){this._element.css("flex-grow","0");this._element.innerHeight(h+this.headerrow.outerHeight(true))}}};
_p._adjustColumnWidth=function(){var total=0;var viewwidth=this.body._element.width();if(this.updatecolwidth||this.hstretch){var newcolwidth=this.colwidth.slice();if(this.showcharts)for(var i=0;i<newcolwidth.length;++i)newcolwidth[i]=200;else for(var i=0;i<newcolwidth.length;++i)if(newcolwidth[i]<24)newcolwidth[i]=24;if(this.hstretch)if(this.samecolwidth){var each=Math.floor(viewwidth/newcolwidth.length);for(var i=0;i<newcolwidth.length;++i)if(i==newcolwidth.length-1)newcolwidth[i]=viewwidth-i*each;
else newcolwidth[i]=each}else{for(var i=0;i<newcolwidth.length;++i)total+=newcolwidth[i];var offset=viewwidth-total;var cols=0;var colswidth=0;for(var i=0;i<this.colwidthfixed.length;++i)if(!this.colwidthfixed[i]){++cols;colswidth+=newcolwidth[i]}var org;var ratio;while(Math.abs(offset)>0&&cols>0){ratio=offset/colswidth;org=offset;colswidth=0;for(var i=0;i<this.colwidthfixed.length;++i)if(!this.colwidthfixed[i]){var addition=Math.ceil(newcolwidth[i]*ratio);if(org>0){addition=Math.min(addition,offset);
newcolwidth[i]+=addition;offset-=addition;colswidth+=newcolwidth[i]}else{addition=Math.max(addition,offset);if(newcolwidth[i]+addition>100){newcolwidth[i]+=addition;offset-=addition;colswidth+=newcolwidth[i]}else{offset+=newcolwidth[i]-100;newcolwidth[i]=100;--cols}}}if(offset==org)break}total=0}var left=0;for(var i=0;i<newcolwidth.length;++i){var all=this.body._element.find(".c"+i);if(i==0)for(var j=0;j<all.length;++j){$(all[j]).css("width",newcolwidth[i].toString()+"px");$(all[j]).css("min-width",
newcolwidth[i].toString()+"px")}else{left+=newcolwidth[i-1];for(var j=0;j<all.length;++j){$(all[j]).css("width",newcolwidth[i].toString());$(all[j]).css("min-width",newcolwidth[i].toString()+"px");$(all[j]).css("left",left+"px")}}all=this.headerrow.children(".c"+i);for(var j=0;j<all.length;++j){$(all[j]).css("width",newcolwidth[i].toString()+"px");$(all[j]).css("min-width",newcolwidth[i].toString()+"px");$(all[j]).css("left",left+"px")}if(this.chartrow){all=this.chartrow.children(".c"+i);for(var j=
0;j<all.length;++j){$(all[j]).css("width",newcolwidth[i].toString()+"px");$(all[j]).css("min-width",newcolwidth[i].toString()+"px");$(all[j]).children().triggerHandler("resize");$(all[j]).css("left",left+"px")}}total+=newcolwidth[i]}this.updatecolwidth=false}else return;var wstr=Math.floor(Math.max(viewwidth,total)).toString()+"px";var all=this.body._element.find(".wcx-grid-body-row");for(var i=0;i<all.length;++i)$(all[i]).css("width",wstr).css("min-width",wstr);this.rowpane.css("width",wstr).css("min-width",
wstr);this.header._element.outerWidth(Math.ceil(this.body._element.outerWidth()));if(this.chartrow){this.chartrow.width(Math.max(total,this._element.width()));if(this.maxrows==0)this.rowpane.append($("<div></div").height(this.rowheight).width(Math.max(total,this._element.width())))}};
_p._showThisRow=function(i,idx,location){var contain=this.searchstr?false:true;var bodyrow=this.bodyrows[idx];var wcrow=this._getRow(i);var found=[];if(this.searchstr){for(var j=0;j<this.maxcols;++j){var element=this._getBodyCellText(j,i);if(this.searchstr&&element!="")if(this.srchregexp.test($("<div></div>").text(element).html())){contain=true;found.push(true)}else found.push(false);else found.push(false)}if(contain)this.searchcount+=1}if(!(this.searchstr&&this.tree&&wcrow&&wcrow.folder)&&!contain)return false;
if(this.tree){if(this.allrows[i].location==-1)return false;this.allrows[i].matched=contain;if(this.allrows[i].parent&&!wcrow.folder)this.allrows[i].parent.files++}bodyrow._element.attr("row",i);bodyrow._element.attr("qa","row-"+i);bodyrow._element.css("top",location*this.rowheight+"px");bodyrow.wcrow=wcrow;var rowstate=this._getBodyRowState(i);bodyrow._element.removeClass("ds-danger ds-success ds-warn");if(rowstate=="invalid")bodyrow._element.addClass("ds-danger");else if(rowstate=="valid")bodyrow._element.addClass("ds-success");
else if(rowstate=="warning")bodyrow._element.addClass("ds-warn");if(wcrow){if(this.viewmode!="dropbox"){if(wcrow.selected){bodyrow._element.addClass("wcx-selected");bodyrow._element.removeAttr("aria-hidden").attr("aria-selected","true")}else{bodyrow._element.attr("aria-hidden","true").removeAttr("aria-selected");bodyrow._element.removeClass("wcx-selected")}if(wcrow.highlighted)bodyrow._element.addClass("wcx-highlighted");else bodyrow._element.removeClass("wcx-highlighted")}bodyrow._element.ibxWidget({"draggable":wcrow.draggable});
wcrow.jqobj=bodyrow._element}if(this.viewmode!="dropbox")if(i==this.maxrows-1){bodyrow._element.addClass("wcx-grid-body-row-last");if(this.lastrowborder)bodyrow._element.addClass("wcx-grid-body-row-last-border")}else bodyrow._element.removeClass("wcx-grid-body-row-last");var dragcolumn=-1;if(this.isTableDraggable())dragcolumn=this.dragcolumn;var maxcols=Math.min(this.maxcols,this.displaycols);for(var j=0;j<maxcols;++j){var c=bodyrow._element.children(".c"+j);c.off();if(dragcolumn==j){c.ibxWidget({"draggable":true});
c.on("ibx_dragstart",this._dragstart.bind(this))}c.css("width","");c.children().detach();var element=this.getBodyCell(j,i);c.attr("qa","row-"+i+"-column-"+j);c.attr("col",j);c.removeAttr("cwidth");var container;if(this.viewmode=="dropbox"&&wcrow){if(wcrow.parentid!="")container=$("<div></div>").addClass("wcx-grid-body-row-dropbox-value");else container=$("<div></div>").addClass("wcx-grid-body-row-dropbox-title");c.append(container)}else container=c;if(this.searchstr&&found[j])if(element!="")if(element.hasClass("wcx-select")||
element.hasClass("wcx-inputtext")){element.addClass("wcx-grid-search-highlighted-input");container.append(element)}else container.append(element.html(element.html().replace(this.rplregexp,"$1<span class='wcx-grid-search-highlighted'>$2</span>$3")));else container.append("");else{if(element!="")element.removeClass("wcx-grid-search-highlighted-input");container.append(element)}if(element!="")if(element.hasClass("wcx-select")||element.hasClass("wcx-inputtext"))this.hasselectbox=true;if(j==0&&this.viewmode==
"dropbox"&&wcrow&&wcrow.parentid==""&&wcrow.xlinks){var menu=new WcxButtonSimple(null,"ds-icon-setting");menu.setIconSize(14);wcAttachLinksTo(menu,wcrow.xlinks);bodyrow._element.unbind("click dblclick contextmenu mouseenter mouseleave");container.append(menu._element)}var state=this._getBodyCellState(j,i);c.removeClass("ds-danger ds-success ds-warn");if(state=="invalid")c.addClass("ds-danger");else if(state=="valid")c.addClass("ds-success");else if(state=="warning")c.addClass("ds-warn");var align=
this._getBodyCellAlign(j,i);if(align=="right")c.css("justify-content","flex-end");else if(align=="center")c.css("justify-content","center");else c.css("justify-content","flex-start");var xlinks=this.getBodyCellXlinks(j,i);if(xlinks){c.on("click dblclick contextmenu",xlinks,wcClickTableCell);c.on("mouseenter mouseleave",xlinks,wcMouseOverTableCell);c.css("text-decoration","underline")}else c.css("text-decoration","");if(this.clicktohighlightcol)c.on("click",j,wcHighlightColumn);if(this.tree&&j==this.treecol&&
wcrow){var icon;if(wcrow.folder==true){if(this.allrows[i].openfolder==true)icon=new WcxLabel(null,false,"remove");else icon=new WcxLabel(null,false,"add");icon._element.children(".ibx-label-glyph").on("click",function(e){e.preventDefault();e.stopPropagation();this._toggleTreeRow($(e.currentTarget).closest(".wcx-grid-body-row, .wcx-grid-body-tree-row"))}.bind(this))}else{icon=new WcxLabel(null,false,"remove");icon._element.children(".ibx-label-glyph").css("visibility","hidden")}icon._element.addClass("wcx-grid-body-tree-row-folder");
c.prepend(icon._element);if(wcrow.level>0)c.children(":first").css("padding-left",wcrow.level*12+"px");else c.children(":first").css("padding-left","")}var color=this._getBodyCellColor(j,i);if(color){var bk=$("<div></div>").css("background-color",color).addClass("wcx-grid-body-row-cell-bk").height(this.rowheight);var width=this._getBodyCellColorWidth(j,i);if(width!=null){bk.css("width",width*100+"%");bk.css("min-width","1px")}else bk.css("width","100%");c.prepend(bk);c.css("border-color",color)}}if(this.viewmode==
"dropbox"&&wcrow&&wcrow.parentid!=""){var prev=bodyrow._element.prev().find(".wcx-grid-body-row-dropbox-value");if(prev.length>0){for(var i=0;i<prev.length;++i)$(prev[i]).css("border-bottom","0px");bodyrow._element.find(".wcx-grid-body-row-dropbox-value").each(function(){$(this).css("border-top","0px")})}}return true};
_p._selectThisRow=function(e,targetrow,selector){if(targetrow.length!=1)return;targetrow.focus();if(targetrow.hasClass("wcx-grid-iconview-cell")){var caption=targetrow.attr("title");wcAriaSpeak(caption+" Button")}if(e.shiftKey&&this.singleselect!==true){var id=parseInt(targetrow.attr("row"));var firstid=-1;for(var i=0;i<this.maxrows;++i)if(this._getRow(i).selected)if(firstid==-1){firstid=i;break}targetrow.siblings().each(function(index){$(this).removeClass("wcx-selected").attr("aria-hidden","true").removeAttr("aria-selected")});
if(firstid!=-1)for(var i=0;i<this.maxrows;++i)if(id<=firstid)if(i>id&&i<=firstid){this._getRow(i).selected=true;targetrow.siblings("div[row='"+i+"']").addClass("wcx-selected").removeAttr("aria-hidden").attr("aria-selected","true")}else this._getRow(i).selected=false;else if(i>=firstid&&i<id){this._getRow(i).selected=true;targetrow.siblings("div[row='"+i+"']").addClass("wcx-selected").removeAttr("aria-hidden").attr("aria-selected","true")}else this._getRow(i).selected=false;targetrow.addClass("wcx-selected").removeAttr("aria-hidden").attr("aria-selected",
"true");this._getRow(id).selected=true}else if(e.ctrlKey&&this.singleselect!==true){var row=this._getRow(parseInt(targetrow.attr("row")));row.selected=!row.selected;if(row.selected)targetrow.addClass("wcx-selected").removeAttr("aria-hidden").attr("aria-selected","true");else targetrow.removeClass("wcx-selected").attr("aria-hidden","true").removeAttr("aria-selected")}else if(e.type!=="keydown"){var r;if(!targetrow.hasClass("wcx-selected")){this.body._element.find(selector+".wcx-selected").removeClass("wcx-selected").attr("aria-hidden",
"true").removeAttr("aria-selected");for(var i=0;i<this.maxrows;++i){r=this._getRow(i);if(r)r.selected=false}}r=this._getRow(parseInt(targetrow.attr("row")));if(r){r.selected=true;targetrow.addClass("wcx-selected").removeAttr("aria-hidden").attr("aria-selected","true")}}};
_p._handleRowSelection=function(bodyrow){bodyrow._element.on("mousedown",function(e){e.stopPropagation();wcClearTextSelection();var selector;if(this.viewmode=="icon")selector=".wcx-grid-iconview-cell";else if(this.tree)selector=".wcx-grid-body-tree-row";else selector=".wcx-grid-body-row";this._selectThisRow(e,$(e.currentTarget).closest(selector),selector)}.bind(this));bodyrow._element.on("mouseup",function(e){var selector;if(this.viewmode=="icon")selector=".wcx-grid-iconview-cell";else if(this.tree)selector=
".wcx-grid-body-tree-row";else selector=".wcx-grid-body-row";if(!e.ctrlKey&&e.which==1&&!e.shiftKey){var r=$(e.currentTarget).closest(selector);var rows=this.body._element.find(selector+".wcx-selected");for(var i=0;i<rows.length;++i)if(!$(rows[i]).is(r))$(rows[i]).removeClass("wcx-selected").attr("aria-hidden","true").removeAttr("aria-selected");var rowid=this._getRow(parseInt(r.attr("row"))).rowid;for(var i=0;i<this.maxrows;++i){var row=this._getRow(i);if(row.rowid!=rowid)row.selected=false}}if(this.selectedfn)this.selectedfn()}.bind(this))};
_p._toggleTreeRow=function(obj){var icon=obj.find(".wcx-grid-body-tree-row-folder").data("wcobj");var wcobj=obj.data("wcobj");if(this.searchstr)return;var link=false;var idx=parseInt(obj.attr("row"));if(icon.getIcon()=="remove"){this.allrows[idx].openfolder=false;this._showTreeRows(idx);icon.setIcon("add");if(wcobj.wcrow.collapsexlink){wcSubmitLink(wcobj.wcrow.collapsexlink);link=true}}else if(wcobj.wcrow.numchildren>0){this.allrows[idx].openfolder=true;this._showTreeRows(idx);icon.setIcon("remove");
if(wcobj.wcrow.expandxlink){wcSubmitLink(wcobj.wcrow.expandxlink);link=true}}else if(wcobj.wcrow.xlinks){for(var k=0;k<wcobj.wcrow.xlinks.length;++k)if(wcobj.wcrow.xlinks[k].method=="post")if(!wcobj.wcrow.xlinks[k].obj||wcobj.wcrow.xlinks[k].obj==""||wcobj.wcrow.xlinks[k].obj=="icon"){wcSubmitLink(wcobj.wcrow.xlinks[k]);link=true;break}icon.setIcon("remove")}if(!link)this.resetColumnWidth()};
function wcMouseOverTableCell(e){if($(this).hasClass("wcx-cursor-contextmenu")){$(this).removeClass("wcx-cursor-contextmenu");return}if(e.data)for(var i=0;i<e.data.length;++i)if(e.data[i].method=="popup"){$(this).addClass("wcx-cursor-contextmenu");break}}
function wcMouseOverTableRow(e){if($(this).hasClass("wcx-cursor-contextmenu")){$(this).removeClass("wcx-cursor-contextmenu");return}var row=e.data.wcrow;if(!row)return;if(row.xlinks)for(var i=0;i<row.xlinks.length;++i)if(row.xlinks[i].method=="popup"){$(this).addClass("wcx-cursor-contextmenu");break}}
function wcClickTableCell(e){var xlinks=e.data.slice();for(var j=0;j<xlinks.length;++j)if(xlinks[j].method=="popup"){if(e.type=="contextmenu"||e.type=="dblclick"){xlinks[j].jqobj=$(this);wcHandleClick.bind([xlinks[j]])(e)}xlinks.splice(j,1);break}if(xlinks.length>0){for(var j=0;j<xlinks.length;++j)xlinks[j].jqobj=$(this);wcHandleClick.bind(xlinks)(e)}}
function wcGetTopButtons(item){if(!item.item)return null;for(var k=0;k<item.item.length;k++)if(item.item[k].type=="wcform"&&item.item[k].formid=="wcf_tablebar")return item.item[k];return null}function wcGetBottomButtons(item){if(!item.item)return null;for(var k=0;k<item.item.length;k++)if(item.item[k].type=="wcform"&&item.item[k].formid=="wcf_bottombar")return item.item[k];return null}
function wcHighlightColumn(e){var jqgrid=$(e.currentTarget).closest(".wcx-grid").data("wcobj");if(e.shiftKey&&jqgrid.allhighlightedcol.length>0){var last=jqgrid.allhighlightedcol[jqgrid.allhighlightedcol.length-1];var i;if(last>e.data)for(i=last;i>=e.data;--i)jqgrid._highlightThisColumn(i,i==last?true:false,false);else for(i=last;i<=e.data;++i)jqgrid._highlightThisColumn(i,i==last?true:false,false)}else jqgrid._highlightThisColumn(e.data,e.ctrlKey?false:true,true)}
function wcClickTableRow(e,obj){if(e.which==0)return;if(e.originalEvent&&e.originalEvent.target){var origTarget=e.originalEvent.target;if(origTarget){if($(origTarget).is("input"))return;if($(origTarget).hasClass("ds-select"))return;if($(origTarget).hasClass("ibx-button"))return}}var jqobj;if(!obj)jqobj=$(e.currentTarget).closest(".wcx-grid-body-row, .wcx-grid-body-tree-row");else jqobj=obj;if(jqobj.length==0)jqobj=$(e.currentTarget).closest(".wcx-grid-iconview-cell");var row=jqobj.data("wcobj").wcrow;
if(!row)return;var wcgrid=$(e.currentTarget).closest(".wcx-grid").data("wcobj");if(wcgrid.contextmenucontainer){if(e.type=="click"||e.type=="dblclick"||e.type=="contextmenu"){wcgrid.contextmenucontainer._element.empty();if(!row.xlinks)return;e.stopPropagation();e.preventDefault();for(var j=0;j<row.xlinks.length;++j){row.xlinks[j].jqobj=jqobj;if(row.xlinks[j].method=="popup"){var node=null;var link=row.xlinks[j];if(link.node){node=link.node[0];node._page=link._page;node._popupnodes=link._popupnodes}if(node&&
node.dynamic){var dlink=node.xlink[0];dlink._page=node._page;dlink._popupnodes=node._popupnodes;dlink._menu_name=node.dynamic;wcHandleLinkVariables(dlink.parameters,link.parameters);node=wcHandleDynamicPopup(dlink,null);if(node)node._page=dlink._page}if(node){if(!row.contextmenu){row.contextmenu=new WcxMenu(true);wcBuildMenu(link.jqobj,node,link.parentNode,link.parameters,row.contextmenu,link.getOtherParams)}if(e.type=="dblclick")row.contextmenu.getFirstItem().trigger("click");else{var first=true;
var allitems=row.contextmenu.getAllItems();for(var i=0;i<allitems.length;++i){var op=$(allitems[i]).data("wcobj");if(op instanceof WcxMenuItem){if(first){first=false;continue}var icon=op.getIconName();if(!icon)icon="ds-icon-unknown";var btn=new wcCreateIconButton({"icon":icon,"title":op.getText()});btn._element.addClass("common-btn btn-toolbar btn-default");btn._element.on("click",function(e){this._element.trigger(e)}.bind(op));wcgrid.contextmenucontainer.add(btn)}}var cmcEl=wcgrid.contextmenucontainer._element;
if(cmcEl&&cmcEl.length){var cmcBtns=$(cmcEl[0]).find(".ibx-button-simple");if(cmcBtns&&cmcBtns.length)$(cmcBtns[0]).focus()}if(e.type=="contextmenu")row.contextmenu.open(e)}}}else{e.jqobj=jqobj;wcHandleClick.bind([row.xlinks[j]])(e)}}}return}if(e.type=="contextmenu"||e.which==93){if(!row.xlinks)return;for(var j=0;j<row.xlinks.length;++j)if(row.xlinks[j].method=="popup"){row.xlinks[j].jqobj=jqobj;e.jqobj=jqobj;wcHandleClick.bind([row.xlinks[j]])(e);break}}else if(e.type=="dblclick")if(row.folder==
true&&wcgrid.viewmode!="dropbox")e.data._toggleTreeRow(jqobj);else{if(!row.xlinks)return;for(var j=0;j<row.xlinks.length;++j)if(row.xlinks[j].method=="popup"){row.xlinks[j].jqobj=$(this);wcHandleClick.bind([row.xlinks[j]])(e);break}}else{if(!row.xlinks)return;e.stopPropagation();for(var j=0;j<row.xlinks.length;++j){if(row.xlinks[j].method=="popup"||row.xlinks[j].method=="post"&&row.xlinks[j].http_target=="TARGET_TREE_FOLDER")continue;if(row.xlinks[j].wcTimeoutId)continue;row.xlinks[j].jqobj=$(this);
row.xlinks[j].wcTimeoutId=setTimeout(function(xlink,e){delete xlink.wcTimeoutId;wcHandleClick.bind([xlink])(e)},300,row.xlinks[j],e)}}}_p.isHeaderCellHighlighted=function(x){return false};_p.isHeaderCellWidthFixed=function(x){return true};_p.getHeaderItem=function(x){return""};_p.getChartCell=function(x){return""};_p.getBodyCell=function(x,y){return""};_p.getBodyCellXlinks=function(x,y){return null};_p.isHeaderDroppable=function(){return false};_p.isBodyDroppable=function(){return false};
_p.isRowMiddleDroppable=function(){return false};_p.isTableDroppable=function(){return false};_p.isTableDraggable=function(){return false};_p.getTableDragName=function(){return""};_p.getTableColDragName=function(){return""};_p.runHeaderDropXlink=function(data,coldata){};_p.runBodyDropXlink=function(data,coldata){};_p.runRowDropXlink=function(rowid,colid,data,coldata,middle){};_p.isClickable=function(){return false};
function wcoauth2(){if(arguments.length<2){console.log("wcoauth2: ERROR: too few arguments="+arguments.length);return}var iobj=wcGetComponentByName(arguments[1]);if(iobj==null)return;var oobj=wcGetComponentByName(arguments[2]);var provider=arguments[4];if(provider!="esri"&&provider!="dyncrm"&&oobj==null)return;var sobj=wcGetComponentByName(arguments[3]);if((provider=="google"||provider=="esri"||provider=="gbq"||provider=="linkedin")&&sobj==null)return;var robj=null;if(provider!="linkedin")robj=wcGetComponentByName(arguments[5]);
var permobj=null;var app_secret="";if(sobj){app_secret=sobj.textfield.getText();if(app_secret.length==0)if(provider=="esri"){var msg=new WcMessageDialog("Client Secret must be provided","warning");return}}var app_id=iobj.textfield.getText();if(app_id.length==0){if(provider=="esri"||provider=="dyncrm")var msg=new WcMessageDialog("Client Id must be provided","warning");else var msg=new WcMessageDialog("Application Id must be provided","warning");return}var scope=null;window.bcfbobj=new Object;window.bcfbobj.cb=
function(result){var app_id=iobj.textfield.getText();if(!result)return;if(provider!="esri"&&provider!="dyncrm")oobj.textfield.setText(result.accesstoken);if(robj)robj.textfield.setText(result.refreshtoken)};var permobj=null;if(provider=="linkedin"||provider=="slack"){scope="";for(var i=13;i<arguments.length;i++){permobj=wcGetComponentByName(arguments[i]);if(permobj!=null&&permobj.checkbox.getChecked()){if(scope.length>0)scope+=" ";scope+=permobj.checkedvalue}}}var workspaceobj=null;var workspace=
null;if(provider=="slack"){workspaceobj=wcGetComponentByName(arguments[12]);if(workspaceobj)workspace=workspaceobj.textfield.getText()}var authobj=null;var tokenobj=null;var authurl=null;var tokenurl=null;authobj=wcGetComponentByName(arguments[6]);tokenobj=wcGetComponentByName(arguments[7]);if(authobj)authurl=authobj.textfield.getText();if(tokenobj)tokenurl=tokenobj.textfield.getText();if(!authurl||!tokenurl)if(provider=="custom"||provider=="slack"||provider=="dyncrm"){var msg=new WcMessageDialog("Authorization URL and Token URL must be provided",
"warning");return}var serviceobj=wcGetComponentByName(arguments[8]);var serviceurl=null;if(serviceobj)serviceurl=serviceobj.textfield.getText();var add_authobj=null;var add_tokenobj=null;var add_auth=null;var add_token=null;add_authobj=wcGetComponentByName(arguments[10]);add_tokenobj=wcGetComponentByName(arguments[11]);if(add_authobj)if(provider=="slack"){add_auth="scope="+scope;if(workspace)add_auth=add_auth+"%26team="+workspace}else add_auth=add_authobj.getText();if(add_tokenobj)add_token=add_tokenobj.getText();
var baseurl=null;var baseurlobj=wcGetComponentByName(arguments[0]);if(baseurlobj)baseurl=baseurlobj.getParams()["PGWY_BASE_URL"][0];var host=window.location.protocol+"//"+window.location.host;var url=host+baseurl+"/"+"oauth20.exe?access_type=offline";var url_trace=url;url+="&client_id="+app_id;url+="&client_secret="+app_secret;response_type="&response_type=code";url+=response_type;if(provider=="gbq"){url+="&state=google";url_trace+="&state=google";scope="https://www.googleapis.com/auth/bigquery";
provider="google"}else if(provider=="google"){url+="&state=google";url_trace+="&state=google";scope="https://www.googleapis.com/auth/analytics.readonly"}else if(provider=="gglshts"||provider=="ggldrv"){url+="&state=google";url_trace+="&state=google";scope="https://www.googleapis.com/auth/drive https://www.googleapis.com/auth/spreadsheets";provider="google"}else if(provider=="linkedin"){url+="&state=linkedin";url_trace+="&state=linkedin"}else{url+="&state="+provider;url_trace+="&state"+provider}if(scope&&
!(provider=="slack")){url+="&scope="+scope;url_trace+="&scope="+scope}if(authurl){url+="&authcode_url="+authurl;url_trace+="&authcode_url="+authurl}if(tokenurl){url+="&token_url="+tokenurl;url_trace+="&token_url="+tokenurl}if(provider=="dyncrm")if(serviceurl){url+="&service_url="+serviceurl;url_trace+="&service_url="+serviceurl}url+="&host_uri="+host;url_trace+="&host_uri="+host;url+="&provider="+provider;url_trace+="&provider="+provider;if(add_auth){var en_add_auth=null;var en_add_auth2=null;en_add_auth=
add_auth.replace(/=/g,"%3D");en_add_auth2=en_add_auth.replace(/&/g,"%26");url+="&add_auth="+en_add_auth2;url_trace+="&add_auth="+en_add_auth2}if(add_token){var en_add_token=null;var en_add_token2=null;en_add_token=add_token.replace(/=/g,"%3D");en_add_token2=en_add_token.replace(/&/g,"%26");url+="&add_token="+en_add_token2;url_trace+="&add_token="+en_add_token2}var newtab=window.open();newtab.location=url;window.removeEventListener("storage",wcoauth2_storage_ev,false);localStorage.removeItem("accessToken");
localStorage.removeItem("refreshToken");window.addEventListener("storage",wcoauth2_storage_ev,false)}function wcoauth2_storage_ev(evt){if(evt&&evt.newValue&&(evt.key=="accessToken"||evt.key=="refreshToken")){if(evt.key=="accessToken")if(evt.newValue!=evt.oldValue)sessionStorage.setItem("accessToken",evt.newValue);if(evt.key=="refreshToken"){fbobj=new Object;fbobj.accesstoken=sessionStorage.getItem("accessToken");fbobj.refreshtoken=evt.newValue;window.bcfbobj.cb(fbobj)}}}
function wcfbauth(){if(arguments.length<2)return;var iobj=wcGetComponentByName(arguments[1]);if(iobj==null)return;var oobj=wcGetComponentByName(arguments[2]);if(oobj==null)return;var sobj=wcGetComponentByName(arguments[3]);if(sobj==null)return;var xobj=wcGetComponentByName(arguments[4]);var permobj=null;var perm_def="public_profile";var app_secret=sobj.textfield.getText();window.bcfbobj=new Object;window.bcfbobj.app_id=iobj.textfield.getText();window.bcfbobj.app_secret=app_secret;window.bcfbobj.scope=
perm_def;for(var i=5;i<arguments.length;i++){permobj=wcGetComponentByName(arguments[i]);if(permobj!=null&&permobj.checkbox.getChecked())window.bcfbobj.scope+=","+permobj.checkedvalue}window.bcfbobj.cb=function(result){if(!result)return;oobj.textfield.setText(result.accesstoken);if(xobj!=null)xobj.textfield.setText(result.expiration)};$.ajaxSetup({"cache":true,"async":false});$.getScript("wcfbauth.js")}
function wcHighlightOutputColumn(colname,objname,framename){var obj=wcapplication.getWcfObject(objname);if(!obj)return;if(obj instanceof WcMultiframes){var frame=obj.getFrameByFrameID(framename);if(frame&&frame.getActiveContentPane()){var obj=frame.getActiveContentPane()._element.find(".wcx-wctable");if(obj){var wcobj=obj.data("wcobj");if(wcobj){var jqgrid=wcobj.jqgrid;jqgrid.scrollColumnIntoView(jqgrid.highlightColumn(colname))}}}}}
function wcShowPulldown(id1,id2,id3){var image=null;var s1=null;var s2=null;if(id3){image=$("div[wcid='"+id1+"']").data("wcobj");s1=$("div[wcid='"+id2+"']").data("wcobj");s2=$("div[wcid='"+id3+"']").data("wcobj")}else{s1=$("div[wcid='"+id1+"']").data("wcobj");s2=$("div[wcid='"+id2+"']").data("wcobj")}s1.wcSelect2=s2;var selectbox1=s1.selectbox;var selectbox2=s2.selectbox;var oldValue1=selectbox1.getText();var oldValue2=selectbox2.getText();var offset1=$(selectbox1._element).offset();var offset2=$(selectbox2._element).offset();
var width1=parseInt($(selectbox1._element).width());var width2=parseInt($(selectbox2._element).width());var left1=parseInt(offset1.left);var left2=parseInt(offset2.left);var width=left2-left1+width2;if(image){var img_offset=$(image._element).offset();var img_width=parseInt($(image._element).outerWidth());var img_left=parseInt(img_offset.left);width=img_left-left1+img_width}var top=parseInt(offset1.top+$(selectbox1._element).height());var multilist_popup=new WcxPopup(true);multilist_popup.setModal(false);
multilist_popup.setResizable(false);multilist_popup._element.addClass("wcx-multilist-popup");multilist_popup._element.css({"width":width+"px","padding":"0"});multilist_popup.setAutoClose(true);var maxheight=$(window).height()-(top+25);var multilist_box=new WcxHBox;multilist_box._element.addClass("wcx-multilist-box");multilist_box._element.css("max-height",maxheight+"px");multilist_popup.add(multilist_box);var box1=new WcxComponent;box1._element.css({"max-height":maxheight+"px","overflow-x":"hidden",
"overflow-y":"auto"});multilist_box.add(box1);var separator=new WcxComponent;separator._element.css({"width":"1px","height":maxheight+"px","overflow":"hidden","border-left":"1px solid #cccccc"});multilist_box.add(separator);var box2=new WcxComponent;box2._element.css({"max-height":maxheight+"px","overflow-x":"hidden","overflow-y":"auto"});multilist_box.add(box2);var wcItem1=s1.wcItem;if(!wcItem1)return;var clone1=wcBuild(wcItem1);var $popup1=clone1.selectbox.getInstance()._popup;var wcItem2=s2.wcItem;
if(!wcItem2)return;var clone2=wcBuild(wcItem2);var $popup2=clone2.selectbox.getInstance()._popup;var $clone1list=$popup1.find(".ibx-select-item-list");var $clone2list=$popup2.find(".ibx-select-item-list");var location=s1.selectbox._element;multilist_popup.open(location);$(clone1._element).off("ibx_change").on("ibx_change",function(e){var text=this.selectbox.getText();s1.selectbox.setText(text)}.bind(clone1));$(clone2._element).off("ibx_change").on("ibx_change",function(){var text=this.selectbox.getText();
s2.selectbox.setText(text)}.bind(clone2));if(s1.searchable)$clone1list.addClass("wcx-searchable");if(s2.searchable)$clone2list.addClass("wcx-searchable");var listwidth1=offset2.left-offset1.left;var listwidth2=width-listwidth1;$clone1list.width(parseInt(listwidth1));$clone2list.width(parseInt(listwidth2));$clone1list.css({"border":"0","margin":"0","padding":"0"});$clone2list.css({"border":"0","margin":"0","padding":"0"});setQaAttrToElement($clone1list.first(),"left-list");setQaAttrToElement($clone2list.first(),
"right-list");box1._element.append($clone1list);box2._element.append($clone2list);selectbox1.resizeMultiListColumns([$clone1list,$clone2list]);multilist_popup._element.focus();if(s1.searchable){$clone1list.addClass("wcx-searchable");var sf=$('<div class="wcx-search-field"><input style="flex:1;margin-top:4px;" placeholder=" '+ibx.resourceMgr.getString("search")+' "/></div>');if(sf){sf.on("keyup",clone1.doPopupSearchKeyUp.bind(clone1));$clone1list.prepend(sf)}$clone1list.on("focus",function(evt){var relatedTarget=
evt.relatedTarget;if(relatedTarget&&$(relatedTarget).is("input"))relatedTarget.focus()});$clone1list.css("margin-top","28px");var search=$(box1._element).find(".wcx-search-field");if(search&&search.length>0){var input=$(search).find("input");input.css("margin-top","0");for(var i=0;i<search.length;i++){var sf=search[i];var parent=$(sf).parent();var w=parent.width();$(sf).css({"width":w+"px","left":"0"})}}$(search._element).find("input").focus()}if(s2.searchable){$clone2list.addClass("wcx-searchable");
var sf=$('<div class="wcx-search-field"><input style="flex:1;margin-top:4px;" placeholder=" '+ibx.resourceMgr.getString("search")+' "/></div>');if(sf){sf.on("keyup",clone2.doPopupSearchKeyUp.bind(clone2));$clone2list.prepend(sf)}$clone2list.on("focus",function(evt){var relatedTarget=evt.relatedTarget;if(relatedTarget&&$(relatedTarget).is("input"))relatedTarget.focus()});$clone2list.css("margin-top","28px");var search=$(box2._element).find(".wcx-search-field");if(search&&search.length>0){var input=
$(search).find("input");input.css("margin-top","0");for(var i=0;i<search.length;i++){var sf=search[i];var parent=$(sf).parent();var w=parent.width();$(sf).css({"width":w+"px","left":""})}}}$(multilist_popup._element).on("ibx_beforeclose",function(){var select1Item=clone1.selectbox.getSelected();var select2Item=clone2.selectbox.getSelected();var xlinks1=select1Item?select1Item.wcxlinks:false;var xlinks2=select2Item?select2Item.wcxlinks:false;var hasXlinks1=xlinks1&&xlinks1.length>0?true:false;var hasXlinks2=
xlinks2&&xlinks2.length>0?true:false;var canMerge=hasXlinks1&&hasXlinks2;var xlinks=hasXlinks1?xlinks1:xlinks2;if(xlinks&&xlinks.length>0)for(var i=0;i<xlinks.length;i++){var xlink=xlinks[i];if(canMerge){var xlink2=xlinks2[i];if(xlink2){var params=xlink2.parameters;for(var j=0;j<params.length;j++){var p=params[j];wcAddParameter(xlink,p.name,p.value)}}}xlink.jqobj=hasXlinks1?s1._element:s2._element;wcSubmitLink(xlink)}clone1.dispose();clone2.dispose()})}
function wcRefreshObject(){if(!window.wcapplication){window.parent.wcRefreshObject.apply(null,arguments);return}if(arguments.length<=1)return;var obj=wcapplication.getWcfObject(arguments[0]);if(!obj)return;if(obj instanceof WcMultiframes){var p=obj.getContentPaneByID(arguments[1]);if(p){var params=new WcUrl;params.setUrl(wcapplication.wcurl);for(var i=2;i<arguments.length;i+=2)params.addParam(arguments[i],arguments[i+1]);p.doLoad(params,true)}}}
function wcGetJoinToolData(mt_id,fn){var xml=new WcLoader(wcapplication.wcurl);xml.addParam("mt_id",mt_id);xml.addParam("mt_action","getjtdata");xml.load(function(){if(fn)fn()},null,function(text){if(fn)fn(text)})}function wcDelJoinToolData(mt_id,fn){var xml=new WcLoader(wcapplication.wcurl);xml.addParam("mt_id",mt_id);xml.addParam("mt_action","deljtdata");xml.load(function(){if(fn)fn()},null,function(text){if(fn)fn(text)})}
function wcUpdateJoinTool(querystring,fn){var xml=new WcLoader(wcapplication.wcurl);xml.addQueryString(querystring);xml.addParam("mt_action","updatejt");xml.load(wcxParseXml,wcapplication.toppage.mainframe.contentframe.content,function(text){if(fn)fn(text)})}function wcUnselectAll(name){var t=$.find(".wcx-wctable[wctable="+name+"]");if(t.length!=1)return;var wcobj=$(t[0]).data("wcobj");if(!wcobj)return;wcobj.unSelectAll()}function wcCloseAllPopups(){ibxPopupManager.closeOpenPopups(".ibx-menu")}
function wcSelectSideBarButton(name){var t=$.find("div[wcid="+name+"]");if(t.length==0)return;var button=$(t[0]).data("wcobj");button._element.ibxWidget("checked",true)}
function WcForm(wcform){if(_wcconstructing)return;WcxComponent.call(this,"WcForm");var hiddengid=[];var rows=wcform.row;var ncol;var issimpleform=false;if(typeof wcform.ncol!=="undefined")ncol=wcform.ncol;else ncol=1;this.wrappable=wcform.wrappable;this.nrow=0;this._formid=wcform.formid;if(this._formid)if(this._formid=="wcf_buttonbar"){var classname="wcx-wcform-buttonbar";if(rows&&rows.length==1){this.add(new WcButtonBar(wcform));this._element.addClass(classname);return}if(wcform.properties)for(var i=
0;i<wcform.properties.length;++i)if(wcform.properties[i].name=="size"&&wcform.properties[i].value=="big"){classname="wcx-wcform-buttonbar-big";break}this._element.addClass(classname)}else if(this._formid=="wcf_toolbar"){this._element.addClass("wcx-wcform-toolbar");var bar=new WcToolBar(this);bar.addButtons(wcform);this.add(bar);this.top=true;return}else if(this._formid=="wcf_simpleform"||this._formid=="loginform"){issimpleform=true;this._element.addClass("wcx-wcform");this._element.addClass("wcx-wcsimpleform");
ncol=ncol*2}else this._element.addClass("wcx-wcform");else this._element.addClass("wcx-wcform");if(wcform.properties)for(var i=0;i<wcform.properties.length;i++){var formProp=wcform.properties[i];var propName=formProp.name;var propValue=formProp.value;if(propName=="bulletin"&&propValue=="y"){this._element.addClass("wcx-wcform-bulletin");break}else if(propName=="background"&&propValue=="y"){this._element.addClass("wcx-wcform-background");break}else if(propName=="justified"&&propValue=="y"){this._element.addClass("wcx-wcform-justified");
this._justified=true;ncol=1;break}}this.wchiddens=wcform.getHiddens?wcform.getHiddens():wcform.hidden;this.wcitems=[];this.wcxgrids=[];this.wcFocusedObj=null;if(!rows||rows.length&&rows.length<1)return;var obj;if(rows.length>1||ncol>1||typeof rows[0].collapsible_num!=="undefined"&&rows[0].collapsible_num!=0||rows[0].item&&rows[0].item.length>0&&rows[0].item[0].type!="wctexteditor"&&rows[0].item[0].type!="wcricheditor"){var wcgrid=null;var pane=null;for(var i=0;i<rows.length;i++){var num=rows[i].collapsible_num;
if(num==-2)wcgrid=null;if(num==-1){if(pane==null){pane=new WcxAccordionPane;pane._element.addClass("ds-accordian");this.add(pane)}var page=new WcxAccordionPage;page._element.addClass("ds-accordian-page");var accordian=page.getInstance();var acc_btn=accordian._button;page.setSelected(rows[i].collapsible_show);page.wcTitle=rows[i].collapsible_text;page.setTitle(page.wcTitle);if(this._justified)wcgrid=new WcxVBox;else{wcgrid=new WcxGrid;wcgrid._element.addClass("wcx-wcform-grid");wcgrid.setColumnCount(ncol)}page.addContent(wcgrid);
pane.addPage(page);page._element.ready(function(){try{if(!this._disposed){var tpButton=this._element.find(".ibx-accordion-page-button");$(tpButton).ibxWidget("setAccessibility",true,{label:this.wcTitle})}}catch(e){}}.bind(page));page._element.on("ibx_open",wcgrid,function(evt){setTimeout(function(g){g._element[0].scrollIntoView()},300,evt.data);evt.stopPropagation()});page._element.on("ibx_close",function(evt){evt.stopPropagation()});this.wcxgrids.push(wcgrid)}else if(wcgrid==null){if(this._justified)wcgrid=
new WcxVBox;else{wcgrid=new WcxGrid;wcgrid._element.addClass("wcx-wcform-grid");wcgrid.setColumnCount(ncol);if(ncol==1&&this._formid!="wcf_buttonbar")wcgrid.setJustifyContent("stretch")}this.add(wcgrid);this.wcxgrids.push(wcgrid)}var items=rows[i].item;if(items==null||wcgrid==null)continue;this.nrow++;var assignGroup=rows[i].assignGroup;var j;var counter=0;var containerObj=wcgrid;var wcJustifiedRow=null;var hasJustifiedRow=this._justified&&items.length>1;if(hasJustifiedRow){wcJustifiedRow=new WcxHBox;
wcJustifiedRow._element.addClass("wcx-justified-row");wcJustifiedRow._element.css("align-self","stretch");wcgrid.add(wcJustifiedRow)}for(j=0;j<items.length;j++){var itm=items[j];itm._isjustified=this._justified;if(hasJustifiedRow){containerObj=new WcxVBox;if(items.length>0)containerObj._element.css("width",Math.floor(1/items.length*100)+"%");wcJustifiedRow.add(containerObj)}var labelbox;if(issimpleform){itm._issimpleform=true;labelbox=new WcxHBox;labelbox._element.addClass("wcx-form-item");labelbox._element.addClass("wcx-form-label-box");
labelbox._element.addClass("wcx-wcform-grid-c1");labelbox._element.css("align-self","flex-start");if(!this._justified)labelbox._element.css("grid-column",(j+1)*2-1+" / span 1");var label,textonly=null;if(this._justified&&itm.type=="wcemailaddr"){var labelStr=itm.label;label=new WcxLabel(labelStr?labelStr:ibx.resourceMgr.getString("strto"));labelbox.add(label);itm._arialabel=label._element[0]}else if(itm.label){label=new WcxLabel(itm.label);label._element.addClass("wcx-simpleform-label");labelbox.add(label);
itm._arialabel=label._element[0];label=new WcxLabel(itm.label2?itm.label2:"");label.setColor(itm.label2color);labelbox.add(label)}else if(itm.text&&itm.type=="wctext"){textonly=new WcxLabel(itm.text);labelbox.add(textonly);itm._arialabel=textonly._element[0]}if(itm.helplink||itm.title){var noHelpFile=!itm.helplink||!itm.helplink.file;var desc={_objtype:"wcdescription",_helplink:itm.helplink,_justified:this._justified,_nohelpfile:noHelpFile,text:itm.title,desc_flags:4096};var helplink=wcCreateIconButton(desc);
if(helplink&&!helplink._disposed)try{$(helplink._element).addClass("wcx-description-help");$(helplink._element).css("font-weight","900");if(itm.title)helplink._element.ibxWidget("setAccessibility",true,{label:ibx.resourceMgr.getString("helptooltip")+" "+itm.title});if(noHelpFile)$(helplink._element).addClass("wcx-no-help");itm._helplink=helplink._element[0];labelbox.add(helplink)}catch(e){}}}hiddengid=hiddengid.concat(wcGetXlinkHideGID(itm));obj=wcBuild(itm);if(textonly&&obj instanceof WcText)obj._element.addClass("wcx-hidetext");
if($.trim((itm.label?itm.label:"")+itm.text)=="")obj._element.addClass("wcx-emptytext");if(assignGroup){obj._element.attr("wcgroup",assignGroup);if(labelbox)labelbox._element.attr("wcgroup",assignGroup)}this.wcitems.push(obj);var colspan;var skipAddObj=false;if(issimpleform)if(obj instanceof WcTextOnly){colspan=2;obj._element.css("grid-column",(j+1)*2-1+" / span 2")}else if(obj instanceof WcEmailAddr){if(!this._justified)colspan=1}else if(obj instanceof WcCheckBox){skipAddObj=true;var newHBox=new WcxHBox;
newHBox._element.addClass("wcx-simpleform-checkbox");newHBox._element.css("align-self","stretch");newHBox.add(obj);obj._element.css("width","auto");obj._element.css("margin-top","3px");newHBox.add(labelbox);containerObj.add(newHBox,1);colspan=1}else{containerObj.add(labelbox,1);colspan=1;obj._element.css("grid-column",(j+1)*2+" / span "+colspan)}else if(!itm.colspan)colspan=1;else colspan=itm.colspan;if(!skipAddObj)containerObj.add(obj,colspan);if(issimpleform)counter+=2;else{if(colspan>1)obj._element.css("grid-column",
j+1+" / span "+colspan);else if(j==0){obj._element.css("grid-column","1");obj._element.addClass("wcx-wcform-grid-c1")}counter+=colspan}if(obj)if(!this.wcFocusedObj||itm.inputfocus)if(obj.takeFocus)this.wcFocusedObj=obj}for(;counter<ncol;++counter){obj=new WcxComponent;if(assignGroup)obj._element.attr("wcgroup",assignGroup);wcgrid.add(obj)}}}else{var itm=rows[0].item;if(itm&&itm.length&&itm.length>0)obj=wcBuild(itm[0]);this.wcitems.push(obj);this.add(obj);this._element.addClass("wcx-wcform-fullpage")}for(var k=
0;k<hiddengid.length;k++){var elm=this._element.find("*[wcgroup='"+hiddengid[k]+"']");for(var i=0;i<elm.length;++i)$(elm[i]).hide()}var wcobj=this;this._element.ready(function(){wcobj.doFilterChanged();var firstcolumns=wcobj._element.find(".wcx-wcform-grid-c1");if(firstcolumns.length==0)return;if(!issimpleform)firstcolumns.each(function(){var item;if($(this).attr("data-ibx-type")=="ibxLabel")item=$(this);else item=$(this).children("[data-ibx-type='ibxLabel']");if(item&&item.length>0){var nextitem=
$(this).next().children(".ibx-text-field");if(nextitem.length>0){$(item[0]).ibxWidget("option","for","#"+nextitem.attr("id")+" input");$(item[0]).attr("tabindex","-1")}}});$(wcobj._element).trigger("formready");if(wcobj.wcxgrids.length<=1)return;var mwidth=0;firstcolumns.each(function(){var width;width=$(this).outerWidth();if(width>mwidth)mwidth=width});firstcolumns.each(function(){$(this).outerWidth(mwidth)})})}_p=wcInherit(WcForm,WcxComponent);
_p.getParams=function(){if(!this.wcitems)return null;var params=new Object;var p;for(var i=0;i<this.wcitems.length;++i){var itm=this.wcitems[i];if(itm&&itm.getParams){p=itm.getParams();for(var k in p)if(k&&p.hasOwnProperty(k))if(params[k])params[k]=params[k].concat(p[k]);else params[k]=p[k]}}if(this.wchiddens&&this.wchiddens.item)for(var j=0;j<this.wchiddens.item.length;++j){p=wcBuild(this.wchiddens.item[j]).getParams();for(var k in p)if(k&&p.hasOwnProperty(k))if(params[k])params[k]=params[k].concat(p[k]);
else params[k]=p[k]}return params};_p.takeFocus=function(){if(this.wcFocusedObj)return this.wcFocusedObj.takeFocus();else return false};
_p.doFilterChanged=function(){var filterValue="";for(var i=0;i<this.wcitems.length;i++){var itm=this.wcitems[i];if(itm&&itm.wcFilterValue){if(filterValue!="")filterValue+="; ";filterValue+=itm.wcFilterValue}else if(itm instanceof WcTextOnly||itm instanceof WcButton);}var ele=$(this._element).closest(".wcx-multiframes-content-pane");var cp=ele?ele.data("wcobj"):null;if(cp&&cp.wcContentInfo){cp.wcContentInfo.wcLastFilterValue=filterValue;var ci=cp.wcContentItem;if(ci)ci.doFilterChanged(filterValue)}};
function WcBaseText(item){if(_wcconstructing)return;WcxHBox.call(this)}_p=WcBaseTextProto=wcInherit(WcBaseText,WcxHBox);
_p.setItemText=function(txt,item){var textFlags=item.text_flags;if(textFlags>0){if(textFlags&wcconstants.WCF_TEXT_BOLD)txt.setBold(true);if(textFlags&wcconstants.WCF_TEXT_SMALL)txt.setSize(11);if(textFlags&wcconstants.WCF_TEXT_LARGE)txt.setSize(16);if(textFlags&wcconstants.WCF_TEXT_WRAP)txt.setWrap(true);if(textFlags&wcconstants.WCF_TEXT_INDENTTEXT&&item.type!="wcimage")txt._element.css("padding-left","20px");if(textFlags&wcconstants.WCF_TEXT_UPPERCASE)txt._element.css("text-transform","uppercase");
if(textFlags&wcconstants.WCF_TEXT_MONOSPACE)txt._element.addClass("wcx-text-monospace")}txt.setColor(item.text_color)};
_p.addItems=function(element,item){var deletexlink=item.deletexlink;var desc=item.description;if(deletexlink){this.add(element);var deletebutton={_objtype:"wcdeletebutton",tooltip:"Delete value",xlink:deletexlink};this.prepend(wcCreateIconButton(deletebutton))}else if(desc){var dtext=desc.text;var dflags=desc.desc_flags;if(!item._issimpleform&&(item.helplink||dtext&&dflags&4096)){this.add(element);desc._objtype="wcdescription";if(item.helplink)desc._helplink=item.helplink;this.add(wcCreateIconButton(desc))}else if(dtext){var label=
null;if(dflags&256||item._isjustified){var box=new WcxVBox;if(item._isjustified)box._element.addClass("wcx-text-field-box");box.add(element);if(item._isjustified&&desc.hiddentext){var basetext=dtext;label=new WcxLabel(ibx.resourceMgr.getString("show")+" "+basetext);label._element.addClass("ds-hide-show");label.wcBaseText=basetext;box.add(label);$(label._element).on("click",function(e){var isVisible=this.wcHiddenLabel.getVisible();this.wcHiddenLabel.setVisible(!isVisible);var newtext=(isVisible?ibx.resourceMgr.getString("show"):
ibx.resourceMgr.getString("hide"))+" "+this.wcBaseText;this.setText(newtext)}.bind(label));var hiddenlabel=new WcxLabel(desc.hiddentext);hiddenlabel._element.addClass("ds-hide-show-label");hiddenlabel.setVisible(false);label.wcHiddenLabel=hiddenlabel;box.add(hiddenlabel)}else{label=new WcxLabel(dtext);box.add(label)}this.add(box)}else{this.add(element);if(desc.hiddentext)label=new WcxLabel(dtext+" "+desc.hiddentext);else label=new WcxLabel(dtext);label._element.css("padding-left","16px");this.add(label)}if(label){if(item._issimpleform)item._description=
label._element[0];label.setWrap(true);label._element.css("white-space","pre-wrap");label._element.ready(function(){var form=$(label._element).closest(".wcx-wcform");if(form&&form.length>0)label.addEventListener("contextmenu",function(evt){var text=" ";if(window.getSelection)text=window.getSelection().toString();else if(document.getSelection)text=document.getSelection().toString();else if(document.selection&&document.selection.type!="Control")text=document.selection.createRange().text;if(text.length>
0)evt.stopPropagation()})})}}else this.add(element)}else this.add(element);if(item.title&&!item._issimpleform)element.setTitle(item.title)};
function WcText(item){if(_wcconstructing)return;WcBaseText.call(this,item);this._element.addClass("wcx-form-item");if(item.class)this._element.addClass(item.class);this.text=item.text;var txt=this.label=new WcxLabel(this.text,(item.text_flags&wcconstants.WCF_TEXT_HTML)!=0);this.setItemText(txt,item);if(item.text_flags&wcconstants.WCF_TEXT_WRAP)this.textwrapped=true;if(item.multiline)txt._element.css("white-space","pre-wrap");txt._element.addClass("wcx-label-text");if(item.title)txt.setTitle(item.title);
var xlink=item.xlink;if(!xlink){xlink=[];xlink.push(item.helplink)}if(xlink)$(txt._element).addClass("wcxlink");wcAttachLinksTo(this,xlink);this.addItems(txt,item);var label=this;this._element.ready(function(){var form=$(label._element).closest(".wcx-wcform");if(form&&form.length>0)label.addEventListener("contextmenu",function(evt){var text=" ";if(window.getSelection)text=window.getSelection().toString();else if(document.getSelection)text=document.getSelection().toString();else if(document.selection&&
document.selection.type!="Control")text=document.selection.createRange().text;if(text.length>0)evt.stopPropagation()})})}_p=WcTextProto=wcInherit(WcText,WcBaseText);
function WcBaseInput(item){if(_wcconstructing)return;WcBaseText.call(this,item);this._element.addClass("ds-input");if(item.readonly)this._element.addClass("ds-readonly");if(item.inputfocus)this.takeFocus();var baseInput=this;this._element.ready(function(){var input=$(baseInput._element).find("input");if(input&&input.length>0){input.removeAttr("role");if(item.value)input.attr("qa-input-value",item.value)}})}_p=WcInputTextProto=wcInherit(WcBaseInput,WcBaseText);
_p.takeFocus=function(){var el=this._element;if(el){setTimeout(function(){var input=$(el).find("input");if(input&&input.length>0)input[0].focus()},0);return true}return false};
_p.setAriaLabel=function(item){if(item._arialabel&&item._textInput){$(item._textInput).removeAttr("aria-label");$(item._textInput).attr("aria-labelledby",item._arialabel.id);var describe_ids="";if(item._helplink)describe_ids+=item._helplink.id+" ";if(item._description)describe_ids+=item._description.id+" ";$(item._textInput).attr("aria-describedby",$.trim(describe_ids));$(item._arialabel).on("focus mousedown",function(){setTimeout(function(){item._textInput.focus()},0)}.bind(this))}};_p.getText=function(){return this.textfield.getText()};
_p.validateInput=function(inputtype,textVal){var itype=parseInt(inputtype);var valid=true;if(textVal!=""&&itype>0){var pattern;if(itype==1)pattern=/^[1-9]+[0-9]*$/;else if(itype==2)pattern=/^[0-9]*$/;else if(itype==3)pattern=/^[-|+]?[0-9]*$/;else pattern=/^[-|+]?[0-9]*\.?[0-9]*$/;var regexp=new RegExp(pattern);valid=regexp.test(textVal)}return valid};
_p.doFilterValue=function(filterValue){if($(this.textfield._element).closest("body").length>0){this.wcFilterValue=this.textfield.getText();var wcFilter=$(this.textfield._element).closest(".wcx-wcfilter");var wcobj=wcFilter?wcFilter.data("wcobj"):null;if(wcobj&&wcobj.doFilterChanged)wcobj.doFilterChanged(this.wcFilterValue);else{var wcForm=$(this.textfield._element).closest(".wcx-wcform");wcobj=wcForm.data("wcobj");if(wcobj&&wcobj.doFilterChanged)wcobj.doFilterChanged()}}};
function WcInputText(item){if(_wcconstructing)return;WcBaseInput.call(this,item);this._element.addClass("wcx-form-item wcx-focusable wcx-inputtext");if(item.class)this._element.addClass(item.class);this.textfield=new WcxTextField(item.value);this.setName(item.name);var maxlength=item.maxlength;if(maxlength>0)this.textfield.setMaxLength(maxlength);var size;if(typeof item.size!=="undefined")size=item.size;else size=28;if(size>0){size=Math.min(400,Math.max(50,size*8));this.textfield.setSize(size)}this.textfield.wcDirtyOnly=
item.dirty_only;this.textfield.wcInitialValue=item.value;this.textfield.setReadOnly(item.readonly);this.textfield.setEnabled(!item.disabled);this.inputtype=item.inputtype;this.invalidmsg=item.invalidmsg;this.xlinks=item.xlink;var tf=this.textfield.getInstance();var textInput=tf._textInput;this.validText=textInput.val();this.oldText=this.validText;this.doFilterValue();$(this.textfield._element).on("drop",function(evt){var e=evt.originalEvent;var dt=e.dataTransfer;var text=dt.getData("text");if(text){var input=
$(e.currentTarget).find("input");text=input.val()+text;if(input&&input.length>0){input.focus();input.val(text)}}}.bind(this));this.textfield.addEventListener("change",this.doChange.bind(this));textInput.on("keyup",this.doKeyUp.bind(this));textInput.on("keydown",this.doKeyDown.bind(this));this.addItems(this.textfield,item);if(item._issimpleform){item._textInput=this.textfield.getInstance()._textInput[0];this.setAriaLabel(item)}else if(item.title){var aria={accessible:true,label:item.title};this.textfield._element.ibxWidget("option",
"aria",aria)}if(item.xlinkcontrol){var btn=new WcxButtonSimple;btn.setIcon(wcapplication.imgstr.ellips);if(item.xlinkcontrol_title)btn.setTitle(item.xlinkcontrol_title);btn._element.addClass("wcx-iconbutton");this.xlinkcontrol=item.xlinkcontrol;btn.addEventListener("click",this.doControlClick,this);this.insertAfter(btn,this.textfield)}if(item.inputfocus)this.textfield._element.ready(function(){this.focus()}.bind(this.textfield._element))}_p=wcInherit(WcInputText,WcBaseInput);
_p.getParams=function(){var name=this.getName();if(name==null||name=="")return null;var value=this.textfield.getText();if(this.textfield.wcDirtyOnly){var initialValue=this.textfield.wcInitialValue;if(value==initialValue)return null}var p=new Object;p[name]=[value];return p};_p.setEnabled=function(enabled){this.textfield.setEnabled(enabled)};
_p.doKeyUp=function(e){if(e.keyCode==13)this.doChange(e);else{var tf=this.textfield.getInstance();var textInput=tf._textInput;var textVal=textInput.val();if(this.validateInput(this.inputtype,textVal))this.validText=textVal;else{textInput.val(this.validText);var dlg=new WcMessageDialog(this.invalidmsg,"warning");dlg.onClose(function(){textInput.focus()},dlg)}}};_p.doKeyDown=function(e){if(e.keyCode==37||e.keyCode==39||e.keyCode==32)e.stopPropagation()};
_p.doChange=function(e){var tf=this.textfield.getInstance();var textInput=tf._textInput;var textVal=textInput.val();if(this.validateInput(this.inputtype,textVal))if(this.oldText!=textVal){this.oldText=textVal;this.doFilterValue();if(this.xlinks)for(var i=0;i<this.xlinks.length;i++){var xlinks=this.xlinks[i];var xlink=JSON.parse(JSON.stringify(xlinks));if(xlink){xlink.jqobj=this._element;wcSubmitLink(xlink)}}}};
_p.doControlClick=function(e){var xlink=JSON.parse(JSON.stringify(this.xlinkcontrol));if(xlink){xlink.jqobj=this._element;wcSubmitLink(xlink)}};
function WcPassword(item){if(_wcconstructing)return;WcBaseInput.call(this,item);this._element.addClass("wcx-form-item wcx-focusable");this.textchanged=false;this.updname=item.updname;this.updvalue=item.updvalue;this.textfield=new WcxTextField(item.fillvalue?"password":"");this.textfield.setType("password");var size=item.size;if(size>0){size=size*8;if(size>400)size=400;this.textfield.setSize(size)}this.setName(item.pwdname);var value=item.value;if(value)this.textfield.setText(value);var maxlength=
item.maxlength;if(maxlength>0)this.textfield.setMaxLength(maxlength);this.textfield.addTextChangedEventListener(function(){this.textchanged=true},this);this.addItems(this.textfield,item)}_p=wcInherit(WcPassword,WcBaseInput);_p.getParams=function(){var name=this.getName();var value=this.textfield.getText();if(name==null||name=="")return null;var p=new Object;if(this.textchanged){if(this.updname)p[this.updname]=this.updvalue;p[name]=[value]}return p};
function WcTextArea(item){if(_wcconstructing)return;WcBaseInput.call(this,item);this._element.addClass("wcx-form-item wcx-focusable ds-textarea");if(item.class)this._element.addClass(item.class);this.setName(item.name);this.xlinks=item.xlink;this.textfield=new WcxTextArea(item.value);if(item.wrap&&item.wrap!="off")this.textfield.setWrap(item.wrap);this.textfield.setReadOnly(item.readonly);if(item.readonly)this._element.addClass("ds-readonly");this.textfield.setRows(item.rows);if(item.cols>0)this.textfield.setCols(item.cols);
else this.textfield._element.css("width","100%");this.textfield.addEventListener("change",this.doChange.bind(this));this.addItems(this.textfield,item)}_p=wcInherit(WcTextArea,WcBaseInput);_p.getParams=function(){var name=this.getName();var value=this.textfield.getText();if(name==null||name=="")return null;var p=new Object;p[name]=[value];return p};_p._takeFocus=_p.takeFocus;
_p.takeFocus=function(){var el=this._element;if(el){setTimeout(function(){var textarea=$(el).find("textarea");if(textarea&&textarea.length>0)textarea[0].focus()},0);return true}return false};_p.doChange=function(e){var newValue=this.textfield.getText();if(newValue===null)newValue="";if(newValue!=this.wcOldValue){this.wcOldValue=newValue;if(this.xlinks)for(var i=0;i<this.xlinks.length;i++){var xlinks=this.xlinks[i];var xlink=JSON.parse(JSON.stringify(xlinks));if(xlink){xlink.jqobj=this._element;wcSubmitLink(xlink)}}}};
function WcBaseSelect(item){if(_wcconstructing)return;WcxHBox.call(this);this._element.addClass("ds-select wcx-base-select");var textColor=item.text_color;if(textColor)$(this.selectbox._element).css("color",textColor);var borderColor=item.bordercolor;if(borderColor)$(this.selectbox._element).css("border-color",borderColor);var backColor=item.backcolor;if(backColor)$(this.selectbox._element).css("background-color",backColor);this.wcItem=item;this.xlinks=item.xlink;this.selectbox.wcReady=false;this.selectbox._element.ready(function(){this.selectbox.addEventListener("ibx_change",
this.doChange.bind(this));this.selectbox.addEventListener("keydown",this.doKeyDown.bind(this));this.selectbox.addEventListener("keyup",this.doKeyUp.bind(this));wcAttachLinksTo(this.selectbox);this.selectbox.wcReady=true;var inputEl=$(this.selectbox._element).find("input");inputEl.removeAttr("role");if(this.maxlength&&this.maxlength>0)if(inputEl&&inputEl.length)inputEl.on("focus",function(){inputEl.attr("maxlength",this.maxlength)}.bind(this));this.doFilterValue();this.wcOldValue=this.wcFilterValue}.bind(this))}
_p=wcInherit(WcBaseSelect,WcBaseInput);_p._doFilterValue=_p.doFilterValue;_p._dispose=_p.dispose;_p.dispose=function(){this.selectbox.wcReady=false;this._dispose.call(this)};
_p.doFilterValue=function(filterValue){if($(this.selectbox._element).closest("body").length>0){this.wcFilterValue=this.selectbox.getText();var wcFilter=$(this.selectbox._element).closest(".wcx-wcfilter");var wcobj=wcFilter?wcFilter.data("wcobj"):null;if(wcobj&&wcobj.doFilterChanged)wcobj.doFilterChanged(this.wcFilterValue);else{var wcForm=$(this.selectbox._element).closest(".wcx-wcform");wcobj=wcForm.data("wcobj");if(wcobj&&wcobj.doFilterChanged)wcobj.doFilterChanged()}}};
_p.setDynamicOptions=function(selectbox,item){selectbox.dynamic_interactive=item.dynamic_interactive;selectbox.dynamic_selected=item.dynamic_selected;selectbox.dynamic_url=item.dynamic_url;selectbox.dynamic_allparams=item.dynamic_allparams};
_p.parseOptions=function(options,isCombo){var si;this.wcParsingOptions=true;for(var i=0;i<options.length;i++){var level=1;var text=options[i].text;var value=options[i].value;var id=options[i].id;var parentid=options[i].parentid;if(parentid)for(var j=i-1;j>=0;j--)if(parentid==options[j].id)level=options[j].level+1;options[i].level=level;if(options[i].separator){if(text)si=new WcxSelectSeparatorLabel(text);else si=new WcxSelectSeparator;this.selectbox.addItem(si,false)}else{var itemOptions={};itemOptions.level=
level;itemOptions.title=options[i].title;var otherText=options[i].othertext;if(otherText&&!Array.isArray(otherText)){var temp=[];temp.push(otherText);otherText=temp}itemOptions.otherText=otherText;if(itemOptions.otherText)this.hasMultiColumns=true;if(this.selectbox.placeholder){var isPlaceholder=$.trim(text)==""&&this.selectbox.placeholder!="";if(isPlaceholder){text=this.selectbox.placeholder;value=this.selectbox.placeholder}}var image=options[i].item?options[i].item[0]:null;if(image){var wcimage=
image?wcBuild(image):null;if(wcimage)itemOptions.image=wcimage}var xlink=options[i].xlink?options[i].xlink:null;if(xlink&&xlink.length>0){var link1=xlink[0];if(link1&&link1.method&&link1.method!="hideshow"){itemOptions.wcSelect=this;itemOptions.xlink=xlink;itemOptions.handler=function(evt){var select=this.wcSelect;select.doOptionClick(this.xlink)}.bind(itemOptions)}}if(this.multi)si=new WcxSelectCheckItem(text,isCombo?text:value,itemOptions);else si=new WcxSelectItem(text,isCombo?text:value,itemOptions);
if(options[i].nonselectable)si._element.ibxWidget({"disabled":true});else if(isPlaceholder){var sb=this.selectbox;si._element.addClass("wcx-placeholder");si._element.on("click",function(evt){if(evt.originalEvent)setTimeout(function(){sb.setUserValue("");sb.setText("");sb._element.find("input").focus()},0)})}}si.wcxlinks=options[i].xlink;si.wcid=id;si.wcparent=parentid;this.selectbox.addItem(si,options[i].selected)}this.wcOptionsCount=options?options.length:0;this.wcParsingOptions=false};
_p.setEnabled=function(enabled){this.selectbox.setEnabled(enabled)};_p.closePopup=function(){var wcselect=this.selectbox?this.selectbox.getInstance():null;var wcpopup=wcselect&&wcselect._popup?wcselect._popup.ibxWidget("instance"):null;if(wcpopup)wcpopup.element.ibxWidget("close")};_p.doPopupSearchKeyUp=function(e){var searchInput=e.currentTarget.firstChild;var searchText=$(searchInput).val().toLowerCase();this.doSearch(searchText)};
_p.doSearch=function(searchText){for(var i=0;i<this.selectbox._items.length;i++){var item=this.selectbox._items[i];var textFound=false;var itemText=item.find(".ibx-label-text").clone().children().remove().end().text().toLowerCase();if(itemText.indexOf(searchText)>=0)textFound=true;var otherText=item.find(".wcx-other-text").clone().children().remove().end().text().toLowerCase();if(otherText.indexOf(searchText)>=0)textFound=true;if(item.hasClass("wcx-placeholder"))textFound=true;if(item.hasClass("wcx-separator")&&
itemText=="")textFound=true;item.css("height","");item.css("min-height","");item.css("padding","");item.css("display","");if(!textFound){item.css("height","0px");item.css("min-height","0px");item.css("padding","0px");item.css("display","none")}}};_p.getWidth=function(){this.selectbox.resetWidth();return this._element.width()};_p.getText=function(){if(this.selectbox&&this.selectbox.wcReady)try{return this.selectbox.getUserValue()}catch(e){}return false};
_p.doBeforeOpenPopup=function(e){var popup=this.selectbox.getInstance()._popup;var hasMultiListPopup=popup.hasClass("wcx-multilist-popup");if(this.hasMultiColumns)if(!hasMultiListPopup)this.selectbox.resizeMultiColumns();if(!hasMultiListPopup)if(this.wcOptionsCount<5)this.searchable=false;if(this.searchable){var search=$(popup).find(".wcx-search-field");if(search&&search.length>0)for(var i=0;i<search.length;i++){var sf=search[i];var parent=$(sf).parent();var width=parent.width();$(sf).css("width",
width+"px");var qa=parent.first().attr("qa");if(!hasMultiListPopup){$(sf).css("left","0");$(sf).css("width","100%")}else if(qa=="left-list")$(sf).css("left","0");else if(qa=="right-list")$(sf).css("left","");else{$(sf).css("left","0");$(sf).css("width","100%")}}if(this.selectbox.dynamic_interactive){var items=this.selectbox._items;if(items&&items.length<=0)this.doDynamicLoad()}$(search._element).find("input").focus()}if(!this.selectbox.dynamic_interactive){if(e.originalEvent&&e.originalEvent.dat){e=
e.originalEvent.data;if(e.currentTarget.tagName==="INPUT"&&(e.type==="click"||e.keyCode!=$.ui.keyCode.DOWN))return false}if(this.selectbox.dynamic_url)this.doDynamicLoad()}if(this.wcSelect2){var s2=this.wcSelect2;if(s2.selectbox.dynamic_url)s2.doDynamicLoad()}return true};
_p.doDynamicLoad=function(){this.wcDynamicLoading=true;if(!this.selectbox.dynamic_url)return true;this.selectbox.clearItems();var xml=new WcLoader(wcapplication.wcurl);if(this.selectbox.dynamic_allparams){var el=this._element.closest("div[contentpage='y']").data("wcobj");if(el){var all={};var children=el.getChildren();for(var i=0;i<children.length;++i)all=wcGetParams(children[i],all);xml.addParam(all)}}var p=this.selectbox.dynamic_url.split("&");for(var i=0;i<p.length;i++){var t=p[i].indexOf("=");
if(t>0)xml.addParam(p[i].substr(0,t),p[i].substr(t+1))}var params=this.getParams();xml.replaceParam(params);xml.setAsync(false);xml.load(this.parseDynamicCombo.bind(this),this.selectbox._element);if(!this.selectbox.dynamic_interactive&&!this.selectbox.dynamic_allparams)delete this.selectbox.dynamic_url};
_p.parseDynamicCombo=function(rsp,jqobj){if(wcPreProcess(rsp,false)!=true)return;if(!rsp.data.item)return;var item=null;for(var i=0;i<rsp.data.item.length;i++)if(rsp.data.item[i].type=="wcform"){var wcform=rsp.data.item[i];if(wcform.row)for(var j=0;j<wcform.row.length;j++)for(var k=0;k<wcform.row[j].item.length;k++)if(wcform.row[j].item[k].type=="wcselect"){item=wcform.row[j].item[k];break}}if(item!=null){var wcxselect=jqobj.data("wcobj");var options=item.option;if(options)this.parseOptions(options,
true)}wcPostProcess(rsp);this.wcDynamicLoading=false};_p.doKeyDown=function(e){if(e.keyCode>=27&&e.keyCode<=46)e.stopPropagation();if(e.keyCode==27)e.preventDefault()};
_p.doKeyUp=function(e){if(e.keyCode==13){if(this.selectbox.dynamic_interactive==0)this.doChange(e,true)}else{this.doFilterValue();var textVal=this.wcFilterValue;if(textVal===null)newValue="";if(this.validateInput(this.inputtype,textVal))if(this.selectbox.dynamic_interactive==1){if(this.key_timeout)clearTimeout(this.key_timeout);this.key_timeout=setTimeout(function(){this.wcOldValue=textVal;this.doDynamicLoad()}.bind(this),3E3)}else{if(this.searchable){var searchInput=$(e.currentTarget).find("input");
var searchText=searchInput.val().toLowerCase();this.doSearch(searchText)}}else{this.selectbox.setText(this.wcOldText);var dlg=new WcMessageDialog(this.invalidmsg,"warning");dlg.onClose(function(){textInput.focus()},dlg)}}};
_p.doChange=function(e,forceSubmit){var valueChanged=false;this.doFilterValue();var newValue=this.wcFilterValue;if(newValue===null)newValue="";if(newValue!=this.wcOldValue)valueChanged=true;if(valueChanged||forceSubmit===true)if(this.validateInput(this.inputtype,newValue)){this.wcOldValue=newValue;if(this.selectbox.dynamic_interactive>=1&&!this.wcDynamicLoading&&!this.wcOptionClicked)this.doDynamicLoad();this.wcOptionClicked=false;if(this.xlinks&&!this.multi)for(var i=0;i<this.xlinks.length;i++){var xlinks=
this.xlinks[i];var xlink=JSON.parse(JSON.stringify(xlinks));if(xlink&&!this.wcParsingOptions){xlink.jqobj=this._element;wcSubmitLink(xlink)}}}};_p.doOptionClick=function(links){if(links)if(this.wcItem.type=="wccombobox"){var grid=$(this.selectbox._element).closest(".wcx-grid");if(grid&&grid.length>0)for(var i=0;i<links.length;i++){var xlinks=links[i];try{var xlink=xlinks.jqobj?xlinks:JSON.parse(JSON.stringify(xlinks));if(xlink){xlink.jqobj=this._element;wcExecLink(xlink);this.wcOptionClicked=true}}catch(err){}}}};
function WcSelect(item){if(_wcconstructing)return;var searchable=item.searchable;this.searchable=searchable;this.editable=false;this.readonly=!searchable;var size=null;if(item.width)size=item.width;else if(item._isjustified)size=-1;this.selectbox=new WcxSelect(this.readonly,size);WcBaseSelect.call(this,item);this._element.addClass("wcx-form-item wcx-focusable wcx-select");if(item.class)this._element.addClass(item.class);this.setWcId(item.id);var itemName=item.name;this.setName(itemName);this.multi=
item.multiple;this.selectbox.setMultiSelect(this.multi);if(item.display=="nopulldown"){this.selectbox.removeButton(true);this._element.addClass("nopulldown")}this.hasMultiColumns=false;if(item.placeholder){this.selectbox.placeholder=item.placeholder;this.selectbox._element.ibxWidget("option","placeholder",item.placeholder)}setQaAttrToElement(this.selectbox._element,itemName+"1");setQaAttrToElement(this.selectbox._element.ibxWidget("children",":first"),itemName+"2");var selectbox=this.selectbox;var popup=
selectbox.getInstance()._popup;if(popup.first())popup.first().ready(function(){if(searchable){var lists=popup.find(".ibx-select-item-list");for(var i=0;i<lists.length;i++){var selectList=lists[i];var sf=$('<div class="wcx-search-field"><input style="flex:1;margin-top:4px;" placeholder=" '+ibx.resourceMgr.getString("search")+' "/></div>');if(sf){sf.on("keyup",this.doPopupSearchKeyUp.bind(this));$(selectList).prepend(sf)}$(selectList).on("focus",function(evt){var relatedTarget=evt.relatedTarget;if(relatedTarget&&
$(relatedTarget).is("input"))relatedTarget.focus()})}}}.bind(this));this.setDynamicOptions(this.selectbox,item);this.selectbox.addBeforeOpenPopupEventListener(this.doBeforeOpenPopup,this);var options=item.option;if(options)this.parseOptions(options);this.selectbox.addClosePopupEventListener(function(){this.doFilterValue();if(!item.xlink)return;for(var i=0;i<item.xlink.length;i++){var xlink=item.xlink[i];xlink.jqobj=this._element;wcSubmitLink(xlink)}},this);this.addItems(this.selectbox,item);if(item._issimpleform){item._textInput=
this.selectbox.getInstance()._textInput[0];this.setAriaLabel(item)}else if(item.title){var aria={accessible:true,label:item.title};this.selectbox._element.ibxWidget("option","aria",aria)}}_p=wcInherit(WcSelect,WcBaseSelect);_p.getParams=function(){var p=new Object;var val=this.selectbox.getUserValue();if(!val)val="";if(this.multi)p[this.getName()]=val;else p[this.getName()]=[val];return p};
function WcComboBox(item){if(_wcconstructing)return;this.maxlength=item.maxlength;this.searchable=item.searchable;this.editable=true;this.readonly=false;var size=item.size;if(size>0)size=Math.min(400,Math.max(50,size*8));if(!size)size=null;if(item._isjustified)size=-1;this.selectbox=new WcxSelect(false,size);if(item.size)this.selectbox._element.ibxWidget("option","autosize",false);WcBaseSelect.call(this,item);this._element.addClass("wcx-form-item wcx-focusable wcx-combo");this.setWcId(item.id);var itemName=
item.name;this.setName(itemName);this.selectbox.setUserValue(item.value);this.selectbox.setText(item.value);this.validText=item.value;this.inputtype=item.inputtype;this.invalidmsg=item.invalidmsg;if(item.value==""){var sb=this.selectbox;setTimeout(function(){sb.setText("")},0)}setQaAttrToElement(this.selectbox._element,itemName+"1");setQaAttrToElement(this.selectbox._element.ibxWidget("children",":first"),itemName+"2");this.key_timeout=null;this.setDynamicOptions(this.selectbox,item);this.selectbox.addBeforeOpenPopupEventListener(this.doBeforeOpenPopup,
this);if(item.placeholder){this.selectbox.placeholder=item.placeholder;this.selectbox._element.ibxWidget("option","placeholder",item.placeholder)}var options=item.option;if(options)this.parseOptions(options);this.addItems(this.selectbox,item);if(item._issimpleform){item._textInput=this.selectbox.getInstance()._textInput[0];this.setAriaLabel(item)}else if(item.title){var aria={accessible:true,label:item.title};this.selectbox._element.ibxWidget("option","aria",aria)}}_p=wcInherit(WcComboBox,WcBaseSelect);
_p.getParams=function(){var p=new Object;p[this.getName()]=[this.selectbox.getText()];return p};_p.validateInput=WcInputTextProto.validateInput;
function WcCalendar(item){if(_wcconstructing)return;WcxVBox.call(this);this._element.addClass("wcx-calendar");var useNewDP=false;if(useNewDP)this._element.addClass("ds-calendar");this.dispfmt=item.dispfmt;var dt=new Date;if(item.year!=0&&item.month!=0&&item.mday!=0)dt.setFullYear(item.year,item.month-1,item.mday);if(item.hour>=0)dt.setHours(item.hour);if(item.minute>=0)dt.setMinutes(item.minute);var datefmt="yy/mm/dd";if(item.description){var desc=new WcxLabel(item.description.text);desc._element.addClass("wcx-calendar-description");
desc._element.css({"padding-bottom":"8px"});this.add(desc)}this.datepicker=new WcxComponent("WcDatepicker");this.datepicker._element.addClass("wcx-datepicker");if(useNewDP)this._element.addClass("ds-datepicker");this.datepicker._element.attr("tabindex","0");this.add(this.datepicker);if(useNewDP)this.datepicker._element.append("<div class='ds-datepicker-input'><input type='text' /></div>");this.calendar=new WcxCalendar(dt,datefmt);this.calendar._element.addClass("wcx-calendar-select");this.datepicker.add(this.calendar);
if(this.dispfmt!="DATE_ONLY"){var obj=WcHourSelect(dt,this);this._element.append(obj)}if(this.dispfmt=="TIME_ONLY")$(this._element.children()[0]).hide();this.setName(item.name);var xlinksxml=item.xlink;if(xlinksxml&&xlinksxml.length>0)this.addEventListener("ibx_change",function(){this.doFilterValue();for(var i=0;i<xlinksxml.length;i++){var xlinkxml=xlinksxml[i];var xlink=JSON.parse(JSON.stringify(xlinkxml));if(xlink){xlink.jqobj=this._element;wcSubmitLink(xlink)}}},this);this._element.ready(function(){var glyphIcon=
$(this._element).find(".ibx-datepicker-input>.ibx-label-glyph.ibx-label-icon");if(glyphIcon&&glyphIcon.length){glyphIcon.text("");glyphIcon.addClass("ds-icon-calendar")}var dateStr=$(this.calendar._element).find(".ibx-label-text").text();var dpInput=$(this._element).find(".ds-datepicker-input>input");if(dpInput&&dpInput.length){dpInput.val(dateStr);dpInput.on("keydown",function(evt){evt.stopPropagation()})}this.doFilterValue()}.bind(this))}_p=wcInherit(WcCalendar,WcxVBox);
_p.getParams=function(){var name=this.getName();var value=this.calendar.getUserValue();if(!name)return null;if(!value)value="";if(this.dispfmt=="TIME_ONLY")value="0000/00/00";value+=" ";if(this.dispfmt!="DATE_ONLY")value+=this.hinp.getUserValue()+":"+this.minp.getUserValue()+":00";var p=new Object;p[name]=[value];return p};
_p.doFilterValue=function(filterValue){this.wcFilterValue=this.calendar.getUserValue();var wcForm=$(this._element).closest(".wcx-wcform");var wcobj=wcForm.data("wcobj");if(wcobj&&wcobj.doFilterChanged)wcobj.doFilterChanged()};
function WcDateRange(item){if(_wcconstructing)return;WcxVBox.call(this);this._element.addClass("wcx-date-range");this.dispfmt=item.dispfmt;this.wcNameRange=item.range.name;var dtFrom=new Date;if(item.year!=0&&item.month!=0&&item.mday!=0)dtFrom.setFullYear(item.year,item.month-1,item.mday);if(item.hour>=0)dtFrom.setHours(item.hour);if(item.minute>=0)dtFrom.setMinutes(item.minute);var dtTo=new Date;if(item.range.year!=0&&item.range.month!=0&&item.range.mday!=0)dtTo.setFullYear(item.range.year,item.range.month-
1,item.range.mday);if(item.range.hour>=0)dtTo.setHours(item.range.hour);if(item.range.minute>=0)dtTo.setMinutes(item.range.minute);var datefmt="yy/mm/dd";this.wcTimeFrom={};this.wcTimeTo={};this.datepicker=new WcxComponent("WcDatepicker");this.datepicker._element.addClass("wcx-datepicker");this.datepicker._element.attr("tabindex","0");this.add(this.datepicker);this.calendar=new WcxDateRange(dtFrom,dtTo,datefmt);this.calendar._element.addClass("wcx-calendar-select");this.datepicker.add(this.calendar);
$(this.calendar._element).css("width","222px");$(this.calendar._element).on("resize",function(e){var parentWidth=$(this).parent().width();if(parentWidth&&parentWidth<222){$(this).css("width","");$(this).attr("title","")}else{$(this).css("width","222px");$(this).attr("title","")}});if(this.dispfmt!="DATE_ONLY"){var timeRange=$("<div class='wcx-time-range' style='display:flex'>"+"</div>");var timeFrom=WcHourSelect(dtFrom,this.wcTimeFrom);timeFrom.css("padding-right","23px");timeRange.append(timeFrom);
var timeTo=WcHourSelect(dtTo,this.wcTimeTo);timeRange.append(timeTo);this._element.append(timeRange)}if(this.dispfmt=="TIME_ONLY")$(this._element.children()[0]).hide();this.setName(item.name);var xlinksxml=item.xlink;if(xlinksxml&&xlinksxml.length>0){var popup=this.getInstance()._popup;if(popup)popup.on("ibx_close",function(){this.doFilterValue();for(var i=0;i<xlinksxml.length;i++){var xlinkxml=xlinksxml[i];var xlink=JSON.parse(JSON.stringify(xlinkxml));if(xlink){xlink.jqobj=this._element;wcSubmitLink(xlink)}}}.bind(this))}this._element.ready(function(){var glyphIcon=
$(this._element).find(".ibx-datepicker-input>.ibx-label-glyph.ibx-label-icon");if(glyphIcon&&glyphIcon.length){glyphIcon.text("");glyphIcon.addClass("ds-icon-calendar")}this.doFilterValue()}.bind(this))}_p=wcInherit(WcDateRange,WcxVBox);
_p.getParams=function(){var p=new Object;var name=this.getName();if(!name)return;var fromValue=this.calendar.getDateFrom();if(!fromValue)fromValue="";if(this.dispfmt=="TIME_ONLY")fromValue="0000/00/00";fromValue+=" ";if(this.dispfmt!="DATE_ONLY")fromValue+=this.wcTimeFrom.hinp.getUserValue()+":"+this.wcTimeFrom.minp.getUserValue()+":00";p[name]=[fromValue];var nameRange=this.wcNameRange;if(nameRange){var toValue=this.calendar.getDateTo();if(!toValue)toValue="";if(this.dispfmt=="TIME_ONLY")toValue=
"0000/00/00";toValue+=" ";if(this.dispfmt!="DATE_ONLY")toValue+=this.wcTimeTo.hinp.getUserValue()+":"+this.wcTimeTo.minp.getUserValue()+":00";p[nameRange]=[toValue]}return p};
_p.doFilterValue=function(filterValue){var fromValue=this.calendar.getDateFrom();var toValue=this.calendar.getDateTo();this.wcFilterValue=fromValue+" - "+toValue;var wcFilter=$(this._element).closest(".wcx-wcfilter");var wcobj=wcFilter?wcFilter.data("wcobj"):null;if(wcobj&&wcobj.doFilterChanged)wcobj.doFilterChanged(this.wcFilterValue);else{var wcForm=$(this._element).closest(".wcx-wcform");var wcobj=wcForm.data("wcobj");if(wcobj&&wcobj.doFilterChanged)wcobj.doFilterChanged()}};
function WcHourSelect(dt,thisObj){var doTimeKeyDown=function(evt){var kc=evt.keyCode;if(kc<=57)return;if(kc>=96&&kc<=105)return;if(kc==144)return;evt.preventDefault();evt.stopPropagation()};var timeSelect=$("<div class='wcx-time-select' style='flex: 1 1 auto'>"+"</div>");var hinp=new WcxSelect;hinp._element.addClass("wcx-calendar-hh");var hitems=[];for(var i=0;i<=23;i++){var s="0"+i;hitems.push(s.substr(s.length-2))}var si;for(var i=0;i<hitems.length;i++){si=new WcxSelectItem(hitems[i],hitems[i]);
hinp.addItem(si,parseInt(dt.getHours())==parseInt(hitems[i]))}var hinput=hinp.getInstance()._textInput;hinput.on("keydown",doTimeKeyDown);var minp=new WcxSelect;minp._element.addClass("wcx-calendar-mm");var mitems=[];for(var i=0;i<=59;i++){var s="0"+i;mitems.push(s.substr(s.length-2))}for(var i=0;i<mitems.length;i++){si=new WcxSelectItem(mitems[i],mitems[i]);minp.addItem(si,parseInt(dt.getMinutes())==parseInt(mitems[i]))}var minput=minp.getInstance()._textInput;minput.on("keydown",doTimeKeyDown);
if(thisObj){thisObj.hinp=hinp;thisObj.minp=minp}timeSelect.append(hinp._element).append(minp._element);return timeSelect}
function WcMonthWeekDays(item,isweek){if(_wcconstructing)return;var sdates=new Array;var options=item.option;if(options)for(var i=0;i<options.length;++i)if(options[i].selected)sdates.push(options[i].value);var dates;if(isweek)dates=[ibx.resourceMgr.getString("sun"),ibx.resourceMgr.getString("mon"),ibx.resourceMgr.getString("tue"),ibx.resourceMgr.getString("wed"),ibx.resourceMgr.getString("thu"),ibx.resourceMgr.getString("fri"),ibx.resourceMgr.getString("sat")];else{dates=["1","2","3","4","5","6",
"7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31"];dates.push(ibx.resourceMgr.getString("lastdaym"))}WcxDaysGrid.call(this,7);this.setName(item.name);this._element.addClass("wcx-monthweek-days");this.wcitems=[];this.isweek=isweek;var col=1;var row=1;for(var i=0;i<dates.length;i++){var l=new WcxLabel(dates[i]);l.setJustify("center");if(isweek){l._element.addClass("wcx-wdate-label");l.wcValue=i;if(sdates.indexOf(i.toString())>=
0){l._element.addClass("wcx-date-label-selected");l.wcSelected=true}}else if(i==31){l._element.addClass("wcx-ldate-label");l.wcValue=0;if(sdates.indexOf("0")>=0){l._element.addClass("wcx-date-label-selected");l.wcSelected=true}}else{l._element.addClass("wcx-date-label");l.wcValue=dates[i];if(sdates.indexOf(dates[i])>=0){l._element.addClass("wcx-date-label-selected");l.wcSelected=true}}l.addEventListenerToLabel("click",function(qe){if(!this.wcSelected){this._element.addClass("wcx-date-label-selected");
this.wcSelected=true}else{this._element.removeClass("wcx-date-label-selected");this.wcSelected=false}},l);l._element[0].style["-ms-grid-column"]=col;l._element[0].style["-ms-grid-row"]=row;this.add(l);this.wcitems.push(l);if(++col>7){col=1;++row}}}_p=wcInherit(WcMonthWeekDays,WcxDaysGrid);
_p.getParams=function(){var name=this.getName();if(!name)return null;var value=[];var d=0;if(!this.isweek){d=1;if(this.wcitems[31].wcSelected)value.push(0)}for(var i=0;i<this.wcitems.length-d;i++)if(this.wcitems[i].wcSelected)value.push(i+d);var p=new Object;p[name]=value;return p};
function WcTextOnly(item){if(_wcconstructing)return;WcxLabel.call(this,item.text,(item.text_flags&wcconstants.WCF_TEXT_HTML)!=0);this._element.addClass("wcx-form-item");if(item.class)this._element.addClass(item.class);this.text=item.text;if(item.text_flags&wcconstants.WCF_TEXT_WRAP)this.textwrapped=true;this.setItemText(this,item);this._element.addClass("wcx-label-text");this._element.attr("aria-label",item.text);if(item.title)this.setTitle(item.title);if(item.multiline){this._element.css("white-space",
"pre-wrap");this._element.ibxWidget({"textWrap":true})}else if(this.text.indexOf("\n")!=-1){this._element.css("white-space","pre");this._element.ibxWidget({"textWrap":true})}else this._element.addClass("wcx-label-text-normal");var align=item.align;if(align)if(align=="center")this.setJustify("center");else if(align=="left")this.setJustify("start");else if(align=="right")this.setJustify("end");var xlink=item.getXlinks?item.getXlinks():item.xlink;if(xlink)$(this._element).addClass("wcxlink");wcAttachLinksTo(this,
xlink);var label=this;this._element.ready(function(){var form=$(label._element).closest(".wcx-wcform");if(form&&form.length>0)label.addEventListener("contextmenu",function(evt){var text=" ";if(window.getSelection)text=window.getSelection().toString();else if(document.getSelection)text=document.getSelection().toString();else if(document.selection&&document.selection.type!="Control")text=document.selection.createRange().text;if(text.length>0)evt.stopPropagation()});if($(label._element).hasClass("wcxlink")){var multiitem=
$(label._element).closest(".wcx-multiitem");if(multiitem&&multiitem.length){var wcobj=multiitem.data("wcobj");if(wcobj)if(!wcobj.wcDefaultElement)wcobj.wcDefaultElement=label._element}}})}_p=wcInherit(WcTextOnly,WcxLabel);_p.setItemText=WcBaseTextProto.setItemText;
function WcImage(item){if(_wcconstructing)return;var txt=item.text;WcxLabel.call(this,txt,false,item.src);this.setItemText(this,item);if(txt&&txt.indexOf("\n")!=-1){this._element.css("white-space","pre");this._element.css("align-items","flex-start");this.setWrap(true)}this.setWcId(item.id);this.setIconColor(item.color);var size=item.size;if(size>0)this.setIconSize(size);this.setTitle(item.title);this._element.addClass("wcx-image");var xlinks=item.xlink;wcAttachLinksTo(this,xlinks);if(xlinks){this._element.attr("tabindex",
"0");this._element.addClass("wcxlink")}if(item.description)this._wcdescription=item.description.text}_p=wcInherit(WcImage,WcxLabel);_p.setItemText=WcBaseTextProto.setItemText;function WcHelpLink(item){if(_wcconstructing)return;WcxButtonSimple.call(this,null,wcapplication.imgstr.documentation_library);wcAttachLinksTo(this,[item.xlink])}_p=wcInherit(WcHelpLink,WcxButtonSimple);function WcHidden(item){if(_wcconstructing)return;WcxHBox.call(this);this.setName(item.name);this.setUserData(item.value)}
_p=wcInherit(WcHidden,WcxHBox);_p.getParams=function(){var p=new Object;p[this.getName()]=[this.getUserData()];return p};
function WcEmailAddr(item){if(_wcconstructing)return;WcxHBox.call(this);this.setName(item.name);var cc=item.cc;var bcc=item.bcc;this.hascc=cc?true:false;this.hasbcc=bcc?true:false;this.xlinks=item.xlink;var size=item.size;var width=size>0?size:32;width=width*8;if(width>400)width=400;this._element.addClass("wcx-focusable");var container;if(item._isjustified){this._element.addClass("wcx-form-item");container=new WcxVBox}else{container=new WcxGrid;container.setColumnCount(2);container.add(new WcxLabel(ibx.resourceMgr.getString("strto")))}container._element.addClass("wcx-emailaddr");
this.totext=new WcxSelect(false,width);this.totext._element.addClass("ds-select");this.totext.setName(item.to);this.totext.setText(item.toval);this.totext._email=this;this.totext.addBeforeOpenPopupEventListener(this.doBeforeOpenPopup,this.totext);this.wcOldTo=item.toval;this.totext._element.ready(function(){this.totext.addEventListener("ibx_change",this.doChange.bind(this));this.totext.addEventListener("keyup",this.doKeyUp.bind(this))}.bind(this));container.add(this.totext);if(this.hascc){container.add(new WcxLabel(ibx.resourceMgr.getString("strcc")));
this.cctext=new WcxSelect(false,width);this.cctext._element.addClass("ds-select");this.cctext.setName(item.cc);this.cctext.setText(item.ccval);this.cctext._email=this;this.cctext.addBeforeOpenPopupEventListener(this.doBeforeOpenPopup,this.cctext);this.wcOldCc=item.ccval;this.cctext._element.ready(function(){this.cctext.addEventListener("ibx_change",this.doChange.bind(this));this.cctext.addEventListener("keyup",this.doKeyUp.bind(this))}.bind(this));container.add(this.cctext)}if(this.hasbcc){container.add(new WcxLabel(ibx.resourceMgr.getString("strbcc")));
this.bcctext=new WcxSelect(false,width);this.bcctext._element.addClass("ds-select");this.bcctext.setName(item.bcc);this.bcctext.setText(item.bccval);this.bcctext._email=this;this.bcctext.addBeforeOpenPopupEventListener(this.doBeforeOpenPopup,this.bcctext);this.wcOldBcc=item.bccval;this.bcctext._element.ready(function(){this.bcctext.addEventListener("ibx_change",this.doChange.bind(this));this.bcctext.addEventListener("keyup",this.doKeyUp.bind(this))}.bind(this));container.add(this.bcctext)}var emailStr=
new WcxLabel(ibx.resourceMgr.getString("stremail"));if(!item._isjustified)emailStr._element.css("grid-column","1 / span 2");container.add(emailStr);this.add(container)}_p=wcInherit(WcEmailAddr,WcxHBox);_p.getParams=function(){var p=new Object;p[this.totext.getName()]=this.totext.getText();if(this.hascc)p[this.cctext.getName()]=this.cctext.getText();if(this.hasbcc)p[this.bcctext.getName()]=this.bcctext.getText();return p};
_p.doBeforeOpenPopup=function(){this.clearItems();var text=this.getText();if(text){var list=text.split(";");for(var i=0;i<list.length;i++){var itemOptions={};itemOptions.itemType="remove";itemOptions.handler=this._email.doPopupItemRemove;var item=new WcxSelectItem(list[i],list[i],itemOptions);item._select=this;this.addItem(item)}}};
_p.doPopupItemRemove=function(evt){evt.stopPropagation();var select=this._select;select.removeItem(this._element);var textArray=[];for(var i=0;i<select._items.length;i++){var item=select._items[i];var text=item.data("text");textArray.push(text)}var newText=textArray.join(";");select.setText(newText)};_p.doKeyUp=function(e){if(e.keyCode==13)this.doChange(e)};
_p.doChange=function(e){var oldTo=this.wcOldTo;var newTo=this.totext.getText();var oldCc=this.hascc?this.wcOldCc:"";var newCc=this.hascc?this.cctext.getText():"";var oldBcc=this.hasbcc?this.wcOldBcc:"";var newBcc=this.hasbcc?this.bcctext.getText():"";if(oldTo!=newTo||oldCc!=newCc||oldBcc!=newBcc){this.wcOldTo=newTo;if(this.hascc)this.wcOldCc=newCc;if(this.hasbcc)this.wcOldBcc=newBcc;if(this.xlinks)for(var i=0;i<this.xlinks.length;i++){var xlinks=this.xlinks[i];var xlink=JSON.parse(JSON.stringify(xlinks));
if(xlink){xlink.jqobj=this._element;wcSubmitLink(xlink)}}}};function WcList(item){if(_wcconstructing)return;WcxComponent.call(this,"WcList");var texts=item.text;if(texts){var otype=item.otype;var obj=$("<"+otype+"></"+otype+">");var ts=texts;for(var i=0;i<ts.length;i++){var l=new WcxLabel(ts[i]);l._element.addClass("wcx-label-text");l.setWrap(item.wrap);obj.append($("<li></li>").append(l._element))}this._element.append(obj)}}_p=wcInherit(WcList,WcxComponent);
function WcUpload(item,options){if(_wcconstructing)return;WcxComponent.call(this,"WcUpload");this._element.addClass("wcx-upload");this.item=item;var xlinks=item.xlink;if(!xlinks||xlinks.length==0)return;this.wcXLink=xlinks[0];this.wcXLink.jqobj=this._element;this.wcName=item.name;var acceptArray=item.accept.toLowerCase().split(",");for(var i=0;i<acceptArray.length;i++)acceptArray[i]="."+acceptArray[i];this.wcAccept=acceptArray.join(",");if(options=="popup"||item.trigger){this.filebrowser=$("<input type='file'/>").addClass("wcx-upload-filebrowser").on("change",
function(e){var file=this.filebrowser.prop("files")[0];var wcprogresswin=new WcxPopup;wcprogresswin._element.addClass("wcx-progressbox-window");wcprogresswin.setResizable(false);if(this.isAccepted(file)){var dfn=file.name;if(dfn.length>40)dfn=dfn.substring(0,40)+"...";wcprogresswin._element.append($("<p/>").addClass("wcx-upload-name-and-error").append(dfn));var progressbox=new WcxVBox;wcprogresswin.add(progressbox);wcprogresswin.open();var jqXHR=this.ajaxUpload(file,progressbox);jqXHR.always(function(p1,
textStatus,p3){wcprogresswin.close();if(this.wcabort)return;if(p1&&textStatus!="success")if(p1.responseText&&p1.responseText!="")new WcMessageDialog(p1.responseText,"error");else if(p1.statusText&&p1.statusText!="")new WcMessageDialog(p1.statusText,"error");else if(p1.status!=0)new WcMessageDialog(p1.status,"error");else new WcMessageDialog("unknown server error","error")}.bind(this))}else{wcprogresswin._element.append($("<p/>").addClass("wcx-upload-name-and-error").append(ibx.resourceMgr.getString("invalidmsg")));
var btn=new WcxButton(ibx.resourceMgr.getString("close"));btn.addEventListener("click",function(){wcprogresswin.close()}.bind(this));wcprogresswin.add(btn);wcprogresswin.open()}}.bind(this));this.filebrowser.prop("accept",this.wcAccept);return}this.selectButton=new WcxButtonBrowse(ibx.resourceMgr.getString("select"));this.selectButton.addChangeEventListener(function(){var file=this.selectButton.getFile();this.uploadsubmit(file)},this);if(this.wcAccept)this.selectButton.setAccept(this.wcAccept);this.divMsgBoard=
$("<div/>");this.divMsgBoard.setMessage=function(message1,bold,message2){this.html("");var m1=$("<p/>").text(message1);if(bold)m1.addClass("wcx-upload-name-and-error");this.append(m1);if(!message2)message2="&nbsp;";this.append($("<p/>").text(message2))};this.divMsgBoard.initMessage=function(){this.setMessage(ibx.resourceMgr.getString("drag"),false,ibx.resourceMgr.getString("or"))};this.divBartop=$("<div/>").append(this.divMsgBoard);if(item.text){this.divMsgBoard.setMessage(item.text);this._element.css("width",
"20%");this._element.css("height","10%")}else{this.divMsgBoard.initMessage();this.divBartop.append($("<div/>").append(this.selectButton._element))}this._element.append(this.divBartop);this._element.on("dragover",function(e){e.preventDefault();this._element.addClass("wcx-drag-over")}.bind(this)).on("dragenter",function(e){e.preventDefault();this._element.addClass("wcx-drag-over")}.bind(this)).on("dragleave",function(e){e.preventDefault();this._element.removeClass("wcx-drag-over")}.bind(this)).on("drop",
function(e){e.preventDefault();this._element.removeClass("wcx-drag-over");this.uploadsubmit(e.originalEvent.dataTransfer.files[0])}.bind(this))}_p=wcInherit(WcUpload,WcxComponent);_p.takeFocus=function(){var el=this.selectButton?this.selectButton._element:null;if(el){setTimeout(function(){el.focus()},0);return true}return false};
_p.show=function(container){$(".wcx-upload-filebrowser").detach();if(container){this._element.detach();this._element.hide();container.append(this._element)}$("body").append(this.filebrowser);this.filebrowser.click()};_p.isAccepted=function(file){var accepted=false;if(this.wcAccept){var acceptArray=this.wcAccept.split(",");var fnParts=file.name.split(".");var ext=fnParts[fnParts.length-1].toLowerCase();for(var i=0;i<acceptArray.length;i++)if(ext===acceptArray[i].substring(1)){accepted=true;break}}return accepted};
_p.uploadsubmit=function(file){if(typeof file!=="undefined"&&file.size>0)if(this.isAccepted(file)){this.selectButton._element.hide();var dfn=file.name;if(dfn.length>40)dfn=dfn.substring(0,40)+"...";this.divMsgBoard.setMessage(dfn,true,ibx.resourceMgr.getString("preparing"));var progressbox=new WcxVBox;this.divBartop.append(progressbox._element);var jqXHR=this.ajaxUpload(file,progressbox);jqXHR.then(function(){this.divMsgBoard.setMessage(dfn,true,ibx.resourceMgr.getString("prepared"))}.bind(this),
function(jqXHR,textStatus,text){progressbox._element.remove();this.divMsgBoard.initMessage();this.selectButton._element.show();if(this.wcabort)return;if(textStatus=="error")if(jqXHR.responseText&&jqXHR.responseText!="")new WcMessageDialog(jqXHR.responseText,"error");else if(text&&text!="")new WcMessageDialog(text,"error");else if(jqXHR.status!=0)new WcMessageDialog(jqXHR.status,"error");else new WcMessageDialog("unknown server error","error")}.bind(this))}else this.divMsgBoard.setMessage(ibx.resourceMgr.getString("invalidmsg"),
true)};
_p.ajaxUpload=function(file,progressbox){progressbox._element.addClass("wcx-progressbox");var formdata=new FormData;formdata.append("bindowspreload",file.name);formdata.append("IBIS_page","BLANK");formdata.append("CGIX_cmd","BindowsPreload");if(wcapplication.csrftokenvalue!=""&&wcapplication.csrftokenname!="")formdata.append(wcapplication.csrftokenname,wcapplication.csrftokenvalue);formdata.append("CHARSET","UTF-8");formdata.append(file.name,file);return $.ajax({method:"POST",url:wcapplication.wcurl,data:formdata,
cache:false,contentType:false,processData:false,xhr:function(){var xhr=new window.XMLHttpRequest;var progressbar=new WcxProgressBar;this.btnCancel=new WcxButton(ibx.resourceMgr.getString("cancelupl"));this.btnCancel.addEventListener("click",function(){this.wcabort=true;xhr.abort()}.bind(this));progressbox.add(progressbar);progressbox.add(this.btnCancel);xhr.upload.addEventListener("progress",function(e){progressbar.setCurVal(Math.round(e.loaded/e.total*100))}.bind(this));return xhr}.bind(this)}).then(function(data,
textStatus,jqXHR){this.btnCancel._element.hide();if(!this.wcXLink.parameters)this.wcXLink.parameters=[];this.wcXLink.parameters.push({name:"bindowsupload",value:this.wcName});wcSubmitLink(this.wcXLink)}.bind(this))};
function WcPopupSelect(wcitem){if(_wcconstructing)return;WcxComponent.call(this);if(wcitem.multiple){menu=new WcxMenu;menu.setMultiSelect(true);menu.paramname=wcitem.name;var xlinks=wcitem.xlink;if(xlinks&&xlinks.length>0)menu.xlink=xlinks[0];var ct=wcitem.control_text;if(ct!=""){menu.control=new WcxCheckMenuItem(ct);menu.control._element.addClass("wcx-checkmenuitem-control");menu.addItem(menu.control);menu.control._element.on("click",function(){var children=this.getAllItems();var checkded=this.control.getChecked();
for(var i=1;i<children.length;++i)$(children[i]).data("wcobj").setChecked(checkded)}.bind(menu))}var allchecked=true;var options=wcitem.option;var si;for(var i=0;i<options.length;++i){si=new WcxCheckMenuItem(options[i].text,options[i].value);var checked=options[i].selected;si.setChecked(checked);if(!checked)allchecked=false;menu.addItem(si);if(menu.control)si._element.on("click",function(){var children=this.getAllItems();var allchecked=true;for(var i=1;i<children.length;++i)if($(children[i]).data("wcobj").getChecked()==
false){allchecked=false;break}$(children[0]).data("wcobj").setChecked(allchecked)}.bind(menu))}if(menu.control)menu.control.setChecked(allchecked);menu.addCloseEventListener(function(){var children=this.getAllItems();var p=[];for(var i=this.control?1:0;i<children.length;++i){var op=$(children[i]).data("wcobj");if(op.getChecked())p.push(op.getUserValue())}if(!this.xlink.parameters)this.xlink.parameters=[];for(var i=0;i<p.length;++i)this.xlink.parameters.push({name:this.paramname,value:p[i]});wcSubmitLink(this.xlink)});
this.wcxmenu=menu}else{this.wcxpopup=new WcxPopup;this.wcxpopup.setAutoClose(true);var list=new WcxSelectItemList;this.wcxpopup.add(list);var options=wcitem.option;if(options){var si;for(var i=0;i<options.length;++i){var itemOptions={};itemOptions.title=options[i].title;si=new WcxSelectItem(options[i].text,options[i].value,itemOptions);list.addItem(si,options[i].selected);wcAttachLinksTo(si,options[i].xlink);si.addEventListener("click",function(){this.close()},this.wcxpopup)}this.wcxpopup._element.height(Math.min(30,
options.length)*12)}}}_p=wcInherit(WcPopupSelect,WcxComponent);_p.show=function(location,xlink){if(this.wcxmenu){this.wcxmenu.xlink.jqobj=xlink.jqobj;this.wcxmenu.open(location);return}if(this.wcxpopup){this.wcxpopup.open(location);return}};
function WcCollapsibleText(item){if(_wcconstructing)return;WcxHBox.call(this);this._element.addClass("wcx-form-item");var text=item.text;var grid=new WcxGrid;grid.setColumnCount(1);grid.setJustifyContent("start");var more;var less;if(item.multiline){more=new WcxGrid;more.setColumnCount(1);more.setJustifyContent("start");grid.add(more);if(item.initial_size>0&&item.initial_size<text.length){var initial_size=0;var istr=text;for(var i=0;i<item.initial_size;i++){var s=istr.search("\n")+1;initial_size+=
s;istr=istr.substr(s)}less=new WcxGrid;less.setColumnCount(1);less.setJustifyContent("start");grid.add(less);more._element.hide()}var tarry=text.split("\n");for(var i=0;i<tarry.length;i++){var ml=new WcxLabel(tarry[i]);this.setFlag(ml,item.text_flags,item.text_color);more.add(ml);if(item.initial_size&&i<item.initial_size){var ll=new WcxLabel(tarry[i]);this.setFlag(ll,item.text_flags,item.text_color);less.add(ll)}}}else{more=new WcxLabel(text);this.setFlag(more,item.text_flags,item.text_color);more.setWrap(true);
grid.add(more);if(item.initial_size>0&&item.initial_size<text.length){less=new WcxLabel(text.substr(0,item.initial_size));grid.add(less);more._element.hide()}}if(item.initial_size>0&&item.initial_size<text.length){var showmore,showless;grid.add(showmore=new WcxLabel(ibx.resourceMgr.getString("seemore")));grid.add(showless=new WcxLabel(ibx.resourceMgr.getString("seeless")));showmore._element.attr("tabindex","0");showless._element.attr("tabindex","0");showmore.setColor("rgb(9,60,193)");showless.setColor("rgb(9,60,193)");
showmore.setCursor("pointer");showless.setCursor("pointer");showmore._element.attr("aria-describedby",more._element[0].id);showless._element.hide();showmore.addEventListener("click",function(){more._element.show();less._element.hide();showmore._element.hide();showless._element.show()}.bind(this));showless.addEventListener("click",function(){more._element.hide();less._element.show();showmore._element.show();showless._element.hide()}.bind(this))}this.add(grid)}_p=wcInherit(WcCollapsibleText,WcxHBox);
_p.setFlag=function(txt,textFlags,textColor){if(textFlags&&textFlags>0){if(textFlags&wcconstants.WCF_TEXT_BOLD)txt.setBold(true);if(textFlags&wcconstants.WCF_TEXT_SMALL)txt.setSize(11);if(textFlags&wcconstants.WCF_TEXT_LARGE)txt.setSize(16);if(textFlags&wcconstants.WCF_TEXT_WRAP)txt.setWrap(true);if(textFlags&wcconstants.WCF_TEXT_INDENTTEXT)this._element.css("padding-left","20px")}txt._element.addClass("wcx-label-text");txt.setColor(textColor)};
function WcSlider(item){if(_wcconstructing)return;var p=item.precision;var name_r=item.rname;var max=parseFloat(item.maxval).toFixed(p);var min=parseFloat(item.minval).toFixed(p);this.wcNullColor="#eeeeee";this.wcSetColor="green";this.wcLColor=item.lcolor;this.wcRColor=item.rcolor;var value_l=parseFloat(item.lvalue).toFixed(p);var value_r=item.rvalue;if(value_r)value_r=parseFloat(value_r).toFixed(p);else value_r=0;var minlabel=item.minlabel;var maxlabel=item.maxlabel;this.wcValueL=value_l*Math.pow(10,
p);this.wcValueR=value_r*Math.pow(10,p);WcxSlider.call(this,name_r?true:false,"horizontal",min*Math.pow(10,p),max*Math.pow(10,p),this.wcValueL,this.wcValueR);this._element.addClass("wcx-slider");this.name_l=item.lname;this.name_r=name_r;this.min=min;this.max=max;this.precision=p;this.unit=item.unit;this.wcFilterInitialized=false;this.wcFilterDisplay="";var slider=this;this.setFormat(function(val,info){var txt;if(val=="min")txt=minlabel?minlabel:this.min+this.unit;else if(val=="max")txt=maxlabel?maxlabel:
this.max+this.unit;else if(val=="value"){txt="";if(slider.wcValueL!=info.value){slider.wcValueL=info.value;slider.wcLColor=slider.wcSetColor}if(slider.wcValueR!=info.value2){slider.wcValueR=info.value2;slider.wcRColor=slider.wcSetColor}if(slider.wcLColor!=slider.wcNullColor){if(info.value<0)txt+="(";txt+=(info.value/Math.pow(10,this.precision)).toFixed(this.precision)+this.unit;if(info.value<0)txt+=")";$(slider._element).find(".ibx-slider-marker-one").css("background-color",slider.wcSetColor)}else txt+=
" { } ";if(this.name_r){txt+=" - ";if(slider.wcRColor!=slider.wcNullColor){if(info.value2<0)txt+="(";txt+=(info.value2/Math.pow(10,this.precision)).toFixed(this.precision)+this.unit;if(info.value2<0)txt+=")";$(slider._element).find(".ibx-slider-marker-two").css("background-color",slider.wcSetColor)}else txt+=" { } "}}else txt="";slider.wcFilterDisplay=txt;slider.doFilterValue(txt);return txt}.bind(this));wcAttachLinksTo(this,item.xlink)}_p=wcInherit(WcSlider,WcxSlider);
_p.getParams=function(){if(!this.name_l)return null;var info=this.getInfo();var p=new Object;if(this.wcLColor!=this.wcNullColor)p[this.name_l]=(info.value/Math.pow(10,this.precision)).toFixed(this.precision);if(this.name_r)if(this.wcRColor!=this.wcNullColor)p[this.name_r]=(info.value2/Math.pow(10,this.precision)).toFixed(this.precision);return p};
_p.takeFocus=function(){var el=this._element;if(el){setTimeout(function(){var markers=$(el).find(".ibx-slider-marker");if(markers&&markers.length>0)markers[0].focus()},0);return true}return false};_p.doFilterUpdate=function(){this.doFilterValue(this.wcFilterDisplay)};
_p.doFilterValue=function(filterValue){var wcFilter=$(this._element).closest(".wcx-wcfilter");var wcobj=wcFilter.data("wcobj");if(wcobj&&wcobj.doFilterChanged){var notInitial=this.wcFilterInitialized;wcobj.doFilterChanged(filterValue,notInitial);this.wcFilterInitialized=true}};_p.doRefresh=function(){this.setOption("value",this.wcValueL);this.setOption("value2",this.wcValueR)};
function WcSimpleCheckBox(cbOptions){if(_wcconstructing)return;WcxHBox.call(this);this._element.addClass("wcx-form-item");this.checkbox=new WcxCheckBoxSimple(cbOptions.wcIsChecked,cbOptions.wcText);this.checkbox._element.addClass("ds-checkbox wcx-focusable");$(this.checkbox._element).data("itemText",cbOptions.wcText);this.add(this.checkbox);if(cbOptions.wcClass)this._element.addClass(cbOptions.wcClass.split(".").join(""));if(cbOptions.wcName)this.setName(cbOptions.wcName);this.checkedvalue=cbOptions.wcValue?
cbOptions.wcValue:"";this.checkbox.wcDirtyOnly=false;this.checkbox.wcInitialValue=cbOptions.wcIsChecked;if(cbOptions.wcIsDisabled)this.checkbox.setEnabled(false);if(cbOptions.wcAssignGroup){var assignGroup=cbOptions.wcAssignGroup;if(assignGroup)this._element.attr("wcgroup",assignGroup)}if(cbOptions.wcTextFlags){var textFlags=cbOptions.wcTextFlags;if(textFlags>0){if(textFlags&wcconstants.WCF_TEXT_BOLD)this.checkbox.setBold(true);if(textFlags&wcconstants.WCF_TEXT_SMALL)this.checkbox.setSize(11);if(textFlags&
wcconstants.WCF_TEXT_LARGE)this.checkbox.setSize(16);if(textFlags&wcconstants.WCF_TEXT_WRAP)this.checkbox.setWrap(true);if(textFlags&wcconstants.WCF_TEXT_INDENTTEXT)this._element.css("padding-left","20px")}}if(cbOptions.wcDescription)if(cbOptions.wcHelplink||cbOptions.wcDescription.text&&cbOptions.wcDescription.desc_flags&4096){cbOptions.wcDescription._objtype="wcdescription";if(cbOptions.wcHelplink)cbOptions.wcDescription._helplink=cbOptions.wcHelplink;this.prepend(wcCreateIconButton(cbOptions.wcDescription))}if(cbOptions.wcDoClick)this.checkbox.addEventListener("click",
cbOptions.wcDoClick,this);if(cbOptions.wcXlinks){this.xlinks=cbOptions.wcXlinks;wcAttachLinksTo(this.checkbox,cbOptions.wcXlinks)}}_p=wcInherit(WcSimpleCheckBox,WcxHBox);
_p.getParams=function(){var name=this.getName();if(!name)return null;var value=this.checkbox.getChecked();if(this.checkbox.wcDirtyOnly){var checkVal=this.checkbox.wcInitialValue;var initialValue=checkVal=="y"||checkVal===true?true:false;if(value==initialValue)return null}else if(!value)return null;var p=new Object;p[name]=[value?this.checkedvalue:""];return p};_p.takeFocus=function(){var el=this.checkbox._element;if(el){setTimeout(function(){el.focus()},0);return true}return false};
function WcCheckBox(item){if(_wcconstructing)return;var cbOptions={wcClass:item.class,wcIsChecked:item.checked,wcText:item.text,wcName:item.name,wcValue:item.value,wcDirtyOnly:item.dirty_only,wcIsDisabled:item.disabled,wcAssignGroup:item.group,wcTextFlags:item.text_flags,wcDescription:item._issimpleform?null:item.description,wcHelplink:item._issimpleform?null:item.helplink,wcXlinks:item.xlink};WcSimpleCheckBox.call(this,cbOptions);if(item._issimpleform)WcBaseTextProto.addItems.call(this,this.checkbox,
item)}_p=wcInherit(WcCheckBox,WcSimpleCheckBox);
function WcCheckBoxList(item){if(_wcconstructing)return;WcxVBox.call(this);$(this._element).addClass("wcx-checkboxlist");$(this._element).addClass("wcx-paging-frame");var isLineThrough=item.linethrough;if(isLineThrough)$(this._element).addClass("wcx-linethrough");this.wcItem=item;var checkboxlist=this;var searchbar=new WcSearchbar;this.add(searchbar);var buttonBox=new WcxHBox;$(buttonBox._element).addClass("wcx-buttonbox");buttonBox.setVisible(false);this.add(buttonBox);var scrollBox=new WcxVBox;
scrollBox._element.addClass("wcx-scrollbox");this.add(scrollBox);var container=new WcxVBox;container._element.addClass("wcx-scrollitems");container._element.addClass("ibx-select-item-list");scrollBox.add(container);var checkall_text=item.control_text;var paging=item.paging;if(paging){this.wcPaging=paging;var pagingToolbar=new WcPagingToolbar(paging,this);this.add(pagingToolbar)}this.wcContainer=container;this.wcFilterInitialized=false;this.wcFilterDisplay=null;var wcControlXlink=item.control_xlink;
var options=item.option;this._element.ready(function(){var wcobj=null;var filter=$(container._element).closest(".wcx-wcfilter");if(filter&&filter.length>0){wcobj=filter.data("wcobj");if(wcobj&&wcobj.searchable){wcobj.wcSearchbar=searchbar;if(paging){wcobj.wcPagingToolbar=pagingToolbar;searchbar.initPagingSearch(paging,wcobj)}else searchbar.setVisible(true);searchbar.setUseSearchBtn(paging);searchbar.wcDataObj=checkboxlist;searchbar.wcSearchHandler=paging?wcobj.doPagingSearch:wcobj.doCommonSearch}}else{var form=
$(container._element).closest(".wcx-wcform");if(form&&form.length>0)wcobj=form.data("wcobj")}if(wcobj){if(paging)$(wcobj._element).addClass("wcx-paging-form");var isallchecked=true;var checkbox;checkboxlist.wcArray=[];wcobj.wrappable=false;if(wcobj.wrappable){$(wcobj._element).addClass("wcx-wrappable");var maxWidth=0;if(checkall_text){var cbOptions={};cbOptions.wcText=checkall_text;checkboxlist.wcFirstItem=new WcSimpleCheckBox(cbOptions);checkboxlist.wcFirstItem.wcCBList=checkboxlist;checkboxlist.wcFirstItem.wcControlXlink=
item.control_xlink;checkboxlist.wcFirstItem.addEventListener("click",function(){var cblist=this.wcCBList;cblist.wcFilterDisplay=null;cblist.doFilterValue();var val=this.checkbox.getChecked();for(var i=0;i<cblist.wcArray.length;i++){var simpleCB=cblist.wcArray[i];simpleCB.checkbox.setChecked(val)}if(this.wcControlXlink){var link=JSON.parse(JSON.stringify(this.wcControlXlink));link.jqobj=cblist._element;wcSubmitLink(link)}},checkboxlist.wcFirstItem);container.add(checkboxlist.wcFirstItem);maxWidth=
$(checkboxlist.wcFirstItem._element).width()}if(options){var checkedArray=[];for(var i=0;i<options.length;i++){var cbOptions={};var ischecked=options[i].selected;if(!ischecked)isallchecked=false;cbOptions.wcIsChecked=ischecked;cbOptions.wcText=options[i].text;cbOptions.wcDoClick=checkboxlist.doClick;if(item._page&&item._page._rsp.data.share&&item._page._rsp.data.share.xlink){var sharedlink=item._page._rsp.data.share.xlink;for(var j=0;j<options[i].xlink.length;j++){var xlink=options[i].xlink[j];xlink._sharedlink=
sharedlink}}cbOptions.wcXlinks=options[i].xlink;checkbox=new WcSimpleCheckBox(cbOptions);checkbox.wcCheckboxList=checkboxlist;checkbox.wcValue=options[i].value;checkboxlist.wcArray.push(checkbox);if(ischecked)checkedArray.push(checkbox.checkbox);container.add(checkbox);var width=$(checkbox._element).width();if(width>maxWidth)maxWidth=width}if(checkall_text&&checkboxlist.wcFirstItem)checkboxlist.wcFirstItem.checkbox.setChecked(isallchecked)}$(container._element).css("display","grid");$(container._element).css("grid-template-columns",
"repeat(auto-fill, "+(maxWidth+10)+"px)");$(container._element).css("row-gap","3px");$(container._element).css("margin-left","3px");$(container._element).css("width","100%")}else{$(wcobj._element).addClass("wcx-not-wrappable");if(checkall_text){var checkAllBtn=new WcxButton("Select all");checkAllBtn.addEventListener("click",function(){checkboxlist.wcFilterDisplay=null;checkboxlist.doFilterValue();var checkedArray=[];for(var i=0;i<checkboxlist.wcArray.length;i++){var simpleCB=checkboxlist.wcArray[i];
simpleCB.checkbox.setChecked(true);checkedArray.push(simpleCB.checkbox)}checkboxlist.wcFilterDisplay=checkedArray;checkboxlist.doFilterValue(checkedArray);if(wcControlXlink){var link=JSON.parse(JSON.stringify(wcControlXlink));link.jqobj=checkboxlist._element;wcSubmitLink(link)}},this);buttonBox.add(checkAllBtn);var clearAllBtn=new WcxButton("Clear");clearAllBtn.addEventListener("click",function(){checkboxlist.wcFilterDisplay=null;checkboxlist.doFilterValue();for(var i=0;i<checkboxlist.wcArray.length;i++){var simpleCB=
checkboxlist.wcArray[i];simpleCB.checkbox.setChecked(false)}checkboxlist.wcFilterDisplay=[null];checkboxlist.doFilterValue([]);if(wcControlXlink){var link=JSON.parse(JSON.stringify(wcControlXlink));link.jqobj=checkboxlist._element;wcSubmitLink(link)}},this);buttonBox.add(clearAllBtn);buttonBox.setVisible(true)}if(options){var checkedArray=[];for(var i=0;i<options.length;i++){var cbOptions={};var ischecked=options[i].selected;if(!ischecked)isallchecked=false;cbOptions.wcIsChecked=ischecked;cbOptions.wcText=
options[i].text;cbOptions.wcDoClick=checkboxlist.doClick;if(item._page&&item._page._rsp.data.share&&item._page._rsp.data.share.xlink){var sharedlink=item._page._rsp.data.share.xlink;for(var j=0;j<options[i].xlink.length;j++){var xlink=options[i].xlink[j];xlink._sharedlink=sharedlink}}cbOptions.wcXlinks=options[i].xlink;checkbox=new WcSimpleCheckBox(cbOptions);$(checkbox.checkbox._element).addClass("ibx-select-item");checkbox.wcCheckboxList=checkboxlist;checkbox.wcValue=options[i].value;checkboxlist.wcArray.push(checkbox);
if(ischecked)checkedArray.push(checkbox.checkbox);container.add(checkbox)}}}}checkboxlist.wcFilterDisplay=checkedArray;var filterValue=checkboxlist.doFilterValue(checkedArray);var eleCP=$(wcobj._element).closest(".wcx-multiframes-content-pane");var cp=eleCP.data("wcobj");if(cp&&cp.wcContentItem){var ci=cp.wcContentItem;ci.doFilterControlCreated(isLineThrough)}})}_p=wcInherit(WcCheckBoxList,WcxVBox);
_p.getParams=function(){var name=this.wcItem.name;if(!name)return;var p=new Object;var val=[];if(this.wcArray)for(var i=0;i<this.wcArray.length;i++){var simpleCB=this.wcArray[i];if(simpleCB.checkbox.getChecked()){var value=simpleCB.wcValue;val.push(value)}}p[name]=val;return p};_p.takeFocus=function(){var el=this._element;if(el){setTimeout(function(){var chks=$(el).find(".wcx-form-item > .ibx-check-box-simple");if(chks&&chks.length>0)chks[0].focus()},0);return true}return false};
_p.doClick=function(evt){var cbList=this.wcCheckboxList;var isselectfirst=cbList.wcItem.selectfirst;var firstUnchecked=null;var isallchecked=true;var checkedArray=[];for(var i=0;i<cbList.wcArray.length;i++){var simpleCB=cbList.wcArray[i];if(simpleCB&&simpleCB.checkbox){if(simpleCB.checkbox.getChecked())checkedArray.push(simpleCB.checkbox);if(!firstUnchecked){if(!simpleCB.checkbox.getChecked()){firstUnchecked=simpleCB;isallchecked=false}}else if(isselectfirst)if(simpleCB.checkbox.getChecked()){$(simpleCB._element).insertBefore($(firstUnchecked._element));
var toIndex=cbList.wcArray.indexOf(firstUnchecked);if(toIndex<0)toIndex=0;WcReorderArray(cbList.wcArray,i,toIndex)}}}if(cbList.wcFirstItem)cbList.wcFirstItem.checkbox.setChecked(isallchecked);cbList.wcFilterDisplay=checkedArray;cbList.doFilterValue(checkedArray);var currentCB=evt.currentTarget;if(currentCB)currentCB.scrollIntoView(false)};_p.doFilterUpdate=function(){this.doFilterValue(this.wcFilterDisplay)};
_p.doFilterValue=function(checkedArray){var filterValue="";if(checkedArray)if(checkedArray.length==this.wcArray.length)filterValue=ibx.resourceMgr.getString("all");else if(checkedArray.length>2){var itemCount=this.wcArray.length;if(this.wcPaging&&this.wcPaging._total>1)filterValue=checkedArray.length+" "+ibx.resourceMgr.getString("selected");else filterValue=checkedArray.length+" / "+itemCount}else{var checkbox=null;if(checkedArray.length>0){checkbox=checkedArray[0];filterValue=$(checkbox._element).data("itemText");
if(checkedArray.length>1){checkbox=checkedArray[1];filterValue+=", "+$(checkbox._element).data("itemText")}}}var wcFilter=$(this._element).closest(".wcx-wcfilter");var wcobj=wcFilter.data("wcobj");if(wcobj&&wcobj.doFilterChanged){var notInitial=this.wcFilterInitialized;wcobj.doFilterChanged(filterValue,notInitial);this.wcFilterInitialized=true}return filterValue};
_p.doRefresh=function(){$(this.wcContainer._element).css("display","");$(this.wcContainer._element).css("grid-template-columns","");var maxWidth=this.wcFirstItem?$(this.wcFirstItem._element).width():20;var wcobj=null;var filter=$(this._element).closest(".wcx-wcfilter");if(filter&&filter.length>0){wcobj=filter.data("wcobj");for(var i=0;i<this.wcArray.length;i++){var item=this.wcArray[i];var width=$(item._element).width();if(width>maxWidth)maxWidth=width}if(wcobj&&wcobj.wrappable){$(this.wcContainer._element).css("display",
"grid");$(this.wcContainer._element).css("grid-template-columns","repeat(auto-fill, "+(maxWidth+10)+"px)")}}};
function WcSimpleRadio(radOptions){if(_wcconstructing)return;WcxHBox.call(this);this._element.addClass("wcx-form-item wcx-focusable wcx-radio");if(radOptions.wcName)this.setName(radOptions.wcName);this.radio=new WcxRadioButtonSimple(radOptions.wcIsChecked,radOptions.wcText);this.radio._element.addClass("ds-radio");$(this.radio._element).data("itemText",radOptions.wcText);var radiogroup=null;if(radOptions.wcRadioGroup)radiogroup=radOptions.wcRadioGroup;else{radiogroup=new WcxRadioGroup(radOptions.wcName?
radOptions.wcName:null);this.add(radiogroup)}if(radiogroup)radiogroup.addButton(this.radio);if(radOptions.wcValue)this.checkedvalue=radOptions.wcValue;if(radOptions.wcIsDisabled)this.radio.setEnabled(false);if(radOptions.wcDescription){var dtext=radOptions.wcDescription.text;var dflags=radOptions.wcDescription.desc_flags;if(radOptions.wcHelplink||dtext&&dflags&4096){radOptions.wcDescription._objtype="wcdescription";if(radOptions.wcHelplink)radOptions.wcDescription._helplink=radOptions.wcHelplink;
this.prepend(wcCreateIconButton(radOptions.wcDescription))}}this.radio.addChangeEventListener(function(e){if(!this.radio.getChecked())return;var b=this;this._element.closest(".wcx-wcform").find(".wcx-radio").each(function(){if($(this).data("wcobj")!=b&&b.getName()==$(this).data("wcobj").getName())$(this).data("wcobj").radio.setChecked(false)});var wcobj=this._element.closest(".wcx-wctable").data("wcobj");if(wcobj)wcobj.uncheckRadio(this.getName(),b._id)},this);if(radOptions.wcXlinks)wcAttachLinksTo(this.radio,
radOptions.wcXlinks);else if(radOptions.wcControlXlink)wcAttachLinksTo(this.radio,[JSON.parse(JSON.stringify(radOptions.wcControlXlink))])}_p=wcInherit(WcSimpleRadio,WcxHBox);_p.getParams=function(){var name=this.getName();var value=this.radio.getChecked();if(!name||!value)return null;var p=new Object;p[name]=[this.checkedvalue];return p};_p.takeFocus=function(){var el=this.radio._element;if(el){setTimeout(function(){el.focus()},0);return true}return false};
function WcRadio(item){if(_wcconstructing)return;var radOptions={wcName:item.name,wcIsChecked:item.checked,wcText:item.text,wcValue:item.value,wcIsDisabled:item.disabled,wcDescription:item.description,wcHelplink:item.helplink,wcXlinks:item.xlink};WcSimpleRadio.call(this,radOptions)}_p=wcInherit(WcRadio,WcSimpleRadio);
function WcRadioList(item){if(_wcconstructing)return;WcxVBox.call(this);$(this._element).addClass("wcx-radiolist");$(this._element).addClass("wcx-paging-frame");this.wcItem=item;var radiolist=this;var searchbar=new WcSearchbar;this.add(searchbar);var scrollBox=new WcxVBox;scrollBox._element.addClass("wcx-scrollbox");this.add(scrollBox);var container=new WcxVBox;container._element.addClass("wcx-select-item-list");scrollBox.add(container);var none_text=item.control_text;var paging=item.paging;if(paging){this.wcPaging=
paging;var pagingToolbar=new WcPagingToolbar(paging,this);this.add(pagingToolbar)}var radiogroup=new WcxRadioGroup(item.id);radiogroup._element.addClass("wcx-radiogroup");container.add(radiogroup);this.wcContainer=radiogroup;this.wcFilterInitialized=false;this.wcFilterDisplay="";var options=item.option;this._element.ready(function(){var radOptions={};var wcobj=null;var filter=$(container._element).closest(".wcx-wcfilter");if(filter&&filter.length>0){radOptions.wcRadioGroup=radiogroup;$(radiogroup._element).css("display",
"grid");wcobj=filter.data("wcobj");if(wcobj&&wcobj.searchable){wcobj.wcSearchbar=searchbar;if(paging){wcobj.wcPagingToolbar=pagingToolbar;searchbar.initPagingSearch(paging,wcobj)}searchbar.setUseSearchBtn(paging);searchbar.wcDataObj=radiogroup;searchbar.wcSearchHandler=paging?wcobj.doPagingSearch:wcobj.doCommonSearch}}else{var form=$(container._element).closest(".wcx-wcform");if(form&&form.length>0){radOptions.wcName=item.id;wcobj=form.data("wcobj")}}if(wcobj){if(paging)$(wcobj._element).addClass("wcx-paging-form");
var maxWidth=0;var isanychecked=false;var radio;radiolist.wcArray=[];if(none_text){radOptions.wcText=none_text;radOptions.wcControlXlink=item.control_xlink;radiolist.wcFirstItem=new WcSimpleRadio(radOptions);$(radiolist.wcFirstItem.radio._element).on("click",function(evt){var jqobj=$(evt.currentTarget);var selectedValue=jqobj.data("itemText");if(!selectedValue)selectedValue=none_text;radiolist.wcFilterDisplay=selectedValue;radiolist.doFilterValue(selectedValue)});if(form&&form.length>0)container.add(radiolist.wcFirstItem);
maxWidth=$(radiolist.wcFirstItem._element).width()}var selectedValue=none_text;for(var i=0;i<options.length;i++){var ischecked=options[i].selected;if(ischecked){isanychecked=true;selectedValue=options[i].text}radOptions.wcIsChecked=ischecked;radOptions.wcText=options[i].text;if(item._page&&item._page._rsp.data.share&&item._page._rsp.data.share.xlink){var sharedlink=item._page._rsp.data.share.xlink;for(var j=0;j<options[i].xlink.length;j++){var xlink=options[i].xlink[j];xlink._sharedlink=sharedlink}}radOptions.wcXlinks=
options[i].xlink;radio=new WcSimpleRadio(radOptions);$(radio.radio._element).on("click",function(evt){var jqobj=$(evt.currentTarget);var selectedValue=jqobj.data("itemText");if(!selectedValue)selectedValue=none_text;radiolist.wcFilterDisplay=selectedValue;radiolist.doFilterValue(selectedValue)});radiolist.wcArray.push(radio);if(form&&form.length>0)container.add(radio);var radioEl=radiogroup._element[0].children[i];var width=$(radioEl).width();if(width>maxWidth)maxWidth=width}if(none_text&&!isanychecked)radiolist.wcFirstItem.radio.setChecked(true);
radiolist.wcFilterDisplay=selectedValue;radiolist.doFilterValue(selectedValue);if(wcobj&&wcobj.wrappable){$(container._element).css("width","100%");if(filter&&filter.length>0){$(radiogroup._element).css("display","grid");$(radiogroup._element).css("grid-template-columns","repeat(auto-fill, "+(maxWidth+10)+"px)");$(radiogroup._element).css("row-gap","3px");$(radiogroup._element).css("width","100%")}else{$(container._element).css("display","grid");$(container._element).css("grid-template-columns","repeat(auto-fill, "+
(maxWidth+10)+"px)");$(container._element).css("row-gap","3px")}}}})}_p=wcInherit(WcRadioList,WcxVBox);_p.getParams=function(){var name=this.wcItem.name;if(!name)return;var p=new Object;var val=[];var options=this.wcItem.option;if(this.wcArray)for(var i=0;i<this.wcArray.length;i++){var simpleRad=this.wcArray[i];if(simpleRad.radio.getChecked()){var value=options[i].value;val.push(value)}}p[name]=val;return p};
_p.takeFocus=function(){var el=this._element;if(el){setTimeout(function(){var radios=$(el).find(".wcx-radiogroup > .ibx-radio-button-simple");if(radios&&radios.length>0)radios[0].focus()},0);return true}return false};_p.doFilterUpdate=function(){this.doFilterValue(this.wcFilterDisplay)};
_p.doFilterValue=function(filterValue,notInitial){var wcFilter=$(this._element).closest(".wcx-wcfilter");var wcobj=wcFilter.data("wcobj");if(wcobj&&wcobj.doFilterChanged){var notInitial=this.wcFilterInitialized;wcobj.doFilterChanged(filterValue,notInitial);this.wcFilterInitialized=true}};
_p.doRefresh=function(){$(this.wcContainer._element).css("display","");$(this.wcContainer._element).css("grid-template-columns","");var maxWidth=$(this.wcFirstItem._element).width();var wcobj=null;var filter=$(this._element).closest(".wcx-wcfilter");if(filter&&filter.length>0){wcobj=filter.data("wcobj");for(var i=0;i<this.wcArray.length;i++){var item=this.wcArray[i].radio;var width=$(item._element).width();if(width>maxWidth)maxWidth=width}if(wcobj&&wcobj.wrappable){$(this.wcContainer._element).css("display",
"grid");$(this.wcContainer._element).css("grid-template-columns","repeat(auto-fill, "+(maxWidth+10)+"px)")}}};function WcSimpleButton(btnOptions){if(_wcconstructing)return;if(btnOptions.wcIsSplit)WcxHSplitMenuButton.call(this,btnOptions.wcValue?btnOptions.wcValue:"");else WcxButton.call(this,btnOptions.wcValue?btnOptions.wcValue:"");this._setup(btnOptions)}_p=wcInherit(WcSimpleButton,WcxButton);
_p._setup=function(btnOptions){$(this._element).data("itemText",btnOptions.wcValue);if(btnOptions.wcImage){this.setIcon(btnOptions.wcImage);var imgclass=btnOptions.wcImage.replace(/ /g,"-");imgclass=imgclass.replace(/\./g,"_");$(this._element).addClass("wcx-"+imgclass)}this.setIconPosition(btnOptions.wcIsImageRight?"right":"left");if(btnOptions.wcTooltip)this.setTitle(btnOptions.wcTooltip);this.setEnabled(!btnOptions.wcIsDisabled);this.highlighted=btnOptions.wcIsHighlight?true:false;this.setHighlighted(this.highlighted);
if(btnOptions.wcWidth)$(this._element).css("width",btnOptions.wcWidth);if(btnOptions.wcDoClick)this.addEventListener("click",btnOptions.wcDoClick,this);if(btnOptions.wcImageColor)this.setIconColor(btnOptions.wcImageColor);if(btnOptions.wcBorderColor)this._element.css("border-color",btnOptions.wcBorderColor);if(btnOptions.wcBackColor)this._element.css("background-color",btnOptions.wcBackColor);if(btnOptions.wcIsActive){this._element.removeClass("btn-default");this._element.addClass("btn-active")}if(btnOptions.wcXlinks)if(btnOptions.wcIsSplit){var xlinks=
btnOptions.wcXlinks.slice();for(var i=0;i<xlinks.length;i++)if(xlinks[i].method=="popup"){this._element.on("ibx_click",xlinks[i],function(e){if(!($(e.target).is(".ibx-menu-button")||e.menu))return;var menu=new WcxMenu(true);e.menu=menu._element;menu.wcxlink=e.data;var node=menu.wcxlink.node[0];if(node.dynamic){var dlink=node.xlink[0];dlink._page=node._page;dlink._popupnodes=node._popupnodes;dlink._menu_name=node.dynamic;node=wcHandleDynamicPopup(dlink);node._page=dlink._page}wcBuildMenu(null,node,
null,null,menu)});xlinks.splice(i,1)}if(xlinks.length>0)wcAttachLinksTo(this,xlinks)}else wcAttachLinksTo(this,btnOptions.wcXlinks);else if(btnOptions.wcControlXlink)wcAttachLinksTo(this,[JSON.parse(JSON.stringify(btnOptions.wcControlXlink))]);else this.setEnabled(false)};
function WcButton(item){if(_wcconstructing)return;btnOptions={wcValue:item.value,wcImage:item.image,wcImageColor:item.imagecolor,wcBorderColor:item.bordercolor?item.bordercolor:item.buttonbordercolor,wcBackColor:item.backcolor,wcIsImageRight:item.image_right,wcTooltip:item.tooltip,wcIsDisabled:item.disabled,wcIsHighlight:item.highlight,wcXlinks:item.helplink?[item.helplink]:item.xlink,wcIsActive:item.active,wcIsSplit:item.split};WcSimpleButton.call(this,btnOptions);var id=item.name;if(id=="OK"||id==
"SUBMIT")this._element.attr("enterbutton","y");this.setWcId(item.name?item.name:item.id);if(item.class)this._element.addClass(item.class)}_p=wcInherit(WcButton,WcSimpleButton);_p.update=function(item){btnOptions={wcValue:item.value,wcImage:item.image,wcTooltip:item.tooltip,wcIsDisabled:item.disabled,wcIsHighlight:item.highlight,wcXlinks:item.xlink};this._element.off("click.wc");this._setup(btnOptions)};_p.updateLink=function(link){this._element.off("click.wc");wcAttachLinksTo(this,[link]);this.setEnabled(true)};
function WcButtonList(item){if(_wcconstructing)return;WcxVBox.call(this);$(this._element).addClass("wcx-buttonlist");$(this._element).addClass("wcx-paging-frame");$(this._element).addClass("ds-button-list");$(this._element).css({top:"28px",bottom:"0px",width:"100%"});this.wcItem=item;var buttonlist=this;var searchbar=new WcSearchbar;this.add(searchbar);var scrollBox=new WcxVBox;scrollBox._element.addClass("wcx-scrollbox");this.add(scrollBox);var container=new WcxVBox;container._element.addClass("wcx-scrollitems");
scrollBox.add(container);var none_text=item.control_text;var paging=item.paging;if(paging){this.wcPaging=paging;var pagingToolbar=new WcPagingToolbar(paging,this);this.add(pagingToolbar)}this.wcContainer=container;this.wcFilterInitialized=false;this.wcFilterDisplay="";var options=item.option;this._element.ready(function(){var wcobj=null;var filter=$(container._element).closest(".wcx-wcfilter");if(filter&&filter.length>0){wcobj=filter.data("wcobj");if(wcobj&&wcobj.searchable){wcobj.wcSearchbar=searchbar;
if(paging){wcobj.wcPagingToolbar=pagingToolbar;searchbar.initPagingSearch(paging,wcobj)}searchbar.setUseSearchBtn(paging);searchbar.wcDataObj=buttonlist;searchbar.wcSearchHandler=paging?wcobj.doPagingSearch:wcobj.doCommonSearch}}else{var form=$(container._element).closest(".wcx-wcform");if(form&&form.length>0)wcobj=form.data("wcobj")}if(wcobj){if(paging)$(wcobj._element).addClass("wcx-paging-form");var maxWidth=0;var isanychecked=false;var button;buttonlist.wcArray=[];var btnOptions={};if(none_text){btnOptions.wcValue=
none_text;btnOptions.wcWidth="80px";btnOptions.wcDoClick=buttonlist.doClicked;btnOptions.wcControlXlink=item.control_xlink;buttonlist.wcFirstItem=new WcSimpleButton(btnOptions);buttonlist.wcFirstItem.setEnabled(true);buttonlist.wcFirstItem.wcButtonList=buttonlist;container.add(buttonlist.wcFirstItem)}var selectedValue=none_text;for(var i=0;i<options.length;i++){var btnOptions={};var ischecked=options[i].selected;if(ischecked){isanychecked=true;selectedValue=options[i].text}btnOptions.wcIsHighlight=
ischecked;btnOptions.wcWidth="80px";btnOptions.wcValue=options[i].text;btnOptions.wcTooltip=options[i].text;btnOptions.wcDoClick=buttonlist.doClicked;if(item._page&&item._page._rsp.data.share&&item._page._rsp.data.share.xlink){var sharedlink=item._page._rsp.data.share.xlink;for(var j=0;j<options[i].xlink.length;j++){var xlink=options[i].xlink[j];xlink._sharedlink=sharedlink}}btnOptions.wcXlinks=options[i].xlink;button=new WcSimpleButton(btnOptions);button.setEnabled(true);button.wcButtonList=buttonlist;
buttonlist.wcArray.push(button);container.add(button);var width=$(button._element).width();if(width>maxWidth)maxWidth=width}if(none_text&&!isanychecked)buttonlist.wcFirstItem.setHighlighted(true);buttonlist.wcFilterDisplay=selectedValue;buttonlist.doFilterValue(selectedValue);if(wcobj&&wcobj.wrappable){$(buttonlist._element).css("width","100%");$(container._element).css("display","grid");$(container._element).css("grid-template-columns","repeat(auto-fill, "+(maxWidth+20)+"px)");$(container._element).css("row-gap",
"3px");$(container._element).css("width","100%")}}})}_p=wcInherit(WcButtonList,WcxVBox);_p.getParams=function(){var name=this.wcItem.name;if(!name)return;var p=new Object;var val=[];var options=this.wcItem.option;if(this.wcArray)for(var i=0;i<this.wcArray.length;i++){var simpleBtn=this.wcArray[i];if(simpleBtn.getHighlighted()){var value=options[i].value;val.push(value)}}p[name]=val;return p};
_p.doClicked=function(evt){if(this.wcButtonList.wcFirstItem)this.wcButtonList.wcFirstItem.setHighlighted(false);var wcArray=this.wcButtonList.wcArray;for(var j=0;j<wcArray.length;j++){var btn=wcArray[j];btn.setHighlighted(false)}this.setHighlighted(true);var txt=this.getText();this.wcButtonList.wcFilterDisplay=txt;this.wcButtonList.doFilterValue(txt)};_p.doFilterUpdate=function(){this.doFilterValue(this.wcFilterDisplay)};
_p.doFilterValue=function(filterValue,notInitial){var wcFilter=$(this._element).closest(".wcx-wcfilter");var wcobj=wcFilter.data("wcobj");if(wcobj&&wcobj.doFilterChanged){var notInitial=this.wcFilterInitialized;wcobj.doFilterChanged(filterValue,notInitial);this.wcFilterInitialized=true}};
function WcFilter(item){if(_wcconstructing)return;WcxComponent.call(this,"WcFilter");this._element.addClass("wcx-wcfilter");this.wcCloseLink=item.closelink;this._filterid=item.id;this.wrappable=true;if(typeof item.searchable=="undefined")this.searchable=false;else this.searchable=item.searchable;var titleText=item.titletext;var wcTitleText=titleText?titleText.getText():"";var displayText=item.displaytext;var wcDisplayText=displayText?displayText.getText():"";var bar=null;var btns=wcGetTopButtons(item);
if(btns||this.searchable){bar=new WcToolBar(this);this.add(bar);if(btns)bar.addButtons(btns);this.toolbar=bar}this.wcComponent=null;var compsXml=item.item;if(compsXml)for(var i=0;i<compsXml.length;i++){if(compsXml[i].type=="wcform"&&compsXml[i].formid=="wcf_tablebar")continue;compsXml[i]._page=item._page;var compObj=wcBuild(compsXml[i]);if(!this.wcComponent)this.wcComponent=compObj;this.add(compObj)}var compObj=this.wcComponent;$(this._element).on("resize",function(){if(compObj.doRefresh)compObj.doRefresh()});
if(this.searchable)if(bar)if(this.wcComponent.wcPaging)bar.addSearchHandler(this.doPagingSearchToggle.bind(this));else bar.addSearchHandler(this.doSearchToggle.bind(this));var thisObj=this;$(this._element).ready(function(){var eleCP=$(thisObj._element).closest(".wcx-multiframes-content-pane");var cp=eleCP.data("wcobj");if(cp&&cp.wcContentItem){thisObj.wcContentPane=cp;var ci=cp.wcContentItem;ci.doFilterCreated(wcTitleText,wcDisplayText)}})}_p=wcInherit(WcFilter,WcxComponent);
_p.getParams=function(){if(!this.wcComponent)return null;var params=new Object;var p;if(this.wcComponent.getParams){p=this.wcComponent.getParams();for(var k in p)if(k&&p.hasOwnProperty(k))if(params[k])params[k]=params[k].concat(p[k]);else params[k]=p[k]}return params};_p.takeFocus=function(){if(this.wcComponent&&this.wcComponent.takeFocus)return this.wcComponent.takeFocus();else return false};
_p.doFilterChanged=function(filterValue,notInitial){var ele=$(this._element).closest(".wcx-multiframes-content-pane");var cp=ele?ele.data("wcobj"):null;if(cp&&cp.wcContentInfo){cp.wcContentInfo.wcLastFilterValue=filterValue;var ci=cp.wcContentItem;if(ci)ci.doFilterChanged(filterValue,notInitial)}};_p.doFilterUpdate=function(){var compObj=this.wcComponent;if(compObj){compObj.wcFilterInitialized=false;compObj.doFilterUpdate();compObj.wcFilterInitialized=true}};
_p.doSearchToggle=function(e){this.wcSearchbar.setVisible(!this.wcSearchbar.getVisible());if(this.wcSearchbar.getVisible())$(this.wcSearchbar.wcSearchbox._element).focus()};
_p.doCommonSearch=function(e){var searchBar=this;var searchText=searchBar.wcSearchbox.getText().toLowerCase();var dataObj=searchBar.wcDataObj;var children=dataObj._element[0].children;for(var i=0;i<children.length;i++){var item=$(children[i]);var wcobj=item.data("wcobj");if(wcobj&&!(wcobj instanceof WcSearchbar)){var itemEl=item.find(".ibx-label-text");var itemText=itemEl.text().toLowerCase();item.css("display","");item.css("height","");item.css("min-height","");item.css("padding","");searchBar.removeHighlight(itemEl);
if(itemText.indexOf(searchText)<0){item.css("display","none");item.css("height","0px");item.css("min-height","0px");item.css("padding","0px")}else searchBar.addHighlight(searchText,itemEl)}}};_p.doPagingSearch=function(e){var filter=$(this._element).closest(".wcx-wcfilter").data("wcobj");if(filter&&filter.wcPagingToolbar)filter.wcPagingToolbar.doPageSearch()};
_p.doPagingSearchCancel=function(e){var filter=$(this._element).closest(".wcx-wcfilter").data("wcobj");if(filter&&filter.wcPagingToolbar){var searchText=$.trim(this.wcSearchbox.getText());this.wcSearchbox.setText("");if(searchText!="")filter.wcPagingToolbar.doPageSearchCancel();else filter.wcPagingToolbar.doPageSearchHide(true)}};
_p.doPagingSearchToggle=function(e){var wasVisible=this.wcSearchbar.getVisible();this.wcSearchbar.setVisible(!wasVisible);if(this.wcSearchbar.getVisible())$(this.wcSearchbar.wcSearchbox._element).focus();var filter=$(this._element).closest(".wcx-wcfilter").data("wcobj");if(filter&&filter.wcPagingToolbar)if(!wasVisible)filter.wcPagingToolbar.doPageSearchShow();else filter.wcPagingToolbar.doPageSearchHide()};
_p.doCloseLink=function(e){var link=this.wcCloseLink;if(link){link.jqobj=this._element;wcSubmitLink(link);return true}return false};
function WcSearchbar(){if(_wcconstructing)return;WcxHBox.call(this);this._element.addClass("wcx-searchbar");this.setVisible(false);this.wcFloat=localStorage.getItem("searchbar,float")=="true";if(this.wcFloat)this._element.addClass("wcx-searchbar-float");else this._element.removeClass("wcx-searchbar-float");this.wcSearchHandler=function(){var msg=new WcMessageDialog("Not yet implemented","warning")};this.wcCancelHandler=function(evt){var searchText=this.wcSearchbox.getText();if(searchText!=""){this.wcSearchbox.setText("");
this.doSearch(evt)}else this.setVisible(false)}.bind(this);this.wcSearchbox=new WcxTextField;this.wcSearchbox._element.ibxWidget("option","placeholder",ibx.resourceMgr.getString("search"));$(this.wcSearchbox._element).attr("title","Double-click to "+(this.wcFloat?"dock":"float")+" search-box");this.wcSearchbox._element.addClass("wcx-searchbox");this.wcSearchbox.addEventListener("keyup",this.doKeyUp,this);this.wcSearchbox.addEventListener("dblclick",this.doDblClick,this);this.add(this.wcSearchbox);
this.wcSearchBtn=new wcCreateIconButton({"icon":wcapplication.imgstr.search});this.wcSearchBtn._setQaAttr("Search");this.wcSearchBtn._element.addClass("wcx-searchbtn");this.wcSearchBtn.addEventListener("click",this.doSearch,this);this.wcSearchBtn.setVisible(this.wcUseSearchBtn);this.add(this.wcSearchBtn);this.wcCancelBtn=new wcCreateIconButton({"icon":"undo"});this.wcCancelBtn._setQaAttr("Cancel");this.wcCancelBtn._element.addClass("wcx-cancelbtn");this.wcCancelBtn.addEventListener("click",this.doCancel,
this);this.add(this.wcCancelBtn)}_p=wcInherit(WcSearchbar,WcxHBox);_p.setUseSearchBtn=function(bUseSearchBtn){this.wcUseSearchBtn=bUseSearchBtn;this.wcSearchBtn.setVisible(this.wcUseSearchBtn)};_p.doSearch=function(evt){if(this.wcSearchHandler)this.wcSearchHandler(evt)};_p.doCancel=function(evt){if(this.wcCancelHandler)this.wcCancelHandler(evt)};_p.doKeyUp=function(evt){if(this.wcUseSearchBtn)if(evt.which==13)this.doSearch(evt);else{if(evt.which==27)this.doCancel(evt)}else this.doSearch(evt)};
_p.doDblClick=function(evt){this.wcFloat=!this.wcFloat;localStorage.setItem("searchbar,float",this.wcFloat);if(this.wcFloat)this._element.addClass("wcx-searchbar-float");else this._element.removeClass("wcx-searchbar-float");$(this.wcSearchbox._element).attr("title","Double-click to "+(this.wcFloat?"dock":"float")+" search-box")};
_p.initPagingSearch=function(paging,filter){this.wcCancelHandler=filter.doPagingSearchCancel;var pagingToolbar=filter.wcPagingToolbar;var searchbar=this;var show=paging.wcShowFindBar;this.setVisible(show);setTimeout(function(){var searchText=paging.searchvalue;if(searchText){var wcobj=pagingToolbar.wcDataObj.wcFirstItem;var itemEl=null;if(wcobj){var item=null;if(wcobj instanceof WcSimpleCheckBox)item=wcobj.checkbox;if(wcobj instanceof WcSimpleRadio)item=wcobj.radio;if(wcobj instanceof WcSimpleButton)item=
wcobj;if(item){itemEl=$(item._element).find(".ibx-label-text");if(itemEl){var itemText=itemEl.text().toLowerCase();if(itemText.indexOf(searchText)>=0)searchbar.addHighlight(searchText,itemEl)}}}var children=pagingToolbar.wcDataObj.wcArray;for(var i=0;i<children.length;i++){wcobj=children[i];if(wcobj){if(wcobj.radio)itemEl=$(wcobj.radio._element).find(".ibx-label-text");else if(!(wcobj instanceof WcSearchbar))itemEl=$(wcobj._element).find(".ibx-label-text");if(itemEl){var itemText=itemEl.text().toLowerCase();
if(itemText.indexOf(searchText)>=0)searchbar.addHighlight(searchText,itemEl)}}}searchbar.setVisible(show);try{searchbar.wcSearchbox.setText(searchText)}catch(err){}$(searchbar.wcSearchbox._element).focus()}},0)};_p.addHighlight=function(searchText,itemEl){searchText=searchText.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&");var searchStr="("+searchText+")";var regexp=new RegExp(searchStr,"ig");var replaceStr='<span class="wcx-search-highlighted">$1</span>';itemEl.html(itemEl.html().replace(regexp,replaceStr))};
_p.removeHighlight=function(itemEl){var itemText=itemEl.parent().data("itemText");if(itemText)itemEl.html(itemText)};
function WcPagingToolbar(pagingObj,dataObj){if(_wcconstructing)return;WcxComponent.call(this);this._element.addClass("wcx-paging-toolbar");this.wcPagingBar=new WcxHBox;this.wcPagingBar._element.addClass("wcx-paging-bar");this.add(this.wcPagingBar);this.wcPageSizeDown=new WcxButtonSimple(null,wcapplication.imgstr.delete_value);this.wcPageSizeDown._element.addClass("wcx-paging-button");this.wcPageSizeDown.setTitle(ibx.resourceMgr.getString("decrease"));this.wcPageSizeDown.addEventListener("click",this.doPageSizeDown,
this);this.wcPagingBar.add(this.wcPageSizeDown);this.wcPageSizeUp=new WcxButtonSimple(null,wcapplication.imgstr.add_value);this.wcPageSizeUp._element.addClass("wcx-paging-button");this.wcPageSizeUp.setTitle(ibx.resourceMgr.getString("increase"));this.wcPageSizeUp.addEventListener("click",this.doPageSizeUp,this);this.wcPagingBar.add(this.wcPageSizeUp);this.wcPageTop=new WcxButtonSimple(null,wcapplication.imgstr.page_top);this.wcPageTop._element.addClass("wcx-paging-button");this.wcPageTop.setTitle(ibx.resourceMgr.getString("firstpage"));
this.wcPageTop.addEventListener("click",this.doPageTop,this);this.wcPagingBar.add(this.wcPageTop);this.wcPageTop.setEnabled(false);this.wcPagePrevious=new WcxButtonSimple(null,wcapplication.imgstr.page_prev);this.wcPagePrevious._element.addClass("wcx-paging-button");this.wcPagePrevious.setTitle(ibx.resourceMgr.getString("previouspage"));this.wcPagePrevious.addEventListener("click",this.doPagePrevious,this);this.wcPagingBar.add(this.wcPagePrevious);this.wcPagePrevious.setEnabled(false);this.wcPagingLabel=
new WcxLabel(ibx.resourceMgr.getString("page")+" 0/0");this.wcPagingLabel._element.addClass("wcx-paging-label");this.wcPagingBar.add(this.wcPagingLabel);this.wcPageNext=new WcxButtonSimple(null,wcapplication.imgstr.page_next);this.wcPageNext._element.addClass("wcx-paging-button");this.wcPageNext.setTitle(ibx.resourceMgr.getString("nextpage"));this.wcPageNext.addEventListener("click",this.doPageNext,this);this.wcPagingBar.add(this.wcPageNext);this.wcPageNext.setEnabled(false);this.wcPageBottom=new WcxButtonSimple(null,
wcapplication.imgstr.page_bottom);this.wcPageBottom._element.addClass("wcx-paging-button");this.wcPageBottom.setTitle(ibx.resourceMgr.getString("lastpage"));this.wcPageBottom.addEventListener("click",this.doPageBottom,this);this.wcPagingBar.add(this.wcPageBottom);this.wcPageBottom.setEnabled(false);this.setVisible(false);this.update(pagingObj,dataObj)}_p=wcInherit(WcPagingToolbar,WcxComponent);
_p.update=function(pagingObj,dataObj){this.wcPagingObj=pagingObj;this.wcDataObj=dataObj;var text=pagingObj.searchvalue;var pagingflags=pagingObj.flags;pagingObj.wcNoPagingSearch=false;if(pagingObj.total==0&&pagingObj.num==1)pagingObj.wcNoPagingSearch=true;pagingObj.wcShowFindBar=false;if(pagingflags&1)pagingObj.wcShowFindBar=true;pagingObj.wcFilteredMode=false;if(pagingflags&2)pagingObj.wcFilteredMode=true;pagingObj.wcHighlightLast=false;if(pagingflags&4)pagingObj.wcHighlightLast=true;pagingObj.wcNotFound=
false;if(pagingflags&8)pagingObj.wcNotFound=true;pagingObj.wcNotFoundNext=false;if(pagingflags&16)pagingObj.wcNotFoundNext=true;pagingObj.wcSelectedOnTop=false;if(pagingflags&32)pagingObj.wcSelectedOnTop=true;pagingObj.wcFilterDisabled=false;if(pagingflags&64)pagingObj.wcFilterDisabled=true;pagingObj.wcUserSetPageSize=false;if(pagingflags&128)pagingObj.wcUserSetPageSize=true;pagingObj.wcCaseSensitive=false;if(pagingflags&256)pagingObj.wcCaseSensitive=true;pagingObj.wcStartsWith=false;if(pagingflags&
512)pagingObj.wcStartsWith=true;pagingObj.wcEndsWith=false;if(pagingflags&1024)pagingObj.wcEndsWith=true;pagingObj.wcMatchedItems=false;if(pagingflags&2048)pagingObj.wcMatchedItems=true;pagingObj.wcAllContentShown=false;if(pagingflags&4096)pagingObj.wcAllContentShown=true;pagingObj.wcSendSearchPref=false;if(pagingflags&8192)pagingObj.wcSendSearchPref=true;pagingObj.wcSearchOptions=pagingObj.option;var pageNum="1";if(pagingObj)pageNum=pagingObj.num;var pageTotal="1";if(pagingObj)pageTotal=pagingObj.total;
var text=ibx.resourceMgr.getString("page")+" "+pageNum+"/"+pageTotal;this.wcPagingLabel.setText(text);this.wcPageTop.setEnabled(parseInt(pageNum)>1);this.wcPagePrevious.setEnabled(parseInt(pageNum)>1);this.wcPageNext.setEnabled(parseInt(pageNum)<parseInt(pageTotal));this.wcPageBottom.setEnabled(parseInt(pageNum)<parseInt(pageTotal));this.setVisible(pageTotal>1||pagingObj.wcUserSetPageSize)};_p.doPageSizeDown=function(){this.doHttpRequest("PgSizeDwn")};_p.doPageSizeUp=function(){this.doHttpRequest("PgSizeUp")};
_p.doPageTop=function(){this.doHttpRequest("PgTop")};_p.doPagePrevious=function(){this.doHttpRequest("PgPrev")};_p.doPageNext=function(){this.doHttpRequest("PgNext")};_p.doPageBottom=function(){this.doHttpRequest("PgBtm")};_p.doPageSearch=function(pagingSearchText){this.doHttpRequest("PgPattSet",pagingSearchText?pagingSearchText:"")};_p.doPageSearchCancel=function(pagingSearchText){this.doHttpRequest("PgPattDel")};_p.doPageSearchShow=function(pagingSearchText){this.doHttpRequest("PgFindShow")};
_p.doPageSearchHide=function(doCancel){var pageAction="PgFindHide";if(doCancel)pageAction+=".PgPattDel";this.doHttpRequest(pageAction)};
_p.doHttpRequest=function(pagingAction,pagingSearchText){if(!this.wcPagingObj)return;if(!this.wcPagingObj.xlink||this.wcPagingObj.xlink.length<1)return;var xlink=this.wcPagingObj.xlink[0];var xml=new WcLoader(xlink.url);var searchText=pagingSearchText?pagingSearchText:"";var filter=$(this._element).closest(".wcx-wcfilter").data("wcobj");if(filter&&filter.wcSearchbar){searchText=$.trim(filter.wcSearchbar.wcSearchbox.getText());if(searchText=="")searchText=" "}xml.addParam(this.wcPagingObj.actionname,
pagingAction);if(searchText!="")xml.addParam(this.wcPagingObj.searchname,searchText);if(!xlink.http_target){xml.addParam(xlink.parameters);var dataObj=this.wcDataObj;if(dataObj){var params=dataObj.getParams();xml.replaceParam(params)}var contentpage=$(this._element).closest("div[contentpage='y']").data("wcobj");xml.load(wcxParseXml,contentpage)}else{xlink.getOtherParams=function(){return xml.getAllParams()};wcSubmitLink(xlink)}};
function WcCalculator(item){if(_wcconstructing)return;WcxComponent.call(this,"wcCalculator");this._element.wcCalculator()}_p=wcInherit(WcCalculator,WcxComponent);_p.show=function(){this._element.ibxWidget("open")};
function WcRichEditor(item){if(_wcconstructing)return;WcxVBox.call(this);this._element.addClass("wcx-texteditor");this.setName(item.name);if(item.rows>0){this._element.height(item.rows*25);this._element.css("position","relative")}this.editor=new WcxRichEdit(item.value);this.editor._element.addClass("wcx-texteditor-content");this.editor._element.css("border","1px solid #eeeeee");this.add(this.editor)}_p=wcInherit(WcRichEditor,WcxVBox);
_p.getParams=function(){var name=this.getName();var value=this.editor.getText();if(name==null||name=="")return null;var p=new Object;p[name]=[value];return p};
function WcBreadCrumb(item){if(_wcconstructing)return;WcxHBox.call(this);this._element.addClass("wcx-breadcrumb");if(!item.trail)return;var folders=item.separator?item.trail.split(item.separator):item.trail;var breadcrumb=[];for(var i=0;i<folders.length;i++){var folderObj={"contextmenu":i!=0,"text":folders[i]};var value="";for(var j=1;j<=i;j++)if(value!="")value+=item.separator+folders[j];else value=folders[j];folderObj.value=value;if(item.separator_xlink){var xlink=JSON.parse(JSON.stringify(item.separator_xlink.xlink));
wcAddParameter(xlink,item.separator_xlink.parameter,value);folderObj.siblingXlink=xlink}if(item.text_xlink){var xlink=JSON.parse(JSON.stringify(item.text_xlink.xlink));wcAddParameter(xlink,item.text_xlink.parameter,value);folderObj.textXlink=xlink}breadcrumb.push(folderObj)}this.add(new WcBreadCrumbBar(breadcrumb))}_p=wcInherit(WcBreadCrumb,WcxHBox);
function WcBreadCrumbBar(breadcrumbs){if(_wcconstructing)return;WcxHBox.call(this);this._element.addClass("wcx-breadcrumb-bar");$(this._element).attr("tabindex",0);this.addEventListener("focus",this.doFocus,this);this.addEventListener("keydown",this.doKeyDown,this);this.wcBreadCrumbs=breadcrumbs;this.doUpdate(breadcrumbs)}_p=wcInherit(WcBreadCrumbBar,WcxHBox);
_p.doUpdate=function(breadcrumbs){this.removeAll();this.wcLastObj=null;var contextmenu=false;var node=null;if(breadcrumbs&&breadcrumbs.length>0){this.wcBreadCrumbs=breadcrumbs;for(var i=0;i<breadcrumbs.length;i++){var bc=breadcrumbs[i];var text=bc.text;if(!text)text=bc;contextmenu=bc.contextmenu;var obj=bc.obj;if(obj)node=obj.data("wcobj");if(i>0){var chevron=new WcxLabel("",false,"ds-icon-chevron-right");chevron._element.addClass("wcx-breadcrumb-item");$(chevron._element).attr("tabindex","-1");chevron._element.addClass("wcx-breadcrumb-separator");
chevron.wcText=text;chevron.wcBCB=this;if(bc.siblingXlink)chevron.wcSiblingXlink=bc.siblingXlink;else chevron.wcSiblings=bc.siblings;chevron.addEventListener("click",this.doChevronClick,chevron);this.add(chevron)}var label=new WcxLabel(text);label._element.addClass("wcx-breadcrumb-item");$(label._element).attr("tabindex","-1");this.add(label);label.wcObj=obj;label.wcIndex=i;label.wcBC=this;if(bc.textXlink)wcAttachLinksTo(label,[bc.textXlink]);else label.addEventListener("click",this.doClick,label);
this.wcLastObj=obj}}var result={};result.node=node;result.contextmenu=contextmenu;return result};_p.doChevronClick=function(evt){var bcb=this.wcBCB;bcb.wcChevron=this;if(this.wcSiblingXlink)bcb.doChevronMenuXlink(evt);else bcb.doChevronMenu()};
_p.doChevronMenuXlink=function(evt){var chevron=this.wcChevron;if(chevron){var xlink=chevron.wcSiblingXlink;var req=new WcLoader(xlink.url);req.addParam(xlink.parameters);req.setAsync(false);req.load(function(rsp,target){if(!rsp.data)return;var items=rsp.data.item;if(items.length>0){var item=items[0];if(item&&item.node&&item.type=="wctree")for(var j=0;j<item.node.length;j++)if(item.node[j].id=="folders"){var nodes=item.node[j].node;var menu=new WcxMenu;for(var k=0;k<nodes.length;k++)if(nodes[k].label){var menuitem=
new WcxMenuItem(nodes[k].label.text);menuitem.setHighlighted(nodes[k].label.text==chevron.wcText);if(nodes[k].label.xlink&&nodes[k].label.xlink.length>0){nodes[k].label.xlink[0].jqobj=$(target);wcAttachLinksTo(menuitem,[nodes[k].label.xlink[0]])}menu.addItem(menuitem)}menu.open(target)}}},evt.currentTarget)}};
_p.doChevronMenu=function(){var chevron=this.wcChevron;var menu=new WcxMenu;for(var i=0;i<chevron.wcSiblings.length;i++){var sibling=chevron.wcSiblings[i];var menuitem=new WcxMenuItem(sibling.text);menuitem.wcObj=sibling.obj;menuitem.setHighlighted(sibling.text==chevron.wcText);menuitem.addEventListener("click",this.doClick,menuitem);menu.addItem(menuitem)}menu.setOption("position",{"my":"left top","at":"left bottom","collision":"flipfit flipfit","of":$(chevron._element)});menu.open()};
_p.doClick=function(evt){if(this.wcObj)this.wcObj.trigger("wcselect")};_p.doFocus=function(evt){var fromChild=$(evt.relatedTarget).hasClass("wcx-breadcrumb-item");if(!fromChild){var item=$(evt.currentTarget).find(".wcx-breadcrumb-item")[0];if(item)item.focus()}};
_p.doKeyDown=function(evt){var item=evt.target;var keyCode=evt.keyCode;if(keyCode==13||keyCode==32)$(item).click();else if(keyCode==37||keyCode==38){var prev=$(item).prev(".wcx-breadcrumb-item");if(prev.length<=0)prev=$(item).siblings().last();prev.focus();evt.preventDefault();evt.stopPropagation()}else if(keyCode==39||keyCode==40){var next=$(item).next(".wcx-breadcrumb-item");if(next.length<=0)next=$(item).siblings().first();next.focus();evt.preventDefault();evt.stopPropagation()}};
_p.doLastObj=function(evt){if(this.wcLastObj)this.wcLastObj.trigger("wcselect")};
function WcButtonBar(obj){if(_wcconstructing)return;WcxHBox.call(this);this._element.addClass("wcx-buttonbar");this.left=new WcxHBox;this.left._element.addClass("wcx-buttonbar-left");this.add(this.left);this.right=new WcxHBox;this.right._element.addClass("wcx-buttonbar-right");this.add(this.right);if(!obj)return;var rows=obj.row;if(rows==null||rows.length==0)return;var items=rows[0].item;if(items==null||items.length==0)return;var wcitem;for(var i=0;i<items.length;++i){var primary=false;var item=items[i];
item._objtype=item.type;wcitem=wcBuild(item);if(wcitem instanceof WcButton)if(wcitem.highlighted){wcitem._element.addClass("common-btn btn-solid");primary=true}else wcitem._element.addClass("common-btn btn-ghost");if(typeof item.position==="undefined"&&!(wcitem instanceof WcTextOnly)||item.position==="right")if(!primary)this.right.prepend(wcitem);else this.right.add(wcitem);else{if(wcitem instanceof WcTextOnly)wcitem._element.addClass("common-btn btn-link").attr("tabindex","0").attr("role","link");
this.left.add(wcitem)}if(!wcitem._element.hasClass("btn-active"))wcitem._element.addClass("btn-default")}if(this.right.getChildren().length==1&&this.right.getChildren()[0]instanceof WcButton)this.right.getChildren()[0]._element.removeClass("ds-btn-ghost").addClass("ds-btn");this._element.ready(function(){$(this._element).trigger("buttonbarready")}.bind(this))}_p=wcInherit(WcButtonBar,WcxHBox);
function WcMultiItem(obj){if(_wcconstructing)return;WcxHBox.call(this);this._element.addClass("wcx-multiitem");if(obj.size)this._element.css("min-width",obj.size).css("max-width",obj.size);if(obj.border)this._element.addClass("wcx-border");if(obj.bordercolor)this._element.css("border-color",obj.bordercolor);if(obj.backcolor)this._element.css("background-color",obj.backcolor);this._element.ready(function(){var parent=$(this._element).parent();if(parent.hasClass("wcx-grid-body-row-cell"))parent.addClass("wcx-contain-multiitem");
this._element.on("click",function(e){if(this.wcDefaultElement){$(this.wcDefaultElement).click();console.debug("this.wcDefaultElement:",this.wcDefaultElement)}}.bind(this))}.bind(this));if(!obj.item)return;var allbuttons=true;var wcitem;for(var i=0;i<obj.item.length;++i){if(obj.item[i].type!="wcbutton")allbuttons=false;wcitem=wcBuild(obj.item[i]);if(obj.item[i].flexiblesize)wcitem._element.css("flex-grow","1");else wcitem._element.css("flex-shrink","0");this.add(wcitem)}if(allbuttons)this._element.addClass("wcx-multiitem-allbuttons")}
_p=wcInherit(WcMultiItem,WcxHBox);
function WcButtonPane(obj){if(_wcconstructing)return;WcxVBox.call(this);this._element.addClass("wcx-buttonpane").attr("tabindex","0");this._element.on("focus",this.doFocus);this._element.on("keyup",this.doKeyUp);var bar;var btns=wcGetTopButtons(obj);if(btns){bar=new WcToolBar(this);if(obj.toolbarstyle==1)bar.addStyle();bar.addButtons(btns);this.add(bar)}if(!obj.button||!obj.button.item)return;var container=$("<div></div>").addClass("wcx-buttonpane-buttons").appendTo(this._element);if(obj.wrap)container.addClass("wcx-wrap");
for(var i=0;i<obj.button.item.length;++i){var wcitem=wcBuild(obj.button.item[i]);wcitem._element.attr("tabindex","-1");wcitem.setIconPosition("top");if(obj.flags&1)container.addClass("wcx-large-button");else{container.addClass("ds-btn-grp");wcitem._element.addClass("common-btn btn-ghost btn-default ds-btn-lg")}container.append(wcitem._element)}}_p=wcInherit(WcButtonPane,WcxVBox);
_p.doFocus=function(evt){var btns=$(this).find(".ibx-button");if(btns&&btns.length>0)setTimeout(function(){btns[0].focus()},0)};_p.doKeyUp=function(evt){var handled=false;var key=evt.keyCode;if(key==37||key==38){$(document.activeElement).prev(".ibx-button").focus();handled=true}else if(key==39||key==40){$(document.activeElement).next(".ibx-button").focus();handled=true}if(handled){evt.stopPropagation();evt.preventDefault()}};
function wcGetXlinkHideGID(itm){var gid=[];if(itm.type==="wcselect"){if(itm.option)for(var i=0;i<itm.option.length;++i)if(itm.option[i].selected&&itm.option[i].xlink)for(var j=0;j<itm.option[i].xlink.length;++j)if(itm.option[i].xlink[j].method=="hideshow"&&itm.option[i].xlink[j].grp_hide)gid=gid.concat(itm.option[i].xlink[j].grp_hide)}else if(itm.type==="wcradio"){if(itm.xlink)for(var j=0;j<itm.xlink.length;++j)if(itm.xlink[j].method=="hideshow"&&itm.checked&&itm.xlink[j].grp_hide)gid=gid.concat(itm.xlink[j].grp_hide)}else if(itm.type===
"wccheckbox")if(itm.xlink)for(var j=0;j<itm.xlink.length;++j)if(itm.xlink[j].method=="hideshow")if(itm.checked){if(itm.xlink[j].grp_hide)gid=gid.concat(itm.xlink[j].grp_hide)}else if(itm.xlink[j].grp_show)gid=gid.concat(itm.xlink[j].grp_show);return gid}
function WcTextEditor(item){if(_wcconstructing)return;WcxVBox.call(this);this._element.addClass("wcx-texteditor");if(item.rows>0){this._element.height(item.rows*25);this._element.css("position","relative")}var bar;var btns=wcGetTopButtons(item);var editor_obj=this;editor_obj.diff_infobuf=item.diffkind;if(editor_obj.diff_infobuf.length>0){editor_obj.diff_info=JSON.parse(editor_obj.diff_infobuf);editor_obj.diffkind=editor_obj.diff_info["diff_kind"]}else editor_obj.diffkind="";editor_obj.diffmode=editor_obj.diffkind!==
""?true:false;if(editor_obj.diffkind==="merge")bar=new WcToolBarExtended(this);else bar=new WcToolBar(this);bar._isXML=false;if(btns)bar.addButtons(btns);if(item.toolbarstyle==1)bar.addStyle();this.add(bar);this.filetype=item.filetype;editor_obj.merge_btn_id="text_ed_merge_save_right";editor_obj.diffvalueright=item.diff_value_right;if(editor_obj.diffmode===true){var diff_names_hbox=new WcxHBox;$(diff_names_hbox._element).addClass("wcx-texteditor-diff-fnbox");$(diff_names_hbox._element).appendTo(this._element);
var diff_names_left_hbox=new WcxHBox;$(diff_names_left_hbox._element).addClass("wcx-texteditor-diff-fn-left");diff_names_left_hbox._element.ibxLabel({"text":editor_obj.diff_info["lname"]});$(diff_names_left_hbox._element).appendTo(diff_names_hbox._element);var diff_names_right_hbox=new WcxHBox;$(diff_names_right_hbox._element).addClass("wcx-texteditor-diff-fn-right");diff_names_right_hbox._element.ibxLabel({"text":editor_obj.diff_info["rname"]});$(diff_names_right_hbox._element).appendTo(diff_names_hbox._element)}if(editor_obj.diffkind===
"merge"){var right_save_btn_pos=0;for(var bi=0;bi<btns.row[0].item.length;bi++)if(btns.row[0].item[bi].name===editor_obj.merge_btn_id){right_save_btn_pos=bi;break}var tb_right=$(editor_obj._element).find(".wcx-toolbar-right");var tb_left_btns=$(editor_obj._element).find(".wcx-toolbar-left").children();var rsave_btn=$(tb_left_btns).eq(right_save_btn_pos).attr("texted_id",editor_obj.merge_btn_id);var rsaveas_btn_hbox=$(rsave_btn).next();var rsaveas_btn=$(rsaveas_btn_hbox).find(".wcx-iconbutton").attr("texted_id",
editor_obj.merge_btn_id+"_as");$(rsave_btn).appendTo(tb_right);$(rsaveas_btn_hbox).appendTo(tb_right)}if(item.readonly||editor_obj.diffmode===true)this.readonly="true";else this.readonly="false";var editor_hbox=new WcxHBox;editor_hbox._element.addClass("wcx-texteditor-content");$(editor_hbox._element).appendTo(this._element);var tstamp_buf="";var log_body_buf="";this.theme=Object.freeze({light:"light",dark:"dark"});this.tstamp="false";this._ace_div_id="wcx-ace-editor-"+this._id;var ace_div=$("<div></div>");
$(ace_div).appendTo(editor_hbox._element);$(ace_div).attr("id",this._ace_div_id);if(item.border){$(ace_div).addClass("wcx-ace-editor");$(ace_div).addClass("wcx-border")}$(ace_div).css("visibility","hidden");if(this.tstamp==="true"){$(ace_div).attr("style","width: calc(75% - 15px);");this.log_body_buf=log_body_buf;this.tstamp_buf=tstamp_buf}this.aceEdDiv=ace_div;this._hbox_el=editor_hbox._element;editor_obj.custfoldstr={TABLE:[false,null],SQL:[false,null],DEFINE:[false,null]};var wcCustFoldOffCB=function(){for(var key in editor_obj.custfoldstr){var cmd=
editor_obj.custfoldstr[key];cmd[0]=false}};var wcSet508modeCB=function(mode,readOnly){if(readOnly===true||mode===true){if(readOnly===false){editor_obj.btn508modeOn._element.show();editor_obj.btn508modeOff._element.hide()}var parhbox;if(editor_obj.diffkind==="merge")parhbox=$(editor_obj.btn508modeOn._element).closest(".wcx-ext-toolbar");else parhbox=$(editor_obj.btn508modeOn._element).closest(".wcx-toolbar");var btn_tbitem=$(parhbox).children(".wcx-toolbar-left:first").children('[data-ibx-type="ibxButtonSimple"]:first');
if(btn_tbitem.length===0)btn_tbitem=$(parhbox).children(".wcx-toolbar-right:first").children('[data-ibx-type="ibxButtonSimple"]:visible:first');if(btn_tbitem.length===0)btn_tbitem=$(parhbox).children(".wcx-toolbar-ext:first").children('[data-ibx-type="ibxButtonSimple"]:visible:first');btn_tbitem.focus()}else{if(editor_obj.diffmode===false)editor_obj.aceEdDiv.aceEditor("focus","default");if(readOnly===false){editor_obj.btn508modeOff._element.show();editor_obj.btn508modeOn._element.hide()}}return};
this._element.ready(function(){var aceWidget;var commonProps={filetype:editor_obj.filetype,set508modeCB:wcSet508modeCB,custFoldOffCB:wcCustFoldOffCB};if(editor_obj.diffmode===true){var diffProps=$.extend({},commonProps,{content:item.value,diffkind:editor_obj.diffkind,rightContent:editor_obj.diffvalueright});aceWidget=editor_obj.aceEdDiv.aceEditor({"config":{"showFoldWidgets":false},"props":diffProps})}else{var regProps=$.extend({},commonProps,{content:editor_obj.log_body_buf!==undefined?editor_obj.log_body_buf:
item.value,tstampDiv:editor_obj._ace_tstamp_div,tstampContent:editor_obj.tstamp_buf,topBorder:true});editor_obj.aceEdDiv.aceEditor({"config":{"readOnly":editor_obj.readonly==="true"?true:false,"useAutoCompleteLocalStrs":false},"props":regProps})}ibx.bindElements(aceWidget);var edWid=editor_obj.aceEdDiv.data("ibiAceEditor");if(bar){var btn508modeOn=new wcCreateIconButton({"icon":wcapplication.imgstr.tab_navigate_on,"title":ibx.resourceMgr.getString("tab_navigation_on")});var btn508modeOff=new wcCreateIconButton({"icon":wcapplication.imgstr.tab_navigate_off,
"title":ibx.resourceMgr.getString("tab_navigation_off")});editor_obj.addRightBtn(bar,btn508modeOn);editor_obj.addRightBtn(bar,btn508modeOff);editor_obj.btn508modeOn=btn508modeOn;editor_obj.btn508modeOff=btn508modeOff;btn508modeOff._element.on("click",function(e){edWid.set508mode(true)}.bind(this));btn508modeOn._element.on("click",function(e){edWid.set508mode(false)}.bind(this));editor_obj.btn508modeOn._element.hide();if(editor_obj.readonly==="true")editor_obj.btn508modeOff._element.hide();if(editor_obj.diffmode!==
true)bar.addSearchHandler(function(){edWid.searchBox()});if(editor_obj.diffmode===false){editor_obj.btnSel=new wcCreateIconButton({"icon":wcapplication.imgstr.fold_selections,"title":ibx.resourceMgr.getString("teo_fold")});editor_obj.addRightBtn(bar,editor_obj.btnSel);editor_obj.btnSel._element.on("click",function(e){edWid.toggleFoldSelections()}.bind(this))}if(editor_obj.readonly==="false"){var btnUp=new wcCreateIconButton({"icon":wcapplication.imgstr.uppercase,"title":ibx.resourceMgr.getString("uppercase")});
editor_obj.addRightBtn(bar,btnUp);btnUp._element.on("click",function(e){edWid.caseChange("toUpper")}.bind(this));var btnLow=new wcCreateIconButton({"icon":wcapplication.imgstr.lowercase,"title":ibx.resourceMgr.getString("lowercase")});editor_obj.addRightBtn(bar,btnLow);btnLow._element.on("click",function(e){edWid.caseChange("toLower")}.bind(this));if(edWid.canHaveComments()){var btnCom=new wcCreateIconButton({"icon":wcapplication.imgstr.list,"title":ibx.resourceMgr.getString("comment")});editor_obj.addRightBtn(bar,
btnCom);btnCom._element.on("click",function(e){edWid.commentToggle()}.bind(this))}}if(editor_obj.diffmode===true){var btnPrevDif=new wcCreateIconButton({"icon":wcapplication.imgstr.prevdiff,"title":ibx.resourceMgr.getString("te_diff_prevdiff")});editor_obj.addRightBtn(bar,btnPrevDif);btnPrevDif._element.on("click",function(e){edWid.jumpToDiff("prev")}.bind(this));var btnNextDif=new wcCreateIconButton({"icon":wcapplication.imgstr.nextdiff,"title":ibx.resourceMgr.getString("te_diff_nextdiff")});editor_obj.addRightBtn(bar,
btnNextDif);btnNextDif._element.on("click",function(e){edWid.jumpToDiff("next")}.bind(this))}if(editor_obj.readonly==="false"||editor_obj.diffkind=="merge"){var btnUN=new wcCreateIconButton({"icon":wcapplication.imgstr.undo,"title":ibx.resourceMgr.getString("undo")});editor_obj.addRightBtn(bar,btnUN);btnUN._element.on("click",function(e){edWid.undo()}.bind(this));var btnRE=new wcCreateIconButton({"icon":wcapplication.imgstr.redo,"title":ibx.resourceMgr.getString("redo")});editor_obj.addRightBtn(bar,
btnRE);btnRE._element.on("click",function(e){edWid.redo()}.bind(this))}if(editor_obj.diffmode!==true){var btnSA=new wcCreateIconButton({"icon":wcapplication.imgstr.selectall,"title":ibx.resourceMgr.getString("selectall")});editor_obj.addRightBtn(bar,btnSA);btnSA._element.on("click",function(e){edWid.selectAll()}.bind(this))}var btnOP=new wcCreateIconButton({"icon":wcapplication.imgstr.menu,"title":ibx.resourceMgr.getString("options")});editor_obj.addRightBtn(bar,btnOP);btnOP._element.on("click",function(e){var menu=
new WcxMenu;var mitem=new WcxMenuItem(ibx.resourceMgr.getString("texteditopt")+" ...");mitem.addEventListener("click",function(){editor_obj._showEditorOptions()},this);menu.addItem(mitem);mitem.setIcon(wcapplication.imgstr.check);if(edWid.canHaveCustomFolding()){var customfold=new WcxMenuItem(ibx.resourceMgr.getString("te_custom_folding")+" ...");customfold.addEventListener("click",function(){editor_obj._customFoldingPopup()},this);menu.addItem(customfold);customfold.setIcon(wcapplication.imgstr.check)}menu.open(e)}.bind(this))}if(editor_obj.readonly===
"false"){var settings_str=item.settings||"";if(settings_str.length){this.settings=JSON.parse(settings_str);if(this.settings){edWid.cursorPos("default",this.settings["cursorPos"]);edWid.option(this.settings.opts)}}}if(editor_obj.filetype=="hti"){edWid.option({"mode":"ace/mode/hti","enableLiveAutocompletion":true});edWid.element.on("keyup",function(ev){var kc=ev.keyCode;if(kc==221){var HtiCompletion=ace.require("ace/mode/hti_completions").HtiCompletions;var completer=new HtiCompletion;var editor=edWid.getEditor();
completer.handleRightBracket(editor)}})}});this.setName(item.name)}_p=wcInherit(WcTextEditor,WcxVBox);_p.okToClose=function(){var okToClose=true;var edWid=this.aceEdDiv.data("ibiAceEditor");if(edWid)okToClose=edWid._ace_editor.getSession().getUndoManager().isClean();return okToClose?null:ibx.resourceMgr.getString("notsaved")};_p.setClean=function(){var edWid=this.aceEdDiv.data("ibiAceEditor");if(edWid)edWid._ace_editor.getSession().getUndoManager().bookmark()};
_p.getParams=function(){var p=new Object;var whichEd="default";var edWid=this.aceEdDiv.data("ibiAceEditor");if(this.diffkind==="merge"){var btnWithFocus=document.activeElement;if($(btnWithFocus).attr("texted_id")===this.merge_btn_id||$(btnWithFocus).attr("texted_id")===this.merge_btn_id+"_as")whichEd="right";else whichEd="left";p["CGIP_te_save"]=["merge_save"]}else{var settings={"cursorPos":edWid.cursorPos("default"),"opts":{"showFoldWidgets":edWid.option("showFoldWidgets"),"autoIndenting":edWid.option("autoIndenting"),
"enableBasicAutocompletion":edWid.option("enableBasicAutocompletion"),"enableLiveAutocompletion":edWid.option("enableLiveAutocompletion"),"highlightActiveLine":edWid.option("highlightActiveLine"),"useAutoCompleteLocalStrs":edWid.option("useAutoCompleteLocalStrs"),"showGutter":edWid.option("showGutter"),"theme":edWid.option("theme")}};var settings_str=JSON.stringify(settings);p["CGIP_te_save"]=[settings_str]}this.setClean();p[this.getName()]=[edWid.contentAny(whichEd)];edWid.focus(whichEd);return p};
_p._showEditorOptions=function(){var d=new WcxDialog;d._element.addClass("wcx-mf-dialog");d.setCaption(ibx.resourceMgr.getString("texteditopt"));var edobj=this;var aceEdDiv=edobj.aceEdDiv;var edWid=aceEdDiv.data("ibiAceEditor");var prevOptState={"showFoldWidgets":edWid.option("showFoldWidgets"),"autoIndenting":edWid.option("autoIndenting"),"enableBasicAutocompletion":edWid.option("enableBasicAutocompletion"),"enableLiveAutocompletion":edWid.option("enableLiveAutocompletion"),"useAutoCompleteLocalStrs":edWid.option("useAutoCompleteLocalStrs"),
"highlightActiveLine":edWid.option("highlightActiveLine"),"showGutter":edWid.option("showGutter"),"theme":edWid.option("theme")};d.onClose(function(e,btn){if(btn=="cancel")edWid.option(prevOptState)});var vbox=new WcxVBox;d.addItem(vbox);var checkboxLOCreact=function(){checkboxLOC.setEnabled(checkboxBA.getChecked()||checkboxLA.getChecked())};var checkboxCF=new WcxCheckBoxSimple(false,ibx.resourceMgr.getString("teo_folding"));var checkboxAI=new WcxCheckBoxSimple(true,ibx.resourceMgr.getString("teo_autoindent"));
var checkboxBA=new WcxCheckBoxSimple(false,ibx.resourceMgr.getString("teo_csauto"));var checkboxLA=new WcxCheckBoxSimple(false,ibx.resourceMgr.getString("teo_liveauto"));var checkboxLOC=new WcxCheckBoxSimple(false,ibx.resourceMgr.getString("teo_local_ac_strs"));var checkboxHA=new WcxCheckBoxSimple(false,ibx.resourceMgr.getString("teo_highlight_actline"));var checkboxSL=new WcxCheckBoxSimple(false,ibx.resourceMgr.getString("teo_linenums"));checkboxCF._element.addClass("wc-grid-colsel-hcheckbox");checkboxCF.editor_obj=
this;if(edWid.canHaveFoldWidgets()===false)checkboxCF.setEnabled(false);else{checkboxCF.setChecked(edWid.option("showFoldWidgets"));checkboxCF.addEventListener("click",function(){var checked=checkboxCF.getChecked();edWid.option({"showFoldWidgets":checked})})}vbox.add(checkboxCF);checkboxAI._element.addClass("wc-grid-colsel-hcheckbox");checkboxAI.editor_obj=this;if(this.readonly==="true")checkboxAI.setEnabled(false);else{checkboxAI.setChecked(edWid.option("autoIndenting"));checkboxAI.addEventListener("click",
function(){var checked=checkboxAI.getChecked();edWid.option({autoIndenting:checked})})}vbox.add(checkboxAI);checkboxBA._element.addClass("wc-grid-colsel-hcheckbox");checkboxBA.editor_obj=this;if(this.readonly==="true")checkboxBA.setEnabled(false);else{checkboxBA.setChecked(edWid.option("enableBasicAutocompletion"));checkboxBA.addEventListener("click",function(){var checked=checkboxBA.getChecked();edWid.option({enableBasicAutocompletion:checked});checkboxLOCreact()})}vbox.add(checkboxBA);checkboxLA._element.addClass("wc-grid-colsel-hcheckbox");
checkboxLA.editor_obj=this;if(this.readonly==="true")checkboxLA.setEnabled(false);else{checkboxLA.setChecked(edWid.option("enableLiveAutocompletion"));checkboxLA.addEventListener("click",function(){var checked=checkboxLA.getChecked();edWid.option({enableLiveAutocompletion:checked});checkboxLOCreact()})}vbox.add(checkboxLA);checkboxLOC._element.addClass("wc-grid-colsel-hcheckbox");checkboxLOC.editor_obj=this;checkboxLOCreact();if(this.readonly==="true")checkboxLOC.setEnabled(false);else{checkboxLOC.setChecked(edWid.option("useAutoCompleteLocalStrs"));
checkboxLOC.addEventListener("click",function(){var checked=checkboxLOC.getChecked();edWid.option({useAutoCompleteLocalStrs:checked})})}vbox.add(checkboxLOC);checkboxHA._element.addClass("wc-grid-colsel-hcheckbox");checkboxHA.editor_obj=this;checkboxHA.setChecked(edWid.option("highlightActiveLine"));checkboxHA.addEventListener("click",function(){var checked=checkboxHA.getChecked();edWid.option({highlightActiveLine:checked})});vbox.add(checkboxHA);checkboxSL._element.addClass("wc-grid-colsel-hcheckbox");
checkboxSL.editor_obj=this;var guttershow=edWid.option("showGutter");checkboxSL.setChecked(guttershow);checkboxSL.addEventListener("click",function(){var checked=checkboxSL.getChecked();edWid.option({showGutter:checked})});vbox.add(checkboxSL);var colorThemeTitle=ibx.resourceMgr.getString("teo_theme");var colorThemeLight=ibx.resourceMgr.getString("teo_theme_light");var colorThemeDark=ibx.resourceMgr.getString("teo_theme_dark");var selectGroupColorTheme=new WcxSelect;selectGroupColorTheme.editor_obj=
this;var selectItemL=new WcxSelectItem(colorThemeLight,0);var selectItemD=new WcxSelectItem(colorThemeDark,0);selectGroupColorTheme.addItem(selectItemL,false);selectGroupColorTheme.addItem(selectItemD,false);var theme=edWid.option("theme");if(theme===edobj.theme.light)selectGroupColorTheme.addItem(selectItemL,true);else selectGroupColorTheme.addItem(selectItemD,true);selectGroupColorTheme.addClosePopupEventListener(function(){var val=selectGroupColorTheme.getText();if(val===colorThemeLight)edWid.option({"theme":edobj.theme.light});
else if(val===colorThemeDark)edWid.option({"theme":edobj.theme.dark})});var select_group_row=$("<div></div>").addClass("wcx-checkbox").append(selectGroupColorTheme._element).appendTo(vbox._element);var SG_title=$("<div>"+colorThemeTitle+"&nbsp;</div>").append(selectGroupColorTheme._element).appendTo(select_group_row);d.show()};
_p._customFoldingPopup=function(){var d=new WcxDialog("std plain","ok");d._element.addClass("wcx-mf-dialog");d.setCaption(ibx.resourceMgr.getString("te_custom_folding"));var edWid=this.aceEdDiv.data("ibiAceEditor");var vbox=new WcxVBox;d.addItem(vbox);var disp_msg1=new WcxLabel(ibx.resourceMgr.getString("te_custfold_msg1"));var disp_msg2=new WcxLabel(ibx.resourceMgr.getString("te_custfold_msg2"));$(disp_msg1._element).appendTo(vbox._element);$(disp_msg2._element).appendTo(vbox._element);var custFoldExcepCB=
function(custfoldstr,line){return custfoldstr["SQL"][0]===true&&line.match("^\\s*SQL\\s+(?!(APT|SET|PING|FMI)\\b).*;")};for(var key in this.custfoldstr){var cmd=this.custfoldstr[key];cmd[1]=null;cmd[1]=new WcxCheckBoxSimple(false,key);cmd[1]._element.addClass("wc-grid-colsel-hcheckbox");cmd[1].editor_obj=this;cmd[1].setChecked(this.custfoldstr[key][0]);cmd[1].addEventListener("click",function(){var checked=this.getChecked();this.editor_obj.custfoldstr[this._element[0].textContent][0]=checked;edWid.customFold(this.editor_obj.custfoldstr,
custFoldExcepCB)});vbox.add(cmd[1])}var hrdiv1=$("<hr></hr>");$(hrdiv1).appendTo(vbox._element);var clearBtn=new WcxButton(ibx.resourceMgr.getString("te_rm_custfold"));clearBtn.editor_obj=this;clearBtn.addEventListener("click",function(){for(var key in this.editor_obj.custfoldstr){var cmd=this.editor_obj.custfoldstr[key];cmd[0]=false;cmd[1].setChecked(cmd[0])}edWid.unfoldAll()});vbox.add(clearBtn);d.show()};
_p.addRightBtn=function(bar,btn){if(this.diffkind==="merge")bar.addExtButton(btn);else bar.addItem(btn,true)};
function WcFilePicker(item,options){if(_wcconstructing)return;WcxHBox.call(this);this._element.addClass("wcx-form-item wcx-filepicker");this._element.addClass("ds-input");this.setName(item.name);this.wcItem=item;var isDirect=item.isdirect?true:false;var fpBox=new WcxHBox;fpBox._element.addClass("wcx-form-item wcx-filepicker-box");if(item.multiline){this.textfield=new WcxTextArea(item.value);this.textfield.setRows(10);this.textfield.setCols(30)}else{this.textfield=new WcxTextField(item.value);this.textfield.setSize(300)}this.textfield.setReadOnly(item.readonly);
if(item.readonly)this._element.addClass("ds-readonly");this.textfield._element.css("margin-right","5px");if(isDirect)this.textfield.setVisible(false);else if(item._issimpleform){var tfi=this.textfield.getInstance();if(tfi){if(tfi._textInput&&tfi._textInput.length>0)item._textInput=tfi._textInput[0];else if(tfi._textArea&&tfi._textArea.length>0)item._textInput=tfi._textArea[0];this.setAriaLabel(item)}}else if(item.title){var aria={accessible:true,label:item.title};this.textfield._element.ibxWidget("option",
"aria",aria)}fpBox.add(this.textfield);var name=item.image;var text=item.text;var btn=text?new WcxButton(text):new WcxButtonSimple;btn.setIcon(name?name:"ds-icon-file");btn.setTitle(item.title);btn._element.addClass("wcx-iconbutton");if(!isDirect)btn._element.css("margin-right","6px");fpBox.add(btn);this.addItems(fpBox,item);var fp=this;btn.addEventListener("click",this.show,this);this.textfield.addEventListener("keyup",this.doKeyUp,this);if(item.trigger)this._element.ready(function(){this.show()}.bind(this))}
_p=wcInherit(WcFilePicker,WcxHBox);_p.getParams=function(){var name=this.getName();var value=this.textfield.getText();if(name==null||name=="")return null;var p=new Object;p[name]=[value];return p};_p.takeFocus=function(){var el=this._element;setTimeout(function(){var input=$(el).find("input");input.focus()},0);return true};_p.addItems=WcTextProto.addItems;_p.setAriaLabel=WcInputTextProto.setAriaLabel;
_p.show=function(){wcapplication.setWcfObject(this);WcFilePicker.fpDialog=new WcFilePickerDialog(this);this.wcFPD=WcFilePicker.fpDialog;WcFilePicker.fpDialog.show()};_p.getObjectByName=function(name){var obj=null;var fpd=WcFilePicker.fpDialog;if(fpd){obj=fpd.fpTable;if(name==this.wcItem.treename)obj=fpd.fpTree;else if(name==this.wcItem.contentname)obj=fpd.fpTable}return obj};
_p.doKeyUp=function(evt){if(evt.keyCode==13){var xlinks=this.wcItem.xlink;if(xlinks&&xlinks.length>0){var xlink=xlinks[0];if(xlink){wcAddParameter(xlink,this.wcItem.name,$.trim(this.textfield.getText()));xlink.jqobj=this._element;wcSubmitLink(xlink)}}}};
function WcFilePickerDialog(fp){if(_wcconstructing)return;WcBaseDialog.call(this);this._element.addClass("wcx-filepicker-dialog");$(this._element).css("width",parseInt(window.innerWidth*.75));this.wcFP=fp;if(fp.wcItem.closelink)this.wcCloseLink=fp.wcItem.closelink;this.onClose(this.doCloseAction,this);var item=fp.wcItem;if(item){this.wcItem=item;var scope=parseInt(item.scope);$(this._element).addClass("wcx-fp-scope-"+scope);var strsel=item.str_sel;var multiline=item.multiline;var shortcut=item.shortcut;
var value="";var text=fp.textfield.getText();if(text&&(scope!=1||multiline))value=multiline?text.split("\n"):text;this.setWindowTitle(item.header);var fpContent=this.createContent();fpContent.addEventListener("mousedown",this.doMouseDown,fpContent);fpContent._element.addClass("wcx-fp-content");var fpTop=new WcxHBox;fpTop._element.addClass("wcx-fp-top");fpContent.add(fpTop);this.fpFolder=new WcxButtonSimple;this.fpFolder.setIcon("folder");this.fpFolder.setSize(18);this.fpFolder.addEventListener("click",
this.doShowHideTree,this);fpTop.add(this.fpFolder);this.fpNewFolder=new WcxButtonSimple;this.fpNewFolder.setIcon("create_new_folder");this.fpNewFolder.setSize(18);this.fpNewFolder.addEventListener("click",this.doNewFolder,this);this.fpNewFolder.setVisible(shortcut);this.fpNewFolder.setEnabled(false);fpTop.add(this.fpNewFolder);this.fpBreadCrumbs=new WcBreadCrumbBar;fpTop.add(this.fpBreadCrumbs);var fpRefresh=new WcxButtonSimple;fpRefresh.setIcon("ds-icon-refresh");fpRefresh.addEventListener("click",
this.doLoadTree,this);fpTop.add(fpRefresh);var fpMiddle=new WcxComponent;fpMiddle._element.addClass("wcx-fp-main");$(fpMiddle._element).css("height",parseInt(window.innerHeight*.4)+"px");fpContent.add(fpMiddle);var fpSplit=new WcxHBox;fpSplit._element.addClass("wcx-fp-split");fpMiddle.add(fpSplit);this.fpLeft=new WcxComponent;this.fpLeft._element.addClass("wcx-fp-left");fpSplit.add(this.fpLeft);this.fpTree=new WcFilePickerPanel(this);this.fpTree.addEventListener("wcclick",this.doFolderSelection,this);
this.fpTree._element.addClass("wcx-fp-tree");this.fpLeft.add(this.fpTree);this.fpRight=new WcxComponent;this.fpRight._element.addClass("wcx-fp-right");fpSplit.add(this.fpRight);this.fpTable=new WcFilePickerPanel(this);this.fpTable.addEventListener("dblclick",this.doDblClick,this);this.fpTable._element.addClass("wcx-fp-table");this.fpRight.add(this.fpTable);var fpTextFields=new WcxVBox;fpTextFields._element.addClass("wcx-fp-textfields");fpContent.add(fpTextFields);var fpFilename=new WcxHBox;fpFilename._element.addClass("wcx-fp-filename");
fpTextFields.add(fpFilename);var fnLabel=new WcxLabel((strsel?strsel:"File Name")+":");fpFilename.add(fnLabel);if(multiline){this.fnTextField=new WcxSelectItemList;this.fnTextField._element.addClass("wcx-fp-multilist");fnLabel._element.css("margin-top","30px");for(var i=0;i<value.length;i++){var text=$.trim(value[i]);var newItem=this.addSelection(text)}this.fnTextField.addEventListener("change",this.doFileChanged,this)}else{this.fnTextField=new WcxTextField(value?value:"");this.fnTextField.setReadOnly(item.readonly)}this.fnTextField.addEventListener("ibx_change",
this.doFileChanged,this);this.fnTextField.addEventListener("keyup",this.doFileChanged,this);fpFilename.add(this.fnTextField);if(scope==1&&!multiline){var fpExtension=new WcxHBox;fpExtension._element.addClass("wcx-fp-extension");fpTextFields.add(fpExtension);var extLabel=new WcxLabel(ibx.resourceMgr.getString("ext")+":");fpExtension.add(extLabel);this.extTextField=new WcxTextField(item.ext);this.extTextField.setReadOnly(item.extdisabled);fpExtension.add(this.extTextField)}var fpBottom=new WcxVBox;
fpBottom._element.addClass("wcx-fp-bottom");fpContent.add(fpBottom);var fpButtonBar=new WcxHBox;fpButtonBar._element.addClass("wcx-fp-buttonbar");fpBottom.add(fpButtonBar);var fpSpacing=new WcxComponent;fpSpacing._element.css("flex","1");fpSpacing._element.css("height","1px");fpButtonBar.add(fpSpacing);var dlg=this.getInstance();var btnOK=dlg.btnOK.ibxWidget("instance").element;$(btnOK).addClass("common-btn btn-solid btn-default");$(btnOK).css("order","1");var btnCancel=dlg.btnCancel.ibxWidget("instance").element;
$(btnCancel).addClass("common-btn btn-ghost btn-default");this.disableOKButton(true);this.wcCurrDir=fp.textfield.getText();this.doLoadTree()}}_p=wcInherit(WcFilePickerDialog,WcBaseDialog);_p.doShowHideTree=function(){var visible=this.fpLeft.getVisible();this.fpLeft.setVisible(!visible);this.fpRight._element.css("margin-left",visible?"5px":"")};_p.doNewFolder=function(){if(this.fpBreadCrumbs.wcLastObj)this.fpBreadCrumbs.wcLastObj.trigger("wcfirstmenuitem")};
_p.doLoadTree=function(){var scope=parseInt(this.wcItem.scope);var multiline=this.wcItem.multiline;var xml=new WcLoader(wcapplication.wcurl);this.wcSys=0;var array=this.wcItem.parameters;for(var i=0;i<array.length;i++){var p=array[i];xml.replaceParam(p.name,p.value);if(p.name=="FNAME")this.wcFile=p.value;if(p.name=="FIL_sys_type")this.wcSys=p.value}var initDir=this.wcCurrDir;if(initDir){var lastChar=initDir.substr(initDir.length-1);if(lastChar=="/"||lastChar=="\\")initDir=initDir.slice(0,-1);xml.replaceParam("FIL_initdir",
initDir)}else xml.replaceParam("FIL_initdir","");if(!multiline)if(this.wcSys>=16){this.fnTextField.setReadOnly(true);if(scope==1)this.extTextField.setReadOnly(true)}this.fpTree.wcFPD=this;xml.load(this.doLoadTreeCallback,this.fpTree);this.fpBreadCrumbs.doUpdate([]);$(this.fpLeft._element).resizable({handles:"e",minWidth:100,stop:this.doResizableStop.bind(this)});var resizable=$(this.fpLeft._element).children(".ui-resizable-handle");$(resizable).addClass("left-splitter");$(resizable).on("mouseover",
this.doResizableMouseOver)};_p.doLoadTreeCallback=function(xml,page){wcxParseXml(xml,page)};
_p.doFolderSelection=function(e,param){var breadcrumbs=param.breadcrumb;var scope=parseInt(this.wcItem.scope);var multiline=this.wcItem.multiline;var result=this.fpBreadCrumbs.doUpdate(breadcrumbs);var node=result.node;if(node){this.wcNode=node;var origAppDir,fname;if(node.properties)for(var i=0;i<node.properties.length;i++){var prop=node.properties[i];if(prop.name=="APPDIR")origAppDir=prop.value;if(prop.name=="FNAME")fname=prop.value}else origAppDir=node.appdir;var appdir=origAppDir;this.wcCurrDir=
appdir;var slash="/";if(appdir){if(appdir.indexOf("\\")>=0)slash="\\";appdir=$.trim(appdir+(appdir==slash?"":slash))}if(!appdir||appdir==slash)this.fpTable.removeAll();this.fnTextField.wcAppDir=appdir?appdir:"";this.fnTextField.wcFName=fname?fname:"";if(multiline){if(scope!=1){appdir=origAppDir;if(appdir&&appdir!=slash){var newItem=this.addSelection(appdir);if(newItem)newItem._element[0].scrollIntoView(false)}}}else if(scope!=1){appdir=origAppDir;this.fnTextField.setText(appdir&&appdir!=slash?appdir:
"")}else if(this.wcFile)this.fnTextField.setText(this.wcFile);var contextmenu=result.contextmenu;this.fpNewFolder.setEnabled(contextmenu)}this.doFileChanged()};
_p.doFileSelection=function(selection){var item=this.wcItem;var scope=parseInt(item.scope);if(scope==3)return;var value=item.multiline?[]:"";var ext="";var appdir=this.fnTextField.wcAppDir;for(var i=0;i<selection.length;i++){var filename=$.trim(selection[i]);var fullname=appdir+filename;if(item.multiline)value.push(fullname);else if(scope==1){value=filename;break}else{value=fullname;break}}if(value)if(item.multiline){var newItem;for(var j=0;j<value.length;j++)newItem=this.addSelection(value[j]);if(newItem)newItem._element[0].scrollIntoView(false)}else{if(scope==
1){if(value.indexOf(".")>=0)ext=value.substr(value.lastIndexOf(".")+1);value=value.replace(/\.[^/.]+$/,"")}this.fnTextField.setText(value)}if(ext)this.extTextField.setText(ext);this.doFileChanged()};
_p.addSelection=function(newValue){newValue=$.trim(newValue);if(!newValue)return false;var exists=false;var itemClass="wcx-fp-multilist-item";var items=this.fnTextField._element.find("."+itemClass+" .ibx-label-text");if(items&&items.length>0)for(var i=0;i<items.length;i++){var itm=items[i];var txt=$(itm).text();if(txt==newValue){exists=true;break}}if(!exists){var option={deletable:true};var newItem=new WcxSelectItem(newValue,newValue,option);newItem._element.addClass(itemClass);this.fnTextField.addItem(newItem);
return newItem}return false};_p.doFileChanged=function(){var disable=true;if(this.wcItem.multiline){var itemClass="wcx-fp-multilist-item";var items=this.fnTextField._element.find("."+itemClass);disable=items.length==0}else{var text=this.fnTextField.getText();disable=text?false:true}this.disableOKButton(disable)};_p.doResizableMouseOver=function(evt){$(this).css("cursor","")};
_p.doDblClick=function(evt){var y=evt.pageY-$(evt.currentTarget).offset().top;if(y<53)return;var value=$.trim(this.fnTextField.getText());if(value){this.doOK();this.close()}};
_p.doOK=function(){var scope=parseInt(this.wcItem.scope);var value="";if(this.wcItem.multiline){var itemClass="wcx-fp-multilist-item";var items=this.fnTextField._element.find("."+itemClass+" .ibx-label-text");if(items&&items.length>0)for(var i=0;i<items.length;i++){var itm=items[i];var txt=$(itm).text();value=$.trim(value)+(value?"\n":"")+$.trim(txt)}}else{value=$.trim(this.fnTextField.getText());if(scope==1&&!this.wcItem.multiline)if(value){var fname=this.fnTextField.wcFName;var ext=$.trim(this.extTextField.getText());
if(fname)value=fname.replace(/__FILENAME__/,value+(ext?"."+ext:""));else value+=ext?"."+ext:""}else value=this.fnTextField.wcAppDir}var textfield=this.wcFP.textfield;if(textfield&&textfield.getVisible())textfield.setText(value);var xlinks=this.wcItem.xlink;if(xlinks&&xlinks.length>0){var xlink=xlinks[0];if(xlink){wcAddParameter(xlink,this.wcItem.name,value);xlink.jqobj=this.wcFP._element;wcSubmitLink(xlink)}}};
_p.doCloseAction=function(evt,btn){var dlg=$(evt.target).data("wcobj");if(dlg&&btn=="ok")this.doOK();wcapplication.clrWcfObject(this.wcFP);if(this.wcCloseLink){this.wcCloseLink.jqobj=this._element;wcSubmitLink(this.wcCloseLink)}};_p.doMouseDown=function(e){e.stopPropagation()};_p.doResizableStop=function(){this.doTriggerResize(this.fpTree);this.doTriggerResize(this.fpTable)};
_p.doTriggerResize=function(target){var children=target.getChildren();for(var i=0;i<children.length;i++){var obj=children[i];try{if(obj._element)$(obj._element).trigger("resize")}catch(e){}}};function WcFilePickerPanel(fpd){if(_wcconstructing)return;WcxComponent.call(this,"WcFilePickerPanel");this.wcFPD=fpd}_p=wcInherit(WcFilePickerPanel,WcxComponent);
_p.done=function(){var fpd=this.wcFPD;if(fpd&&fpd.fpTable){var all=fpd.fpTable._element.find(".wcx-wctable");for(var i=0;i<all.length;++i){var table=$(all[i]).data("wcobj");if(table)table.setSelected(fpd.doFileSelection.bind(fpd))}}};
function WcMainRibbon(homepage){if(typeof ibxShellTool==="undefined"||!ibxShellTool.getShellTool()){this.wcribbon=new WcRibbon(homepage);return}this.objs=[];window.addEventListener(ibxShellTool.msgGetShellToolResources,function(e){var shellTool=ibxShellTool.getShellTool();if(shellTool.shellUI){e.data.shellUI=shellTool.shellUI;return}wcapplication.shellTool=shellTool;var shellUI=shellTool.shellUI=e.data.shellUI;var url=wcapplication.wcurl.substring(0,wcapplication.wcurl.lastIndexOf("/webconsole"));
shellUI.css="@font-face {\n"+" font-family: 'Information Builders Icons';\n"+" font-style: normal;\n"+" font-weight: normal;\n"+" src:\n"+"  url('"+url+"/iconfont/ibi-icons.woff"+"') format('woff'),\n"+"  url('"+url+"/iconfont/ibi-icons.ttf"+"') format('truetype');\n"+"}\n"+".ibi-icons {\n"+" font: normal normal normal 14px/1 'Information Builders Icons';\n"+" display: inline-block;\n"+" text-transform: none;\n"+" letter-spacing: normal;\n"+" word-wrap: normal;\n"+" white-space: nowrap;\n"+" direction: ltr;\n"+
" opacity:0.6;\n"+" color: rgb(0, 0, 0);\n"+" text-rendering: optimizeLegibility;\n"+" -webkit-font-smoothing: antialiased;\n"+" -moz-osx-font-smoothing: grayscale;\n"+" -webkit-font-feature-settings: 'liga';\n"+" font-variant-ligatures: discretionary-ligatures;\n"+" font-feature-settings: 'liga';\n"+" text-indent: 0px;\n"+"}";if(!shellUI.toolBarRight)shellUI.toolBarRight=$("<div>").ibxHBox().css("align-items","center");shellUI.toolBarRight.append(this._getFrameControl());if(!shellUI.toolBarLeft)shellUI.toolBarLeft=
$("<div>").ibxHBox().css("align-items","center");for(var i=0;i<this.objs.length;++i)this._addButton(this.objs[i],shellUI)}.bind(this))}
WcMainRibbon.prototype._getFrameControl=function(){var button=new wcCreateIconButton({"icon":"ds-icon-layout","title":ibx.resourceMgr.getString("view")});button.viewcontrol=this.viewcontrol;button.addEventListener("click",function(e){e.preventDefault();e.stopPropagation();ibxPopupManager.closeOpenPopups(".ibx-menu");if(!this.mfoptions){var shellTool=ibxShellTool.getShellTool();shellTool.setResContext(true);this.mfoptions=new WcxMenu(true);shellTool.setResContext(false);this.mfoptions._element.on("ibx_beforeopen",
this,function(e){var menuArray=wcBuildFrameControlMenuArray();var shellTool=ibxShellTool.getShellTool();shellTool.setResContext(true);wcMainRibbonBuildMenu(e.data,menuArray);shellTool.setResContext(false)})}this.mfoptions.open(e.currentTarget,e.which==93)},button);return button._element};
WcMainRibbon.prototype._addButton=function(obj,shellUI){obj._objtype=obj.type?obj.type:"wcnode";obj._inribbon=true;var button;button=wcCreateIconButton(obj);button._element.css("border-width","0px");button._element.attr("mainribbon","y");button.setWcId(obj.name?obj.name:obj.id);if(obj.position_right||obj.position=="right"){button.hideText();button.setIconPosition("top");button._element.ibxWidget("option","showMarker",false);if(shellUI.toolBarRight)shellUI.toolBarRight.append(button._element)}else{button.hideText();
if(shellUI.toolBarLeft)shellUI.toolBarLeft.append(button._element)}button._element.on("click",function(e){ibxPopupManager.closeOpenPopups(".ibx-menu")});return button};WcMainRibbon.prototype.addLogo=function(logo,link){if(this.wcribbon)this.wcribbon.addLogo(logo,link)};WcMainRibbon.prototype.addTitle=function(title,header){if(this.wcribbon)this.wcribbon.addTitle(title,header)};
WcMainRibbon.prototype.addButton=function(obj,grouplist){if(obj.location==3){if(wcapplication.toppage&&wcapplication.toppage.mainframe&&wcapplication.toppage.mainframe.contentframe&&wcapplication.toppage.mainframe.contentframe.sidebar)wcapplication.toppage.mainframe.contentframe.sidebar.addButton(obj);return}if(this.wcribbon)return this.wcribbon.addButton(obj,grouplist);if(obj.nodetype=="viewcontrol"){if(!this.viewcontrol)this.viewcontrol=[];this.viewcontrol.push(obj);return null}var shellTool=ibxShellTool.getShellTool();
var shellUI=shellTool.shellUI;if(!shellUI){this.objs.push(obj);return}shellTool.setResContext(true);var button=this._addButton(obj,shellUI);shellTool.setResContext(false);return button};
WcMainRibbon.prototype.removeButton=function(obj){if(obj.location==3){if(wcapplication.toppage&&wcapplication.toppage.mainframe&&wcapplication.toppage.mainframe.contentframe&&wcapplication.toppage.mainframe.contentframe.sidebar)wcapplication.toppage.mainframe.contentframe.sidebar.removeButton(obj);return}if(this.wcribbon)return this.wcribbon.removeButton(obj);var shellTool=ibxShellTool.getShellTool();var shellUI=shellTool.shellUI;if(!shellUI)return;shellTool.setResContext(true);if(obj.position_right||
obj.position=="right"){if(shellUI.toolBarRight)shellUI.toolBarRight.children("div[wcid='"+(obj.name?obj.name:obj.id)+"']").remove()}else if(shellUI.toolBarLeft)shellUI.toolBarLeft.children("div[wcid='"+(obj.name?obj.name:obj.id)+"']").remove();shellTool.setResContext(false)};
WcMainRibbon.prototype.removeAllButtons=function(){if(this.wcribbon){if(wcapplication.toppage&&wcapplication.toppage.mainframe&&wcapplication.toppage.mainframe.contentframe&&wcapplication.toppage.mainframe.contentframe.sidebar)wcapplication.toppage.mainframe.contentframe.sidebar.removeAllButtons();return this.wcribbon.removeAllButtons()}delete this.viewcontrol;var shellTool=ibxShellTool.getShellTool();var shellUI=shellTool.shellUI;if(!shellUI)return;shellTool.setResContext(true);if(shellUI.toolBarLeft)shellUI.toolBarLeft.empty();
if(shellUI.toolBarRight)shellUI.toolBarRight.empty();shellUI.toolBarRight.append(this._getFrameControl());shellTool.setResContext(false)};WcMainRibbon.prototype.setGroups=function(groups){if(this.wcribbon)return this.wcribbon.setGroups(groups);this.groupname=groups;this.groupname.push("unnamed")};WcMainRibbon.prototype.takeFocus=function(){if(this.wcribbon)return this.wcribbon.takeFocus()};WcMainRibbon.prototype.displayIconText=function(display){if(this.wcribbon)return this.wcribbon.displayIconText(display)};
WcMainRibbon.prototype.getWcObject=function(){if(this.wcribbon)return this.wcribbon;return null};
function wcMainRibbonBuildMenu(ribbon,menuArray){var menu=ribbon.mfoptions;menu.removeAllItems();if(ribbon.viewcontrol)for(var i=0;i<ribbon.viewcontrol.length;++i){var item=ribbon.viewcontrol[i];var menuitem=new WcxMenuItem(item.label?item.label.text:"");if(item.image){menuitem.setIcon(item.image.src);menuitem.setIconColor(item.image.color)}if(item.title!="")menuitem.setTitle(item.title);if(item.xlink)wcAttachLinksTo(menuitem,item.xlink);menu.addItem(menuitem)}for(var i=0;i<menuArray.length;i++){var item=
menuArray[i];var menuitem=new WcxMenuItem(item.text);menuitem.wcContentFrame=item.wcContentFrame;menuitem.addEventListener("click",item.click,menuitem.wcContentFrame);menuitem.wcFramesToolbar=item.wcFramesToolbar;menuitem.addEventListener("mouseover",item.mouseover,menuitem);menuitem.addEventListener("mouseout",item.mouseout,menuitem);menu.addItem(menuitem)}}
function WcRibbon(homepage){if(_wcconstructing)return;WcxVBox.call(this);this._element.addClass("wcx-mainribbon-bar");if(homepage)this._element.addClass("homepage");this.buttons=[];this.hasicontext=true;this.groups=[];this.groupname=["unnamed"]}_p=wcInherit(WcRibbon,WcxVBox);_p.takeFocus=function(){var btns=$(this._element).find(".ibx-button-simple:not(.split-menu):not(.ibx-widget-disabled)");if(btns&&btns.length>0)btns[0].focus()};
_p.addLogo=function(logo,xlink){if(this._container){var divider=new WcxHBox;wcapplication.topframe._element.prepend(divider._element.addClass("wcx-mainmenu-bar-top"));this._left._element.prepend($("<div>/</div>").addClass("wcx-webfocus-logo-separator"));var imgdiv=$("<div></div>").attr("qa","logo").addClass("wcx-webfocus-logo-container");var img=$("<img></img>").attr("src",logo).addClass("wcx-webfocus-logo").addClass("wcx-webfocus-logo-tool");imgdiv.append(img);this._left._element.prepend(imgdiv);
if(xlink){var pulldown=new wcCreateIconButton({"icon":"ds-icon-menu","title":ibx.resourceMgr.getString("toolmenu")});pulldown._element.addClass("wcx-webfocus-logo-pulldown");imgdiv.prepend(pulldown._element);xlink.jqobj=pulldown._element;wcAttachLinksTo(pulldown._element,[xlink])}this.displayIconText(false);this._element.removeClass("homepage");var btn=this._element.find(".btn-solid");btn.removeClass("btn-solid").addClass("no-border-style").addClass("btn-toolbar");wcapplication.topframe._element.css("bottom",
"17px");if(wcapplication.statusbar)wcapplication.statusbar._element.show()}};_p.addTitle=function(title,header){if(this._element.hasClass("homepage"))return;if(!this._container)return;this._middle=new WcxVBox;this._middle._element.addClass("wcx-ribbon-middle");this._container.insertAfter(this._middle,this._left);this._middle.add(new WcxLabel(title));if(header)this._middle.add(new WcxLabel(header))};
_p.addButton=function(obj,grouplist){var homepage;if(!this._element.hasClass("homepage"))homepage=false;else homepage=true;if(!this._container){if(!homepage)this._element.height(49);this._container=new WcxHBox;this._container._element.addClass("wcx-ribbon");this.add(this._container);this._left=new WcxHBox;this._left._element.addClass("wcx-ribbon-left");this._right=new WcxHBox;this._right._element.addClass("wcx-ribbon-right");this._container.add(this._left);this._container.add(this._right);var gb=
new WcxHBox;gb._element.addClass("wcx-ribbon-group");this._right.add(gb);var button=new wcCreateIconButton({"text":ibx.resourceMgr.getString("view"),"icon":"ds-icon-layout","title":ibx.resourceMgr.getString("view")},"wcx-ribbon-button");button._element.addClass("wcx-button-pulldown").addClass("control");if(homepage)button._element.addClass("common-btn btn-solid btn-default");else button._element.addClass("common-btn btn-toolbar btn-default no-border-style");button.hideText();gb.add(button);button.group=
gb;button.addEventListener("click",function(e){e.preventDefault();e.stopPropagation();if(!this.mfoptions){this.mfoptions=new WcxMenu(true);this.mfoptions._element.on("ibx_beforeopen",this,function(e){wcMainRibbonBuildMenu(e.data,wcBuildFrameControlMenuArray())})}this.mfoptions.open(e.currentTarget,e.which==93)},this);this.groups.push({"name":"frame-control","groupbox":gb})}if(obj.nodetype=="viewcontrol"){if(!this.viewcontrol)this.viewcontrol=[];this.viewcontrol.push(obj);return}this.numbutton++;obj._objtype=
obj.type?obj.type:"wcnode";var button=wcCreateIconButton(obj,"wcx-ribbon-button");if(button.getHighlighted()||button._element.hasClass("wcx-selected"))button._element.addClass("wcx-highlighted");if(homepage)button._element.addClass("common-btn btn-solid btn-default");else button._element.addClass("common-btn btn-toolbar btn-default no-border-style");button._element.find(".fa-fw").removeClass("fa-fw");obj.wcvbox=button;var g=null;if(grouplist)for(i=0;i<grouplist.length;i++){if(obj.groupid==grouplist[i].id){g=
grouplist[i].name;break}}else g=obj.gname;if(!g)g="unnamed";var i;for(i=0;i<this.groups.length;++i)if(this.groups[i].name==g)break;if(i==this.groups.length){var rb;if(obj.position_right||obj.position=="right")rb=this._right;else{rb=this._left;if(this.numbutton==1&&homepage&&button.getText()=="")button._element.removeClass("btn-default").addClass("btn-gradient")}var j;var gb=new WcxHBox;gb._element.addClass("wcx-ribbon-group");for(j=0;j<this.groupname.length;++j)if(this.groupname[j]==g){this.groups.push({"name":this.groupname[j],
"groupbox":gb});var children=rb.getChildren();var before=null;for(var k=j+1;k<this.groupname.length;++k){for(var l=0;l<children.length;++l)if(children[l].groupname==this.groupname[k]){before=children[l];break}if(before!=null)break}rb.insertBefore(gb,before);break}if(j==this.groupname.length){if(i==0||this.groups[i-1].name!="unnamed")this.groups.push({"name":g,"groupbox":gb});else this.groups.splice(--i,0,{"name":g,"groupbox":gb});rb.add(gb)}gb.groupname=g}this.groups[i].groupbox.add(button);button.group=
this.groups[i].groupbox;if(this.hasicontext)button.showText();else button.hideText();return button};_p.removeButton=function(obj){if(obj._disposed||!obj.wcvbox)return;this.numbutton--;if(!this._disposed&&this._container)obj.wcvbox.group.remove(obj.wcvbox);delete obj.wcvbox};_p.removeAllButtons=function(){this.remove(this._container);delete this._container;this.groups=[];this.numbutton=0;delete this.viewcontrol};
_p.displayIconText=function(display){if(this.hasicontext==display)return;this.hasicontext=display;if(!this._container)return;for(var i=0;i<this.groups.length;++i)for(var j=0;j<this.groups[i].groupbox._children.length;++j){var btn=this.groups[i].groupbox._children[j];if(display)btn.showText();else btn.hideText()}};_p.setGroups=function(groups){this.groupname=groups;this.groupname.push("unnamed")};
function WcSidebar(){if(_wcconstructing)return;WcxVBox.call(this);this.counter=0;this._element.css("display","none");this._element.attr("tabindex","0");this._element.on("focus",this.doFocus)}_p=wcInherit(WcSidebar,WcxVBox);
_p.addButton=function(obj){if(this.counter++==0){this._element.css("width","64px");this._element.css("display","")}if(!this.radiogroup){this.radiogroup=new WcxRadioGroup("mainribbonsidebar");this.add(this.radiogroup)}var button=this.createRibbonRadioButton(obj);button._element.addClass("wcx-sidebar-button");button.setWcId(obj.name?obj.name:obj.id);$("<div></div>").addClass("wcx-sidebar-selector").appendTo(button._element);this.radiogroup.addButton(button);obj.wcbutton=button;return button};
_p.removeButton=function(obj){if(obj._disposed||!obj.wcbutton)return;if(!this._disposed){if(this.radiogroup&&!this.radiogroup._disposed)this.radiogroup._element.ibxWidget("remove",obj._element);delete obj.wcbutton;if(--this.counter==0){this._element.css("width","0px");this._element.css("display","none")}}delete obj.wcbutton};_p.removeAllButtons=function(){if(this.radiogroup)this.radiogroup.removeAll()};
_p.createRibbonRadioButton=function(obj){var button=new WcxRadioButtonSimple(obj.highlight,obj.value);button._element.addClass("ibx-button-group-member");button.setIcon(obj.image&&obj.image.src?obj.image.src:obj.image);wcAttachTooltip(button,obj.tooltip,"right","");button._element.ibxWidget("option","iconPosition","top");button._element.ibxWidget("option","showMarker",false);button._element.attr("tabindex","-1");if(obj.xlink)wcAttachLinksTo(button,obj.xlink);return button};
_p.doFocus=function(evt){var btns=$(this).find(".wcx-sidebar-button");if(btns&&btns.length>0)setTimeout(function(){btns[0].focus()},0)};function WcVToolbar(){if(_wcconstructing)return;WcxVBox.call(this);this.counter=0}_p=wcInherit(WcVToolbar,WcxVBox);_p.addButton=function(obj){if(this.counter++==0)this._element.css("width","48px");var button=wcCreateIconButton(obj,"wcx-vtoolbar-button");button.setIconPosition("top");button.setText("");this.add(button);obj.wcbutton=button;return button};
_p.removeButton=function(obj){if(obj._disposed||!obj.wcbutton)return;if(!this._disposed){this.remove(obj.wcbutton);if(--this.counter==0)this._element.css("width","0px")}delete obj.wcbutton};
function WcGraph(item){if(_wcconstructing)return;WcxWidget.call(this);this._element.addClass("wcx-graph");this.hidehscrollbar=true;var bar=new WcToolBar(this);var btns=wcGetTopButtons(item);if(btns)bar.addButtons(btns);var enableAerialView=item.aerialview;if(enableAerialView){var btn=new wcCreateIconButton({"icon":"ds-icon-show"});$(btn._element).on("click",this.doMiniViewClick.bind(this));bar.addControlButton(btn)}if(item.searchable&&!item.leftright)bar.addSearchHandler(function(e){if(this._graph.searchbox){if(this._graph.searchbox.css("display")==
"none")this._graph.searchbox.css("display","");else this._graph.closeSearchPanel();return}this._graph.openSearchPanel()}.bind(this));this.add(bar);item._graphid=this._id;var graph=new WcFlowGraph(item);this._graph=graph;graph._contentobj=this;this.buildGraph(graph,item);this.add(graph);this.wcMiniView=new WcGraphMiniView(graph);graph.wcMiniView=enableAerialView?this.wcMiniView:null;if(enableAerialView){this.add(this.wcMiniView);var miniViewVisible=enableAerialView&&sessionStorage.getItem("graph,"+
graph.graphid+",miniview,visible")==="true";this.wcMiniView.setVisible(miniViewVisible);if(miniViewVisible)this.wcMiniView.doInitShow()}$(this._element).on("resize",this.doResize.bind(this));wcAddDragDropScroller($(graph._element))}_p=wcInherit(WcGraph,WcxWidget);_p.getParams=function(){return[]};_p.takeFocus=function(){var el=this._element;setTimeout(function(){var graphtop=$(el).find("div.wcx-graph-top");graphtop.focus()},0);return true};
_p.doMiniViewClick=function(){var graph=this._graph;if(graph&&graph.wcMiniView)graph.wcMiniView.doToggleShow()};_p.doResize=function(evt){if(evt.target&&$(evt.target).hasClass("wcx-graph-content"))return;if(evt.target&&$(evt.target).hasClass("wcx-graph-miniview"))return;if(this.wcMiniView&&this.wcMiniView.wcMiniResizing)return;var graph=this._graph;graph.autoSize();graph.draw(true);if(this.wcMiniView)this.wcMiniView.doInitShow()};
_p.buildGraph=function(graph,item){graph.graphid=item.graphid;graph.isLeftRight=item.leftright;graph.isShowStopCursor=item.showstopcursor;graph.isCompact=item.compact;graph.page=item.page;graph.xlinkd=item.xlinkd;if(item.xlink&&item.xlink.length>0){graph.xlinks=[];for(var x=0;x<item.xlink.length;x++)graph.xlinks.push(item.xlink[x])}if(item.caption)graph.caption=item.caption;var subitems=item.item;if(subitems)for(var k=0;k<subitems.length;k++){var si=subitems[k];if(si.type=="wcgnode")this.parseGraphNode(graph,
si);else if(si.type=="wcglink")this.parseGraphLink(graph,si)}};
_p.parseGraphNode=function(graph,node){var item=node.type?node:new wcGNode(node);var img=item.img;if(!img)img=wcapplication.imgstr.mtregseg48;var x=item.x;var y=item.y;var w=item.w;var h=item.h;if(w<0)w=-1;if(h<0)h=-1;var subnodes=item.subnodes;var linkptxml=item.xlinkpt;var dxlinkxml=item.xlinkd&&!item.xlinkd2?item.xlinkd:null;var xlinks=[];var mlink=null;var pitem=null;if(item.xlink)for(var i=0;i<item.xlink.length;i++){var xlink=item.xlink[i];if(xlink.method=="popup")mlink=xlink;else xlinks.push(xlink)}var items=
item.item;var inobj=items&&items.length>0?items[0]:null;var font={img:img,w:graph.isCompact?24:48,h:graph.isCompact?24:48};var iscontainer=subnodes?true:false;var nodeInfo={"html":inobj,"fontimage":font,"collapsed":item.collapsed?true:false,"iscontainer":iscontainer,"draggable":item.draggable?true:false,"leftportname":item.leftportname,"leftportvalue":item.leftportvalue,"leftporttype":item.leftporttype,"leftportstatus":item.leftportstatus,"rightportname":item.rightportname,"rightportvalue":item.rightportvalue,
"rightporttype":item.rightporttype,"rightportstatus":item.rightportstatus,"is_ran":item.is_ran?true:false,"is_target":item.is_target?true:false,"is_key":item.is_key?true:false,"highlight":item.highlight?true:false,"noborder":item.noborder?true:false,"extension":item.extension,"assessment":item.assessment};var nodeItem=graph.addNode(item,x,y,w,h,nodeInfo);if(xlinks.length>0||mlink||dxlinkxml)graph.setAction(nodeItem,xlinks,mlink,dxlinkxml);if(subnodes)for(var i=0;i<subnodes.item.length;i++){var sitem=
subnodes.item[i];var sfont={img:sitem.img,w:graph.isCompact?24:48,h:graph.isCompact?24:48};var subNodeInfo={"fontimage":sfont,"draggable":item.draggable?true:false,"leftportname":item.leftportname,"leftportvalue":item.leftportvalue,"rightportname":item.rightportname,"rightportvalue":item.rightportvalue,"highlight":sitem.highlight?true:false};var snode=nodeItem.addSubNode(sitem.name,subNodeInfo,sitem.caption);var sxlinks=[];if(sitem.xlink&&sitem.xlink.length>0)for(var j=0;j<sitem.xlink.length;j++)if(sitem.xlink[j].method==
"popup")smlink=item.xlink[j];else sxlinks.push(sitem.xlink[j]);if(sxlinks.length>0||smlink||sitem.xlinkd)graph.setAction(snode,sxlinks,smlink,sitem.xlinkd)}};
_p.parseGraphLink=function(graph,node){var item=node.type?node:new wcGLink(node);var xlink=null;var mlink=null;if(item.xlink&&item.xlink.length>0){xlink=item.xlink[0];if(item.xlink.length>1)mlink=item.xlink[1]}if(xlink&&!mlink)mlink=xlink;var link=graph.addLine(graph.getNodeAt(item.sindex),graph.getNodeAt(item.eindex),item.desc,item.tip,graph.isLeftRight?"right":"bottom",graph.isLeftRight?"left":"top",item.linestart,item.lineend,item.linetype,2,item.color?item.color:"");if(xlink)graph.setAction(link,
xlink,mlink,null,item.xlink)};
function WcFlowGraph(item,options){if(_wcconstructing)return;WcxWidget.call(this);this._graphid=item._graphid;this._fitsize=true;this._width=0;this._height=0;this._dots=[];this._pts=[];this._npad=20;this._minnodesize=120;this.hoverColor="rgb(50,7,248)";this.highlightColor="rgb(11,61,191)";this.topZ=3;this.boxGap=2;this.setDragOverEventListener(this.doDragOver.bind(this));this.setDropEventListener(this.doDrop.bind(this));$(this._element).on("scroll",this.doScroll.bind(this));var ele=this._element;
this._tbh=28;ele.addClass("wcx-graph-top");ele.css({"overflow":this._fitsize=="fit"?"hidden":"auto"});ele.attr("tabindex","-1");this.wcCanvas=new WcGraphCanvas(this);ele.append(this.wcCanvas._element);this.wcOverlay=new WcxComponent("wcOverlay");this.wcOverlay._element.css({"position":"absolute","top":"0","left":"0","right":"0","bottom":"0","z-index":"99","background-color":"white","opacity":"0.001"});this.wcOverlay.setVisible(false);this.add(this.wcOverlay);this._element.ready(function(){this.create();
this.init()}.bind(this))}WcFlowGraph.wcZIndexStart=3;WcFlowGraph.wcZIndex_Collapsed=WcFlowGraph.wcZIndexStart;WcFlowGraph.wcZIndex_Collapsed_Highlighted=WcFlowGraph.wcZIndexStart+1;WcFlowGraph.wcZIndex_Expanded=WcFlowGraph.wcZIndexStart+2;WcFlowGraph.wcZIndex_Expanded_Highlighted=WcFlowGraph.wcZIndexStart+3;WcFlowGraph.wcZIndex_Dragged=WcFlowGraph.wcZIndexStart+4;_p=WcFlowGraph.prototype=wcInherit(WcFlowGraph,WcxWidget);
_p.addNode=function(item,x,y,w,h,nodeInfo){if(w<this._minnodesize&&w>=0)w=this._minnodesize;if(h<this._minnodesize&&h>=0)h=this._minnodesize;var nodeItem={"name":item.name,"index":this._dots.length,"x":x,"y":y,"type":"node","text":item.caption,"tip":item.tip,"errmsg":item.errmsg,"warnmsg":item.warnmsg,"ptooltip":item.ptooltip,"w":w,"h":h,"_links":[],"_inlinks":[],"_subnodes":[],"wcNodeInfo":nodeInfo,"droptypes":item.droptypes,"editname":item.editname,"xlinkte":item.xlinkte,"editvalue":item.editvalue,
"editmaxlen":item.maxlength};if(item.xlinkd)nodeItem.xlinkd=item.xlinkd;if(item.xlinkd_label)nodeItem.xlinkd_label=item.xlinkd_label;if(item.xlinkd2)nodeItem.xlinkd2=item.xlinkd2;if(item.xlinkd2_label)nodeItem.xlinkd2_label=item.xlinkd2_label;nodeItem.w0=w;nodeItem.h0=h;this._dots.push(nodeItem);nodeItem._graph=this;nodeItem.addSubNode=function(sname,subNodeInfo,scaption){subNodeInfo.issubnode=true;var snode={"name":sname,"index":this._graph._dots.length,"type":"node","text":scaption,"wcNodeInfo":subNodeInfo,
"_links":[],"container":this};this._graph._dots.push(snode);this._subnodes.push(snode);this.y+=nodeItem.w;this.y0=this.y;if(!this._snum)this._snum=1;else this._snum++;this.h+=nodeItem.hd;return snode};if(nodeItem.wcNodeInfo.iscontainer){var fw=nodeItem.wcNodeInfo.fontimage.w;var fwp=parseInt(nodeItem.wcNodeInfo.fontimage.w)+this._npad;nodeItem.w=fwp;nodeItem.hd=fw;nodeItem.h=item.subnodes.item.length*(fw-15);nodeItem.w0=w;nodeItem.y=0}return nodeItem};
_p.addLine=function(dot1,dot2,text,tip,anchor1,anchor2,linestart,lineend,linetype,linkw,linkstyle){var link={"name":dot1.name+"-"+dot2.name,"index":dot1._links.length,"dot":dot1,"linkdot":dot2,"text":text,"tip":tip,"anchor1":anchor1,"anchor2":anchor2,"linestart":linestart,"lineend":lineend,"linetype":linetype,"options":{"linewidth":linkw,"strokestyle":linkstyle}};dot1._links.push(link);dot2._inlinks.push(link);return link};
_p.create=function(){var graphNode,graphContent,graphIcon;this.useNewFlow=this.isLeftRight&&!this.isCompact;for(var i=0;i<this._dots.length;i++){var dot=this._dots[i];if(dot.wcNodeInfo){var nodeInfo=dot.wcNodeInfo;graphNode=this.useNewFlow?new WcFlowNode(dot,this):new WcGraphNode(dot,this);dot.wcGraphNode=graphNode;this.add(graphNode);dot._element=graphNode;if(nodeInfo.html&&!nodeInfo.iscontainer){graphContent=new WcGraphContent(dot,graphNode);dot.wcGraphContent=graphContent;graphNode.wcGraphContent=
graphContent;graphNode.add(graphContent)}if(nodeInfo.iscontainer){graphNode._element.css({"padding-left":this._npad+"px","padding-right":this._npad+"px","border":"1px solid black"});for(var j=0;j<this._dots.length;j++)if(this._dots[j].container&&this._dots[j].container.index==dot.index){var groupIcon=this._dots[j].wcNodeInfo.fontimage;if(groupIcon){groupIcon._iconClass=this._dots[j].wcNodeInfo.highlight?"wcx-gnode-sel":"wcx-gsnode";var wcGroupIcon=new WcGraphIcon(groupIcon,graphNode);graphNode.add(wcGroupIcon)}}var wcGroupLabel=
new WcGraphLabel(dot.text);graphNode.add(wcGroupLabel)}}}for(var i=0;i<this._dots.length;i++)if(this._dots[i]._links&&this._dots[i]._links.length>0)for(var j=0;j<this._dots[i]._links.length;j++){var link=this._dots[i]._links[j];var graphlink=new WcGraphLink(link);link.wcGraphLink=graphlink;this.add(graphlink);if(link.tip){var graphlinktip=new WcGraphLinkTip(link.tip,10*(i+j));link.wcGraphLinkTip=graphlinktip;this.add(graphlinktip)}}};
_p.init=function(){if(this._initlized||this._initlizing)return;this._initlizing=true;if(!this.wcCanvas._element)return;var thisobj=this;thisobj.rsc=0;$(window).resize(function(e){if(thisobj._initlized&&!thisobj._contentobj._disposed){thisobj.autoSize();thisobj.draw(true);$(".wcx-gnode-content-table-container").each(function(){$(this).ibxWidget("refresh")})}});this._hilightnode=0;for(var i=0;i<this._dots.length;i++){if(this._dots[i].wcNodeInfo.highlight)this._hilightnode=i;if(!this._dots[i].wcNodeInfo.collapsed)this.embedGrid(this._dots[i]);
if(this._dots[i].tip){var graphNode=this._dots[i].wcGraphNode;if(graphNode&&!(graphNode instanceof WcFlowNode))$(graphNode._element).attr("title",this._dots[i].tip)}if(this._dots[i].ptooltip){var pt=new WcPersistentToolTip(this._dots[i].ptooltip,this._element,this._dots[i],"left",null);pt.open();this._pts.push(pt)}if(this._dots[i]._links&&this._dots[i]._links.length>0)for(var j=0;j<this._dots[i]._links.length;j++)if(this._dots[i]._links[j].tip){var link=this._dots[i]._links[j];var graphLinkTip=link.wcGraphLinkTip;
if(graphLinkTip){graphLinkTip.link=link;graphLinkTip.obj=this;graphLinkTip.addEventListener("contextmenu",function(evt){if(this.link._oncontextmenu)this.link._oncontextmenu(evt);evt.stopPropagation();evt.preventDefault()},false)}}}if(this._fitsize)this.autoSize(this._fitsize=="fit");this.draw(true);if(this._fitsize)this.autoSize(this._fitsize=="fit");this.draw(true);if(this.xlinks)for(var x=0;x<this.xlinks.length;x++)this.runLink(this.xlinks[x]);if(this._dots.length>0)this.scrollToNode(this._hilightnode);
var g=this._element;$(g).on("keydown",function(e){if(e.which!=13&&e.which!=38&&e.which!=93&&e.which!=40&&e.which!=39&&e.which!=37)return;e.preventDefault();e.stopPropagation();var node=this._dots[this._hilightnode];if(e.which==13){if(!node)return;if(this._textedit)return;if(node._xlink)for(var i=0;i<node._xlink.length;i++){var xlink=node._xlink[i];var param={};param["DBG_nodeid"]=node.index+1;if(node.x)param["DBG_nodex"]=node.x;if(node.y)param["DBG_nodey"]=node.y;this.runLink(xlink,param)}}else if(e.which==
93){if(!node)return;if(node._oncontextmenu)node._oncontextmenu(null,node.x+node.w/2,node.y+node.h/2)}else if(e.which==39||e.which==37||e.which==38||e.which==40){var cn=this._hilightnode;if(!cn&&cn!=0)cn=0;switch(e.which){case 37:cn=this.left(cn);break;case 38:cn=this.up(cn);break;case 39:cn=this.right(cn);break;case 40:cn=this.down(cn);break}var nextNode=this.getNodeAt(cn+1);if(nextNode&&nextNode.wcGraphNode)nextNode.wcGraphNode.focusNode();this.scrollToNode(cn)}}.bind(this));setTimeout(function(){this.doScroll()}.bind(this));
this._initlized=true;this._initlizing=false};
_p.embedGrid=function(dot){var content=dot.wcGraphContent?dot.wcGraphContent.wcNodeContent:null;if(dot.wcNodeInfo.html){var inobj=wcBuild(dot.wcNodeInfo.html);if(!inobj.jqgrid)return;if(content)content.setResizeEventListener(function(){if(dot.ptobj){dot.ptobj.updDis(dot.wcNodeInfo.collapsed);dot.ptobj.updPos()}},inobj);dot._inobj=inobj;inobj.jqgrid._element.ready(function(){var dot=this;if(dot.w==-1){dot.w=dot._inobj.jqgrid.colwidth.reduce(function(a,b){return a+b},0);if(dot.w<20)dot.w=200;else dot.w+=
24;dot.w0=dot.w;dot._graph.draw(true);dot.fullsize=true}if(dot.fullsize){var param={};var p=dot._graph.xlinkd.parameters;if(p)for(var i=0;i<p.length;i++)param[p[i].name]=p[i].value;param["DBG_update"]="sizes";param["DBG_nodeid"]=dot.index+1;param["DBG_nodew"]=dot.w;param["DBG_nodeh"]=dot.h;dot._graph.runLink(null,param)}}.bind(dot));if(dot.w==-1)content._element.width(200);content._element.append(inobj._element);if(inobj&&inobj.jqgrid&&inobj.jqgrid.rows){var theight=27*(Math.min(200,inobj.jqgrid.rows.length)+
inobj._children.length+1);if(dot.h==-1){dot.h=theight;dot.h0=theight;dot.fullsize=true}}}};
_p.setAction=function(nodeItem,xlinks,mlink,droplink){if(xlinks)nodeItem._xlink=xlinks;if(mlink){var thisobj=this;nodeItem._mlink=mlink;nodeItem._oncontextmenu=function(e,x,y){var link=JSON.parse(JSON.stringify(nodeItem._mlink));if(nodeItem.linkdot){wcAddParameter(link,"DBG_nodeidx1",nodeItem.dot.index+1);wcAddParameter(link,"DBG_nodeidx2",nodeItem.linkdot.index+1)}else if(nodeItem.index>=0)wcAddParameter(link,"DBG_nodeid",nodeItem.index+1);link.jqobj=thisobj._contentobj._element;link.getOtherParams=
function(){var p={};if(this.linkdot){p["DBG_nodeidx1"]=this.dot.index+1;p["DBG_nodeidx2"]=this.linkdot.index+1}else if(this.index>=0)p["DBG_nodeid"]=this.index+1;return p}.bind(nodeItem);wcHandleClick.bind([link])(e);nodeItem._menuopen=true}}if(droplink)nodeItem.xlinkd=droplink};
_p.runLink=function(xlinkxml,inparam){var link;if(xlinkxml)link=xlinkxml;else{link=new Object;link.method="post";link.http_target="TARGET_NONE";link.url=wcapplication.wcurl}if(link.method=="popup")return;var param=inparam?inparam:{};if(!xlinkxml){if(!param["DBG_type"])param["DBG_type"]=this.graphid;if(!param["IBIS_page"])param["IBIS_page"]=this.page}var stats="";var highlight=0;for(var n=0;n<this._dots.length;n++){stats+=this._dots[n].wcNodeInfo.collapsed?"true":"false";if(n!=this._dots.length-1)stats+=
",";if(this._dots[n].wcNodeInfo.highlight)highlight=this._dots[n].index+1}if(stats)param["GRAPH_node_collapseds"]=stats;if(highlight)param["DBG_sel1"]=highlight;for(var p in param)if(p&&param.hasOwnProperty(p))wcAddParameter(link,p,param[p]);link.jqobj=this._contentobj._element;wcSubmitLink(link)};
_p.draw=function(clear){if(clear)this._eraseDot(-1);if(this.caption){var canvas=this.wcCanvas._element;if(canvas&&this._dots.length==0){var context=canvas.getContext("2d");context.save();context.textAlign="left";context.font="16px Arial";context.fillStyle="rgba(50, 50, 50, 0.7)";var words=this.caption.split("\n");var mw=0;for(var n=0;n<words.length;n++){var metrics=context.measureText(words[n]);if(metrics.width>mw)mw=metrics.width}if(mw>canvas.width-80)mw=canvas.width-80;this.wrapText(context,this.caption.replace("\n",
" \n "),(canvas.width-mw)/2,canvas.height/2-20,mw+40,30);context.restore()}}for(var i in this._dots)if(i&&this._dots.hasOwnProperty(i)){var dot=this._dots[i];dot._otext=this._drawDot(dot)}for(var i in this._dots)if(i&&this._dots.hasOwnProperty(i)){var dot=this._dots[i];if(!dot)continue;if(dot._links&&dot._links.length>0)for(var j=0;j<dot._links.length;j++){var link=dot._links[j];this._drawLine(link,dot,link.linkdot,link.hover);var graphlink=link.wcGraphLink;if(graphlink)$(graphlink._element).css({"left":(dot.lx_out+
link.linkdot.lx_in)/2-1,"top":(dot.ly_out+link.linkdot.ly_in)/2-1});if(dot.wcGraphNode.wcExtension){var position;for(var k=0;k<dot.wcGraphNode.wcExtension.length;++k){position=wcGetFlowExtensionPosition(k,dot.lx_out,dot.ly_out,link.linkdot.lx_in,link.linkdot.ly_in);dot.wcGraphNode.wcExtension[k]._element.css({"left":position.x,"top":position.y})}}}else if(dot.wcGraphNode.wcExtension){var position;var x_out=dot.x+dot.w;var y_out=dot.y+dot.h/2;for(var k=0;k<dot.wcGraphNode.wcExtension.length;++k){position=
wcGetFlowExtensionPosition(k,x_out,y_out);dot.wcGraphNode.wcExtension[k]._element.css({"left":position.x,"top":position.y})}var canvas=this.wcCanvas._element;if(canvas){var context=canvas.getContext("2d");context.beginPath();context.moveTo(x_out,y_out);context.lineTo(x_out+26+(dot.wcGraphNode.wcExtension.length-1)*28,y_out);context.stroke()}}}if(this.wcMiniView)this.wcMiniView.doRefresh()};
_p._drawDot=function(dot){if(this.wcOverlay.getVisible())return;var canvas=this.wcCanvas._element;if(!canvas)return;var context=canvas.getContext("2d");context.beginPath();var options=dot.options?dot.options:[];context.font=options.font?options.font:"14px Calibri";context.fillStyle=options.fillstyle?options.fillstyle:"#000000";context.strokeStyle=options.strokestyle?options.strokestyle:"#888888";context.lineWidth=options.linewidth?options.linewidth:1;if(dot.type=="node"){if((dot.wcNodeInfo.html||
dot.wcNodeInfo.fontimage)&&!dot.wcNodeInfo.issubnode){var isDragged=this.wcMoving&&this.wcMoving==dot&&this.wcUnitDragging;var graphNode=dot.wcGraphNode;var graphNodeEl=graphNode._element;var isFlowNode=graphNodeEl.hasClass("ds-flow-node");if(graphNodeEl)$(graphNodeEl).css({"display":"block","left":dot.x+"px","top":dot.y+"px"});var graphContent=dot.wcGraphContent;if(graphContent){var graphContentEl=graphContent._element;var bodyContent=dot.wcGraphContent.wcBodyContent._element;var nodeContent=dot.wcGraphContent.wcNodeContent._element;
var font=dot.wcGraphIcon?dot.wcGraphIcon._element:null;if(dot.wcNodeInfo.iscontainer){if(font)$(font).css({"display":"none"});if(graphNodeEl)$(graphNodeEl).css({"width":dot.w+"px","height":dot.h+"px","border":context.lineWidth+"px dashed "+context.strokeStyle,"z-index":isDragged?WcFlowGraph.wcZIndex_Dragged:dot.ewcNodeInfo.highlight?WcFlowGraph.wcZIndex_Collapsed_Highlighted:WcFlowGraph.wcZIndex_Collapsed})}else if(dot.wcNodeInfo.collapsed){if(font)$(font).css({"display":"block"});if(graphContentEl)$(graphContentEl).css({"display":"none"});
var fw=56;var fh=56;if(!isFlowNode){fw=dot.wcNodeInfo.fontimage.w?parseInt(dot.wcNodeInfo.fontimage.w)+0:dot.w;fh=dot.wcNodeInfo.fontimage.h?parseInt(dot.wcNodeInfo.fontimage.h):dot.h;if(graphNodeEl)$(graphNodeEl).css({"width":fw+"px","height":fh+"px"})}if(graphNodeEl)$(graphNodeEl).css({"z-index":isDragged?WcFlowGraph.wcZIndex_Dragged:dot.wcNodeInfo.highlight?WcFlowGraph.wcZIndex_Collapsed_Highlighted:WcFlowGraph.wcZIndex_Collapsed});dot.w=fw;dot.h=fh}else{if(!this._initlized)dot.wcIsGridEmbedded=
true;if(font)$(font).css({"display":"none"});if(graphContentEl)$(graphContentEl).css({"display":"block","width":dot.w+"px","height":dot.h+"px"});if(bodyContent)$(bodyContent).css({"width":dot.w+"px","height":dot.h-24+"px"});if(graphNodeEl)$(graphNodeEl).css({"z-index":isDragged?WcFlowGraph.wcZIndex_Dragged:dot.wcNodeInfo.highlight?WcFlowGraph.wcZIndex_Expanded_Highlighted:WcFlowGraph.wcZIndex_Expanded});if(dot._inobj)dot._inobj._element.trigger("resize")}}$(graphNode._element).css("opacity","");if(this.wcConnecting){var overNode=
this.wcConnecting_overnode?this.wcConnecting_overnode.wcGraphNode:null;if(overNode)if(overNode==graphNode)$(graphNode._element).css("opacity","0.6")}}}else if(dot.type=="circle"){var radius=radius?radius:this._dotradius?_dotradius:5;context.arc(dot.x,dot.y,radius,0,2*Math.PI,false);context.stroke();if(dot.fill)context.fill()}else if(dot.type=="rect"){context.rect(dot.x,dot.y,dot.w,dot.h);context.stroke();if(dot.fill)context.fill()}if(dot.options){context.font="14px Calibri";context.fillStyle="#000000";
context.strokeStyle="#888888";context.linewidth=1}var otext;if(dot.wcNodeInfo.collapsed&&!dot.wcNodeInfo.issubnode){var text=dot.text;if(typeof text=="function")otext=text(dot.x,dot.y);else otext=text}return dot.text};
_p._drawLine=function(link,dot1,dot2,hover){var text=link.text;var anchor1=link.anchor1;var anchor2=link.anchor2;var linestart=link.linestart;var lineend=link.lineend;var linetype=link.linetype;var options=link.options;var highlight=link.highlight;var radius=this.isCompact?2:4;var x1=dot1.x+1;var y1=dot1.y+2;var x2=dot2.x+1;var y2=dot2.y+2;if(anchor1){if(anchor1=="left")y1+=dot1.h/2;if(anchor1=="right"){x1+=dot1.w;y1+=dot1.h/2}if(anchor1=="top")x1+=dot1.w/2;if(anchor1=="bottom"){x1+=dot1.w/2;y1+=
dot1.h;if(!dot1.wcNodeInfo.collapsed)y1+=2}}if(anchor2){if(anchor2=="left")y2+=dot2.h/2;if(anchor2=="right"){x2+=dot2.w;y2+=dot2.h/2}if(anchor2=="top")x2+=dot2.w/2;if(anchor2=="bottom"){x2+=dot2.w/2;y2+=dot2.h}}if(dot2.wcNodeInfo.iscontainer)x2+=this._npad;if(dot1.wcGraphNode instanceof WcFlowNode){dot1.wcGraphNode.setConnectionClass("right");x1+=2;y1-=2}if(dot2.wcGraphNode instanceof WcFlowNode){dot2.wcGraphNode.setConnectionClass("left");x2-=2;y2-=2}dot1.lx_out=x1;dot1.ly_out=y1;dot2.lx_in=x2;dot2.ly_in=
y2;var canvas=this.wcCanvas._element;if(!canvas)return;var context=canvas.getContext("2d");context.beginPath();var jqGraphLink=link.wcGraphLink?$(link.wcGraphLink._element):null;var usingServerColor=false;if(options){var ss=options.strokestyle;if(this.useNewFlow)if(ss=="#3455db")context.strokeStyle="#cccccc";else if(ss){context.strokeStyle=ss;usingServerColor=true}else context.strokeStyle="#31a3ce";else context.strokeStyle=options.strokestyle?options.strokestyle:"#31a3ce";context.lineWidth=options.linewidth?
options.linewidth:2;context.lineCap=options.linecap?options.linecap:"round"}if(!usingServerColor)if(highlight)context.strokeStyle=this.highlightColor;else if(hover)context.strokeStyle=this.hoverColor;if(linetype=="dashed")context.setLineDash([5,3]);if(hover)context.lineWidth=4;if(jqGraphLink){jqGraphLink.attr("line-color",context.strokeStyle);jqGraphLink.attr("line-width",context.lineWidth)}context.moveTo(x1+(linestart=="circle"?this.isLeftRight?this.boxGap:0:0),y1+(linestart=="circle"?this.isLeftRight?
0:this.boxGap:0));context.lineTo(x2-(lineend=="circle"?this.isLeftRight?this.boxGap:0:0),y2-(lineend=="circle"?this.isLeftRight?0:this.boxGap:0));context.stroke();if(linetype=="dashed")context.setLineDash([]);if(!this.useNewFlow){if(linestart=="circle"){context.fillStyle="#ffffff";context.beginPath();context.arc(x1+(this.isLeftRight?this.boxGap:0),y1+(this.isLeftRight?0:this.boxGap),radius,0,2*Math.PI,false);context.fill();context.stroke();context.fillStyle=options.strokestyle?options.strokestyle:
"#31a3ce";if(highlight)context.fillStyle=this.highlightColor;else if(hover)context.fillStyle=this.hoverColor}if(lineend){var angle=x2==x1?Math.PI:Math.atan((y2-y1)/(x2-x1));if(lineend=="arrow"||lineend=="doublearrow"){context.fillStyle=options.strokestyle?options.strokestyle:"#31a3ce";if(highlight)context.fillStyle=this.highlightColor;else if(hover)context.fillStyle=this.hoverColor;var h=10;var w=4;var r=angle;if(x2>x1)r+=90*Math.PI/180;else if(x2<x1)r-=90*Math.PI/180;else if(y2<y1)r+=Math.PI;context.save();
context.translate(x2,y2);context.rotate(r);context.moveTo(0,0);context.lineTo(w,h);context.lineTo(-w,h);context.fill();context.restore();if(lineend=="doublearrow"){context.save();if(x2>x1)context.translate(x2-h*Math.cos(angle),y2-h*Math.sin(angle));else if(x2<x1)context.translate(x2+h*Math.cos(angle),y2+h*Math.sin(angle));else if(y2<y1)context.translate(x2,y2+h);else context.translate(x2,y2-h);context.rotate(r);context.moveTo(0,0);context.lineTo(w,h);context.lineTo(-w,h);context.fill();context.restore()}context.fillStyle=
"#000000"}else if(lineend=="circle"){context.fillStyle="#ffffff";context.beginPath();context.arc(x2-(this.isLeftRight?this.boxGap:0),y2-(this.isLeftRight?0:this.boxGap),radius,0,2*Math.PI,false);context.fill();context.stroke();context.fillStyle=options.strokestyle?options.strokestyle:"#31a3ce";if(highlight)context.fillStyle=this.highlightColor;else if(hover)context.fillStyle=this.hoverColor}}}if(text)context.fillText(text,(x1+x2)/2+20,(y1+y2)/2+10);if(options||hover||highlight){context.strokeStyle=
"#31a3ce";context.lineWidth=2;context.lineCap="round"}};_p._eraseDot=function(index){var canvas=this.wcCanvas._element;if(!canvas)return;var context=canvas.getContext("2d");if(index<0){context.clearRect(0,0,canvas.width,canvas.height);return}var radius=this._dotradius?this._dotradius:10;var x=this._dots[index].x;var y=this._dots[index].y;var textsize=20;context.clearRect(x-radius-2,y-radius-2,2*radius+4,2*radius+4)};
_p.wrapText=function(context,text,x,y,maxWidth,lineHeight){var words=text.split(" ");var line="";for(var n=0;n<words.length;n++){var testLine=line+words[n]+" ";var metrics=context.measureText(testLine);var testWidth=metrics.width;if(testLine.indexOf("\n")>0){context.fillText(line,x,y);line="";y+=lineHeight}else if(testWidth>maxWidth&&n>0){context.fillText(line,x,y);line=words[n]+" ";y+=lineHeight}else line=testLine}context.fillText(line,x,y)};
_p.autoSize=function(fit){var canvas=this.wcCanvas._element;var parentNode=canvas?canvas.parentNode:null;if(parentNode)if(fit){canvas.width=canvas.offsetWidth;canvas.height=canvas.offsetHeight}else{var cap=this.caption&&this._dots.length==0;var width=cap?parentNode.clientWidth:0;var height=cap?parentNode.clientHeight:0;for(var i=0;i<this._dots.length;i++){var dotw=this._dots[i].wcNodeInfo.collapsed?80:this._dots[i].w;var doth=this._dots[i].wcNodeInfo.collapsed?60:this._dots[i].h;if(this._dots[i]._textheight)doth+=
this._dots[i]._textheight+5;if(this._dots[i].x+dotw>width)width=this._dots[i].x+dotw;if(this._dots[i].y+doth>height)height=this._dots[i].y+doth}if(parentNode.clientWidth>0&&width<parentNode.clientWidth)canvas.width=parentNode.clientWidth;else canvas.width=width;if(height<parentNode.clientHeight)canvas.height=parentNode.clientHeight-5;else canvas.height=height-5}};
_p.doScroll=function(){if(this.wcMiniView){this.wcOverlay.setVisible(false);this.wcMiniView.doRefresh()}var dots=this._dots;for(var i=0;i<dots.length;i++){var dot=dots[i];if(dot.wcGraphContent){dot.wcGraphContent.wcNodeContent._element.css({"height":"","width":""});if(dot._inobj&&dot._inobj._element){dot._inobj._element.css({"height":"","width":""});dot._inobj._element.trigger("resize")}}}};_p.getNodeAt=function(index){if(index<1)return null;return this._dots[index-1]};
_p.getNodeByPosition=function(x,y,expandedOnly){for(var i=this._dots.length-1;i>=0;i--){var node=this._dots[i];var isExpanded=!node.wcNodeInfo.collapsed;if(!expandedOnly||isExpanded)if(this.isNodeInPosition(node,x,y))return node}return null};_p.isNodeInPosition=function(node,x,y){var pp=node.wcNodeInfo.iscontainer?this._npad*2:0;if(x>node.x&&x<node.x+node.w+pp&&y>node.y&&y<node.y+node.h)return true};
_p.getNodeByTextPosition=function(x,y){for(var i=0;i<this._dots.length;i++){var node=this._dots[i];var wd=node._textwidth-node.w;if(node.text&&node.wcNodeInfo.collapsed&&x>node.x-wd/2&&x<node.x+node.w+wd&&y>node.y+node.h&&y<node.y+node.h+node._textheight)return node}return null};
_p.getLinkByPosition=function(x,y){for(var i=0;i<this._dots.length;i++){var node=this._dots[i];if(node._links&&node._links.length>0)for(var j=0;j<node._links.length;j++){var n1=node;var n2=node._links[j].linkdot;var x1=n1.lx_out;var y1=n1.ly_out;var x2=n2.lx_in;var y2=n2.ly_in;var d=9;if(Math.abs(x2-x1)<2&&Math.abs(x-x1)<d&&(y2>y1?y<y2&&y>y1:y>y2&&y<y1)){node._links[j]._dot=n1;return node._links[j]}else{var t=(y2-y1)/(x2-x1);var b=(y2+y1)/2-(y2-y1)*(x1+x2)/((x2-x1)*2);if(Math.abs(y-t*x-b)<d&&(x2>
x1?x<x2&&x>x1:x>x2&&x<x1)){node._links[j]._dot=n1;return node._links[j]}}}}return null};_p.getMousePos=function(evt){if(this.wcCanvas._element){var rect=this.wcCanvas._element.getBoundingClientRect();return{x:evt.clientX-rect.left,y:evt.clientY-rect.top}}};
_p.scrollToNode=function(i){var g=this._element;g.scrollTop(i<0?0:this._dots[i].y-g.height()/2+this._dots[i].h/2);g.scrollLeft(i<0?0:this._dots[i].x-g.width()/2+this._dots[i].w/2);for(var j=0;j<this._dots.length;j++){var dot=this._dots[j];if(!dot._found&&i>=0)continue;var h=dot.wcGraphContent.wcNodeHeader._element;if(i==j)h.css({"background-color":"rgb(164, 164, 164)"});else h.css({"background-color":"rgb(204, 204, 204)"})}this._currentnode=i};
_p.highlightNode=function(index){var hnode=null;for(var i=0;i<this._dots.length;i++){var gItem=this._dots[i];var graphNode=gItem.wcGraphNode;if(gItem.index==index){hnode=gItem;graphNode._element.addClass("wcx-selected");gItem.wcNodeInfo.highlight=true;$(graphNode._element).css("z-index",gItem.wcNodeInfo.collapsed?WcFlowGraph.wcZIndex_Collapsed_Highlighted:WcFlowGraph.wcZIndex_Expanded_Highlighted)}else{graphNode._element.removeClass("wcx-selected");gItem.wcNodeInfo.highlight=false;$(graphNode._element).css("z-index",
gItem.wcNodeInfo.collapsed?WcFlowGraph.wcZIndex_Collapsed:WcFlowGraph.wcZIndex_Expanded)}if(gItem._links.length>0)for(var j=0;j<gItem._links.length;j++){var link=gItem._links[j];link.highlight=false;this._drawLine(link,gItem,link.linkdot,false)}}gItem=hnode;if(gItem){if(gItem._links)for(var j=0;j<gItem._links.length;j++){var link=gItem._links[j];link.highlight=true;this._drawLine(link,gItem,link.linkdot,false)}if(gItem._inlinks)for(var j=0;j<gItem._inlinks.length;j++){var link=gItem._inlinks[j];link.highlight=
true;this._drawLine(link,link.dot,gItem,false)}}this._hilightnode=index;if(this.wcMiniView)this.wcMiniView.doRefresh()};_p.unhighlightAllGroups=function(){for(var i=0;i<this._dots.length;i++){var dot=this._dots[i];var graphContent=dot.wcGraphContent;if(graphContent)graphContent.setHighlighterVisible(false)}if(this._fitsize&&this._fitsize!="fit")this.autoSize();this.draw(true)};
_p.extDrop=function(e){if(e.target==e.srcElement&&e.target.className.indexOf("ibx-grid")!=-1)return;var dt=e.dataTransfer;var rowid=dt.getData("text");if(!rowid)return;var epos=this.getMousePos(e);var params=[];var s=rowid.indexOf("=");if(s>0)params[rowid.substring(0,s)]=rowid.substring(s+1);else params["DBG_text"]=rowid;var node=this.getNodeByPosition(epos.x,epos.y);if(node){node._extdrop=true;if(node.wcNodeInfo.collapsed||s<0){params["DBG_nodeid"]=node.index+1;this.runLink(this.xlinkd,params)}}else if(this.xlinkd){params["DBG_nodex"]=
epos.x;params["DBG_nodey"]=epos.y;this.runLink(this.xlinkd,params)}};
_p.doDragOver=function(evt){this.wcExternalDragging=true;this.wcMoving=false;this.wcUnitDragging=false;var e=evt.originalEvent;var dt=e.dataTransfer;var dragtype=dt.getData("dragtype");var arrDragTypes=dragtype?dragtype.split(","):[];var epos=this.getMousePos(evt);var node=this.getNodeByPosition(epos.x,epos.y);var allowDrop=true;if(this.isShowStopCursor)if(node)if(!node.xlinkd)allowDrop=false;else{if(node.droptypes){allowDrop=false;var arrDropTypes=node.droptypes.split(",");for(var iDrop=0;iDrop<
arrDropTypes.length;iDrop++){for(var iDrag=0;iDrag<arrDragTypes.length;iDrag++){var strDropType=arrDropTypes[iDrop];var strDragType=arrDragTypes[iDrag];if(strDropType==strDragType){allowDrop=true;break}}if(allowDrop)break}}}else if(!this.xlinkd)allowDrop=false;if(allowDrop){dt.dropEffect="copy";evt.preventDefault()}};_p.doDrop=function(evt){this.extDrop(evt.originalEvent)};
_p.right=function(cn){var v=Number.MAX_VALUE;var n;for(var i=0;i<this._dots.length;i++){if(i==cn)continue;if(this._dots[i].x<v&&(cn<0||this._dots[i].x>this._dots[cn].x)){v=this._dots[i].x;n=i}}if(v==Number.MAX_VALUE)n=this.right(-1);return n};_p.down=function(cn){var v=Number.MAX_VALUE;var n;for(var i=0;i<this._dots.length;i++){if(i==cn)continue;if(this._dots[i].y<v&&(cn<0||this._dots[i].y>this._dots[cn].y)){v=this._dots[i].y;n=i}}if(v==Number.MAX_VALUE)n=this.down(-1);return n};
_p.left=function(cn){var v=-1;var n;for(var i=0;i<this._dots.length;i++){if(i==cn)continue;if(this._dots[i].x>v&&(cn<0||this._dots[i].x<this._dots[cn].x)){v=this._dots[i].x;n=i}}if(v==-1)n=this.left(-1);return n};_p.up=function(cn){var v=-1;var n;for(var i=0;i<this._dots.length;i++){if(i==cn)continue;if(this._dots[i].y>v&&(cn<0||this._dots[i].y<this._dots[cn].y)){v=this._dots[i].y;n=i}}if(v==-1)n=this.up(-1);return n};
_p.openSearchPanel=function(text){if(this.searchbox)return;this.expandAll();this.searchbox=$("<div></div>").addClass("wcx-grid-searchbox").css({"z-index":"5","top":"30px"}).appendTo(this._contentobj._element);this.searchbox.input=$("<input type='text'></input>").attr("qa","searchinput").val(text?text:this.searchstr?this.searchstr:"").attr("placeholder",ibx.resourceMgr.getString("search")).appendTo(this.searchbox).focus();this._resizeSearchBox();this.searchbox.input.keyup(function(e){if(this.searchbox.timerid){clearTimeout(this.searchbox.timerid);
delete this.searchbox.timerid}if(e.keyCode==$.ui.keyCode.ENTER)this.search(this.searchbox.input.val());else this.searchbox.timerid=setTimeout(function(graph){delete graph.searchbox.timerid;graph.search(graph.searchbox.input.val())},400,this)}.bind(this));var button=new WcxButtonSimple(null,wcapplication.imgstr.search_next);button._element.addClass("wcx-grid-searchbox-button").css("margin-right","0px");button.setTitle(ibx.resourceMgr.getString("next"));button._element.on("click",function(){var i=this._currentnode;
if(i<0)return;if(i==this._dots.length-1)i=0;else i++;while(!this._dots[i]._found)if(i==this._dots.length-1)i=0;else i++;this.scrollToNode(i)}.bind(this));this.searchbox.append(button._element);button.setVisible(false);this.nextbtn=button;var button=new WcxButtonSimple(null,wcapplication.imgstr.search_prev);button._element.addClass("wcx-grid-searchbox-button").css("margin-right","0px");button.setTitle(ibx.resourceMgr.getString("prev"));button._element.on("click",function(){var i=this._currentnode;
if(i<0)return;if(i==0)i=this._dots.length-1;else i--;while(!this._dots[i]._found)if(i==0)i=this._dots.length-1;else i--;this.scrollToNode(i)}.bind(this));this.searchbox.append(button._element);button.setVisible(false);this.prvbtn=button;var button=new WcxButtonSimple(null,"ds-icon-times");button._element.addClass("wcx-grid-searchbox-button").css("margin-right","0px");button.setTitle(ibx.resourceMgr.getString("cancel"));button._element.on("click",function(){if(this.searchbox.input.val()==""){this.closeSearchPanel();
return}this.searchbox.input.val("");this.searchbox.input.focus();this.search("")}.bind(this));this.searchbox.append(button._element)};_p.expandAll=function(text){for(var i=0;i<this._dots.length;i++){var dot=this._dots[i];var graphNode=dot.wcGraphNode;if(dot.wcNodeInfo.iscontainer)continue;if(dot.wcNodeInfo.collapsed){graphNode.expandNode();dot._findopen=true}}if(this._fitsize&&this._fitsize!="fit")this.autoSize();this.draw(true)};
_p.recoverAll=function(text){for(var i=0;i<this._dots.length;i++){var dot=this._dots[i];var graphNode=dot.wcGraphNode;if(dot.wcNodeInfo.iscontainer)continue;if(dot._findopen){graphNode.collapseNode();dot._findopen=false}dot._found=false}if(this._fitsize&&this._fitsize!="fit")this.autoSize();this.draw(true)};_p.showNext=function(show){this.prvbtn.setVisible(show);this.nextbtn.setVisible(show);this._resizeSearchBox(show)};
_p.closeSearchPanel=function(){if(this.searchbox)if(!this.searchstr){this.recoverAll();this.searchbox.remove();delete this.searchbox}else this.searchbox.css("display","none")};_p._resizeSearchBox=function(show){if(!this.searchbox)return;var len=Math.min(400,Math.floor(this._contentobj._element.prop("clientWidth")*3/5));this.searchbox.width(len);var width=Math.floor(this.searchbox.outerWidth(true));this.searchbox.input.width(width-52-(show?50:0))};
_p.search=function(str){var s=str.trim();if(!s)delete this.searchstr;else{this.searchstr=s;var str=s.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&");var searchstr="("+str+")";this.rplregexp=new RegExp(searchstr,"ig");this.srchregexp=new RegExp(str,"i")}var found1=-1;for(var i=0;i<this._dots.length;i++){var grid=this._dots[i]._inobj?this._dots[i]._inobj.jqgrid:null;if(!grid)continue;var fh=this.searchHead(this._dots[i]);var ft=grid.search(s);if(found1<0&&fh|ft&&!this._dots[i]._findopen)found1=i;if(fh|ft)this._dots[i]._found=
true;else this._dots[i]._found=false}var nf=0;for(var i=0;i<this._dots.length;i++){if(found1<0&&this._dots[i]._found)found1=i;if(this._dots[i]._found)nf++}if(found1>=0)this.scrollToNode(found1);else if(!s)this.scrollToNode(this._hilightnode);this.showNext(nf>1)};
_p.searchHead=function(dot){var h=dot.wcGraphContent.wcNodeHeader.label._element;if(this.searchstr&&this.srchregexp.test(dot.text)){var nhtml=h.text().replace(this.rplregexp,"<span class='wcx-grid-search-highlighted'>$1</span>");h.html(nhtml);return true}else{h.html(dot.text);return false}};function WcGraphSearch(graph){if(_wcconstructing)return;WcxComponent.call(this);this.wcFlowGraph=graph;this._element.addClass("wcx-grid-searchbox");$(this._element).css({"z-index":"5","top":"30px"})}
_p=wcInherit(WcGraphSearch,WcxComponent);
function WcGraphCanvas(graph){this._jqobj=$("<canvas></canvas>");this._jqobj.attr("height",graph._height?graph._height:200);this._jqobj.attr("width",graph._width?graph._width:200);this._jqobj.css({"position":"absolute","left":0,"right":0,"top":0,"bottom":0});this._element=this._jqobj[0];this.wcFlowGraph=graph;this._element.addEventListener("click",this.doClick.bind(this));this._element.addEventListener("mousedown",this.doMouseDown.bind(this));this._element.addEventListener("mousemove",this.doMouseMove.bind(this));
this._element.addEventListener("mouseup",this.doMouseUp.bind(this));this._element.addEventListener("contextmenu",this.doContextMenu.bind(this));this._element.addEventListener("drop",this.doDrop.bind(this))}_p=WcGraphCanvas.prototype;
_p.doClick=function(evt){var graph=this.wcFlowGraph;var epos=graph.getMousePos(evt);var node=graph.getNodeByTextPosition(epos.x,epos.y);if(!node){graph.highlightNode(-1);graph._element.focus();if(graph._textedit){graph._element.remove(graph._textedit);graph._textedit=null}}if(graph.wcMiniView)graph.wcMiniView.doRefresh();evt.stopPropagation();evt.preventDefault()};_p.doMouseDown=function(evt){wcClearTextSelection();evt.stopPropagation();evt.preventDefault()};
_p.doMouseMove=function(evt){if(evt.buttons==2)return;var graph=this.wcFlowGraph;if(graph.wcOverlay.getVisible())return;var epos=graph.getMousePos(evt);if(graph.isLeftRight&&(graph.wcExternalDragging||graph.wcGroupDragging)){graph.wcMoving=false;graph.wcUnitDragging=false;graph.wcConnecting=false;if(evt.buttons==1)this.doMouseMove_wcGroupHighlight(epos);else graph.unhighlightAllGroups();evt.stopPropagation();evt.preventDefault()}else if(graph.wcMoving){graph.wcExternalDragging=false;graph.wcGroupingDragging=
false;graph.wcConnecting=false;if(evt.buttons==1)this.doMouseMove_wcMoving(evt);else this.doMouseUp_wcMoving(evt);evt.stopPropagation();evt.preventDefault()}else if(graph.wcConnecting){graph.draw(true);if(epos){graph.wcConnecting_overnode=graph.getNodeByPosition(epos.x,epos.y);var ctx=this._element.getContext("2d");ctx.beginPath();ctx.lineWidth=2;ctx.strokeStyle=graph.highlightColor;ctx.setLineDash([5,5]);ctx.moveTo(graph.wcConnecting_pos.x,graph.wcConnecting_pos.y);ctx.lineTo(epos.x,epos.y);ctx.stroke();
ctx.setLineDash([])}evt.stopPropagation();evt.preventDefault()}else if(evt.buttons==0){var epos=graph.getMousePos(evt);if(epos){var link=graph.getLinkByPosition(epos.x,epos.y);if(link){if(link!=this.wcHoverLink){if(this.wcHoverLink)this.wcHoverLink.hover=false;this.wcHoverLink=link;link.hover=true;graph.draw(true)}var graphLinkTip=link.wcGraphLinkTip;if(graphLinkTip)if(graphLinkTip.visible){$(graphLinkTip._element).css({"display":"none"});graphLinkTip.visible=false}else{$(graphLinkTip._element).css({"left":epos.x-
5+"px","top":epos.y-5+"px","display":""});graphLinkTip.visible=true}}else if(this.wcHoverLink){link=this.wcHoverLink;if(link.hover){link.hover=false;graph.draw(true)}if(link.wcGraphLinkTip)$(link.wcGraphLinkTip._element).css({"display":"none"});this.wcHoverLink=null}}evt.stopPropagation();evt.preventDefault()}};
_p.doMouseMove_wcMoving=function(evt){var graph=this.wcFlowGraph;var canvas=graph.wcCanvas._element;var graphWidth=canvas.clientWidth;var graphHeight=canvas.clientHeight;if(evt.buttons!=1)this.doMouseUp_wcMoving(evt);else{var epos=graph.getMousePos(evt);if(epos.x>=0&&epos.y>=0&&epos.x<=graphWidth&&epos.y<=graphHeight){if(graph.wcMoving){var dot=graph.wcMoving;if(dot.x-(epos.x-dot.rx)!=0||dot.x-(epos.x-dot.rx)!=0){dot.x0=dot.x;dot.y0=dot.y;dot.x=epos.x-dot.rx;dot.y=epos.y-dot.ry;if(dot.x<0)dot.x=0;
if(dot.y<0)dot.y=0;graph.draw(true);if(dot.ptobj)dot.ptobj.updPos();if(graph._textedit){graph._element.remove(this._textedit);graph._textedit=null}dot.wcmoving=true}}if(graph.wcUnitDragging)this.doMouseMove_wcGroupHighlight(epos,graph.wcMoving.index)}}};
_p.doMouseMove_wcGroupHighlight=function(epos,excludeIndex){var graph=this.wcFlowGraph;var oldNode=graph.mouseOverNode;var newNode=graph.getNodeByPosition(epos.x,epos.y,true);if(newNode)if(newNode.index==excludeIndex){newNode.wcGraphContent.setHighlighterVisible(false);graph.mouseOverNode=null}else{if(oldNode&&oldNode!=newNode)oldNode.wcGraphContent.setHighlighterVisible(false);newNode.wcGraphContent.setHighlighterVisible(true);graph.mouseOverNode=newNode}else{if(oldNode)oldNode.wcGraphContent.setHighlighterVisible(false);
graph.mouseOverNode=null}};
_p.doMouseUp=function(evt){var graph=this.wcFlowGraph;if(graph.wcGroupDragging&&graph.mouseOverNode){var sourceDot=graph.wcMoving;var targetDot=graph.mouseOverNode;var droplink=targetDot.xlinkd;var param={};param["DBG_nodeid"]=targetDot.index+1;if(graph.wcDragData){var isDragFromTable=graph.wcDragData.indexOf(":")>=0;if(isDragFromTable){param["DBG_text"]=graph.wcDragData;graph.runLink(droplink,param)}}else;}$(this._element).css("cursor","default");var dots=graph._dots;for(var i=0;i<dots.length;i++){var node=
dots[i];if(node)$(node._element).css("cursor","default")}graph.draw(true);graph.unhighlightAllGroups();graph.wcConnecting=false;graph.wcMoving=false;graph.wcUnitDragging=false;graph.wcExternalDragging=false;graph.wcGroupDragging=false;graph.wcdragging=false};
_p.doMouseUp_wcMoving=function(evt){var graph=this.wcFlowGraph;var canvas=graph.wcCanvas._element;var graphWidth=canvas.clientWidth;var graphHeight=canvas.clientHeight;var epos=graph.getMousePos(evt);var notDraggedToGroup=true;if(graph.mouseOverNode&&!graph.mouseOverNode.wcNodeInfo.collapsed){if(graph.wcUnitDragging){notDraggedToGroup=false;var sourceDot=graph.wcMoving;var targetDot=graph.mouseOverNode;var droplink=targetDot.xlinkd;var param={};param["DBG_text"]=graph.wcDragData?graph.wcDragData:
sourceDot.index+1;param["DBG_nodeid"]=targetDot.index+1;graph.runLink(droplink,param)}graph.mouseOverNode.wcGraphContent.setHighlighterVisible(false);graph.mouseOverNode=null}if(notDraggedToGroup){if(epos.x>=0&&epos.y>=0&&epos.x<=graphWidth&&epos.y<=graphHeight)graph.wcMoving=false;var node=graph.getNodeByPosition(epos.x,epos.y);if(node){var dx=node.x-node.px;var dy=node.y-node.py;if(dx!=0||dy!=0){var param={};var p=graph.xlinkd.parameters;if(p)for(var i=0;i<p.length;i++)param[p[i].name]=p[i].value;
param["DBG_update"]="positions";param["DBG_nodeid"]=node.index+1;if(node._subnodes.length>0)for(var k=0;k<node._subnodes.length;k++)param["DBG_nodeid"+(k+1)]=node._subnodes[k].index+1;param["DBG_nodex"]=node.x;param["DBG_nodey"]=node.y;graph.runLink(null,param)}}}graph.wcMoving=false;this.doMouseUp()};
_p.doContextMenu=function(evt){var graph=this.wcFlowGraph;var epos=graph.getMousePos(evt);var link=graph.getLinkByPosition(epos.x,epos.y);if(link)if(link._oncontextmenu)link._oncontextmenu(evt);else if(graph._oncontextmenu)graph._oncontextmenu(evt);evt.stopPropagation();evt.preventDefault()};_p.doDrop=function(evt){var graph=this.wcFlowGraph;if(graph.xlinkd)graph.runLink(graph.xlinkd)};
function WcGraphNode(node,graph){if(_wcconstructing)return;WcxComponent.call(this);this.wcFlowGraph=graph;var nodeInfo=node.wcNodeInfo;this._element.addClass(graph.isLeftRight?"ds-graph-node":"wcx-graph-node");if(nodeInfo.highlight)this._element.addClass("wcx-selected");$(this._element).attr("tabindex","0");$(this._element).attr("qa",node.text?node.text.replace(/"/g,'\\"'):"");$(this._element).css({"display":"none","position":"absolute","outline":"none"});this.wcGraphItem=node;var icon=nodeInfo.fontimage;
if(icon&&!nodeInfo.iscontainer){icon.isLeftRight=graph.isLeftRight;icon.isCompact=graph.isCompact;graphIcon=new WcGraphIcon(icon,this);node.wcGraphIcon=graphIcon;this.wcGraphIcon=graphIcon;this.add(graphIcon)}$(this._element).on("dblclick",this.doDblClick.bind(this));$(this._element).on("mousedown",this.doMouseDown.bind(this));$(this._element).on("mouseup",this.doMouseUp.bind(this));$(this._element).on("ibx_drop",this.doIbxDrop.bind(this));$(this._element).on("focus",this.doFocus.bind(this));if(this.wcGraphItem._xlink)wcAttachLinksTo(this,
this.wcGraphItem._xlink,"node_click")}_p=wcInherit(WcGraphNode,WcxComponent);_p.expandNode=function(){var dot=this.wcGraphItem;dot.wcNodeInfo.collapsed=false;if(!dot.wcIsGridEmbedded){this.wcFlowGraph._drawDot(dot);this.wcFlowGraph.embedGrid(dot);dot.w=this.wcFlowGraph._minnodesize;dot.h=this.wcFlowGraph._minnodesize;dot.wcIsGridEmbedded=true}else{if(dot.w0&&dot.w0>0)dot.w=dot.w0;if(dot.h0&&dot.h0>0)dot.h=dot.h0}if(dot.ptobj){dot.ptobj.updDis(false);dot.ptobj.updPos()}};
_p.collapseNode=function(){var dot=this.wcGraphItem;dot.wcNodeInfo.collapsed=true;dot.w=parseInt(dot.wcNodeInfo.fontimage.w);dot.h=parseInt(dot.wcNodeInfo.fontimage.h);if(dot.ptobj){dot.ptobj.updDis(true);dot.ptobj.updPos()}};_p.focusNode=function(){this._element.focus()};
_p.doDblClick=function(evt){var dot=this.wcGraphItem;var graph=this.wcFlowGraph;if(graph&&graph.isLeftRight){var link=JSON.parse(JSON.stringify(dot._mlink));link.jqobj=graph._contentobj._element;link.getOtherParams=function(){var p={};p["DBG_nodeid"]=this.index+1;return p}.bind(dot);wcHandleClick.bind([link])(evt);return}if(dot.wcNodeInfo.iscontainer)return;if(dot.wcNodeInfo.collapsed)this.expandNode();else this.collapseNode();if(dot.ptobj)dot.ptobj.updDis(dot.wcNodeInfo.collapsed);graph.draw(true);
if(graph._fitsize&&graph._fitsize!="fit"){graph.autoSize();graph.draw(true)}var param={};var p=graph.xlinkd.parameters;if(p)for(var i=0;i<p.length;i++)param[p[i].name]=p[i].value;param["DBG_update"]=dot.wcNodeInfo.collapsed?"node_collapse":"node_expand";param["DBG_nodeid"]=dot.index+1;graph.runLink(null,param);evt.stopPropagation();evt.preventDefault()};
_p.doMouseDown=function(evt){wcClearTextSelection();var graph=this.wcFlowGraph;var canvas=graph.wcCanvas._element;var graphWidth=canvas.clientWidth;var graphHeight=canvas.clientHeight;var dot=this.wcGraphItem;if(evt.buttons==1){graph.wcMoving=dot;graph.wcMovingX=dot.x;graph.wcMovingY=dot.y;graph.wcUnitDragging=dot._inlinks.length==0&&dot._links.length==0;graph.wcDragData=false;dot.wcmoving=false;dot._extdrop=false;var epos=graph.getMousePos(evt);if(epos.x>=0&&epos.y>=0&&epos.x<=graphWidth*1&&epos.y<=
graphHeight*1){var p={x:epos.x,y:epos.y};dot.px=dot.x;dot.py=dot.y;var x=dot.x;var y=dot.y;if(p.x>=x&&p.y>=y&&p.x<=x+dot.w&&p.y<=y+dot.h&&(dot.wcNodeInfo.collapsed||dot.wcNodeInfo.iscontainer||dot.wcNodeInfo.issubnode||p.x<=x+dot.w-20||p.y<=y+dot.h-20)){dot.rx=p.x-x;dot.ry=p.y-y}}this.focusNode()}evt.stopPropagation();evt.preventDefault()};
_p.doMouseUp=function(evt){var graph=this.wcFlowGraph;if(graph.wcConnecting){graph.draw(true);var droplink=this.wcGraphItem.xlinkd;var param=graph.wcConnectingParam;param["DBG_nodeid"]=this.wcGraphItem.index+1;if(this.wcGraphItem.x)param["DBG_nodex"]=this.wcGraphItem.x;if(this.wcGraphItem.y)param["DBG_nodey"]=this.wcGraphItem.y;graph.runLink(droplink,param)}graph.wcConnecting=false;graph.wcdragging=false;$(graph.wcCanvas._element).css("cursor","default")};
_p.doIbxDrop=function(evt){var graph=this.wcFlowGraph;var p=$(this).find(".topleft-popup-expanded");if(p.length>0)p.removeClass("topleft-popup-expanded");p=$(this).find(".bottomright-popup-expanded");if(p.length>0)p.removeClass("bottomright-popup-expanded");p=$(this).find(".wcx-gnode-topleft-drop-zone-popup");if(p.length>0){evt.stopPropagation();evt.preventDefault();return}var e=evt.originalEvent;var data=e.dataTransfer.getData("DBG_nodeid");if((data||data==0)&&data!=this.wcGraphItem.index){var droplink=
this.wcGraphItem.xlinkd;var param={};param["DBG_nodeid"]=this.wcGraphItem.index+1;if(this.wcGraphItem.x)param["DBG_nodex"]=this.wcGraphItem.x;if(this.wcGraphItem.y)param["DBG_nodey"]=this.wcGraphItem.y;param["DBG_text"]=data+1;graph.runLink(droplink,param)}};_p.doFocus=function(evt){var graph=this.wcFlowGraph;var nodeIndex=this.wcGraphItem.index;graph.highlightNode(nodeIndex);evt.stopPropagation();evt.preventDefault()};
function WcGraphConnector(node,connectorClass,parentObj,connectorName,connectorValue){if(_wcconstructing)return;WcxWidget.call(this);this._element.addClass("wcx-graph-connector");this._element.addClass("ds-graph-connector");this._element.addClass(connectorClass);this.wcConnectorClass=connectorClass;$(this._element).css({"position":"absolute","top":"0"});this.wcParentObj=parentObj;this.wcGraphNode=parentObj.wcGraphNode;this.wcConnectorName=connectorName;this.wcConnectorValue=connectorValue;this.setVisible(false);
$(this._element).on("mousedown",this.doMouseDown.bind(this));$(this._element).on("mousemove",this.doMouseMove.bind(this))}_p=wcInherit(WcGraphConnector,WcxWidget);_p.show=function(nodeHeight){var visible=nodeHeight>0;if(visible)$(this._element).css({"top":parseInt((nodeHeight-7)/2)+"px"});this.setVisible(visible)};
_p.doMouseDown=function(evt){wcClearTextSelection();if(evt.buttons==1){var graphNode=this.wcGraphNode;var graphNodeEl=graphNode._element;var graph=graphNode.wcFlowGraph;graph.wcConnecting=true;graph.wcConnecting_pos=graph.getMousePos(evt);graph.wcConnectingParam=[];graph.wcConnectingParam["DBG_text"]=graphNode.wcGraphItem.index+1;graph.wcConnectingParam[this.wcConnectorName]=this.wcConnectorValue;graphNode.focusNode();$(graph.wcCanvas._element).css("cursor","no-drop")}evt.stopPropagation();evt.preventDefault()};
_p.doMouseMove=function(evt){var graphNode=this.wcGraphNode;var graph=graphNode.wcFlowGraph;if(!graph.wcResizing){graph.wcCanvas.doMouseMove(evt);evt.stopPropagation();evt.preventDefault()}};
function WcGraphContent(node,graphNode){if(_wcconstructing)return;WcxComponent.call(this);this.wcGraphNode=graphNode;var graph=this.wcFlowGraph=graphNode.wcFlowGraph;this._element.addClass("wcx-graph-content");this._element.addClass("wcx-gnode");$(this._element).attr("tabindex","0");$(this._element).attr("qa",node.text?node.text.replace(/"/g,'\\"'):"");$(this._element).css({"display":"none","position":"absolute"});this.wcNodeHeader=new WcxComponent;this.wcNodeHeader._element.addClass("wcx-gnode-header-container");
var label=new WcxLabel(node.text);label._element.addClass("wcx-gnode-header");$(label._element).on("mousedown",this.doHeaderMouseDown.bind(this));$(label._element).on("mousemove",this.doHeaderMouseMove.bind(this));label.setTitle(node.tip);this.wcNodeHeader.add(label);this.wcNodeHeader.label=label;this.add(this.wcNodeHeader);if(node.wcNodeInfo.extension){if(!this.wcExtension)this.wcExtension=[];var ext;if(node.wcNodeInfo.extension)for(var i=0;i<node.wcNodeInfo.extension.item.length;++i){ext=new WcxComponent;
ext._element.addClass("wcx-gnode-header-extension");ext.add(wcBuild(node.wcNodeInfo.extension.item[i]));this.wcNodeHeader.prepend(ext);this.wcExtension.push(ext)}}if(node.errmsg||node.warnmsg){var ard=graph.isCompact?12:16;this.wcAlertIcon=new WcxLabel("");this.wcAlertIcon._element.addClass("wcx-gnode-alert");$(this.wcAlertIcon._element).css({"right":"-"+ard/2+"px","top":"-"+ard/2+"px"});this.wcAlertIcon.setTitle(node.errmsg?node.errmsg:node.warnmsg);this.wcAlertIcon.setIcon(node.errmsg?"ds-icon-status-alert":
"ds-icon-status-alert");this.wcAlertIcon.setIconSize(ard);this.wcAlertIcon.setIconColor("#f05050");this.add(this.wcAlertIcon)}this.wcBodyContent=new WcxComponent;this.wcBodyContent._element.addClass("wcx-gnode-bodycontent");$(this.wcBodyContent._element).css({"position":"absolute","top":"23px","left":"0","overflow":"hidden"});this.add(this.wcBodyContent);this.wcNodeContent=new WcxWidget;this.wcNodeContent._element.addClass("wcx-gnode-content");$(this.wcNodeContent._element).css({"position":"absolute",
"top":"0","left":"0","right":"0","bottom":"0"});this.wcBodyContent.add(this.wcNodeContent);this.wcHighlighter=new WcxWidget;this.wcHighlighter._element.addClass("wcx-gnode-content-highlighter");$(this.wcHighlighter._element).css({"position":"absolute","top":"0","left":"0","right":"0","bottom":"0","border":"2px solid gold"});this.setHighlighterVisible(false);$(this.wcHighlighter._element).on("mouseup",this.doHighlighterMouseUp.bind(this));this.wcBodyContent.add(this.wcHighlighter);this.wcResizable=
$(this._element).resizable({handles:"se",minWidth:graph._minnodesize,minHeight:graph._minnodesize,start:this.doStart,stop:this.doStop});$(this._element).data("dot",node);this.wcGraphItem=node;$(this._element).on("mouseenter",this.doMouseEnter.bind(this));$(this._element).on("mouseleave",this.doMouseLeave.bind(this));$(this._element).on("mousedown",this.doMouseDown.bind(this));$(this._element).on("mousemove",this.doMouseMove.bind(this));$(this._element).on("mouseup",this.doMouseUp.bind(this));$(this._element).on("resize",
this.doResize.bind(this));$(this._element).on("contextmenu",this.doContextMenu.bind(this))}_p=wcInherit(WcGraphContent,WcxComponent);_p.setHighlighterVisible=function(visible){this.wcHighlighter.setVisible(visible)};_p.doMouseEnter=function(evt){var graph=this.wcFlowGraph;if(graph.wcOverlay.getVisible()){evt.stopPropagation();evt.preventDefault();return}if(evt.buttons==0)if(this.wcGraphItem._mlink)this.setCursor("pointer")};
_p.doMouseLeave=function(evt){var graph=this.wcFlowGraph;if(graph.wcOverlay.getVisible()){evt.stopPropagation();evt.preventDefault();return}this.setCursor("")};_p.doMouseDown=function(evt){var graph=this.wcFlowGraph;if(evt.buttons==1)graph.wcResizing=true;evt.stopPropagation();evt.preventDefault()};
_p.doMouseMove=function(evt){var graph=this.wcFlowGraph;if(graph.wcOverlay.getVisible()){evt.stopPropagation();evt.preventDefault();return}if(!graph.wcResizing){if(graph.wcExternalDragging&&graph.isLeftRight)this.setHighlighterVisible(true);graph.wcCanvas.doMouseMove(evt);evt.stopPropagation();evt.preventDefault()}};
_p.doMouseUp=function(evt){var graph=this.wcFlowGraph;var graphNode=this.wcGraphNode;graphNode._element.focus();if(!graph.wcResizing){if(graph.wcMoving)graph.wcCanvas.doMouseUp_wcMoving(evt);else if(graph.wcConnecting)graphNode.doMouseUp(evt);else graph.wcCanvas.doMouseUp(evt);evt.stopPropagation();evt.preventDefault()}graph.wcResizing=false};_p.doContextMenu=function(evt){if(this.wcGraphItem._oncontextmenu)this.wcGraphItem._oncontextmenu(evt);evt.stopPropagation();evt.preventDefault()};
_p.doHeaderMouseDown=function(evt){this.wcGraphNode.doMouseDown(evt);evt.stopPropagation();evt.preventDefault()};_p.doHeaderMouseMove=function(evt){var graph=this.wcGraphNode.wcFlowGraph;graph.wcCanvas.doMouseMove(evt);evt.stopPropagation();evt.preventDefault()};
_p.doStart=function(){var dot=$(this).data("dot");var graphContent=dot.wcGraphContent;$(graphContent._element).css({"background-color":"#fafafa"});$(graphContent.wcBodyContent._element).css({"display":"none"});var node=dot.wcGraphNode;if(node&&node instanceof WcFlowNode){node._element.css("border-color","transparent");node.wcPortLeft.hide();node.wcConnectorLeft.hide();node.wcPortRight.hide();node.wcConnectorRight.hide()}};
_p.doStop=function(){var dot=$(this).data("dot");var graphContent=dot.wcGraphContent;var graph=dot._graph;graph.wcResizing=false;$(graphContent._element).css({"background-color":""});$(graphContent.wcBodyContent._element).css({"display":"block"});dot.w=$(this).width();dot.h=$(this).height();dot.w0=dot.w;dot.h0=dot.h;if(dot._inobj&&dot.w>0&&dot.h>0){dot._inobj._element.width(dot.w);dot._inobj._element.height(dot.h)}graph.draw(true);var param={};var p=graph.xlinkd.parameters;if(p)for(var i=0;i<p.length;i++)param[p[i].name]=
p[i].value;param["DBG_update"]="sizes";param["DBG_nodeid"]=dot.index+1;param["DBG_nodew"]=dot.w;param["DBG_nodeh"]=dot.h;graph.runLink(null,param);if(dot.wcGraphContent){dot.wcGraphContent.wcNodeContent._element.css({"height":"","width":""});dot._inobj._element.css({"height":"","width":""});dot._inobj._element.trigger("resize")}var node=dot.wcGraphNode;if(node&&node instanceof WcFlowNode){node._element.css("border-color","");node.wcPortLeft.show();node.wcConnectorLeft.show();node.wcPortRight.show();
node.wcConnectorRight.show();node.doResizeContentNode()}};_p.doResize=function(evt){evt.stopPropagation();evt.preventDefault()};_p.doHighlighterMouseUp=function(evt){this.setHighlighterVisible(false)};_p.doGridStartDrag=function(evt,rowid){var graph=this.wcFlowGraph;if(graph&&graph.isLeftRight){var s=rowid.indexOf("=");var data=rowid;if(s>0)data=rowid.substring(s+1);graph.wcDragData=data;graph.wcGroupDragging=true}};
_p.doGridDragOver=function(evt){var graph=this.wcFlowGraph;if(graph.wcOverlay.getVisible()){evt.stopPropagation();return}if(graph&&graph.isLeftRight){var dt=evt.dataTransfer;var rowid=dt?dt.getData("text"):"";var s=rowid.indexOf("=");var data=rowid;if(s>0)data=rowid.substring(s+1);graph.wcDragData=data;graph.wcGroupDragging=true;graph.wcMouseOverNode=this.wcGraphNode.wcGraphItem;graph.wcCanvas.doMouseMove(evt)}};
function WcGraphIcon(icon,graphNode){if(_wcconstructing)return;WcxComponent.call(this);var node=graphNode.wcGraphItem;this.wcGraphNode=graphNode;this.wcIcon=icon;var graph=this.wcFlowGraph=graphNode.wcFlowGraph;this._element.addClass(icon.isLeftRight?"ds-graph-icon":"wcx-graph-icon");this.setTitle(node.tip);if(icon._iconClass){this._element.addClass(icon._iconClass);$(this._element).css({"position":"relative","margin-bottom":(node.container?35:5)+"px","top":"10px","height":iconSize+"px","align":"center"})}else{var issvg=
icon.img.match(/svg/);iconSize=icon.w-(icon.isLeftRight?10:0);if(iconSize>24&&icon.isLeftRight&&!issvg)iconSize=24;$(this._element).css({"text-align":"center","height":"100%"})}var iconLabel=new WcxLabel("");iconLabel.setIcon(icon.img);iconLabel.setIconSize(iconSize);var padding=icon.isLeftRight?icon.isCompact?issvg?6:6:issvg?4:12:1;iconLabel._element.css({"display":"block","position":"absolute","top":"50%","left":"50%","text-align":"center","transform":"translate(-50%, -50%)"});this.add(iconLabel);
if(node.errmsg||node.warnmsg){var ard=graph.isCompact?12:16;this.wcAlertIcon=new WcxLabel("");this.wcAlertIcon._element.addClass("wcx-gnode-alert");$(this.wcAlertIcon._element).css({"left":icon.w-ard/2+"px","top":"-"+ard/2+"px"});this.wcAlertIcon.setTitle(node.errmsg?node.errmsg:node.warnmsg);this.wcAlertIcon.setIcon(node.errmsg?"ds-icon-status-alert":"ds-icon-status-alert");this.wcAlertIcon.setIconSize(ard);this.wcAlertIcon.setIconColor("#f05050");this.add(this.wcAlertIcon)}this.addDropZones(node);
var nodeInfo=graphNode.wcGraphItem.wcNodeInfo;var connectorInfo={"leftportname":nodeInfo.leftportname,"leftportvalue":nodeInfo.leftportvalue,"rightportname":nodeInfo.rightportname,"rightportvalue":nodeInfo.rightportvalue};var notContainer=!nodeInfo.iscontainer;this.wcTextLabel=new WcxLabel(node.text);this.wcTextLabel._element.addClass(icon.isLeftRight?"ds-graph-icon-label":"wcx-graph-node-label");this.wcTextLabel.setWidth(graph.isCompact?80:100);this.wcTextLabel.setJustify("center");this.wcTextLabel.setTitle(node.text);
var left=icon.w/2-this.wcTextLabel.getWidth()/2+"px";var top=icon.h+5+"px";$(this.wcTextLabel._element).css({"position":"absolute","left":left,"top":top,"text-shadow":"-1px -1px 0 #FFF, 0px -1px 0 #FFF, 1px -1px 0 #FFF,-1px 0px 0 #FFF, 1px 0px 0 #FFF, -1px 1px 0 #FFF, 0px 1px 0 #FFF, 1px 1px 0 #FFF"});$(this.wcTextLabel._element).on("mousedown",this.doTextLabelMouseDown.bind(this));$(this.wcTextLabel._element).on("dblclick",this.doTextLabelDblClick.bind(this));this.add(this.wcTextLabel);this.wcTextLabel.wcOriginalText=
this.wcTextLabel._element.find(".ibx-label-text").html();$(this.wcTextLabel._element).ready(function(){var originalText=this.wcOriginalText;var ibxLabel=$(this._element).find(".ibx-label-text");if(ibxLabel&&ibxLabel.length>0){var htmlText=originalText.replace(/_/g,"_<wbr>&#x200b;</wbr>");ibxLabel.html(htmlText);var clientHeight=Math.ceil(ibxLabel.height());var scrollHeight=Math.ceil(ibxLabel[0].scrollHeight);if(scrollHeight>clientHeight){var lastPos=originalText.lastIndexOf("(");if(lastPos<0)lastPos=
originalText.lastIndexOf("_");if(lastPos<0)lastPos=originalText.lastIndexOf(" ");if(lastPos<0)lastPos=originalText.lastIndexOf("-");if(lastPos<0)lastPos=originalText.length-10;if(lastPos<0)lastPos=originalText.length-1;var beginText=lastPos>0?originalText.substr(0,lastPos):originalText;var endText=lastPos>0?originalText.substr(lastPos):"";for(var i=lastPos-1;i>0;i--){htmlText=beginText.substr(0,i)+"..."+endText;htmlText=htmlText.replace(/_/g,"_<wbr>&#x200b;</wbr>");ibxLabel.html(htmlText);clientHeight=
Math.ceil(ibxLabel.height());scrollHeight=Math.ceil(ibxLabel[0].scrollHeight);if(scrollHeight<=clientHeight)break}}}}.bind(this.wcTextLabel));this.wcTextEdit=new WcxTextField(node.editvalue?node.editvalue:node.text);this.wcTextEdit._element.css("position","absolute");if(node.editmaxlen)this.wcTextEdit.setMaxLength(node.editmaxlen);this.wcTextEdit.setSize(100);this.wcTextEdit.setVisible(false);$(this.wcTextEdit._element).on("mousedown",this.doTextEditMouseDown.bind(this));$(this.wcTextEdit._element).find("input").on("keyup",
this.doTextEditKeyUp.bind(this));$(this.wcTextEdit._element).find("input").on("blur",this.doTextEditBlur.bind(this));this.add(this.wcTextEdit);this.wcGraphItem=node;$(this._element).on("mouseenter",this.doMouseEnter.bind(this));$(this._element).on("mouseleave",this.doMouseLeave.bind(this));$(this._element).on("mousedown",this.doMouseDown.bind(this));$(this._element).on("mousemove",this.doMouseMove.bind(this));$(this._element).on("mouseup",this.doMouseUp.bind(this));$(this._element).on("contextmenu",
this.doContextMenu.bind(this))}_p=WcGraphIconProto=wcInherit(WcGraphIcon,WcxComponent);
_p.addDropZones=function(node){if(node.xlinkd&&node.xlinkd2){var dropzone1=new WcGraphDropZone(node,"wcx-gnode-topleft-drop-zone-popup",node.xlinkd_label?node.xlinkd_label:"",node.xlinkd);this.add(dropzone1);var dropzone2=new WcGraphDropZone(node,"wcx-gnode-bottomright-drop-zone-popup",node.xlinkd2_label?node.xlinkd2_label:"",node.xlinkd2);this.add(dropzone2);var droptypes=node.droptypes;this._element.on("ibx_dragover ibx_dragenter ibx_dragleave",{"dropzone1":dropzone1._element,"dropzone2":dropzone2._element},
function(event){var evt=event.originalEvent;var dt=evt.dataTransfer;var dragtype=dt.items.dragtype;var allowDrop=dragtype?true:false;if(droptypes){allowDrop=false;var arrDragTypes=dragtype?dragtype.split(","):[];var arrDropTypes=droptypes.split(",");for(var iDrop=0;iDrop<arrDropTypes.length;iDrop++){for(var iDrag=0;iDrag<arrDragTypes.length;iDrag++){var strDropType=arrDropTypes[iDrop];var strDragType=arrDragTypes[iDrag];if(strDropType==strDragType){allowDrop=true;break}}if(allowDrop)break}}if(allowDrop){dropzone1._element.show();
dropzone2._element.show()}else{dropzone1._element.hide();dropzone2._element.hide();return}if(event.type==="ibx_dragover"){dt.dropEffect="default";event.preventDefault()}else if(event.type==="ibx_dragenter"){if(allowDrop){event.data.dropzone1.ibxAddClass("topleft-popup-expanded");event.data.dropzone2.ibxAddClass("bottomright-popup-expanded");var t=$(this).attr("title");if(t){$(this).attr("data-title",t);$(this).attr("title","")}}}else{var dropTarget=event.originalEvent.toElement;if(!dropTarget||!dropTarget.getAttribute("class")||
dropTarget.getAttribute("class").indexOf("wcx-gnode-topleft-drop-zone-popup")===-1&&dropTarget.getAttribute("class").indexOf("wcx-gnode-bottomright-drop-zone-popup")===-1){event.data.dropzone1.ibxRemoveClass("topleft-popup-expanded");event.data.dropzone2.ibxRemoveClass("bottomright-popup-expanded")}var t=$(this).attr("data-title");if(t){$(this).attr("title",t);$(this).attr("data-title","")}}})}};
_p.doMouseEnter=function(evt){var graph=this.wcFlowGraph;if(graph.wcOverlay.getVisible()){evt.stopPropagation();evt.preventDefault();return}if(evt.buttons==0){var hasSubNodes=this.wcGraphItem._subnodes?this.wcGraphItem._subnodes.length>0:false;if(this.wcGraphItem._mlink&&!hasSubNodes)this.setCursor("pointer")}};_p.doMouseLeave=function(evt){this.setCursor("")};_p.doMouseDown=function(evt){if(evt.buttons==1){this.wcMoveStarted=true;this.wcMoveStartedAt={x:evt.clientX,y:evt.clientY};this.wcMoved=false}};
_p.doMouseMove=function(evt){var graph=this.wcFlowGraph;if(graph.wcOverlay.getVisible()){evt.stopPropagation();evt.preventDefault();return}if(this.wcMoveStarted){var start=this.wcMoveStartedAt;var diffX=Math.abs(evt.clientX-start.x);var diffY=Math.abs(evt.clientY-start.y);if(diffX>5||diffY>5)this.wcMoved=true}if(!graph.wcResizing)graph.wcCanvas.doMouseMove(evt)};
_p.doMouseUp=function(evt){if(this.wcMoveStarted&&!this.wcMoved)this.wcGraphNode._element.trigger("node_click");this.wcMoved=false;this.wcMoveStarted=false};_p.doContextMenu=function(evt){if(this.wcGraphItem._oncontextmenu)this.wcGraphItem._oncontextmenu(evt);evt.stopPropagation();evt.preventDefault()};_p.doTextLabelMouseDown=function(evt){this.wcGraphNode._element.focus();evt.stopPropagation();evt.preventDefault()};
_p.doTextLabelDblClick=function(evt){var graph=this.wcFlowGraph;var node=this.wcGraphItem;if(!node||!node.editname)return;this.wcTextLabel.setVisible(false);this.wcTextEdit.setText(node.editvalue?node.editvalue:node.text);var font=node.wcNodeInfo.fontimage;this.wcTextEdit.setLeft(font.w/2-100/2);this.wcTextEdit.setTop(font.h+5);this.wcTextEdit.setVisible(true);$(this.wcTextEdit._element).find("input")[0].focus();evt.stopPropagation();evt.preventDefault()};
_p.doTextEditMouseDown=function(evt){evt.stopPropagation();evt.preventDefault()};_p.doTextEditKeyUp=function(evt){if(evt.keyCode==13)this.doTextEditBlur(evt)};_p.doTextEditBlur=function(evt){var graph=this.wcFlowGraph;var newText=this.wcTextEdit.getText();this.wcTextLabel.setText(newText);this.wcTextLabel.setVisible(true);this.wcTextEdit.setVisible(false);var node=this.wcGraphItem;if(node.xlinkte){var param={};param[node.editname]=newText;graph.runLink(node.xlinkte,param)}};
function WcGraphDropZone(node,dzClass,textLabel,droplink){if(_wcconstructing)return;WcxComponent.call(this,"WcGraphDropZone");this._element.addClass(!node._graph.isCompact?"ds-drop-zone":"wcx-drop-zone");this._element.ibxLabel({"text":textLabel,"justify":"center","overlays":this._element}).ibxAddClass(dzClass);wcAttachTooltip(this,node.tip,"up","");this._element.on("ibx_dragover ibx_drop ibx_dragenter ibx_dragleave",{"dropzone":this._element,"node":node},function(event){if(event.type==="ibx_dragenter")event.data.dropzone.ibxAddClass("wcx-gnode-drop-zone-hover");
else if(event.type==="ibx_dragleave")event.data.dropzone.ibxRemoveClass("wcx-gnode-drop-zone-hover");else if(event.type==="ibx_dragover"){event.originalEvent.dataTransfer.dropEffect="default";event.preventDefault()}else if(event.type==="ibx_drop"){event.stopPropagation();event.preventDefault();var data=event.originalEvent.dataTransfer.getData("text");if((data||data==0)&&data!=event.data.node.index){var dlink=droplink;var param={};param["DBG_nodeid"]=event.data.node.index+1;if(event.data.node.x)param["DBG_text"]=
data;event.data.node._graph.runLink(dlink,param)}}})}_p=wcInherit(WcGraphDropZone,WcxComponent);
function WcFlowNode(node,graph){if(_wcconstructing)return;WcxComponent.call(this);this.wcFlowGraph=graph;this.wcGraphItem=node;var nodeInfo=node.wcNodeInfo;this._element.addClass("ds-flow-node");if(nodeInfo.highlight)this._element.addClass("wcx-selected");if(nodeInfo.leftportname)this._element.addClass("ds-has-connector-left");if(nodeInfo.leftporttype)this._element.addClass("ds-porttype-"+nodeInfo.leftporttype+"-left");if(nodeInfo.leftportstatus)this._element.addClass("ds-has-connector-status-left");
if(nodeInfo.rightportname)this._element.addClass("ds-has-connector-right");if(nodeInfo.rightporttype)this._element.addClass("ds-porttype-"+nodeInfo.rightporttype+"-right");if(nodeInfo.rightportstatus)this._element.addClass("ds-has-connector-status-right");if(nodeInfo.is_ran)this._element.addClass("ds-is-ran-trained");if(nodeInfo.is_target)this._element.addClass("ds-has-target-icon");if(nodeInfo.is_key)this._element.addClass("ds-has-key-icon");if(node.errmsg||node.warnmsg)this._element.addClass("ds-has-status-icon");
$(this._element).attr("tabindex","0");$(this._element).attr("qa",node.text?node.text.replace(/"/g,'\\"'):"");$(this._element).css({"display":"none","position":"absolute","outline":"none"});if(nodeInfo.noborder)this._element.addClass("ds-hide-border");else this._element.addClass("ds-show-border");this.wcPortLeft=$("<div></div>");this.wcPortLeft.addClass("ds-graph-port ds-port-left");this._element.append(this.wcPortLeft);this.wcConnectorLeft=$("<div></div>");this.wcConnectorLeft.addClass("ds-graph-connector ds-connector-left");
if(nodeInfo.leftportname)this.wcConnectorLeft.on("mousedown",function(evt){this.doConnectorMouseDown(evt,nodeInfo.leftportname,nodeInfo.leftportvalue)}.bind(this));if(nodeInfo.leftportstatus)wcAttachTooltip(this.wcConnectorLeft,nodeInfo.leftportstatus,"left","error");this.wcConnectorLeft.on("mousemove",this.doConnectorMouseMove.bind(this));this._element.append(this.wcConnectorLeft);var connectorHalfLeft=$("<div></div>");connectorHalfLeft.addClass("ds-connector-half");this.wcConnectorLeft.append(connectorHalfLeft);
this.wcPortRight=$("<div></div>");this.wcPortRight.addClass("ds-graph-port ds-port-right");this._element.append(this.wcPortRight);if(nodeInfo.extension||nodeInfo.assessment){this._element.addClass("ds-has-extension");if(!this.wcExtension)this.wcExtension=[];var ext;if(nodeInfo.extension)for(var i=0;i<nodeInfo.extension.item.length;++i){ext=new WcxComponent;ext._element.addClass("ds-flownode-item");ext.add(wcBuild(nodeInfo.extension.item[i]));graph.add(ext);this.wcExtension.push(ext)}if(nodeInfo.assessment){ext=
new WcFlowAssessmentNode(this);graph.add(ext);this.wcExtension.push(ext)}}else{this.wcConnectorRight=$("<div></div>");this.wcConnectorRight.addClass("ds-graph-connector ds-connector-right");if(nodeInfo.rightportname)this.wcConnectorRight.on("mousedown",function(evt){this.doConnectorMouseDown(evt,nodeInfo.rightportname,nodeInfo.rightportvalue)}.bind(this));if(nodeInfo.rightportstatus)wcAttachTooltip(this.wcConnectorRight,nodeInfo.rightportstatus,"right","error");this.wcConnectorRight.on("mousemove",
this.doConnectorMouseMove.bind(this));this._element.append(this.wcConnectorRight);var connectorHalfRight=$("<div></div>");connectorHalfRight.addClass("ds-connector-half");this.wcConnectorRight.append(connectorHalfRight)}if(nodeInfo.collapsed){var icon=nodeInfo.fontimage;var iconLabel=new WcxLabel("");iconLabel._element.addClass("ds-node-icon");iconLabel.setIcon(icon.img);iconLabel.setIconSize(32);this.add(iconLabel);wcAttachTooltip(iconLabel,node.tip,"up","");iconLabel=new WcxLabel("");iconLabel._element.addClass("ds-corner-icon ds-node-menu-icon");
iconLabel.setIcon("ds-icon-setting");iconLabel.setVisible(this.wcGraphItem._oncontextmenu?true:false);iconLabel.addEventListener("mousedown",this.doIconMouseDown.bind(this));iconLabel.addEventListener("click",this.doContextMenu.bind(this));this.add(iconLabel);iconLabel=new WcxLabel("");iconLabel._element.addClass("ds-corner-icon ds-node-status-icon");var statusText=node.errmsg?node.errmsg:node.warnmsg;wcAttachTooltip(iconLabel,statusText,"up",node.errmsg?"error":"warn");iconLabel.setIcon("ds-icon-status-alert");
iconLabel.addEventListener("mousedown",this.doIconMouseDown.bind(this));this.add(iconLabel);iconLabel=new WcxLabel("");iconLabel._element.addClass("ds-corner-icon ds-node-key-icon");iconLabel.setIcon("ds-icon-key");iconLabel.addEventListener("mousedown",this.doIconMouseDown.bind(this));this.add(iconLabel);iconLabel=new WcxLabel("");iconLabel._element.addClass("ds-corner-icon ds-node-target-icon");iconLabel.setIcon("wc_target.svg");iconLabel.addEventListener("mousedown",this.doIconMouseDown.bind(this));
this.add(iconLabel)}else wcAttachTooltip(this,node.tip,"up","");this.wcTextLabel=new WcxLabel(node.text);this.wcTextLabel._element.addClass("ds-node-label");this.wcTextLabel.setWidth(graph.isCompact?80:100);this.wcTextLabel.setJustify("center");this.wcTextLabel.setTitle(node.text);$(this.wcTextLabel._element).on("mousedown",this.doTextLabelMouseDown.bind(this));$(this.wcTextLabel._element).on("dblclick",this.doTextLabelDblClick.bind(this));this.add(this.wcTextLabel);this.wcTextLabel.wcOriginalText=
this.wcTextLabel._element.find(".ibx-label-text").html();$(this.wcTextLabel._element).ready(function(){var originalText=this.wcOriginalText;var ibxLabel=$(this._element).find(".ibx-label-text");if(ibxLabel&&ibxLabel.length>0){var htmlText=originalText.replace(/_/g,"_<wbr>&#x200b;</wbr>");ibxLabel.html(htmlText);var clientHeight=Math.ceil(ibxLabel.height());var scrollHeight=Math.ceil(ibxLabel[0].scrollHeight);if(scrollHeight>clientHeight){var lastPos=originalText.lastIndexOf("(");if(lastPos<0)lastPos=
originalText.lastIndexOf("_");if(lastPos<0)lastPos=originalText.lastIndexOf(" ");if(lastPos<0)lastPos=originalText.lastIndexOf("-");if(lastPos<0)lastPos=originalText.length-10;if(lastPos<0)lastPos=originalText.length-1;var beginText=lastPos>0?originalText.substr(0,lastPos):originalText;var endText=lastPos>0?originalText.substr(lastPos):"";for(var i=lastPos-1;i>0;i--){htmlText=beginText.substr(0,i)+"..."+endText;htmlText=htmlText.replace(/_/g,"_<wbr>&#x200b;</wbr>");ibxLabel.html(htmlText);clientHeight=
Math.ceil(ibxLabel.height());scrollHeight=Math.ceil(ibxLabel[0].scrollHeight);if(scrollHeight<=clientHeight)break}}}}.bind(this.wcTextLabel));this.wcTextEdit=new WcxTextField(node.editvalue?node.editvalue:node.text);this.wcTextEdit._element.css("position","absolute");if(node.editmaxlen)this.wcTextEdit.setMaxLength(node.editmaxlen);this.wcTextEdit.setSize(100);this.wcTextEdit.setVisible(false);$(this.wcTextEdit._element).on("mousedown",this.doTextEditMouseDown.bind(this));$(this.wcTextEdit._element).find("input").on("keyup",
this.doTextEditKeyUp.bind(this));$(this.wcTextEdit._element).find("input").on("blur",this.doTextEditBlur.bind(this));this.add(this.wcTextEdit);if(!nodeInfo.collapsed){this._element.addClass("ds-expanded-node");this.wcTextLabel.setVisible(false);this._element.ready(function(){this.doResizeContentNode()}.bind(this))}this.addDropZones(node);$(this._element).on("dblclick",this.doDblClick.bind(this));$(this._element).on("mousedown",this.doMouseDown.bind(this));$(this._element).on("mousemove",this.doMouseMove.bind(this));
$(this._element).on("mouseup",this.doMouseUp.bind(this));$(this._element).on("ibx_drop",this.doIbxDrop.bind(this));$(this._element).on("focus",this.doFocus.bind(this));$(this._element).on("contextmenu",this.doContextMenu.bind(this));if(this.wcGraphItem._xlink)wcAttachLinksTo(this,this.wcGraphItem._xlink,"node_click")}_p=wcInherit(WcFlowNode,WcxComponent);_p.addDropZones=WcGraphIconProto.addDropZones;
_p.setConnectionClass=function(connector){this._element.addClass("ds-has-connector-"+connector);this._element.addClass("ds-has-connection-"+connector)};_p.expandNode=function(){};_p.collapseNode=function(){};_p.focusNode=function(){this._element.focus()};
_p.doDblClick=function(evt){var dot=this.wcGraphItem;var graph=this.wcFlowGraph;if(graph&&graph.isLeftRight){var link=JSON.parse(JSON.stringify(dot._mlink));link.jqobj=graph._contentobj._element;link.getOtherParams=function(){var p={};p["DBG_nodeid"]=this.index+1;return p}.bind(dot);wcHandleClick.bind([link])(evt);return}if(dot.wcNodeInfo.iscontainer)return;if(dot.wcNodeInfo.collapsed)this.expandNode();else this.collapseNode();if(dot.ptobj)dot.ptobj.updDis(dot.wcNodeInfo.collapsed);graph.draw(true);
if(graph._fitsize&&graph._fitsize!="fit"){graph.autoSize();graph.draw(true)}var param={};var p=graph.xlinkd.parameters;if(p)for(var i=0;i<p.length;i++)param[p[i].name]=p[i].value;param["DBG_update"]=dot.wcNodeInfo.collapsed?"node_collapse":"node_expand";param["DBG_nodeid"]=dot.index+1;graph.runLink(null,param);evt.stopPropagation();evt.preventDefault()};
_p.doMouseDown=function(evt){wcClearTextSelection();var graph=this.wcFlowGraph;var canvas=graph.wcCanvas._element;var graphWidth=canvas.clientWidth;var graphHeight=canvas.clientHeight;var dot=this.wcGraphItem;if(evt.buttons==1){this.wcMoveStarted=true;this.wcMoveStartedAt={x:evt.clientX,y:evt.clientY};this.wcMoved=false;graph.wcMoving=dot;graph.wcMovingX=dot.x;graph.wcMovingY=dot.y;graph.wcUnitDragging=dot._inlinks.length==0&&dot._links.length==0;graph.wcDragData=false;dot.wcmoving=false;dot._extdrop=
false;var epos=graph.getMousePos(evt);if(epos.x>=0&&epos.y>=0&&epos.x<=graphWidth*1&&epos.y<=graphHeight*1){var p={x:epos.x,y:epos.y};dot.px=dot.x;dot.py=dot.y;var x=dot.x;var y=dot.y;if(p.x>=x&&p.y>=y&&p.x<=x+dot.w&&p.y<=y+dot.h&&(dot.wcNodeInfo.collapsed||dot.wcNodeInfo.iscontainer||dot.wcNodeInfo.issubnode||p.x<=x+dot.w-20||p.y<=y+dot.h-20)){dot.rx=p.x-x;dot.ry=p.y-y}}this.focusNode()}evt.stopPropagation();evt.preventDefault()};
_p.doMouseMove=function(evt){var graph=this.wcFlowGraph;if(graph.wcOverlay.getVisible()){evt.stopPropagation();evt.preventDefault();return}if(this.wcMoveStarted){var start=this.wcMoveStartedAt;var diffX=Math.abs(evt.clientX-start.x);var diffY=Math.abs(evt.clientY-start.y);if(diffX>5||diffY>5)this.wcMoved=true}if(!graph.wcResizing)graph.wcCanvas.doMouseMove(evt)};
_p.doMouseUp=function(evt){if(this.wcMoveStarted&&!this.wcMoved)this._element.trigger("node_click");this.wcMoved=false;this.wcMoveStarted=false;var graph=this.wcFlowGraph;if(graph.wcConnecting){graph.draw(true);var droplink=this.wcGraphItem.xlinkd;var param=graph.wcConnectingParam;param["DBG_nodeid"]=this.wcGraphItem.index+1;if(this.wcGraphItem.x)param["DBG_nodex"]=this.wcGraphItem.x;if(this.wcGraphItem.y)param["DBG_nodey"]=this.wcGraphItem.y;graph.runLink(droplink,param)}graph.wcConnecting=false;
graph.wcdragging=false;$(graph.wcCanvas._element).css("cursor","default")};
_p.doIbxDrop=function(evt){var graph=this.wcFlowGraph;var p=$(this).find(".topleft-popup-expanded");if(p.length>0)p.removeClass("topleft-popup-expanded");p=$(this).find(".bottomright-popup-expanded");if(p.length>0)p.removeClass("bottomright-popup-expanded");p=$(this).find(".wcx-gnode-topleft-drop-zone-popup");if(p.length>0){evt.stopPropagation();evt.preventDefault();return}var e=evt.originalEvent;var data=e.dataTransfer.getData("DBG_nodeid");if((data||data==0)&&data!=this.wcGraphItem.index){var droplink=
this.wcGraphItem.xlinkd;var param={};param["DBG_nodeid"]=this.wcGraphItem.index+1;if(this.wcGraphItem.x)param["DBG_nodex"]=this.wcGraphItem.x;if(this.wcGraphItem.y)param["DBG_nodey"]=this.wcGraphItem.y;param["DBG_text"]=data+1;graph.runLink(droplink,param)}};_p.doFocus=function(evt){var graph=this.wcFlowGraph;var nodeIndex=this.wcGraphItem.index;graph.highlightNode(nodeIndex);evt.stopPropagation();evt.preventDefault()};_p.doIconMouseDown=function(evt){evt.stopPropagation();evt.preventDefault()};
_p.doContextMenu=function(evt){if(this.wcGraphItem._oncontextmenu)this.wcGraphItem._oncontextmenu(evt);evt.stopPropagation();evt.preventDefault()};
_p.doConnectorMouseDown=function(evt,portName,portValue){wcClearTextSelection();if(evt.buttons==1){var graph=this.wcFlowGraph;graph.wcConnecting=true;graph.wcConnecting_pos=graph.getMousePos(evt);graph.wcConnectingParam=[];graph.wcConnectingParam["DBG_text"]=this.wcGraphItem.index+1;graph.wcConnectingParam[portName]=portValue;this.focusNode();$(graph.wcCanvas._element).css("cursor","no-drop")}evt.stopPropagation();evt.preventDefault()};
_p.doConnectorMouseMove=function(evt){var graph=this.wcFlowGraph;if(!graph.wcResizing){graph.wcCanvas.doMouseMove(evt);evt.stopPropagation();evt.preventDefault()}};
_p.doResizeContentNode=function(){var graph=this.wcFlowGraph;var w=$(this.wcGraphContent._element).width();var h=$(this.wcGraphContent._element).height();$(this._element).css({width:w,height:h});var iTop=parseInt(h/2)-8;$(this.wcPortLeft).css("top",iTop+"px");$(this.wcConnectorLeft).css("top",iTop+3+"px");$(this.wcPortRight).css("top",iTop+"px");$(this.wcConnectorRight).css("top",iTop+3+"px")};_p.doTextLabelMouseDown=function(evt){this._element.focus();evt.stopPropagation();evt.preventDefault()};
_p.doTextLabelDblClick=function(evt){var graph=this.wcFlowGraph;var node=this.wcGraphItem;if(!node||!node.editname)return;this.wcTextLabel.setVisible(false);this.wcTextEdit.setText(node.editvalue?node.editvalue:node.text);var font=node.wcNodeInfo.fontimage;this.wcTextEdit.setLeft(font.w/2-100/2);this.wcTextEdit.setTop(font.h+5);this.wcTextEdit.setVisible(true);$(this.wcTextEdit._element).find("input")[0].focus();evt.stopPropagation();evt.preventDefault()};
_p.doTextEditMouseDown=function(evt){evt.stopPropagation();evt.preventDefault()};_p.doTextEditKeyUp=function(evt){if(evt.keyCode==13)this.doTextEditBlur(evt)};_p.doTextEditBlur=function(evt){var graph=this.wcFlowGraph;var newText=this.wcTextEdit.getText();this.wcTextLabel.setText(newText);this.wcTextLabel.setVisible(true);this.wcTextEdit.setVisible(false);var node=this.wcGraphItem;if(node.xlinkte){var param={};param[node.editname]=newText;graph.runLink(node.xlinkte,param)}};
function WcFlowAssessmentNode(flownode){if(_wcconstructing)return;WcxComponent.call(this);this._element.addClass("ds-flownode-assessment");$(this._element).attr("qa","assessment_"+flownode.wcGraphItem.name);var item=flownode.wcGraphItem;var assessment=item.wcNodeInfo.assessment;this.wcItem=item;this.wcImage=new WcxLabel;this.wcImage._element.addClass("ds-icon-assessment");this.add(this.wcImage);if(assessment){var state=assessment.state;if(state&&state!="complete"){this.wcState=new WcxLabel;this.wcState._element.addClass("ds-assessment-state");
this.wcState.wcAssessmentState=state;if(assessment.tooltip)this.wcState.wcAssessmentTooltip=assessment.tooltip;this.add(this.wcState);this.wcState._element.ready(function(){var stateLabel=$(this._element).find(".ibx-label-text");var state=this.wcAssessmentState;var type;if(state=="running"){stateLabel.addClass("ds-icon-hour-glass");type="success"}else if(state=="error"){stateLabel.addClass("ds-icon-status-alert");type="error"}else if(state=="warning"){stateLabel.addClass("ds-icon-status-warn");type=
"warn"}else type="success";if(this.wcAssessmentTooltip)wcAttachTooltip(stateLabel,this.wcAssessmentTooltip,"up",type,"dq-tooltip")}.bind(this.wcState))}$(this.wcImage._element).on("click",this.doClick.bind(this));$(this.wcImage._element).on("mousedown",this.doMouseDown.bind(this));$(this.wcImage._element).on("mouseup",this.doMouseUp.bind(this))}flownode.wcConnectorRight=$("<div></div>");flownode.wcConnectorRight.addClass("ds-graph-connector ds-assessment-connector");var nodeInfo=item.wcNodeInfo;if(nodeInfo.rightportname)flownode.wcConnectorRight.on("mousedown",
function(evt){this.doConnectorMouseDown(evt,nodeInfo.rightportname,nodeInfo.rightportvalue)}.bind(flownode));if(nodeInfo.rightportstatus)wcAttachTooltip(flownode.wcConnectorRight,nodeInfo.rightportstatus,"right","error");flownode.wcConnectorRight.on("mousemove",flownode.doConnectorMouseMove.bind(flownode));var connectorHalfRight=$("<div></div>");connectorHalfRight.addClass("ds-connector-half");flownode.wcConnectorRight.append(connectorHalfRight);this._element.append(flownode.wcConnectorRight)}
_p=wcInherit(WcFlowAssessmentNode,WcxComponent);_p.doClick=function(evt){var xlinks=this.wcItem.wcNodeInfo.assessment.xlink;if(xlinks&&xlinks.length>0)for(var i=0;i<xlinks.length;i++){var xlink=xlinks[i];if(xlink){xlink.jqobj=this._element;wcSubmitLink(xlink)}}evt.stopPropagation();evt.preventDefault()};_p.doMouseDown=function(evt){evt.stopPropagation();evt.preventDefault()};_p.doMouseUp=function(evt){evt.stopPropagation();evt.preventDefault()};
function WcGraphLabel(text){if(_wcconstructing)return;WcxComponent.call(this);this._element.addClass("wcx-graph-label");$(this._element).css({"position":"relative","margin-bottom":"-10px","top":"10px"});$(this._element).append(text)}_p=wcInherit(WcGraphLabel,WcxComponent);
function WcGraphLink(link){if(_wcconstructing)return;WcxComponent.call(this);$(this._element).attr("id","link-"+link.dot.index+"-to-"+link.linkdot.index);this._element.addClass("wcx-graph-link");$(this._element).css({"visibility":"visible","width":"3px","height":"3px","position":"absolute","opacity":"0.001"});$(this._element).attr("from_index",link.dot.index);$(this._element).attr("from_name",link.dot.name);$(this._element).attr("to_index",link.linkdot.index);$(this._element).attr("to_name",link.linkdot.name);
$(this._element).attr("line_type",link.linetype);$(this._element).attr("line_start",link.linestart);$(this._element).attr("line_end",link.lineend);this.wcLink=link;$(this._element).on("contextmenu",this.doContextMenu.bind(this))}_p=wcInherit(WcGraphLink,WcxComponent);_p.doContextMenu=function(evt){if(this.wcLink._oncontextmenu)this.wcLink._oncontextmenu(evt);evt.stopPropagation();evt.preventDefault()};
function WcGraphLinkTip(title,left){if(_wcconstructing)return;WcxComponent.call(this);this._element.addClass("wcx-graph-link-tip");$(this._element).css({"display":"none","width":"10px","height":"10px","position":"absolute","left":left+"px","top":"500px"});$(this._element).attr("title",title)}_p=wcInherit(WcGraphLinkTip,WcxComponent);
function WcGraphMiniView(graph){if(_wcconstructing)return;WcxVBox.call(this);this.wcFlowGraph=graph;this._element.addClass("wcx-graph-miniview");$(this._element).css({"border":"1px solid #222222","z-index":"9999"});this.wcHeader=new WcxLabel;this.wcHeader._element.addClass("wcx-graph-miniview-header");$(this.wcHeader._element).css({"position":"absolute","top":"-10px","left":"-1px","width":"100%","height":"10px","border":"1px solid black","background-color":"rgb(204, 204, 204)","overflow":"hidden"});
this.add(this.wcHeader);var closeBtn=new WcxButtonSimple;closeBtn._element.addClass("wcx-closebutton");$(closeBtn._element).css({"position":"absolute","right":"0"});closeBtn.setIcon(wcapplication.imgstr.close);closeBtn.setTitle(ibx.resourceMgr.getString("hide"));closeBtn.addEventListener("click",this.doClose,this);this.wcHeader.add(closeBtn);this.wcBodyContent=new WcxComponent;this.wcBodyContent._element.addClass("wcx-miniview-bodycontent");$(this.wcBodyContent._element).css({"background-color":"#AAAAAA",
"width":"100%","height":"100%","overflow":"hidden"});this.add(this.wcBodyContent);this.wcCanvasBody=new WcGraphMiniCanvas(this);this.wcBodyContent.add(this.wcCanvasBody);this.wcResizable=$(this._element).resizable({handles:"e, s, w, se, ne, sw, nw",minWidth:120,minHeight:90,maxWidth:800,maxHeight:600,start:this.doResizeStart.bind(this),resize:this.doResize.bind(this),stop:this.doResizeStop.bind(this)});this.wcDraggable=$(this._element).draggable({containment:$(graph._element).parent(),start:this.doDraggableStart.bind(this),
stop:this.doDraggableStop.bind(this)})}_p=wcInherit(WcGraphMiniView,WcxVBox);
_p.doToggleShow=function(){var visible=!this.getVisible();this.setVisible(visible);var graph=this.wcFlowGraph;if(visible){sessionStorage.setItem("graph,"+graph.graphid+",miniview,visible",visible);sessionStorage.setItem("graph,"+graph.graphid+",miniview,top",42);sessionStorage.setItem("graph,"+graph.graphid+",miniview,left",2);sessionStorage.setItem("graph,"+graph.graphid+",miniview,width",300);sessionStorage.setItem("graph,"+graph.graphid+",miniview,height",200);this.doInitShow()}else this.doSavePosition()};
_p.doInitShow=function(){var miniview=this;var miniHeight=miniview._element.height();var miniWidth=miniview._element.width();var graph=this.wcFlowGraph;var savePos=true;var top=sessionStorage.getItem("graph,"+graph.graphid+",miniview,top");if(!top)top=42;else top=parseInt(top);if(top<42)top=42;else{var graphHeight=graph._element.height();if(graphHeight>0&&miniHeight>0){if(top>graphHeight-miniHeight-4)top=graphHeight-miniHeight-4}else savePos=false}var left=sessionStorage.getItem("graph,"+graph.graphid+
",miniview,left");if(!left)left=2;else left=parseInt(left);if(left<2)left=2;else{var graphWidth=graph._element.width();if(graphWidth>0&&miniWidth>0){if(left>graphWidth-miniWidth-4)left=graphWidth-miniWidth-4}else savePos=false}var width=sessionStorage.getItem("graph,"+graph.graphid+",miniview,width");if(width&&width<=miniWidth)width=parseInt(width);else width=300;var height=sessionStorage.getItem("graph,"+graph.graphid+",miniview,height");if(height&&height<=miniHeight)height=parseInt(height);else height=
200;miniview._element.css({"position":"absolute","top":top+"px","left":left+"px","width":width+"px","height":height+"px"});if(savePos)this.doSavePosition();this.doRefresh()};
_p.doRefresh=function(){if(!this.getVisible())return;if(this.wcMiniResizing)return;var graph=this.wcFlowGraph;var actualWidth=graph._element[0].scrollWidth;var actualHeight=graph._element[0].scrollHeight;var miniWidth=$(this.wcBodyContent._element).width();var miniHeight=$(this.wcBodyContent._element).height();if(!actualWidth||!actualHeight||!miniHeight)return;var actualRatio=actualWidth/actualHeight;var miniRatio=miniWidth/miniHeight;var canvasWidth=miniWidth;var canvasHeight=miniHeight;if(miniRatio>
actualRatio){canvasWidth=miniHeight*actualWidth/actualHeight;this.wcCanvasBody._element.css({"width":canvasWidth+"px","height":"100%","margin-left":"auto","margin-right":"auto","margin-top":"","margin-bottom":""})}else{canvasHeight=miniWidth*actualHeight/actualWidth;this.wcCanvasBody._element.css({"width":"100%","height":canvasHeight+"px","margin-left":"","margin-right":"","margin-top":"auto","margin-bottom":"auto"})}var scale=this.wcScale=canvasHeight/actualHeight;this.wcCanvasBody.removeAll();this._canvas=
$("<canvas></canvas>");this._canvas.attr("height",canvasHeight);this._canvas.attr("width",canvasWidth);this._canvas.css({"position":"absolute","top":"0","left":"0","right":"0","bottom":"0"});var context=this._canvas[0].getContext("2d");this.wcCanvasBody._element.append(this._canvas);this.wcScrollView=new WcGraphMiniScroll(this,scale);this.wcCanvasBody.add(this.wcScrollView);var isLeftRight=graph.isLeftRight;var dots=graph._dots;for(var i=0;i<dots.length;i++){var dot=dots[i];if(dot.type=="node"){var x=
dot.x*scale;var y=dot.y*scale;var w=dot.w*scale;var h=dot.h*scale;var nodeObj=new WcxComponent;nodeObj.wcGraphItem=dot;var collapsed=dot.wcNodeInfo.collapsed;var borderWidth=1;if(!isLeftRight&&collapsed)borderWidth=0;var isSelected=dot.wcGraphNode._element.hasClass("wcx-selected");var backgroundColor=isSelected?"rgba(53,184,254,0.4)":"";$(nodeObj._element).css({"position":"absolute","left":x+"px","top":y+"px","width":w+"px","height":h+"px","background-color":backgroundColor,"border":borderWidth+"px solid black"});
if(borderWidth==1)$(nodeObj._element).css({"overflow":"hidden"});nodeObj.setTitle(dot.text);$(nodeObj._element).on("click",this.doNodeClick.bind(nodeObj));this.wcCanvasBody.add(nodeObj);if(collapsed){var nodeIcon=new WcxLabel("");nodeIcon._element.css({"position":"absolute","top":"50%","left":"50%","text-align":"center","transform":"translate(-50%, -50%)"});if(dot.wcGraphIcon)nodeIcon.setIcon(dot.wcGraphIcon.wcIcon.img);else if(dot.wcNodeInfo.fontimage)nodeIcon.setIcon(dot.wcNodeInfo.fontimage.img);
nodeIcon.setSize(h+"px"),nodeObj.add(nodeIcon)}if(dot._links)for(var j=0;j<dot._links.length;j++){var link=dot._links[j];var dot1=dot;var dot2=link.linkdot;var anchor1=link.anchor1;var anchor2=link.anchor2;var x1=dot1.x*scale;var y1=dot1.y*scale;var x2=dot2.x*scale;var y2=dot2.y*scale;if(anchor1){if(anchor1=="left")y1+=dot1.h*scale/2;if(anchor1=="right"){x1+=dot1.w*scale;y1+=dot1.h*scale/2}if(anchor1=="top")x1+=dot1.w*scale/2;if(anchor1=="bottom"){x1+=dot1.w*scale/2;y1+=dot1.h*scale;if(!dot1.wcNodeInfo.collapsed)y1+=
2}}if(anchor2){if(anchor2=="left")y2+=dot2.h*scale/2;if(anchor2=="right"){x2+=dot2.w*scale;y2+=dot2.h*scale/2}if(anchor2=="top")x2+=dot2.w*scale/2;if(anchor2=="bottom"){x2+=dot2.w*scale/2;y2+=dot2.h*scale}}x1=x1+1;y1=y1+1;x2=x2+1;y2=y2+1;var strokeStyle="#31a3ce";if(link.options&&link.options.strokestyle)strokeStyle=link.options.strokestyle;if(link.highlight)strokeStyle=graph.highlightColor;else if(link.hover)strokeStyle=graph.hoverColor;context.beginPath();context.strokeStyle=strokeStyle;context.lineWidth=
1;context.moveTo(x1,y1);context.lineTo(x2,y2);context.stroke()}}}};_p.doClose=function(){this.setVisible(false);this.doSavePosition()};_p.doNodeClick=function(){var dot=this.wcGraphItem;var graphNode=dot?dot.wcGraphNode:null;if(graphNode)$(graphNode._element).focus()};
_p.doSavePosition=function(){var graph=this.wcFlowGraph;var visible=this.getVisible();if(visible){var pos=this._element.position();sessionStorage.setItem("graph,"+graph.graphid+",miniview,visible",true);sessionStorage.setItem("graph,"+graph.graphid+",miniview,top",pos.top);sessionStorage.setItem("graph,"+graph.graphid+",miniview,left",pos.left);sessionStorage.setItem("graph,"+graph.graphid+",miniview,width",this._element.width());sessionStorage.setItem("graph,"+graph.graphid+",miniview,height",this._element.height())}else{sessionStorage.removeItem("graph,"+
graph.graphid+",miniview,visible");sessionStorage.removeItem("graph,"+graph.graphid+",miniview,top");sessionStorage.removeItem("graph,"+graph.graphid+",miniview,left");sessionStorage.removeItem("graph,"+graph.graphid+",miniview,width");sessionStorage.removeItem("graph,"+graph.graphid+",miniview,height")}};_p.doResizeStart=function(){this.wcFlowGraph.wcOverlay.setVisible(true);this.wcMiniResizing=true};_p.doResize=function(){$(this.wcCanvasBody._element).css({"max-width":this._element.width(),"max-height":this._element.height()})};
_p.doResizeStop=function(){this.wcMiniResizing=false;$(this.wcCanvasBody._element).css({"max-width":"","max-height":""});this.wcFlowGraph.wcOverlay.setVisible(false);this.doRefresh();this.doSavePosition()};_p.doDraggableStart=function(){this.wcFlowGraph.wcOverlay.setVisible(true)};_p.doDraggableStop=function(){this.wcFlowGraph.wcOverlay.setVisible(false);this.doSavePosition()};
function WcGraphMiniCanvas(miniview){if(_wcconstructing)return;WcxComponent.call(this,"WcGraphMiniCanvas");this._element.addClass("wcx-miniview-canvasbody");this.wcMiniView=miniview;this._element.css({"display":"block","background-color":"white","position":"absolute","top":"50%","left":"50%","transform":"translate(-50%, -50%)","overflow":"hidden"});$(this._element).on("mousedown",this.doMouseDown.bind(this));$(this._element).on("mousemove",this.doMouseMove.bind(this));$(this._element).on("mouseup",
this.doMouseUp.bind(this))}_p=wcInherit(WcGraphMiniCanvas,WcxComponent);_p.doMouseDown=function(evt){var miniview=this.wcMiniView;var scrollViewEl=miniview.wcScrollView._element;if(evt.buttons==1){this.wcScrollStarted=true;var pos=$(scrollViewEl).position();this.wcScrollStartedAt={left:pos.left,top:pos.top,clientX:evt.clientX,clientY:evt.clientY};this.wcMaxLeft=$(this._element).width()-$(scrollViewEl).width();this.wcMaxTop=$(this._element).height()-$(scrollViewEl).height()}evt.stopPropagation();evt.preventDefault()};
_p.doMouseMove=function(evt){var miniview=this.wcMiniView;var graph=miniview.wcFlowGraph;var scale=miniview.wcScale;if(evt.buttons==1){if(!scale||scale==0)return;if(this.wcScrollStarted){var start=this.wcScrollStartedAt;var left=start.left+(evt.clientX-start.clientX);var top=start.top+(evt.clientY-start.clientY);if(left<0)left=0;if(top<0)top=0;if(left>this.wcMaxLeft)left=this.wcMaxLeft;if(top>this.wcMaxTop)top=this.wcMaxTop;left=parseInt(left/scale);top=parseInt(top/scale);$(graph._element).scrollLeft(left);
$(graph._element).scrollTop(top)}}else this.wcScrollStarted=false};_p.doMouseUp=function(evt){this.wcScrollStarted=false};
function WcGraphMiniScroll(miniview,scale){if(_wcconstructing)return;WcxComponent.call(this,"WcGraphMiniScroll");this.wcMiniView=miniview;this.wcScale=scale;var graph=miniview.wcFlowGraph;this._element.addClass("wcx-graph-miniscroll");$(this._element).css({"position":"absolute","border":"1px solid green","background-color":"lightgreen","overflow":"hidden","opacity":".5"});var actualScrollTop=graph._element.scrollTop();var actualScrollLeft=graph._element.scrollLeft();var actualClientWidth=graph._element.width();
var actualClientHeight=graph._element.height();var canvasScrollTop=actualScrollTop*scale;var canvasScrollLeft=actualScrollLeft*scale;var canvasClientWidth=actualClientWidth*scale;var canvasClientHeight=actualClientHeight*scale;$(this._element).css({"top":canvasScrollTop+"px","left":canvasScrollLeft+"px","width":canvasClientWidth+"px","height":canvasClientHeight+"px"})}_p=wcInherit(WcGraphMiniScroll,WcxComponent);
function WcPersistentToolTip(text,obj,subobj,arrow,linkxml){if(_wcconstructing)return;WcxComponent.call(this);if(!subobj)subobj=obj;var dx=0;var dy=0;this._arrow=arrow;if(arrow=="top")this._element.addClass("wcx-persistent-tooltip-top");else if(arrow=="right")this._element.addClass("wcx-persistent-tooltip-right");else if(arrow=="bottom")this._element.addClass("wcx-persistent-tooltip-bottom");else this._element.addClass("wcx-persistent-tooltip-left");this._element.css("box-shadow","unset");this.dx=
0;this.dy=0;this.setOption("position",{"of":subobj._element,"my":"left+"+0+" top+"+0,"at":"left top"});this._obj=obj;this._subobj=subobj;subobj.ptobj=this;if(subobj.wcNodeInfo)this.updDis(subobj.wcNodeInfo.collapsed);this._header=new WcxHBox;this._header._element.addClass("wcx-persistent-tooltip-header");var button=new WcxButtonSimple;button._element.addClass("wcx-persistent-tooltip-closebutton");button.setIcon(wcapplication.imgstr.close);button.addEventListener("click",function(evt){this.close();
this.dispose();this._subobj.ptobj=null;evt.stopPropagation();evt.preventDefault()},this);this._header.add(button);this.add(this._header);this._content=new WcxLabel(text);this._content.popup=this;this.add(this._content)}_p=wcInherit(WcPersistentToolTip,WcxComponent);_p.open=function(){this._obj.append(this._element);this.updPos()};_p.close=function(){this._element.remove()};
_p.updPos=function(){var obj=this._obj;var subobj=this._subobj;var x=subobj.x+this.dx+8;var y=subobj.y+this.dy;this._element.css("left",x);this._element.css("top",y)};_p.updDis=function(collapsed){var fw=this._obj.isCompact?24:48;if(this._arrow=="top")if(collapsed)this.dy=fw+10;else this.dy=this._subobj.h+10;else if(this._arrow=="left")if(collapsed)this.dx=fw+10;else this.dx=this._subobj.w+10};
function WcFlowChart(item,options){if(_wcconstructing)return;WcxVBox.call(this);this._element.addClass("wcx-flowchart");if(item.class)this._element.addClass(item.class);this.setName(item.name);this.wcItem=item}_p=wcInherit(WcFlowChart,WcxVBox);
function wcGetFlowExtensionPosition(idx,xout,yout,xin,yin){var position={};var linel;var offset=40+idx*28;if(xin===undefined){position.x=offset+xout;position.y=yout}else{var diag=Math.sqrt(Math.pow(yin-yout,2)+Math.pow(xin-xout,2));if(diag<=40)offset=14+idx*28;position.x=offset*(xin-xout)/diag+xout;position.y=offset*(yin-yout)/diag+yout}position.y-=14;position.x-=14;return position}
function WcBarChart(item){if(_wcconstructing)return;WcxVBox.call(this,"WcBarChart");this._element.addClass(item.active?"wcx-barchart-top-active":"wcx-barchart-top");var tb=new WcToolBar;var btns=wcGetTopButtons(item);if(btns)tb.addButtons(btns);tb.addSearchHandler(function(e){if(this.searchbox){if(this.searchbox.css("display")=="none")this.searchbox.css("display","");else this.closeSearchPanel();return}this.openSearchPanel()}.bind(this));this.add(tb);this._tb=tb;this._comp=new WcxComponent;this._comp._element.addClass("wcx-barchart");
this.add(this._comp);this.addEventListener("contextmenu",function(evt){evt.stopPropagation()});$(this._element).on("drop",function(evt){var e=evt.originalEvent;var dt=e.dataTransfer}.bind(this));var height=item.height;this._element.css("width","100%");var bars=item.bar;if(!bars)return;this._barn=bars.length;if(this._barn==0)return;var bwidth=20;this._barw=bwidth;this._gap=height?height/this._barn-this._barn-bwidth:7;this._bars=[];this._barsdata=[];for(var i=0;i<bars.length;i++){this._barsdata[i]=
[];var bar=bars[i];if(bar){this._barsdata[i]["bid"]=bar.id;this._barsdata[i]["btext"]=bar.text;this._barsdata[i]["btext1"]=bar.text1;this._barsdata[i]["btext2"]=bar.text2;this._barsdata[i]["btitle"]=bar.title;this._barsdata[i]["bwidth"]=20;this._barsdata[i]["percent1"]=bar.percent1;this._barsdata[i]["percent2"]=bar.percent2;if(typeof bar.selected=="undefined")this._barsdata[i]["selected"]=false;else this._barsdata[i]["selected"]=bar.selected;this._barsdata[i]["color1"]=bar.color1;this._barsdata[i]["color2"]=
bar.color2;var xlinkxml=bar.xlink;var xlink=null;if(xlinkxml&&xlinkxml.length>0)xlink=xlinkxml[0];this._barsdata[i]["xlink"]=xlink}}if(item.paging){this.wcPaging=item.paging;var pagingToolbar=new WcPagingToolbar(item.paging,this);this.add(pagingToolbar)}this.clickable=item.clickable;this.sort(0)}_p=wcInherit(WcBarChart,WcxVBox);
_p.addBar=function(index,text,text1,text2,title,w,h1,h2,selected,color1,color2,xlink){var v=new WcxComponent;v._element.addClass("wcx-chartbar");if(this._gap!=7)v._element.css("margin-top",this._gap+"px");v.index=index;v.selected=selected;if(text1){var l=$("<div></div>");l.text(text1);l.addClass("wcx-bar-label");v._element.append(l);v._label1=l}if(title)v.setTitle(title);if(h1>0){var v1=$("<div></div>").addClass(selected?"wcx-subbar-select":"wcx-subbar").css({"width":h1+"%","height":w+"px"});if(color1)v1.css("background-color",
color1);v._element.append(v1);v.v1=v1}var v2w=h2>h1?h2-h1:0;if(v2w>0){var v2=$("<div></div>").addClass(selected?"wcx-subbar2-select":"wcx-subbar2").css({"width":v2w+"%","height":w+"px"});if(color2)v2.css("background-color",color2);if(text2){var t2=$("<div></div>");t2.text(text2);v2._element.append(t2)}v._element.append(v2);v.v2=v2}this._comp.add(v);var that=this;$(v).on("click",function(e){if(!that.clickable)return;that.doSelect(this,e.ctrlKey,e.shiftKey);if(xlink&&!e.ctrlKey&&!e.shiftKey)wcSubmitLink(xlink)}.bind(v));
return v};_p.setHighlighted=function(bar,highlighted){if(highlighted){if(bar.v1){bar.v1.removeClass("wcx-subbar");bar.v1.addClass("wcx-subbar-select")}if(bar.v2){bar.v2.removeClass("wcx-subbar");bar.v2.addClass("wcx-subbar2-select")}}else{if(bar.v1){bar.v1.removeClass("wcx-subbar-select");bar.v1.addClass("wcx-subbar")}if(bar.v2){bar.v2.removeClass("wcx-subbar2-select");bar.v2.addClass("wcx-subbar2")}}};
_p.doSelect=function(bar,ctrl,shift){if(!ctrl&&!shift){for(var i=0;i<this._bars.length;++i){this.setHighlighted(this._bars[i],false);this._bars[i].selected=false;this._barsdata[i].selected=false}this.setHighlighted(bar,true);bar.selected=true;this._barsdata[bar.index].selected=true}else if(ctrl)for(var i=0;i<this._bars.length;++i){var bari=this._bars[i];if(bari.index==bar.index)if(bar.selected){this.setHighlighted(bar,false);bar.selected=false;this._barsdata[bar.index].selected=false}else{this.setHighlighted(bar,
true);bar.selected=true;this._barsdata[bar.index].selected=true}}else if(shift){var sel=null;for(var i=0;i<this._bars.length;++i)if(this._bars[i].selected)sel=this._bars[i];if(!sel){this.setHighlighted(bar,false);bar.selected=false;this._barsdata[bar.index].selected=false}else{var s=sel.index>bar.index?bar.index:sel.index;var e=sel.index<bar.index?bar.index:sel.index;for(var i=s;i<=e;++i){this.setHighlighted(this._bars[i],true);this._bars[i].selected=true;this._barsdata[i].selected=true}}}};
_p.sort=function(by){this._comp.removeAll();var newbars=[];if(by)this._barsdata.sort(function(a,b){if(by==1){if(a.btext1>b.btext1)return 1;if(b.btext1>a.btext1)return-1;return 0}else if(by==2)return a.percent2-b.percent2;else if(by==3)return b.percent2-a.percent2;else return 0});for(var i=0;i<this._barsdata.length;i++){var b=this.addBar(i,this._barsdata[i]["btext"],this._barsdata[i]["btext1"],this._barsdata[i]["btext2"],this._barsdata[i]["btitle"],this._barsdata[i]["bwidth"],this._barsdata[i]["percent1"],
this._barsdata[i]["percent2"],this._barsdata[i]["selected"],this._barsdata[i]["color1"],this._barsdata[i]["color2"],this._barsdata[i]["xlink"]);newbars.push(b)}this._bars=newbars;this._comp._element.scrollTop(0)};_p.sortAZ=function(e){this._sortaa.setHighlighted(true);this._sortma.setHighlighted(false);this._sortmd.setHighlighted(false);this.sort(1)};_p.sortNI=function(e){this._sortaa.setHighlighted(false);this._sortma.setHighlighted(true);this._sortmd.setHighlighted(false);this.sort(2)};
_p.sortND=function(e){this._sortaa.setHighlighted(false);this._sortma.setHighlighted(false);this._sortmd.setHighlighted(true);this.sort(3)};
_p.openSearchPanel=function(text){if(this.searchbox)return;this.searchbox=$("<div></div>").addClass("wcx-chart-searchbox").insertBefore(this._comp._element);this.searchbox.input=$("<input type='text'></input>").attr("qa","searchinput").val(text?text:this.searchstr?this.searchstr:"").appendTo(this.searchbox).focus();this._resizeSearchBox();this.searchbox.input.keyup(function(e){if(this.searchbox.timerid){clearTimeout(this.searchbox.timerid);delete this.searchbox.timerid}if(e.keyCode==$.ui.keyCode.ENTER)this.search(this.searchbox.input.val());
else this.searchbox.timerid=setTimeout(function(graph){delete graph.searchbox.timerid;graph.search(graph.searchbox.input.val())},400,this)}.bind(this));var button=new WcxButtonSimple(null,wcapplication.imgstr.search_next);button._element.addClass("wcx-chart-searchbox-button").css("margin-right","0px");button.setTitle(ibx.resourceMgr.getString("next"));button._element.on("click",function(){var i=this._currentnode;if(i<0)return;if(i==this._bars.length-1)i=0;else i++;while(!this._bars[i]._found)if(i==
this._bars.length-1)i=0;else i++;this._comp._element.scrollTop(i*(this._barw+this._gap))}.bind(this));this.searchbox.append(button._element);button.setVisible(false);this.nextbtn=button;var button=new WcxButtonSimple(null,wcapplication.imgstr.search_prev);button._element.addClass("wcx-chart-searchbox-button").css("margin-right","0px");button.setTitle(ibx.resourceMgr.getString("prev"));button._element.on("click",function(){var i=this._currentnode;if(i<0)return;if(i==0)i=this._bars.length-1;else i--;
while(!this._bars[i]._found)if(i==0)i=this._bars.length-1;else i--;this._comp._element.scrollTop(i*(this._barw+this._gap))}.bind(this));this.searchbox.append(button._element);button.setVisible(false);this.prvbtn=button;var button=new WcxButtonSimple(null,"ds-icon-times");button._element.addClass("wcx-chart-searchbox-button").css("margin-right","0px");button.setTitle(ibx.resourceMgr.getString("cancel"));button._element.on("click",function(){if(this.searchbox.input.val()==""){this.closeSearchPanel();
return}this.searchbox.input.val("");this.searchbox.input.focus();this.search("")}.bind(this));this.searchbox.append(button._element)};_p.showNext=function(show){this.prvbtn.setVisible(show);this.nextbtn.setVisible(show);this._resizeSearchBox(show)};_p.closeSearchPanel=function(){if(this.searchbox)if(!this.searchstr){this.searchbox.remove();delete this.searchbox}else this.searchbox.css("display","none")};
_p._resizeSearchBox=function(show){if(!this.searchbox)return;var len=Math.min(400,this._element.prop("clientWidth")-40);this.searchbox.width(len);var width=Math.floor(this.searchbox.outerWidth(true));this.searchbox.input.width(width-52-(show?50:0))};
_p.search=function(str){var s=str.trim();if(!s)delete this.searchstr;else{this.searchstr=s;var str=s.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&");var searchstr="("+str+")";this.rplregexp=new RegExp(searchstr,"ig");this.srchregexp=new RegExp(str,"i")}var found1=-1;for(var i=0;i<this._bars.length;i++){var fh=this.searchBar(this._bars[i]);if(found1<0&&fh)found1=i;if(fh)this._bars[i]._found=true;else this._bars[i]._found=false}var nf=0;for(var i=0;i<this._bars.length;i++){if(found1<0&&this._bars[i]._found)found1=
i;if(this._bars[i]._found)nf++}if(found1>=0){this._comp._element.scrollTop(found1*(this._barw+this._gap));this._currentnode=found1}else if(!s){this._comp._element.scrollTop(0);this._currentnode=0}};
_p.searchBar=function(bar){var h=bar._label1;if(this.searchstr&&this.srchregexp.test(this._barsdata[bar.index].btext1)){$(h).html(this._barsdata[bar.index].btext1);var nhtml=$(h).html().replace(this.rplregexp,"<span class='wcx-search-highlighted'>$1</span>");$(h).html(nhtml);return true}else{$(h).html(this._barsdata[bar.index].btext1);return false}};_p.getParams=function(){return[]};
$.widget("ibi.wcCalculator",$.ibi.ibxPopup,{options:{title:"my Title",wclng:""},_create:function(){this._super();this.element.ibxWidget({"resizable":true,"movable":true,"modal":true});this.element.addClass("wcx-calculator-window");this.element.addClass("wcx-popup-window");this.container=$("<div>").ibxVBox().addClass("wcx-popup-window-container");this.element.append(this.container);this.header=$("<div>").ibxHBox().addClass("wcx-popup-window-header");this.title=$("<div>").ibxLabel({"text":this.options.title}).addClass("wcx-calculator-title").appendTo(this.header);
var button=$("<div>").ibxButtonSimple({"glyphClasses":"ds-icon-close"}).addClass("wcx-popup-window-header-closebutton");button.on("click",function(e){this.element.ibxWidget("close")}.bind(this));this.header.append(button);this.container.append(this.header)},_setOption:function(key,value){if(key==="title")if(this.title)this.title.ibxWidget({"text":value});this._super(key,value)},close:function(closeInfo){if(typeof this.opendata==="string"){this.callback=this._super;var xml=new WcLoader(wcapplication.wcurl);
xml.addParam("mt_id",this.opendata);xml.addParam("mt_action","getcaldata");xml.load(function(){this.callback(closeInfo);delete this.callback}.bind(this));delete this.opendata}else this._super(closeInfo)},open:function(data){this._super();this.opendata=data;if(!window.wcapplication){window.wcapplication=new wcApplication;var url=$('script[src$="/wcc.js"]').attr("src").replace(/IWAYNODE_[^\/]+(.+)/g,function(match,$1){return match.replace($1,"/wc/wchome.xmlt")});window.wcapplication.init(url,this._load.bind(this))}else this._load()},
_load:function(){this.body=new WcxVBox;this.body._element.addClass("wcx-popup-window-body");this.container.append(this.body._element);var url=$('script[src$="/wcc.js"]').attr("src").replace(/IWAYNODE_[^\/]+(.+)/g,function(match,$1){return match.replace($1,"/webconsole")});var xml=new WcLoader(url);xml.addParam("mt_action","startcal");if(typeof this.opendata==="string")xml.addParam("mt_id",this.opendata);if(this.options.wclng!="")xml.addParam("IBIS_wclng",this.options.wclng);xml.load(wcxParseXml,this.body)}});
function WcExpCalculator(item){if(_wcconstructing)return;WcxVBox.call(this);this._element.addClass("wcx-expcalculator");this.setName(item.name);this.wcItem=item;wcapplication.setWcfObject(this);var bar=new WcToolBar;var btns=wcGetTopButtons(item);if(btns)bar.addButtons(btns);if(btns)this.add(bar);var body=new WcxVBox;body._element.addClass("wcx-expcalculator-body");this.add(body);this.wcBtnsOnTop=true;this.wcBtnLayout=0;this.wcEditorPanel=this.createEditorPanel();this.wcButtonsPanel=this.createButtonsPanel();
body.add(this.wcButtonsPanel);body.add(this.wcEditorPanel);var expCalc=this;this._element.ready(function(){$(expCalc._element).closest(".wcx-wcform").css("flex","1");$(expCalc._element).closest(".wcx-wcform-grid").css("display","flex");$(expCalc._element).closest(".wcx-wcform-grid").css("flex-direction","column");$(expCalc._element).closest(".wcx-wcform-grid").css("height","100%");var aceEditor=ace.edit(expCalc.wcEditor._id);expCalc.restoreSession(aceEditor);aceEditor.renderer.setShowGutter(false);
var s=aceEditor.getSession();s.setOption("indentedSoftWrap",false);s.setUseWrapMode(true);s.setUseSoftTabs(false);aceEditor.setShowPrintMargin(false);aceEditor.setValue(item.value);expCalc.wcAceEditor=aceEditor;var selStart=parseInt(item.selstartvalue);var selLength=parseInt(item.sellenvalue);if(selStart||selLength){if(!selStart)selStart=0;if(!selLength)selLength=0;var range=expCalc.getSelRange(selStart,selLength);aceEditor.selection.setSelectionRange(range,false)}else aceEditor.navigateFileEnd();
aceEditor.container.addEventListener("contextmenu",expCalc.doRightClick.bind(expCalc),false);var parent=$(expCalc._element).parent();if(parent)parent.on("resize",function(){aceEditor.resize(true)});aceEditor.focus()})}_p=wcInherit(WcExpCalculator,WcxVBox);_p._dispose=_p.dispose;_p.dispose=function(){wcapplication.clrWcfObject(this);this._dispose.call(this)};
_p.getParams=function(){var name=this.getName();if(name==null||name=="")return null;var p=new Object;var value=this.wcAceEditor?this.wcAceEditor.getValue():"";p[name]=[value];this.addSelectionParams(p);return p};_p.addSelectionParams=function(p){var selstartname=this.wcItem.selstartname;if(selstartname){var selstart=this.getSelStart();p[selstartname]=selstart;var sellenname=this.wcItem.sellenname;if(sellenname){var sellen=this.getSelLength();p[sellenname]=sellen}}};
_p.getSelStart=function(){var selstart=0;if(this.wcAceEditor){var selectionRange=this.wcAceEditor.getSelectionRange();selstart=selectionRange.start.row;for(var i=0;i<selectionRange.start.row;i++)selstart+=this.wcAceEditor.session.getLine(i).length;selstart+=selectionRange.start.column}return selstart};_p.getSelLength=function(){var sellength=0;if(this.wcAceEditor){var selectedText=this.wcAceEditor.getSelectedText();sellength=selectedText.length}return sellength};
_p.getSelRange=function(start,length){var startRow=0;var startCol=0;var startFound=false;var end=start+length;var endRow=0;var endCol=0;var endFound=false;var session=this.wcAceEditor.session;var rows=session.getLength();var lastColIndex=0;for(var i=0;i<rows;i++){var lineLength=session.getLine(i).length;if(i==0){if(start<=lineLength){startRow=0;startCol=start;startFound=true}if(end<=lineLength){endRow=0;endCol=end;endFound=true}}else{if(!startFound&&start<=lastColIndex+lineLength+1){startRow=i;startCol=
start-lastColIndex-1;startFound=true}if(!endFound&&end<=lastColIndex+lineLength+1){endRow=i;endCol=end-lastColIndex-1;endFound=true}}lastColIndex+=lineLength;if(i>0)lastColIndex+=1;if(startFound&&endFound)break}var range={};range.start={};range.start.row=startRow;range.start.column=startCol;range.end={};range.end.row=endRow;range.end.column=endCol;return range};
_p.createEditorPanel=function(){var editorPanel=new WcxHBox;editorPanel._element.addClass("wcx-expcalculator-editor");editorPanel.setDragOverEventListener(this.doDragOver,this);editorPanel.setDropEventListener(this.doDrop,this);var editor=new WcxComponent;editor._element.addClass("wcx-expcalculator-ace");$(editor._element).on("dragover",this.doDragOver);$(editor._element).on("drop",this.doDrop);editorPanel.add(editor);this.wcEditor=editor;return editorPanel};
_p.createButtonsPanel=function(){var buttonsPanel=new WcxComponent;buttonsPanel._element.addClass("wcx-expcalculator-buttonspanel");buttonsPanel.addEventListener("contextmenu",this.doButtonsContextClick,this);this.createButtonLayout0(buttonsPanel);return buttonsPanel};
_p.doButtonsContextClick=function(evt){var menu=new WcxMenu;menu.wcSwapBtn=new WcxMenuItem("Show buttons "+(this.wcBtnsOnTop?"at bottom":"on top"));menu.wcSwapBtn.setIcon("ds-icon-move-vertical");menu.wcSwapBtn.addEventListener("click",this.doToggle,this);menu.addItem(menu.wcSwapBtn);menu.wcLayoutBtn=new WcxMenuItem("Switch button layout");menu.wcLayoutBtn.setIcon("ds-icon-calculator");menu.wcLayoutBtn.addEventListener("click",this.doBtnLayouts,this);menu.addItem(menu.wcLayoutBtn);menu.setOption("position",
{"my":"left top","at":"left bottom","collision":"flipfit flipfit","of":evt});menu.open()};
_p.createButtonLayout0=function(btnsPanel){var btn=null;var btnWidth=20;btnsPanel.removeAll();var btnsVBox=new WcxVBox;$(btnsVBox._element).css("margin","0 auto");$(btnsVBox._element).css("margin-top","0px");$(btnsVBox._element).css("margin-left","5px");$(btnsVBox._element).css("margin-right","5px");btnsPanel.add(btnsVBox);var btnsContainer=new WcxComponent;btnsContainer._element.addClass("wcx-expcalculator-buttonscontainer");btnsVBox.add(btnsContainer);btn=new WcxButton("+");this.setBtn(btn,1,btnWidth,
"+",5);btnsContainer.add(btn);btn=new WcxButton("-");this.setBtn(btn,1,btnWidth,"-",5);btnsContainer.add(btn);btn=new WcxButton("*");this.setBtn(btn,1,btnWidth,"*",5);btnsContainer.add(btn);btn=new WcxButton("/");this.setBtn(btn,1,btnWidth,"/",5);btnsContainer.add(btn);btn=new WcxButton("(");this.setBtn(btn,1,btnWidth,"(",5);btnsContainer.add(btn);btn=new WcxButton(")");this.setBtn(btn,1,btnWidth,")",5);btnsContainer.add(btn);btn=new WcxButton("IF");this.setBtn(btn,1,btnWidth*2,"IF");btnsContainer.add(btn);
btn=new WcxButton("THEN");this.setBtn(btn,1,btnWidth*2,"THEN",5);btnsContainer.add(btn);btn=new WcxButton("ELSE");this.setBtn(btn,1,btnWidth*2,"ELSE",5);btnsContainer.add(btn);btn=new WcxButton("EQ");this.setBtn(btn,1,btnWidth,"EQ",5);btnsContainer.add(btn);btn=new WcxButton("NE");this.setBtn(btn,1,btnWidth,"NE",5);btnsContainer.add(btn);btn=new WcxButton("GT");this.setBtn(btn,1,btnWidth,"GT",5);btnsContainer.add(btn);btn=new WcxButton("GE");this.setBtn(btn,1,btnWidth,"GE",5);btnsContainer.add(btn);
btn=new WcxButton("LT");this.setBtn(btn,1,btnWidth,"LT",5);btnsContainer.add(btn);btn=new WcxButton("LE");this.setBtn(btn,1,btnWidth,"LE",5);btnsContainer.add(btn);btn=new WcxButton("AND");this.setBtn(btn,1,btnWidth*2,"AND",5);btnsContainer.add(btn);btn=new WcxButton("OR");this.setBtn(btn,1,btnWidth*2,"OR",5);btnsContainer.add(btn);btn=new WcxButton("NOT");this.setBtn(btn,1,btnWidth*2,"NOT",5);btnsContainer.add(btn);btn=new WcxButton("|");this.setBtn(btn,1,btnWidth,"|",5);btnsContainer.add(btn);btn=
new WcxButton("||");this.setBtn(btn,1,btnWidth,"||",5);btnsContainer.add(btn);btn=new WcxButton;btn.setTitle("Undo");btn._element.css("margin-left","0px");btn.setIcon("ds-icon-undo");this.setBtn(btn,5,btnWidth,"undo",5);btnsContainer.add(btn);btn=new WcxButton;btn.setTitle("Redo");btn._element.css("margin-left","0px");btn.setIcon("ds-icon-redo");this.setBtn(btn,5,btnWidth,"redo",5);btnsContainer.add(btn);btn=new WcxButton;btn.setTitle("Clear all");btn._element.css("margin-left","0px");btn.setIcon("ds-icon-delete");
this.setBtn(btn,5,btnWidth,"clearall",5);btnsContainer.add(btn);this.wcSwapBtn=new WcxButton;this.wcSwapBtn.setTitle("Show buttons "+(this.wcBtnsOnTop?"at bottom":"on top"));this.wcSwapBtn._element.css("margin-left","0px");this.wcSwapBtn.setIcon("ds-icon-move-vertical");this.setBtn(this.wcSwapBtn,5,btnWidth,"toggle",5);btnsContainer.add(this.wcSwapBtn)};
_p.createButtonLayout1=function(btnsPanel){var btn=null;var btnWidth=20;btnsPanel.removeAll();var btnsVBox=new WcxVBox;$(btnsVBox._element).css("width","480px");$(btnsVBox._element).css("margin","0 auto");$(btnsVBox._element).css("margin-top","0px");btnsPanel.add(btnsVBox);var topBtns=new WcxHBox;$(topBtns._element).css("width","100%");btnsVBox.add(topBtns);var leftBtns=new WcxVBox;$(leftBtns._element).css("height","100%");topBtns.add(leftBtns);var left1=new WcxHBox;leftBtns.add(left1);btn=new WcxButton("LT");
this.setBtn(btn,1,btnWidth,"LT");left1.add(btn);btn=new WcxButton("EQ");this.setBtn(btn,1,btnWidth,"EQ");left1.add(btn);btn=new WcxButton("GT");this.setBtn(btn,1,btnWidth,"GT");left1.add(btn);btn=new WcxButton("|");this.setBtn(btn,1,btnWidth,"|");left1.add(btn);btn=new WcxButton('""');this.setBtn(btn,2,btnWidth,'""');left1.add(btn);btn=new WcxButton("''");this.setBtn(btn,2,btnWidth,"''");left1.add(btn);var left2=new WcxHBox;leftBtns.add(left2);btn=new WcxButton("LE");this.setBtn(btn,1,btnWidth,"LE");
left2.add(btn);btn=new WcxButton("NE");this.setBtn(btn,1,btnWidth,"NE");left2.add(btn);btn=new WcxButton("GE");this.setBtn(btn,1,btnWidth,"GE");left2.add(btn);btn=new WcxButton("||");this.setBtn(btn,1,btnWidth,"||");left2.add(btn);btn=new WcxButton("()");this.setBtn(btn,2,btnWidth,"()");left2.add(btn);btn=new WcxButton("");btn.setWidth(btnWidth);btn.setHeight(17);$(btn._element).css("visibility","hidden");$(btn._element).css("opacity","0");left2.add(btn);var left3=new WcxHBox;leftBtns.add(left3);
btn=new WcxButton("IF");this.setBtn(btn,1,btnWidth*3-3,"IF");left3.add(btn);btn=new WcxButton("THEN");this.setBtn(btn,1,btnWidth*3-4,"THEN");left3.add(btn);btn=new WcxButton("ELSE");this.setBtn(btn,1,btnWidth*3-3,"ELSE");left3.add(btn);var left4=new WcxHBox;leftBtns.add(left4);btn=new WcxButton("AND");this.setBtn(btn,1,btnWidth*3-3,"AND");left4.add(btn);btn=new WcxButton("OR");this.setBtn(btn,1,btnWidth*3-4,"OR");left4.add(btn);btn=new WcxButton("NOT");this.setBtn(btn,1,btnWidth*3-3,"NOT");left4.add(btn);
var numBtns=new WcxVBox;$(numBtns._element).css("margin-left","5px");$(numBtns._element).css("height","100%");topBtns.add(numBtns);var num1=new WcxHBox;numBtns.add(num1);btn=new WcxButton("7");this.setBtn(btn,0,btnWidth,"7");num1.add(btn);btn=new WcxButton("8");this.setBtn(btn,0,btnWidth,"8");num1.add(btn);btn=new WcxButton("9");this.setBtn(btn,0,btnWidth,"9");num1.add(btn);btn=new WcxButton("/");this.setBtn(btn,1,btnWidth,"/");num1.add(btn);var num2=new WcxHBox;numBtns.add(num2);btn=new WcxButton("4");
this.setBtn(btn,0,btnWidth,"4");num2.add(btn);btn=new WcxButton("5");this.setBtn(btn,0,btnWidth,"5");num2.add(btn);btn=new WcxButton("6");this.setBtn(btn,0,btnWidth,"6");num2.add(btn);btn=new WcxButton("*");this.setBtn(btn,1,btnWidth,"*");num2.add(btn);var num3=new WcxHBox;numBtns.add(num3);btn=new WcxButton("1");this.setBtn(btn,0,btnWidth,"1");num3.add(btn);btn=new WcxButton("2");this.setBtn(btn,0,btnWidth,"2");num3.add(btn);btn=new WcxButton("3");this.setBtn(btn,0,btnWidth,"3");num3.add(btn);btn=
new WcxButton("-");this.setBtn(btn,1,btnWidth,"-");num3.add(btn);var num4=new WcxHBox;numBtns.add(num4);btn=new WcxButton("0");this.setBtn(btn,0,btnWidth,"0");num4.add(btn);btn=new WcxButton(" ");btn.setWidth(btnWidth);$(btn._element).css("visibility","hidden");$(btn._element).css("opacity","0");num4.add(btn);btn=new WcxButton(".");this.setBtn(btn,0,btnWidth,".");num4.add(btn);btn=new WcxButton("+");this.setBtn(btn,1,btnWidth,"+");num4.add(btn);var rightBtns=new WcxVBox;$(rightBtns._element).css("margin-left",
"5px");topBtns.add(rightBtns);btn=new WcxButton("a->A");this.setBtn(btn,3,btnWidth*4,"a->A");rightBtns.add(btn);btn=new WcxButton("A->a");this.setBtn(btn,3,btnWidth*4,"A->a");rightBtns.add(btn);if(this.wcItem.xlinkdate){btn=new WcxButton("Date");this.setBtn(btn,4,btnWidth*4,"Date");rightBtns.add(btn)}if(this.wcItem.xlinkdatetime){btn=new WcxButton("Datetime");this.setBtn(btn,4,btnWidth*4,"Datetime");rightBtns.add(btn)}var bottomBtns=new WcxHBox;$(bottomBtns._element).css("width","100%");$(bottomBtns._element).css("margin-top",
"5px");btnsVBox.add(bottomBtns);btn=new WcxButton("SPACE");this.setBtn(btn,0,btnWidth*6+9," ");bottomBtns.add(btn);btn=new WcxButton("BACKSPACE");this.setBtn(btn,5,btnWidth*6+15,"backspace");bottomBtns.add(btn);this.wcSwapBtn=new WcxButton;this.wcSwapBtn.setTitle("Show buttons "+(this.wcBtnsOnTop?"at bottom":"on top"));this.wcSwapBtn.setIcon("ds-icon-move-vertical");this.setBtn(this.wcSwapBtn,5,btnWidth,"toggle");bottomBtns.add(this.wcSwapBtn);btn=new WcxButton;btn.setTitle("Switch button layout");
btn.setIcon("ds-icon-calculator");this.setBtn(btn,5,btnWidth,"layout");bottomBtns.add(btn);btn=new WcxButton("Clear all");btn._element.addClass("wcx-expcalculator-btn-clearall");this.setBtn(btn,5,btnWidth*4,"clearall");bottomBtns.add(btn)};
_p.setBtn=function(btn,type,width,btnVal,margin){btn.setWidth(width);btn.wcCalc=this;btn.wcType=type;if(btnVal)btn.wcBtn=btnVal;if(margin){$(btn._element).css("margin-right",margin+"px");$(btn._element).css("margin-bottom",margin+"px")}btn.addEventListener("click",this.doBtnClick,btn)};
_p.restoreSession=function(aceEditor){var sessionContainer=$(this._element).closest(".wcx-popup-window");if(!sessionContainer||sessionContainer.length==0)sessionContainer=$(this._element).closest(".wcx-wcform");if(sessionContainer&&sessionContainer.length>0){var wcSession=sessionContainer.data("wcsession");if(wcSession)aceEditor.setSession(wcSession);sessionContainer.data("wcsession",aceEditor.session)}};
_p.doBtnClick=function(){var expCalc=this.wcCalc;var aceEditor=expCalc.wcAceEditor;var selectionRange=aceEditor.getSelectionRange();if(this.wcType<3){if(this.wcType==1)if(selectionRange.start.column>0){selectionRange.start.column=selectionRange.start.column-1;var ch=aceEditor.session.getTextRange(selectionRange);if(ch!=" ")aceEditor.insert(" ")}else aceEditor.insert(" ");if(this.wcType>=0&&this.wcType<=2)aceEditor.insert(this.wcBtn);if(this.wcType==1){var row=aceEditor.session.getLength()-1;var maxCol=
aceEditor.session.getLine(row).length;var cursorPos=aceEditor.getCursorPosition();var curCol=cursorPos.column;if(curCol<maxCol)aceEditor.insert(" ")}if(this.wcType==2){selectionRange=aceEditor.getSelectionRange();var row=selectionRange.start.row;var column=selectionRange.start.column-1;aceEditor.gotoLine(row+1,column)}}else if(this.wcType==3){var selectedText=aceEditor.getSelectedText();var newText="";if(this.wcBtn=="a->A")newText=selectedText.toUpperCase();else newText=selectedText.toLowerCase();
aceEditor.session.replace(selectionRange,newText)}else if(this.wcType==4){var name=expCalc.wcItem.name;if(name){var link=null;if(this.wcBtn=="Date")link=JSON.parse(JSON.stringify(expCalc.wcItem.xlinkdate));else if(this.wcBtn=="Datetime")link=JSON.parse(JSON.stringify(expCalc.wcItem.xlinkdatetime));if(link){var value=expCalc.wcAceEditor?expCalc.wcAceEditor.getValue():"";var p={};expCalc.addSelectionParams(p);wcAddParameter(link,name,value);for(var i in p)if(i&&p.hasOwnProperty(i))wcAddParameter(link,
i,p[i]);link.jqobj=expCalc._element;wcSubmitLink(link)}}}else if(this.wcType==5)if(this.wcBtn=="backspace"){if(selectionRange.start.row==selectionRange.end.row&&selectionRange.start.column==selectionRange.end.column)if(selectionRange.start.column>0)selectionRange.start.column=selectionRange.start.column-1;else if(selectionRange.start.row>0){selectionRange.start.row=selectionRange.start.row-1;selectionRange.start.column=aceEditor.session.getLine(selectionRange.start.row).length}aceEditor.session.replace(selectionRange,
"")}else if(this.wcBtn=="undo")aceEditor.undo();else if(this.wcBtn=="redo")aceEditor.redo();else if(this.wcBtn=="clearall")aceEditor.setValue("");else if(this.wcBtn=="toggle"){expCalc.doToggle();expCalc.wcSwapBtn.setTitle("Show buttons "+(expCalc.wcBtnsOnTop?"at bottom":"on top"))}else if(this.wcBtn=="layout")expCalc.doBtnLayouts();aceEditor.focus()};
_p.doToggle=function(){if(this.wcBtnsOnTop)$(this.wcButtonsPanel._element).insertAfter($(this.wcEditorPanel._element));else $(this.wcEditorPanel._element).insertAfter($(this.wcButtonsPanel._element));this.wcBtnsOnTop=!this.wcBtnsOnTop};_p.doBtnLayouts=function(){if(this.wcBtnLayout==1){this.createButtonLayout0(this.wcButtonsPanel);this.wcBtnLayout=0}else{this.createButtonLayout1(this.wcButtonsPanel);this.wcBtnLayout=1}};
_p.doRefresh=function(){var name=this.wcItem.name;if(name&&this.wcItem.xlinkrefresh){var xlink=JSON.parse(JSON.stringify(this.wcItem.xlinkrefresh));var value=this.wcAceEditor?this.wcAceEditor.getValue():"";wcAddParameter(xlink,name,value);var p={};this.addSelectionParams(p);for(var i in p)if(i&&p.hasOwnProperty(i))wcAddParameter(xlink,i,p[i]);xlink.jqobj=this._element;wcSubmitLink(xlink)}};
_p.doRightClick=function(evt){evt.preventDefault();this.wcRightClickEvent=evt;var xlinkLoaded=false;var name=this.wcItem.name;if(name&&this.wcItem.xlinkrightclick){var xlink=JSON.parse(JSON.stringify(this.wcItem.xlinkrightclick));var value=this.wcAceEditor?this.wcAceEditor.getValue():"";wcAddParameter(xlink,name,value);var p={};this.addSelectionParams(p);for(var i in p)if(i&&p.hasOwnProperty(i))wcAddParameter(xlink,i,p[i]);xlink.jqobj=this._element;var xml=new WcLoader(xlink.url);xml.addParam(xlink.parameters);
xml.load(this.doRightClickCallback,this);xlinkLoaded=true}if(!xlinkLoaded){var menu=new WcxMenu;this.doRightClickMenu(menu);menu.setOption("position",{"my":"left top","at":"left bottom","collision":"flipfit flipfit","of":evt});menu.open()}return false};
_p.doRightClickCallback=function(rsp,page){var menu=null;if(rsp&&rsp.data&&rsp.data.item&&page)for(var i=0;i<rsp.data.item.length;i++){var wctree=rsp.data.item[i];if(wctree&&wctree.type=="wctree"){var rnode=wctree.node[0];if(rnode){menu=wcBuildMenu(page._element,rnode,null,null);if(menu)menu.addItem(new WcxMenuSeparator);break}}}if(!menu)menu=new WcxMenu;page.addClientOptions(menu);menu.setOption("position",{"my":"left top","at":"left bottom","collision":"flipfit flipfit","of":page.wcRightClickEvent});
menu.open()};
_p.addClientOptions=function(menu){var aceEditor=this.wcAceEditor;var selectedText=aceEditor.getSelectedText();var hasSelection=selectedText.length>0;menuitem=new WcxMenuItem("Uppercase");menuitem.setEnabled(hasSelection);menuitem.wcCalc=this;menuitem.wcType=3;menuitem.wcBtn="a->A";menuitem.addEventListener("click",this.doBtnClick,menuitem);menu.addItem(menuitem);menuitem=new WcxMenuItem("Lowercase");menuitem.setEnabled(hasSelection);menuitem.wcCalc=this;menuitem.wcType=3;menuitem.wcBtn="A->a";menuitem.addEventListener("click",
this.doBtnClick,menuitem);menu.addItem(menuitem)};_p.doDragOver=function(evt){evt.preventDefault();evt.stopPropagation();var e=evt.originalEvent;var dt=e.dataTransfer;dt.dropEffect="copy"};
_p.doDrop=function(evt){evt.preventDefault();evt.stopPropagation();var e=evt.originalEvent;var dt=e.dataTransfer;var data=dt.getData("text");if(this.wcItem.xlinkd){var link=JSON.parse(JSON.stringify(this.wcItem.xlinkd));var p=data.indexOf("=");if(p>0){wcAddParameter(link,data.substring(0,p),data.substring(p+1));var name=this.wcItem.name;if(name){var value=this.wcAceEditor?this.wcAceEditor.getValue():"";wcAddParameter(link,name,value);var k={};this.addSelectionParams(k);for(var i in k)if(i&&k.hasOwnProperty(i))wcAddParameter(link,
i,k[i]);link.jqobj=this._element;wcSubmitLink(link)}}}}; //# sourceURL=wccombo1.js
